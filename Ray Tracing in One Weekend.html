<html><head><meta charset="UTF-8"><meta http-equiv="content-type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=600, initial-scale=1"><style>body{max-width:680px;margin:auto;padding:20px;text-align:justify;line-height:140%;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;font-smoothing:antialiased;color:#222;font-family:Palatino,Georgia,"Times New Roman",serif}</style><style>@media print{*{-webkit-print-color-adjust:exact;text-shadow:none !important}}body{counter-reset: h1 paragraph line item list-item}@page{margin:0;size:auto}#mdContextMenu{position:absolute;background:#383838;cursor:default;border:1px solid #999;color:#fff;padding:4px 0px;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,"Helvetica Neue",sans-serif;font-size:85%;font-weight:600;border-radius:4px;box-shadow:0px 3px 10px rgba(0,0,0,35%)}#mdContextMenu div{padding:0px 20px}#mdContextMenu div:hover{background:#1659d1}.md code,.md pre{font-family:Menlo,Consolas,monospace;font-size:85%;text-align:left;line-height:140%}.md .mediumToc code,.md longToc code,.md .shortToc code,.md h1 code,.md h2 code,.md h3 code,.md h4 code,.md h5 code,.md h6 code{font-size:unset}.md div.title{font-size:26px;font-weight:800;line-height:120%;text-align:center}.md div.afterTitles{height:10px}.md div.subtitle{text-align:center}.md iframe.textinsert, .md object.textinsert,.md iframe:not(.markdeep){display:block;margin-top:10px;margin-bottom:10px;width:100%;height:75vh;border:1px solid #000;border-radius:4px;background:#f5f5f4}.md .image{display:inline-block}.md img{max-width:100%;page-break-inside:avoid}.md li{text-align:left;text-indent:0}.md pre.listing {width:100%;tab-size:4;-moz-tab-size:4;-o-tab-size:4;counter-reset:line;overflow-x:auto;resize:horizontal}.md pre.listing .linenumbers span.line:before{width:30px;margin-left:-28px;font-size:80%;text-align:right;counter-increment:line;content:counter(line);display:inline-block;padding-right:13px;margin-right:8px;color:#ccc}.md div.tilde{margin:20px 0 -10px;text-align:center}.md .imagecaption,.md .tablecaption,.md .listingcaption{display:inline-block;margin:7px 5px 12px;text-align:justify;font-style:italic}.md img.pixel{image-rendering:-moz-crisp-edges;image-rendering:pixelated}.md blockquote.fancyquote{margin:25px 0 25px;text-align:left;line-height:160%}.md blockquote.fancyquote::before{content:"“";color:#DDD;font-family:Times New Roman;font-size:45px;line-height:0;margin-right:6px;vertical-align:-0.3em}.md span.fancyquote{font-size:118%;color:#777;font-style:italic}.md span.fancyquote::after{content:"”";font-style:normal;color:#DDD;font-family:Times New Roman;font-size:45px;line-height:0;margin-left:6px;vertical-align:-0.3em}.md blockquote.fancyquote .author{width:100%;margin-top:10px;display:inline-block;text-align:right}.md small{font-size:60%}.md big{font-size:150%}.md div.title,contents,.md .tocHeader,.md h1,.md h2,.md h3,.md h4,.md h5,.md h6,.md .shortTOC,.md .mediumTOC,.nonumberh1,.nonumberh2,.nonumberh3,.nonumberh4,.nonumberh5,.nonumberh6{font-family:Verdana,Helvetica,Arial,sans-serif;margin:13.4px 0 13.4px;padding:15px 0 3px;border-top:none;clear:both}.md .tocTop {display:none}.md h1,.md h2,.md h3,.md h4,.md h5,.md h6,.md .nonumberh1,.md .nonumberh2,.md .nonumberh3,.md .nonumberh4,.md .nonumberh5,.md .nonumberh6{page-break-after:avoid;break-after:avoid}.md svg.diagram{display:block;font-family:Menlo,Consolas,monospace;font-size:85%;text-align:center;stroke-linecap:round;stroke-width:2px;page-break-inside:avoid;stroke:#000;fill:#000}.md svg.diagram .opendot{fill:#fff}.md svg.diagram .shadeddot{fill:#CCC}.md svg.diagram .dotteddot{stroke:#000;stroke-dasharray:4;fill:none}.md svg.diagram text{stroke:none}@media print{@page{margin:1in 5mm;transform: scale(150%)}}@media print{.md .pagebreak{page-break-after:always;visibility:hidden}}.md a{font-family:Georgia,Palatino,'Times New Roman'}.md h1,.md .tocHeader,.md .nonumberh1{border-bottom:3px solid;font-size:20px;font-weight:bold;}.md h1,.md .nonumberh1{counter-reset:h2 h3 h4 h5 h6}.md h2,.md .nonumberh2{counter-reset:h3 h4 h5 h6;border-bottom:2px solid #999;color:#555;font-weight:bold;font-size:18px;}.md h3,.md h4,.md h5,.md h6,.md .nonumberh3,.md .nonumberh4,.md .nonumberh5,.md .nonumberh6{font-family:Verdana,Helvetica,Arial,sans-serif;color:#555;font-size:16px;}.md h3{counter-reset:h4 h5 h6}.md h4{counter-reset:h5 h6}.md h5{counter-reset:h6}.md div.table{margin:16px 0 16px 0}.md table{border-collapse:collapse;line-height:140%;page-break-inside:avoid}.md table.table{margin:auto}.md table.calendar{width:100%;margin:auto;font-size:11px;font-family:Verdana,Helvetica,Arial,sans-serif}.md table.calendar th{font-size:16px}.md .today{background:#ECF8FA}.md .calendar .parenthesized{color:#999;font-style:italic}.md table.table th{color:#FFF;background-color:#AAA;border:1px solid #888;padding:8px 15px 8px 15px}.md table.table td{padding:5px 15px 5px 15px;border:1px solid #888}.md table.table tr:nth-child(even){background:#EEE}.md pre.tilde{border-top: 1px solid #CCC;border-bottom: 1px solid #CCC;padding: 5px 0 5px 20px;margin:0 0 0 0;background:#FCFCFC;page-break-inside:avoid}.md a.target{width:0px;height:0px;visibility:hidden;font-size:0px;display:inline-block}.md a:link, .md a:visited{color:#38A;text-decoration:none}.md a:link:hover{text-decoration:underline}.md dt{font-weight:700}.md dl>dd{margin-top:-8px; margin-bottom:8px}.md dl>table{margin:35px 0 30px}.md code{page-break-inside:avoid;} @media print{.md .listing code{white-space:pre-wrap}}.md .endnote{font-size:13px;line-height:15px;padding-left:10px;text-indent:-10px}.md .bib{padding-left:80px;text-indent:-80px;text-align:left}.markdeepFooter{font-size:9px;text-align:right;padding-top:80px;color:#999}.md .mediumTOC{float:right;font-size:12px;line-height:15px;border-left:1px solid #CCC;padding-left:15px;margin:15px 0px 15px 25px}.md .mediumTOC .level1{font-weight:600}.md .longTOC .level1{font-weight:600;display:block;padding-top:12px;margin:0 0 -20px}.md .shortTOC{text-align:center;font-weight:bold;margin-top:15px;font-size:14px}.md .admonition{position:relative;margin:1em 0;padding:.4rem 1rem;border-radius:.2rem;border-left:2.5rem solid rgba(68,138,255,.4);background-color:rgba(68,138,255,.15);}.md .admonition-title{font-weight:bold;border-bottom:solid 1px rgba(68,138,255,.4);padding-bottom:4px;margin-bottom:4px;margin-left: -1rem;padding-left:1rem;margin-right:-1rem;border-color:rgba(68,138,255,.4)}.md .admonition.tip{border-left:2.5rem solid rgba(50,255,90,.4);background-color:rgba(50,255,90,.15)}.md .admonition.tip::before{content:"\24d8";font-weight:bold;font-size:200%;position:relative;top:3px;color:rgba(26,128,46,.8);left:-2.95rem;display:block;width:0;height:0}.md .admonition.tip>.admonition-title{border-color:rgba(50,255,90,.4)}.md .admonition.warn,.md .admonition.warning{border-left:2.5rem solid rgba(255,145,0,.4);background-color:rgba(255,145,0,.15)}.md .admonition.warn::before,.md .admonition.warning::before{content:"\26A0";font-weight:bold;position:relative;top:2px;color:rgba(128,73,0,.8);left:-2.95rem;display:block;width:0;height:0}.md .admonition.warn>.admonition-title,.md .admonition.warning>.admonition-title{border-color:rgba(255,145,0,.4)}.md .admonition.error{border-left: 2.5rem solid rgba(255,23,68,.4);background-color:rgba(255,23,68,.15)}.md .admonition.error>.admonition-title{border-color:rgba(255,23,68,.4)}.md .admonition.error::before{content: "\2612";font-family:"Arial";font-size:150%;position:relative;color:rgba(128,12,34,.8);top:-2px;left:-3rem;display:block;width:0;height:0}.md .admonition p:last-child{margin-bottom:0}.md li.checked,.md li.unchecked{list-style:none;overflow:visible;text-indent:-1.2em}.md li.checked:before,.md li.unchecked:before{content:"\2611";display:block;float:left;width:1em;font-size:120%}.md li.unchecked:before{content:"\2610"}</style><style>.md h1::before {
content:counter(h1) " ";
counter-increment: h1;margin-right:10px}

.md h2::before {
content:counter(h1) "."counter(h2) " ";
counter-increment: h2;margin-right:10px}

.md h3::before {
content:counter(h1) "."counter(h2) "."counter(h3) " ";
counter-increment: h3;margin-right:10px}

.md h4::before {
content:counter(h1) "."counter(h2) "."counter(h3) "."counter(h4) " ";
counter-increment: h4;margin-right:10px}

.md h5::before {
content:counter(h1) "."counter(h2) "."counter(h3) "."counter(h4) "."counter(h5) " ";
counter-increment: h5;margin-right:10px}

.md h6::before {
content:counter(h1) "."counter(h2) "."counter(h3) "."counter(h4) "."counter(h5) "."counter(h6) " ";
counter-increment: h6;margin-right:10px}

</style><style>.hljs{display:block;overflow-x:auto;padding:0.5em;background:#fff;color:#000;-webkit-text-size-adjust:none}.hljs-comment{color:#006a00}.hljs-keyword{color:#02E}.hljs-literal,.nginx .hljs-title{color:#aa0d91}.method,.hljs-list .hljs-title,.hljs-tag .hljs-title,.setting .hljs-value,.hljs-winutils,.tex .hljs-command,.http .hljs-title,.hljs-request,.hljs-status,.hljs-name{color:#008}.hljs-envvar,.tex .hljs-special{color:#660}.hljs-string{color:#c41a16}.hljs-tag .hljs-value,.hljs-cdata,.hljs-filter .hljs-argument,.hljs-attr_selector,.apache .hljs-cbracket,.hljs-date,.hljs-regexp{color:#080}.hljs-sub .hljs-identifier,.hljs-pi,.hljs-tag,.hljs-tag .hljs-keyword,.hljs-decorator,.ini .hljs-title,.hljs-shebang,.hljs-prompt,.hljs-hexcolor,.hljs-rule .hljs-value,.hljs-symbol,.hljs-symbol .hljs-string,.hljs-number,.css .hljs-function,.hljs-function .hljs-title,.coffeescript .hljs-attribute{color:#A0C}.hljs-function .hljs-title{font-weight:bold;color:#000}.hljs-class .hljs-title,.smalltalk .hljs-class,.hljs-type,.hljs-typename,.hljs-tag .hljs-attribute,.hljs-doctype,.hljs-class .hljs-id,.hljs-built_in,.setting,.hljs-params,.clojure .hljs-attribute{color:#5c2699}.hljs-variable{color:#3f6e74}.css .hljs-tag,.hljs-rule .hljs-property,.hljs-pseudo,.hljs-subst{color:#000}.css .hljs-class,.css .hljs-id{color:#9b703f}.hljs-value .hljs-important{color:#ff7700;font-weight:bold}.hljs-rule .hljs-keyword{color:#c5af75}.hljs-annotation,.apache .hljs-sqbracket,.nginx .hljs-built_in{color:#9b859d}.hljs-preprocessor,.hljs-preprocessor *,.hljs-pragma{color:#643820}.tex .hljs-formula{background-color:#eee;font-style:italic}.diff .hljs-header,.hljs-chunk{color:#808080;font-weight:bold}.diff .hljs-change{background-color:#bccff9}.hljs-addition{background-color:#baeeba}.hljs-deletion{background-color:#ffc8bd}.hljs-comment .hljs-doctag{font-weight:bold}.method .hljs-id{color:#000}</style><style>div.title { padding-top: 40px; } div.afterTitles { height: 15px; }</style><meta charset="utf-8">
<link rel="icon" type="image/png" href="https://raytracing.github.io/favicon.png">
<!-- Markdeep: https://casual-effects.com/markdeep/ -->



                                   <script type="text/javascript" src="Ray%20Tracing%20in%20One%20Weekend_files/MathJax.js"></script><style type="text/css">.MathJax_Hover_Frame {border-radius: .25em; -webkit-border-radius: .25em; -moz-border-radius: .25em; -khtml-border-radius: .25em; box-shadow: 0px 0px 15px #83A; -webkit-box-shadow: 0px 0px 15px #83A; -moz-box-shadow: 0px 0px 15px #83A; -khtml-box-shadow: 0px 0px 15px #83A; border: 1px solid #A6D ! important; display: inline-block; position: absolute}
.MathJax_Menu_Button .MathJax_Hover_Arrow {position: absolute; cursor: pointer; display: inline-block; border: 2px solid #AAA; border-radius: 4px; -webkit-border-radius: 4px; -moz-border-radius: 4px; -khtml-border-radius: 4px; font-family: 'Courier New',Courier; font-size: 9px; color: #F0F0F0}
.MathJax_Menu_Button .MathJax_Hover_Arrow span {display: block; background-color: #AAA; border: 1px solid; border-radius: 3px; line-height: 0; padding: 4px}
.MathJax_Hover_Arrow:hover {color: white!important; border: 2px solid #CCC!important}
.MathJax_Hover_Arrow:hover span {background-color: #CCC!important}
</style><style type="text/css">#MathJax_About {position: fixed; left: 50%; width: auto; text-align: center; border: 3px outset; padding: 1em 2em; background-color: #DDDDDD; color: black; cursor: default; font-family: message-box; font-size: 120%; font-style: normal; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; border-radius: 15px; -webkit-border-radius: 15px; -moz-border-radius: 15px; -khtml-border-radius: 15px; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_About.MathJax_MousePost {outline: none}
.MathJax_Menu {position: absolute; background-color: white; color: black; width: auto; padding: 5px 0px; border: 1px solid #CCCCCC; margin: 0; cursor: default; font: menu; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; border-radius: 5px; -webkit-border-radius: 5px; -moz-border-radius: 5px; -khtml-border-radius: 5px; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
.MathJax_MenuItem {padding: 1px 2em; background: transparent}
.MathJax_MenuArrow {position: absolute; right: .5em; padding-top: .25em; color: #666666; font-size: .75em}
.MathJax_MenuActive .MathJax_MenuArrow {color: white}
.MathJax_MenuArrow.RTL {left: .5em; right: auto}
.MathJax_MenuCheck {position: absolute; left: .7em}
.MathJax_MenuCheck.RTL {right: .7em; left: auto}
.MathJax_MenuRadioCheck {position: absolute; left: .7em}
.MathJax_MenuRadioCheck.RTL {right: .7em; left: auto}
.MathJax_MenuLabel {padding: 1px 2em 3px 1.33em; font-style: italic}
.MathJax_MenuRule {border-top: 1px solid #DDDDDD; margin: 4px 3px}
.MathJax_MenuDisabled {color: GrayText}
.MathJax_MenuActive {background-color: #606872; color: white}
.MathJax_MenuDisabled:focus, .MathJax_MenuLabel:focus {background-color: #E8E8E8}
.MathJax_ContextMenu:focus {outline: none}
.MathJax_ContextMenu .MathJax_MenuItem:focus {outline: none}
#MathJax_AboutClose {top: .2em; right: .2em}
.MathJax_Menu .MathJax_MenuClose {top: -10px; left: -10px}
.MathJax_MenuClose {position: absolute; cursor: pointer; display: inline-block; border: 2px solid #AAA; border-radius: 18px; -webkit-border-radius: 18px; -moz-border-radius: 18px; -khtml-border-radius: 18px; font-family: 'Courier New',Courier; font-size: 24px; color: #F0F0F0}
.MathJax_MenuClose span {display: block; background-color: #AAA; border: 1.5px solid; border-radius: 18px; -webkit-border-radius: 18px; -moz-border-radius: 18px; -khtml-border-radius: 18px; line-height: 0; padding: 8px 0 6px}
.MathJax_MenuClose:hover {color: white!important; border: 2px solid #CCC!important}
.MathJax_MenuClose:hover span {background-color: #CCC!important}
.MathJax_MenuClose:hover:focus {outline: none}
</style><style type="text/css">.MathJax_Preview .MJXf-math {color: inherit!important}
</style><style type="text/css">.MJX_Assistive_MathML {position: absolute!important; top: 0; left: 0; clip: rect(1px, 1px, 1px, 1px); padding: 1px 0 0 0!important; border: 0!important; height: 1px!important; width: 1px!important; overflow: hidden!important; display: block!important; -webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none}
.MJX_Assistive_MathML.MJX_Assistive_MathML_Block {width: 100%!important}
</style><style type="text/css">#MathJax_Zoom {position: absolute; background-color: #F0F0F0; overflow: auto; display: block; z-index: 301; padding: .5em; border: 1px solid black; margin: 0; font-weight: normal; font-style: normal; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; -webkit-box-sizing: content-box; -moz-box-sizing: content-box; box-sizing: content-box; box-shadow: 5px 5px 15px #AAAAAA; -webkit-box-shadow: 5px 5px 15px #AAAAAA; -moz-box-shadow: 5px 5px 15px #AAAAAA; -khtml-box-shadow: 5px 5px 15px #AAAAAA; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_ZoomOverlay {position: absolute; left: 0; top: 0; z-index: 300; display: inline-block; width: 100%; height: 100%; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
#MathJax_ZoomFrame {position: relative; display: inline-block; height: 0; width: 0}
#MathJax_ZoomEventTrap {position: absolute; left: 0; top: 0; z-index: 302; display: inline-block; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
</style><style type="text/css">.MathJax_Preview {color: #888}
#MathJax_Message {position: fixed; left: 1px; bottom: 2px; background-color: #E6E6E6; border: 1px solid #959595; margin: 0px; padding: 2px 8px; z-index: 102; color: black; font-size: 80%; width: auto; white-space: nowrap}
#MathJax_MSIE_Frame {position: absolute; top: 0; left: 0; width: 0px; z-index: 101; border: 0px; margin: 0px; padding: 0px}
.MathJax_Error {color: #CC0000; font-style: italic}
</style><style type="text/css">.MJXp-script {font-size: .8em}
.MJXp-right {-webkit-transform-origin: right; -moz-transform-origin: right; -ms-transform-origin: right; -o-transform-origin: right; transform-origin: right}
.MJXp-bold {font-weight: bold}
.MJXp-italic {font-style: italic}
.MJXp-scr {font-family: MathJax_Script,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-frak {font-family: MathJax_Fraktur,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-sf {font-family: MathJax_SansSerif,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-cal {font-family: MathJax_Caligraphic,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-mono {font-family: MathJax_Typewriter,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-largeop {font-size: 150%}
.MJXp-largeop.MJXp-int {vertical-align: -.2em}
.MJXp-math {display: inline-block; line-height: 1.2; text-indent: 0; font-family: 'Times New Roman',Times,STIXGeneral,serif; white-space: nowrap; border-collapse: collapse}
.MJXp-display {display: block; text-align: center; margin: 1em 0}
.MJXp-math span {display: inline-block}
.MJXp-box {display: block!important; text-align: center}
.MJXp-box:after {content: " "}
.MJXp-rule {display: block!important; margin-top: .1em}
.MJXp-char {display: block!important}
.MJXp-mo {margin: 0 .15em}
.MJXp-mfrac {margin: 0 .125em; vertical-align: .25em}
.MJXp-denom {display: inline-table!important; width: 100%}
.MJXp-denom > * {display: table-row!important}
.MJXp-surd {vertical-align: top}
.MJXp-surd > * {display: block!important}
.MJXp-script-box > *  {display: table!important; height: 50%}
.MJXp-script-box > * > * {display: table-cell!important; vertical-align: top}
.MJXp-script-box > *:last-child > * {vertical-align: bottom}
.MJXp-script-box > * > * > * {display: block!important}
.MJXp-mphantom {visibility: hidden}
.MJXp-munderover, .MJXp-munder {display: inline-table!important}
.MJXp-over {display: inline-block!important; text-align: center}
.MJXp-over > * {display: block!important}
.MJXp-munderover > *, .MJXp-munder > * {display: table-row!important}
.MJXp-mtable {vertical-align: .25em; margin: 0 .125em}
.MJXp-mtable > * {display: inline-table!important; vertical-align: middle}
.MJXp-mtr {display: table-row!important}
.MJXp-mtd {display: table-cell!important; text-align: center; padding: .5em 0 0 .5em}
.MJXp-mtr > .MJXp-mtd:first-child {padding-left: 0}
.MJXp-mtr:first-child > .MJXp-mtd {padding-top: 0}
.MJXp-mlabeledtr {display: table-row!important}
.MJXp-mlabeledtr > .MJXp-mtd:first-child {padding-left: 0}
.MJXp-mlabeledtr:first-child > .MJXp-mtd {padding-top: 0}
.MJXp-merror {background-color: #FFFF88; color: #CC0000; border: 1px solid #CC0000; padding: 1px 3px; font-style: normal; font-size: 90%}
.MJXp-scale0 {-webkit-transform: scaleX(.0); -moz-transform: scaleX(.0); -ms-transform: scaleX(.0); -o-transform: scaleX(.0); transform: scaleX(.0)}
.MJXp-scale1 {-webkit-transform: scaleX(.1); -moz-transform: scaleX(.1); -ms-transform: scaleX(.1); -o-transform: scaleX(.1); transform: scaleX(.1)}
.MJXp-scale2 {-webkit-transform: scaleX(.2); -moz-transform: scaleX(.2); -ms-transform: scaleX(.2); -o-transform: scaleX(.2); transform: scaleX(.2)}
.MJXp-scale3 {-webkit-transform: scaleX(.3); -moz-transform: scaleX(.3); -ms-transform: scaleX(.3); -o-transform: scaleX(.3); transform: scaleX(.3)}
.MJXp-scale4 {-webkit-transform: scaleX(.4); -moz-transform: scaleX(.4); -ms-transform: scaleX(.4); -o-transform: scaleX(.4); transform: scaleX(.4)}
.MJXp-scale5 {-webkit-transform: scaleX(.5); -moz-transform: scaleX(.5); -ms-transform: scaleX(.5); -o-transform: scaleX(.5); transform: scaleX(.5)}
.MJXp-scale6 {-webkit-transform: scaleX(.6); -moz-transform: scaleX(.6); -ms-transform: scaleX(.6); -o-transform: scaleX(.6); transform: scaleX(.6)}
.MJXp-scale7 {-webkit-transform: scaleX(.7); -moz-transform: scaleX(.7); -ms-transform: scaleX(.7); -o-transform: scaleX(.7); transform: scaleX(.7)}
.MJXp-scale8 {-webkit-transform: scaleX(.8); -moz-transform: scaleX(.8); -ms-transform: scaleX(.8); -o-transform: scaleX(.8); transform: scaleX(.8)}
.MJXp-scale9 {-webkit-transform: scaleX(.9); -moz-transform: scaleX(.9); -ms-transform: scaleX(.9); -o-transform: scaleX(.9); transform: scaleX(.9)}
.MathJax_PHTML .noError {vertical-align: ; font-size: 90%; text-align: left; color: black; padding: 1px 3px; border: 1px solid}
</style><style type="text/css">.MathJax_Display {text-align: center; margin: 1em 0em; position: relative; display: block!important; text-indent: 0; max-width: none; max-height: none; min-width: 0; min-height: 0; width: 100%}
.MathJax .merror {background-color: #FFFF88; color: #CC0000; border: 1px solid #CC0000; padding: 1px 3px; font-style: normal; font-size: 90%}
.MathJax .MJX-monospace {font-family: monospace}
.MathJax .MJX-sans-serif {font-family: sans-serif}
#MathJax_Tooltip {background-color: InfoBackground; color: InfoText; border: 1px solid black; box-shadow: 2px 2px 5px #AAAAAA; -webkit-box-shadow: 2px 2px 5px #AAAAAA; -moz-box-shadow: 2px 2px 5px #AAAAAA; -khtml-box-shadow: 2px 2px 5px #AAAAAA; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true'); padding: 3px 4px; z-index: 401; position: absolute; left: 0; top: 0; width: auto; height: auto; display: none}
.MathJax {display: inline; font-style: normal; font-weight: normal; line-height: normal; font-size: 100%; font-size-adjust: none; text-indent: 0; text-align: left; text-transform: none; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0; min-height: 0; border: 0; padding: 0; margin: 0}
.MathJax:focus, body :focus .MathJax {display: inline-table}
.MathJax.MathJax_FullWidth {text-align: center; display: table-cell!important; width: 10000em!important}
.MathJax img, .MathJax nobr, .MathJax a {border: 0; padding: 0; margin: 0; max-width: none; max-height: none; min-width: 0; min-height: 0; vertical-align: 0; line-height: normal; text-decoration: none}
img.MathJax_strut {border: 0!important; padding: 0!important; margin: 0!important; vertical-align: 0!important}
.MathJax span {display: inline; position: static; border: 0; padding: 0; margin: 0; vertical-align: 0; line-height: normal; text-decoration: none; box-sizing: content-box}
.MathJax nobr {white-space: nowrap!important}
.MathJax img {display: inline!important; float: none!important}
.MathJax * {transition: none; -webkit-transition: none; -moz-transition: none; -ms-transition: none; -o-transition: none}
.MathJax_Processing {visibility: hidden; position: fixed; width: 0; height: 0; overflow: hidden}
.MathJax_Processed {display: none!important}
.MathJax_test {font-style: normal; font-weight: normal; font-size: 100%; font-size-adjust: none; text-indent: 0; text-transform: none; letter-spacing: normal; word-spacing: normal; overflow: hidden; height: 1px}
.MathJax_test.mjx-test-display {display: table!important}
.MathJax_test.mjx-test-inline {display: inline!important; margin-right: -1px}
.MathJax_test.mjx-test-default {display: block!important; clear: both}
.MathJax_ex_box {display: inline-block!important; position: absolute; overflow: hidden; min-height: 0; max-height: none; padding: 0; border: 0; margin: 0; width: 1px; height: 60ex}
.MathJax_em_box {display: inline-block!important; position: absolute; overflow: hidden; min-height: 0; max-height: none; padding: 0; border: 0; margin: 0; width: 1px; height: 60em}
.mjx-test-inline .MathJax_left_box {display: inline-block; width: 0; float: left}
.mjx-test-inline .MathJax_right_box {display: inline-block; width: 0; float: right}
.mjx-test-display .MathJax_right_box {display: table-cell!important; width: 10000em!important; min-width: 0; max-width: none; padding: 0; border: 0; margin: 0}
.MathJax .MathJax_HitBox {cursor: text; background: white; opacity: 0; filter: alpha(opacity=0)}
.MathJax .MathJax_HitBox * {filter: none; opacity: 1; background: transparent}
#MathJax_Tooltip * {filter: none; opacity: 1; background: transparent}
@font-face {font-family: MathJax_Main; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/fonts/HTML-CSS/TeX/woff/MathJax_Main-Regular.woff?V=2.7.6') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/fonts/HTML-CSS/TeX/otf/MathJax_Main-Regular.otf?V=2.7.6') format('opentype')}
@font-face {font-family: MathJax_Main; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/fonts/HTML-CSS/TeX/woff/MathJax_Main-Bold.woff?V=2.7.6') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/fonts/HTML-CSS/TeX/otf/MathJax_Main-Bold.otf?V=2.7.6') format('opentype'); font-weight: bold}
@font-face {font-family: MathJax_Main; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/fonts/HTML-CSS/TeX/woff/MathJax_Main-Italic.woff?V=2.7.6') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/fonts/HTML-CSS/TeX/otf/MathJax_Main-Italic.otf?V=2.7.6') format('opentype'); font-style: italic}
@font-face {font-family: MathJax_Math; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/fonts/HTML-CSS/TeX/woff/MathJax_Math-Italic.woff?V=2.7.6') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/fonts/HTML-CSS/TeX/otf/MathJax_Math-Italic.otf?V=2.7.6') format('opentype'); font-style: italic}
@font-face {font-family: MathJax_Caligraphic; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/fonts/HTML-CSS/TeX/woff/MathJax_Caligraphic-Regular.woff?V=2.7.6') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/fonts/HTML-CSS/TeX/otf/MathJax_Caligraphic-Regular.otf?V=2.7.6') format('opentype')}
@font-face {font-family: MathJax_Size1; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/fonts/HTML-CSS/TeX/woff/MathJax_Size1-Regular.woff?V=2.7.6') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/fonts/HTML-CSS/TeX/otf/MathJax_Size1-Regular.otf?V=2.7.6') format('opentype')}
@font-face {font-family: MathJax_Size2; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/fonts/HTML-CSS/TeX/woff/MathJax_Size2-Regular.woff?V=2.7.6') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/fonts/HTML-CSS/TeX/otf/MathJax_Size2-Regular.otf?V=2.7.6') format('opentype')}
@font-face {font-family: MathJax_Size3; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/fonts/HTML-CSS/TeX/woff/MathJax_Size3-Regular.woff?V=2.7.6') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/fonts/HTML-CSS/TeX/otf/MathJax_Size3-Regular.otf?V=2.7.6') format('opentype')}
@font-face {font-family: MathJax_Size4; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/fonts/HTML-CSS/TeX/woff/MathJax_Size4-Regular.woff?V=2.7.6') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/fonts/HTML-CSS/TeX/otf/MathJax_Size4-Regular.otf?V=2.7.6') format('opentype')}
.MathJax .noError {vertical-align: ; font-size: 90%; text-align: left; color: black; padding: 1px 3px; border: 1px solid}
</style><style type="text/css">@font-face {font-family: MathJax_AMS; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/fonts/HTML-CSS/TeX/woff/MathJax_AMS-Regular.woff?V=2.7.6') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/fonts/HTML-CSS/TeX/otf/MathJax_AMS-Regular.otf?V=2.7.6') format('opentype')}
</style></head><body style="visibility: visible;" id="md" class=""><div style="visibility: hidden; overflow: hidden; position: absolute; top: 0px; height: 1px; width: auto; padding: 0px; border: 0px; margin: 0px; text-align: left; text-indent: 0px; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal;"><div id="MathJax_Hidden"><br></div></div><div id="MathJax_Message" style="display: none;"></div><script type="text/x-mathjax-config;executed=true">MathJax.Hub.Config({ TeX: { equationNumbers: {autoNumber: "AMS"} } });</script><span style="display:none"><span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-1-Frame" tabindex="0" style="text-align: center; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot; /&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1" style="width: 0em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(3.831em, 1000em, 4.133em, -1000em); top: -3.982em; left: 0em;"><span class="mrow" id="MathJax-Span-2"></span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.063em; border-left: 0px solid; width: 0px; height: 0.125em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-1">\newcommand{\n}{\hat{n}}\newcommand{\thetai}{\theta_\mathrm{i}}\newcommand{\thetao}{\theta_\mathrm{o}}\newcommand{\d}[1]{\mathrm{d}#1}\newcommand{\w}{\hat{\omega}}\newcommand{\wi}{\w_\mathrm{i}}\newcommand{\wo}{\w_\mathrm{o}}\newcommand{\wh}{\w_\mathrm{h}}\newcommand{\Li}{L_\mathrm{i}}\newcommand{\Lo}{L_\mathrm{o}}\newcommand{\Le}{L_\mathrm{e}}\newcommand{\Lr}{L_\mathrm{r}}\newcommand{\Lt}{L_\mathrm{t}}\newcommand{\O}{\mathrm{O}}\newcommand{\degrees}{{^{\large\circ}}}\newcommand{\T}{\mathsf{T}}\newcommand{\mathset}[1]{\mathbb{#1}}\newcommand{\Real}{\mathset{R}}\newcommand{\Integer}{\mathset{Z}}\newcommand{\Boolean}{\mathset{B}}\newcommand{\Complex}{\mathset{C}}\newcommand{\un}[1]{\,\mathrm{#1}}</script>
</span>
<span class="md"><p><title>Ray Tracing in One Weekend</title></p><div class="title"> Ray Tracing in One Weekend </div>

<div class="subtitle"> <a href="https://github.com/petershirley">Peter Shirley</a>, <a href="https://github.com/trevordblack">Trevor David Black</a>, <a href="https://github.com/hollasch">Steve Hollasch</a> </div>
<div class="subtitle"> <br> </div>
<div class="subtitle"> Version 4.0.0-alpha.1, 2023-08-06 </div>
<div class="subtitle"> <br> </div>
<div class="subtitle"> Copyright 2018-2023 Peter Shirley. All rights reserved. </div>
<div class="afterTitles"></div>

<p></p>
<div class="longTOC"><div class="tocHeader">Contents</div><p><a href="#" class="tocTop">(Top)</a><br>
<a href="#overview" class="level1"><span class="tocNumber">1&nbsp; </span>Overview</a><br>
<a href="#outputanimage" class="level1"><span class="tocNumber">2&nbsp; </span>Output an Image</a><br>
&nbsp;&nbsp;<a href="#outputanimage/theppmimageformat" class="level2"><span class="tocNumber">2.1&nbsp; </span>The PPM Image Format</a><br>
&nbsp;&nbsp;<a href="#outputanimage/creatinganimagefile" class="level2"><span class="tocNumber">2.2&nbsp; </span>Creating an Image File</a><br>
&nbsp;&nbsp;<a href="#outputanimage/addingaprogressindicator" class="level2"><span class="tocNumber">2.3&nbsp; </span>Adding a Progress Indicator</a><br>
<a href="#thevec3class" class="level1"><span class="tocNumber">3&nbsp; </span>The vec3 Class</a><br>
&nbsp;&nbsp;<a href="#thevec3class/colorutilityfunctions" class="level2"><span class="tocNumber">3.1&nbsp; </span>Color Utility Functions</a><br>
<a href="#rays,asimplecamera,andbackground" class="level1"><span class="tocNumber">4&nbsp; </span>Rays, a Simple Camera, and Background</a><br>
&nbsp;&nbsp;<a href="#rays,asimplecamera,andbackground/therayclass" class="level2"><span class="tocNumber">4.1&nbsp; </span>The ray Class</a><br>
&nbsp;&nbsp;<a href="#rays,asimplecamera,andbackground/sendingraysintothescene" class="level2"><span class="tocNumber">4.2&nbsp; </span>Sending Rays Into the Scene</a><br>
<a href="#addingasphere" class="level1"><span class="tocNumber">5&nbsp; </span>Adding a Sphere</a><br>
&nbsp;&nbsp;<a href="#addingasphere/ray-sphereintersection" class="level2"><span class="tocNumber">5.1&nbsp; </span>Ray-Sphere Intersection</a><br>
&nbsp;&nbsp;<a href="#addingasphere/creatingourfirstraytracedimage" class="level2"><span class="tocNumber">5.2&nbsp; </span>Creating Our First Raytraced Image</a><br>
<a href="#surfacenormalsandmultipleobjects" class="level1"><span class="tocNumber">6&nbsp; </span>Surface Normals and Multiple Objects</a><br>
&nbsp;&nbsp;<a href="#surfacenormalsandmultipleobjects/shadingwithsurfacenormals" class="level2"><span class="tocNumber">6.1&nbsp; </span>Shading with Surface Normals</a><br>
&nbsp;&nbsp;<a href="#surfacenormalsandmultipleobjects/simplifyingtheray-sphereintersectioncode" class="level2"><span class="tocNumber">6.2&nbsp; </span>Simplifying the Ray-Sphere Intersection Code</a><br>
&nbsp;&nbsp;<a href="#surfacenormalsandmultipleobjects/anabstractionforhittableobjects" class="level2"><span class="tocNumber">6.3&nbsp; </span>An Abstraction for Hittable Objects</a><br>
&nbsp;&nbsp;<a href="#surfacenormalsandmultipleobjects/frontfacesversusbackfaces" class="level2"><span class="tocNumber">6.4&nbsp; </span>Front Faces Versus Back Faces</a><br>
&nbsp;&nbsp;<a href="#surfacenormalsandmultipleobjects/alistofhittableobjects" class="level2"><span class="tocNumber">6.5&nbsp; </span>A List of Hittable Objects</a><br>
&nbsp;&nbsp;<a href="#surfacenormalsandmultipleobjects/somenewc++features" class="level2"><span class="tocNumber">6.6&nbsp; </span>Some New C++ Features</a><br>
&nbsp;&nbsp;<a href="#surfacenormalsandmultipleobjects/commonconstantsandutilityfunctions" class="level2"><span class="tocNumber">6.7&nbsp; </span>Common Constants and Utility Functions</a><br>
&nbsp;&nbsp;<a href="#surfacenormalsandmultipleobjects/anintervalclass" class="level2"><span class="tocNumber">6.8&nbsp; </span>An Interval Class</a><br>
<a href="#movingcameracodeintoitsownclass" class="level1"><span class="tocNumber">7&nbsp; </span>Moving Camera Code Into Its Own Class</a><br>
<a href="#antialiasing" class="level1"><span class="tocNumber">8&nbsp; </span>Antialiasing</a><br>
&nbsp;&nbsp;<a href="#antialiasing/somerandomnumberutilities" class="level2"><span class="tocNumber">8.1&nbsp; </span>Some Random Number Utilities</a><br>
&nbsp;&nbsp;<a href="#antialiasing/generatingpixelswithmultiplesamples" class="level2"><span class="tocNumber">8.2&nbsp; </span>Generating Pixels with Multiple Samples</a><br>
<a href="#diffusematerials" class="level1"><span class="tocNumber">9&nbsp; </span>Diffuse Materials</a><br>
&nbsp;&nbsp;<a href="#diffusematerials/asimplediffusematerial" class="level2"><span class="tocNumber">9.1&nbsp; </span>A Simple Diffuse Material</a><br>
&nbsp;&nbsp;<a href="#diffusematerials/limitingthenumberofchildrays" class="level2"><span class="tocNumber">9.2&nbsp; </span>Limiting the Number of Child Rays</a><br>
&nbsp;&nbsp;<a href="#diffusematerials/fixingshadowacne" class="level2"><span class="tocNumber">9.3&nbsp; </span>Fixing Shadow Acne</a><br>
&nbsp;&nbsp;<a href="#diffusematerials/truelambertianreflection" class="level2"><span class="tocNumber">9.4&nbsp; </span>True Lambertian Reflection</a><br>
&nbsp;&nbsp;<a href="#diffusematerials/usinggammacorrectionforaccuratecolorintensity" class="level2"><span class="tocNumber">9.5&nbsp; </span>Using Gamma Correction for Accurate Color Intensity</a><br>
<a href="#metal" class="level1"><span class="tocNumber">10&nbsp; </span>Metal</a><br>
&nbsp;&nbsp;<a href="#metal/anabstractclassformaterials" class="level2"><span class="tocNumber">10.1&nbsp; </span>An Abstract Class for Materials</a><br>
&nbsp;&nbsp;<a href="#metal/adatastructuretodescriberay-objectintersections" class="level2"><span class="tocNumber">10.2&nbsp; </span>A Data Structure to Describe Ray-Object Intersections</a><br>
&nbsp;&nbsp;<a href="#metal/modelinglightscatterandreflectance" class="level2"><span class="tocNumber">10.3&nbsp; </span>Modeling Light Scatter and Reflectance</a><br>
&nbsp;&nbsp;<a href="#metal/mirroredlightreflection" class="level2"><span class="tocNumber">10.4&nbsp; </span>Mirrored Light Reflection</a><br>
&nbsp;&nbsp;<a href="#metal/ascenewithmetalspheres" class="level2"><span class="tocNumber">10.5&nbsp; </span>A Scene with Metal Spheres</a><br>
&nbsp;&nbsp;<a href="#metal/fuzzyreflection" class="level2"><span class="tocNumber">10.6&nbsp; </span>Fuzzy Reflection</a><br>
<a href="#dielectrics" class="level1"><span class="tocNumber">11&nbsp; </span>Dielectrics</a><br>
&nbsp;&nbsp;<a href="#dielectrics/refraction" class="level2"><span class="tocNumber">11.1&nbsp; </span>Refraction</a><br>
&nbsp;&nbsp;<a href="#dielectrics/snell'slaw" class="level2"><span class="tocNumber">11.2&nbsp; </span>Snell's Law</a><br>
&nbsp;&nbsp;<a href="#dielectrics/totalinternalreflection" class="level2"><span class="tocNumber">11.3&nbsp; </span>Total Internal Reflection</a><br>
&nbsp;&nbsp;<a href="#dielectrics/schlickapproximation" class="level2"><span class="tocNumber">11.4&nbsp; </span>Schlick Approximation</a><br>
&nbsp;&nbsp;<a href="#dielectrics/modelingahollowglasssphere" class="level2"><span class="tocNumber">11.5&nbsp; </span>Modeling a Hollow Glass Sphere</a><br>
<a href="#positionablecamera" class="level1"><span class="tocNumber">12&nbsp; </span>Positionable Camera</a><br>
&nbsp;&nbsp;<a href="#positionablecamera/cameraviewinggeometry" class="level2"><span class="tocNumber">12.1&nbsp; </span>Camera Viewing Geometry</a><br>
&nbsp;&nbsp;<a href="#positionablecamera/positioningandorientingthecamera" class="level2"><span class="tocNumber">12.2&nbsp; </span>Positioning and Orienting the Camera</a><br>
<a href="#defocusblur" class="level1"><span class="tocNumber">13&nbsp; </span>Defocus Blur</a><br>
&nbsp;&nbsp;<a href="#defocusblur/athinlensapproximation" class="level2"><span class="tocNumber">13.1&nbsp; </span>A Thin Lens Approximation</a><br>
&nbsp;&nbsp;<a href="#defocusblur/generatingsamplerays" class="level2"><span class="tocNumber">13.2&nbsp; </span>Generating Sample Rays</a><br>
<a href="#wherenext?" class="level1"><span class="tocNumber">14&nbsp; </span>Where Next?</a><br>
&nbsp;&nbsp;<a href="#wherenext?/afinalrender" class="level2"><span class="tocNumber">14.1&nbsp; </span>A Final Render</a><br>
&nbsp;&nbsp;<a href="#wherenext?/nextsteps" class="level2"><span class="tocNumber">14.2&nbsp; </span>Next Steps</a><br>
<a href="#acknowledgments" class="level1"><span class="tocNumber">15&nbsp; </span>Acknowledgments</a><br>
<a href="#citingthisbook" class="level1"><span class="tocNumber">16&nbsp; </span>Citing This Book</a><br>
&nbsp;&nbsp;<a href="#citingthisbook/basicdata" class="level2"><span class="tocNumber">16.1&nbsp; </span>Basic Data</a><br>
&nbsp;&nbsp;<a href="#citingthisbook/snippets" class="level2"><span class="tocNumber">16.2&nbsp; </span>Snippets</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#citingthisbook/snippets/markdown" class="level3"><span class="tocNumber">16.2.1&nbsp; </span>Markdown</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#citingthisbook/snippets/html" class="level3"><span class="tocNumber">16.2.2&nbsp; </span>HTML</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#citingthisbook/snippets/latexandbibtex" class="level3"><span class="tocNumber">16.2.3&nbsp; </span>LaTeX and BibTex</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#citingthisbook/snippets/biblatex" class="level3"><span class="tocNumber">16.2.4&nbsp; </span>BibLaTeX</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#citingthisbook/snippets/ieee" class="level3"><span class="tocNumber">16.2.5&nbsp; </span>IEEE</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#citingthisbook/snippets/mla:" class="level3"><span class="tocNumber">16.2.6&nbsp; </span>MLA:</a><br>
</p></div><a class="target" name="overview">&nbsp;</a><a class="target" name="overview">&nbsp;</a><a class="target" name="toc1">&nbsp;</a><h1>Overview</h1>
<p>

I’ve taught many graphics classes over the years. Often I do them in ray tracing, because you are
forced to write all the code, but you can still get cool images with no API. I decided to adapt my
course notes into a how-to, to get you to a cool program as quickly as possible. It will not be a
full-featured ray tracer, but it does have the indirect lighting which has made ray tracing a staple
in movies. Follow these steps, and the architecture of the ray tracer you produce will be good for
extending to a more extensive ray tracer if you get excited and want to pursue that.

</p><p>

When somebody says “ray tracing” it could mean many things. What I am going to describe is
technically a path tracer, and a fairly general one. While the code will be pretty simple (let the
computer do the work!) I think you’ll be very happy with the images you can make.

</p><p>

I’ll take you through writing a ray tracer in the order I do it, along with some debugging tips. By
the end, you will have a ray tracer that produces some great images. You should be able to do this
in a weekend. If you take longer, don’t worry about it. I use C++ as the driving language, but you
don’t need to. However, I suggest you do, because it’s fast, portable, and most production movie and
video game renderers are written in C++. Note that I avoid most “modern features” of C++, but
inheritance and operator overloading are too useful for ray tracers to pass on.
</p><blockquote>
 I do not provide the code online, but the code is real and I show all of it except for a few
 straightforward operators in the <code>vec3</code> class. I am a big believer in typing in code to learn it,
 but when code is available I use it, so I only practice what I preach when the code is not
 available. So don’t ask!</blockquote>

<p></p><p>

I have left that last part in because it is funny what a 180 I have done. Several readers ended up
with subtle errors that were helped when we compared code. So please do type in the code, but you
can find the finished source for each book in the <a href="https://github.com/RayTracing/raytracing.github.io/">RayTracing project on GitHub</a>.

</p><p>

A note on the implementing code for these books — our philosophy for the included code prioritizes
the following goals:

</p><p>

</p><ul>
  <li class="minus">The code should implement the concepts covered in the books.

<p></p><p>

</p></li>
  <li class="minus">We use C++, but as simple as possible. Our programming style is very C-like, but we take
      advantage of modern features where it makes the code easier to use or understand.

<p></p><p>

</p></li>
  <li class="minus">Our coding style continues the style established from the original books as much as possible,
      for continuity.

<p></p><p>

</p></li>
  <li class="minus">Line length is kept to 96 characters per line, to keep lines consistent between the codebase and
      code listings in the books.</li></ul>

<p></p><p>

The code thus provides a baseline implementation, with tons of improvements left for the reader to
enjoy. There are endless ways one can optimize and modernize the code; we prioritize the simple
solution.

</p><p>

We assume a little bit of familiarity with vectors (like dot product and vector addition). If you
don’t know that, do a little review. If you need that review, or to learn it for the first time,
check out the online <a href="https://graphicscodex.com/"><em class="underscore">Graphics Codex</em></a> by Morgan McGuire, <em class="underscore">Fundamentals of Computer
Graphics</em> by Steve Marschner and Peter Shirley, or <em class="underscore">Fundamentals of Interactive Computer Graphics</em>
by J.D. Foley and Andy Van Dam.

</p><p>

Peter maintains a site related to this book series at <a href="https://in1weekend.blogspot.com/," class="url">https://in1weekend.blogspot.com/,</a> which
includes further reading and links to resources.

</p><p>

If you want to communicate with us, feel free to send us an email at:

</p><p>

</p><ul>
  <li class="minus">Peter Shirley, <a href="mailto:ptrshrl@gmail.com">ptrshrl@gmail.com</a>
</li>
  <li class="minus">Steve Hollasch, <a href="mailto:steve@hollasch.net">steve@hollasch.net</a>
</li>
  <li class="minus">Trevor David Black, <a href="mailto:trevordblack@trevord.black">trevordblack@trevord.black</a></li></ul>

<p></p><p>

Finally, if you run into problems with your implementation, have general questions, or would like to
share your own ideas or work, see <a href="https://github.com/RayTracing/raytracing.github.io/discussions/">the GitHub Discussions forum</a> on the GitHub project.

</p><p>

Thanks to everyone who lent a hand on this project. You can find them in the <a href="#acknowledgments">acknowledgments</a> section
at the end of this book.

</p><p>

Let’s get on with it!

</p>
<a class="target" name="outputanimage">&nbsp;</a><a class="target" name="outputanimage">&nbsp;</a><a class="target" name="toc2">&nbsp;</a><h1>Output an Image</h1>

<a class="target" name="theppmimageformat">&nbsp;</a><a class="target" name="outputanimage/theppmimageformat">&nbsp;</a><a class="target" name="toc2.1">&nbsp;</a><h2>The PPM Image Format</h2>
<p>

Whenever you start a renderer, you need a way to see an image. The most straightforward way is to
write it to a file. The catch is, there are so many formats. Many of those are complex. I always
start with a plain text ppm file. Here’s a nice description from Wikipedia:

</p><p>

  </p><center><div class="image" style=""><a href="https://raytracing.github.io/images/fig-1.01-ppm.jpg" target="_blank"><img class="markdeep" src="Ray%20Tracing%20in%20One%20Weekend_files/fig-1.01-ppm.jpg"></a><center><span class="imagecaption"><a class="target" name="figure_ppm">&nbsp;</a><b style="font-style:normal;">Figure&nbsp;1:</b> PPM Example</span></center></div></center>

<p></p><p>

</p><div class="together">
Let’s make some C++ code to output such a thing:

<p></p><pre class="listing tilde"><code><span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>
<span class="line"></span>
<span class="line"></span><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
<span class="line"></span>
<span class="line"></span>    <span class="hljs-comment">// Image</span>
<span class="line"></span>
<span class="line"></span>    <span class="hljs-type">int</span> image_width = <span class="hljs-number">256</span>;
<span class="line"></span>    <span class="hljs-type">int</span> image_height = <span class="hljs-number">256</span>;
<span class="line"></span>
<span class="line"></span>    <span class="hljs-comment">// Render</span>
<span class="line"></span>
<span class="line"></span>    std::cout &lt;&lt; <span class="hljs-string">"P3\n"</span> &lt;&lt; image_width &lt;&lt; <span class="hljs-string">' '</span> &lt;&lt; image_height &lt;&lt; <span class="hljs-string">"\n255\n"</span>;
<span class="line"></span>
<span class="line"></span>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> j = <span class="hljs-number">0</span>; j &lt; image_height; ++j) {
<span class="line"></span>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; image_width; ++i) {
<span class="line"></span>            <span class="hljs-keyword">auto</span> r = <span class="hljs-built_in">double</span>(i) / (image_width<span class="hljs-number">-1</span>);
<span class="line"></span>            <span class="hljs-keyword">auto</span> g = <span class="hljs-built_in">double</span>(j) / (image_height<span class="hljs-number">-1</span>);
<span class="line"></span>            <span class="hljs-keyword">auto</span> b = <span class="hljs-number">0</span>;
<span class="line"></span>
<span class="line"></span>            <span class="hljs-type">int</span> ir = <span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">int</span>&gt;(<span class="hljs-number">255.999</span> * r);
<span class="line"></span>            <span class="hljs-type">int</span> ig = <span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">int</span>&gt;(<span class="hljs-number">255.999</span> * g);
<span class="line"></span>            <span class="hljs-type">int</span> ib = <span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">int</span>&gt;(<span class="hljs-number">255.999</span> * b);
<span class="line"></span>
<span class="line"></span>            std::cout &lt;&lt; ir &lt;&lt; <span class="hljs-string">' '</span> &lt;&lt; ig &lt;&lt; <span class="hljs-string">' '</span> &lt;&lt; ib &lt;&lt; <span class="hljs-string">'\n'</span>;
<span class="line"></span>        }
<span class="line"></span>    }
<span class="line"></span>}</code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_main-initial">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;1:</b> <kbd>[main.cc]</kbd> Creating your first image</div></center>
<p>


</p></div>

<p></p><p>

There are some things to note in this code:

</p><p>

</p><ol start="1">
  <li class="number">The pixels are written out in rows.

<p></p><p>

</p></li>
  <li class="number">Every row of pixels is written out left to right.

<p></p><p>

</p></li>
  <li class="number">These rows are written out from top to bottom.

<p></p><p>

</p></li>
  <li class="number">By convention, each of the red/green/blue components are represented internally by real-valued
       variables that range from 0.0 to 1.0. These must be scaled to integer values between 0 and 255
       before we print them out.

<p></p><p>

</p></li>
  <li class="number">Red goes from fully off (black) to fully on (bright red) from left to right, and green goes
       from fully off at the top to black at the bottom. Adding red and green light together make
       yellow so we should expect the bottom right corner to be yellow.</li></ol>

<p></p>
<a class="target" name="creatinganimagefile">&nbsp;</a><a class="target" name="outputanimage/creatinganimagefile">&nbsp;</a><a class="target" name="toc2.2">&nbsp;</a><h2>Creating an Image File</h2>
<p>

Because the file is written to the standard output stream, you'll need to redirect it to an image
file. Typically this is done from the command-line by using the <code>&gt;</code> redirection operator, like so:

</p><pre class="listing tilde"><code><span class="line"></span>build\<span class="hljs-keyword">Release</span>\inOneWeekend.exe <span class="hljs-operator">&gt;</span> image.ppm</code></pre><p>

(This example assumes that you are building with CMake, using the same approach as the
<code>CMakeLists.txt</code> file in the included source. Use whatever build environment (and language) you're
comfortable with.)

</p><p>

This is how things would look on Windows with CMake. On Mac or Linux, it might look like this:

</p><pre class="listing tilde"><code><span class="line"></span>build/inOneWeekend &gt; image.ppm</code></pre><p>

Opening the output file (in <code>ToyViewer</code> on my Mac, but try it in your favorite image viewer and
Google “ppm viewer” if your viewer doesn’t support it) shows this result:

</p><p>

  </p><center><div class="image" style=""><a href="https://raytracing.github.io/images/img-1.01-first-ppm-image.png" target="_blank"><img class="markdeep pixel" src="Ray%20Tracing%20in%20One%20Weekend_files/img-1.01-first-ppm-image.png"></a><center><span class="imagecaption"><span class="num">Image 1:</span> First PPM image
  </span></center></div></center>

<p></p><p>

Hooray! This is the graphics “hello world”. If your image doesn’t look like that, open the output
file in a text editor and see what it looks like. It should start something like this:

</p><pre class="listing tilde"><code><span class="line"></span>P3
<span class="line"></span>256 256
<span class="line"></span>255
<span class="line"></span>0 0 0
<span class="line"></span>1 0 0
<span class="line"></span>2 0 0
<span class="line"></span>3 0 0
<span class="line"></span>4 0 0
<span class="line"></span>5 0 0
<span class="line"></span>6 0 0
<span class="line"></span>7 0 0
<span class="line"></span>8 0 0
<span class="line"></span>9 0 0
<span class="line"></span>10 0 0
<span class="line"></span>11 0 0
<span class="line"></span>12 0 0
<span class="line"></span>...</code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_first-img">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;2:</b> First image output</div></center>
<p>


If your PPM file doesn't look like this, then double-check your formatting code.
If it <em class="underscore">does</em> look like this but fails to render, then you may have line-ending differences or
something similar that is confusing your image viewer.
To help debug this, you can find a file <code>test.ppm</code> in the <code>images</code> directory of the Github project.
This should help to ensure that your viewer can handle the PPM format and to use as a comparison
against your generated PPM file.

</p><p>

Some readers have reported problems viewing their generated files on Windows.
In this case, the problem is often that the PPM is written out as UTF-16, often from PowerShell.
If you run into this problem, see
<a href="https://github.com/RayTracing/raytracing.github.io/discussions/1114">Discussion 1114</a>
for help with this issue.

</p><p>

If everything displays correctly, then you're pretty much done with system and IDE issues —
everything in the remainder of this series uses this same simple mechanism for generated rendered
images.

</p><p>

If you want to produce other image formats, I am a fan of <code>stb_image.h</code>, a header-only image library
available on GitHub at <a href="https://github.com/nothings/stb" class="url">https://github.com/nothings/stb</a>.

</p>
<a class="target" name="addingaprogressindicator">&nbsp;</a><a class="target" name="outputanimage/addingaprogressindicator">&nbsp;</a><a class="target" name="toc2.3">&nbsp;</a><h2>Adding a Progress Indicator</h2>
<p>

Before we continue, let's add a progress indicator to our output. This is a handy way to track the
progress of a long render, and also to possibly identify a run that's stalled out due to an infinite
loop or other problem.

</p><p>

</p><div class="together">
Our program outputs the image to the standard output stream (<code>std::cout</code>), so leave that alone and
instead write to the logging output stream (<code>std::clog</code>):

<p></p><pre class="listing tilde"><code><span class="line"></span>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> j = <span class="hljs-number">0</span>; j &lt; image_height; ++j) {<div class=" highlight"><span class="line"></span>        std::clog &lt;&lt; <span class="hljs-string">"\rScanlines remaining: "</span> &lt;&lt; (image_height - j) &lt;&lt; <span class="hljs-string">' '</span> &lt;&lt; std::flush;</div><span class="line"></span>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; image_width; ++i) {
<span class="line"></span>            <span class="hljs-keyword">auto</span> r = <span class="hljs-built_in">double</span>(i) / (image_width<span class="hljs-number">-1</span>);
<span class="line"></span>            <span class="hljs-keyword">auto</span> g = <span class="hljs-built_in">double</span>(j) / (image_height<span class="hljs-number">-1</span>);
<span class="line"></span>            <span class="hljs-keyword">auto</span> b = <span class="hljs-number">0</span>;
<span class="line"></span>
<span class="line"></span>            <span class="hljs-type">int</span> ir = <span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">int</span>&gt;(<span class="hljs-number">255.999</span> * r);
<span class="line"></span>            <span class="hljs-type">int</span> ig = <span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">int</span>&gt;(<span class="hljs-number">255.999</span> * g);
<span class="line"></span>            <span class="hljs-type">int</span> ib = <span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">int</span>&gt;(<span class="hljs-number">255.999</span> * b);
<span class="line"></span>
<span class="line"></span>            std::cout &lt;&lt; ir &lt;&lt; <span class="hljs-string">' '</span> &lt;&lt; ig &lt;&lt; <span class="hljs-string">' '</span> &lt;&lt; ib &lt;&lt; <span class="hljs-string">'\n'</span>;
<span class="line"></span>        }
<span class="line"></span>    }
<span class="line"></span>
<span class="line"></span><div class=" highlight"><span class="line"></span>    std::clog &lt;&lt; <span class="hljs-string">"\rDone.                 \n"</span>;</div></code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_main-progress">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;3:</b> <kbd>[main.cc]</kbd> Main render loop with progress reporting</div></center>
<p>


</p></div>

<p></p><p>

Now when running, you'll see a running count of the number of scanlines remaining. Hopefully this
runs so fast that you don't even see it! Don't worry — you'll have lots of time in the future to
watch a slowly updating progress line as we expand our ray tracer.

</p>
<a class="target" name="thevec3class">&nbsp;</a><a class="target" name="thevec3class">&nbsp;</a><a class="target" name="toc3">&nbsp;</a><h1>The vec3 Class</h1>
<p>

Almost all graphics programs have some class(es) for storing geometric vectors and colors. In many
systems these vectors are 4D (3D position plus a homogeneous coordinate for geometry, or RGB plus an
alpha transparency component for colors). For our purposes, three coordinates suffice. We’ll use the
same class <code>vec3</code> for colors, locations, directions, offsets, whatever. Some people don’t like this
because it doesn’t prevent you from doing something silly, like subtracting a position from a color.
They have a good point, but we’re going to always take the “less code” route when not obviously
wrong. In spite of this, we do declare two aliases for <code>vec3</code>: <code>point3</code> and <code>color</code>. Since these two
types are just aliases for <code>vec3</code>, you won't get warnings if you pass a <code>color</code> to a function
expecting a <code>point3</code>, and nothing is stopping you from adding a <code>point3</code> to a <code>color</code>, but it makes
the code a little bit easier to read and to understand.

</p><p>

We define the <code>vec3</code> class in the top half of a new <code>vec3.h</code> header file, and define a set of useful
vector utility functions in the bottom half:

</p><pre class="listing tilde"><code><span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">ifndef</span> VEC3_H</span>
<span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">define</span> VEC3_H</span>
<span class="line"></span>
<span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cmath&gt;</span></span>
<span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>
<span class="line"></span>
<span class="line"></span><span class="hljs-keyword">using</span> std::sqrt;
<span class="line"></span>
<span class="line"></span><span class="hljs-keyword">class</span> <span class="hljs-title class_">vec3</span> {
<span class="line"></span>  <span class="hljs-keyword">public</span>:
<span class="line"></span>    <span class="hljs-type">double</span> e[<span class="hljs-number">3</span>];
<span class="line"></span>
<span class="line"></span>    <span class="hljs-built_in">vec3</span>() : e{<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>} {}
<span class="line"></span>    <span class="hljs-built_in">vec3</span>(<span class="hljs-type">double</span> e0, <span class="hljs-type">double</span> e1, <span class="hljs-type">double</span> e2) : e{e0, e1, e2} {}
<span class="line"></span>
<span class="line"></span>    <span class="hljs-function"><span class="hljs-type">double</span> <span class="hljs-title">x</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>{ <span class="hljs-keyword">return</span> e[<span class="hljs-number">0</span>]; }
<span class="line"></span>    <span class="hljs-function"><span class="hljs-type">double</span> <span class="hljs-title">y</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>{ <span class="hljs-keyword">return</span> e[<span class="hljs-number">1</span>]; }
<span class="line"></span>    <span class="hljs-function"><span class="hljs-type">double</span> <span class="hljs-title">z</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>{ <span class="hljs-keyword">return</span> e[<span class="hljs-number">2</span>]; }
<span class="line"></span>
<span class="line"></span>    vec3 <span class="hljs-keyword">operator</span>-() <span class="hljs-type">const</span> { <span class="hljs-keyword">return</span> <span class="hljs-built_in">vec3</span>(-e[<span class="hljs-number">0</span>], -e[<span class="hljs-number">1</span>], -e[<span class="hljs-number">2</span>]); }
<span class="line"></span>    <span class="hljs-type">double</span> <span class="hljs-keyword">operator</span>[](<span class="hljs-type">int</span> i) <span class="hljs-type">const</span> { <span class="hljs-keyword">return</span> e[i]; }
<span class="line"></span>    <span class="hljs-type">double</span>&amp; <span class="hljs-keyword">operator</span>[](<span class="hljs-type">int</span> i) { <span class="hljs-keyword">return</span> e[i]; }
<span class="line"></span>
<span class="line"></span>    vec3&amp; <span class="hljs-keyword">operator</span>+=(<span class="hljs-type">const</span> vec3 &amp;v) {
<span class="line"></span>        e[<span class="hljs-number">0</span>] += v.e[<span class="hljs-number">0</span>];
<span class="line"></span>        e[<span class="hljs-number">1</span>] += v.e[<span class="hljs-number">1</span>];
<span class="line"></span>        e[<span class="hljs-number">2</span>] += v.e[<span class="hljs-number">2</span>];
<span class="line"></span>        <span class="hljs-keyword">return</span> *<span class="hljs-keyword">this</span>;
<span class="line"></span>    }
<span class="line"></span>
<span class="line"></span>    vec3&amp; <span class="hljs-keyword">operator</span>*=(<span class="hljs-type">double</span> t) {
<span class="line"></span>        e[<span class="hljs-number">0</span>] *= t;
<span class="line"></span>        e[<span class="hljs-number">1</span>] *= t;
<span class="line"></span>        e[<span class="hljs-number">2</span>] *= t;
<span class="line"></span>        <span class="hljs-keyword">return</span> *<span class="hljs-keyword">this</span>;
<span class="line"></span>    }
<span class="line"></span>
<span class="line"></span>    vec3&amp; <span class="hljs-keyword">operator</span>/=(<span class="hljs-type">double</span> t) {
<span class="line"></span>        <span class="hljs-keyword">return</span> *<span class="hljs-keyword">this</span> *= <span class="hljs-number">1</span>/t;
<span class="line"></span>    }
<span class="line"></span>
<span class="line"></span>    <span class="hljs-function"><span class="hljs-type">double</span> <span class="hljs-title">length</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>{
<span class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">sqrt</span>(<span class="hljs-built_in">length_squared</span>());
<span class="line"></span>    }
<span class="line"></span>
<span class="line"></span>    <span class="hljs-function"><span class="hljs-type">double</span> <span class="hljs-title">length_squared</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>{
<span class="line"></span>        <span class="hljs-keyword">return</span> e[<span class="hljs-number">0</span>]*e[<span class="hljs-number">0</span>] + e[<span class="hljs-number">1</span>]*e[<span class="hljs-number">1</span>] + e[<span class="hljs-number">2</span>]*e[<span class="hljs-number">2</span>];
<span class="line"></span>    }
<span class="line"></span>};
<span class="line"></span>
<span class="line"></span><span class="hljs-comment">// point3 is just an alias for vec3, but useful for geometric clarity in the code.</span>
<span class="line"></span><span class="hljs-keyword">using</span> point3 = vec3;
<span class="line"></span>
<span class="line"></span>
<span class="line"></span><span class="hljs-comment">// Vector Utility Functions</span>
<span class="line"></span>
<span class="line"></span><span class="hljs-keyword">inline</span> std::ostream&amp; <span class="hljs-keyword">operator</span>&lt;&lt;(std::ostream &amp;out, <span class="hljs-type">const</span> vec3 &amp;v) {
<span class="line"></span>    <span class="hljs-keyword">return</span> out &lt;&lt; v.e[<span class="hljs-number">0</span>] &lt;&lt; <span class="hljs-string">' '</span> &lt;&lt; v.e[<span class="hljs-number">1</span>] &lt;&lt; <span class="hljs-string">' '</span> &lt;&lt; v.e[<span class="hljs-number">2</span>];
<span class="line"></span>}
<span class="line"></span>
<span class="line"></span><span class="hljs-keyword">inline</span> vec3 <span class="hljs-keyword">operator</span>+(<span class="hljs-type">const</span> vec3 &amp;u, <span class="hljs-type">const</span> vec3 &amp;v) {
<span class="line"></span>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">vec3</span>(u.e[<span class="hljs-number">0</span>] + v.e[<span class="hljs-number">0</span>], u.e[<span class="hljs-number">1</span>] + v.e[<span class="hljs-number">1</span>], u.e[<span class="hljs-number">2</span>] + v.e[<span class="hljs-number">2</span>]);
<span class="line"></span>}
<span class="line"></span>
<span class="line"></span><span class="hljs-keyword">inline</span> vec3 <span class="hljs-keyword">operator</span>-(<span class="hljs-type">const</span> vec3 &amp;u, <span class="hljs-type">const</span> vec3 &amp;v) {
<span class="line"></span>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">vec3</span>(u.e[<span class="hljs-number">0</span>] - v.e[<span class="hljs-number">0</span>], u.e[<span class="hljs-number">1</span>] - v.e[<span class="hljs-number">1</span>], u.e[<span class="hljs-number">2</span>] - v.e[<span class="hljs-number">2</span>]);
<span class="line"></span>}
<span class="line"></span>
<span class="line"></span><span class="hljs-keyword">inline</span> vec3 <span class="hljs-keyword">operator</span>*(<span class="hljs-type">const</span> vec3 &amp;u, <span class="hljs-type">const</span> vec3 &amp;v) {
<span class="line"></span>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">vec3</span>(u.e[<span class="hljs-number">0</span>] * v.e[<span class="hljs-number">0</span>], u.e[<span class="hljs-number">1</span>] * v.e[<span class="hljs-number">1</span>], u.e[<span class="hljs-number">2</span>] * v.e[<span class="hljs-number">2</span>]);
<span class="line"></span>}
<span class="line"></span>
<span class="line"></span><span class="hljs-keyword">inline</span> vec3 <span class="hljs-keyword">operator</span>*(<span class="hljs-type">double</span> t, <span class="hljs-type">const</span> vec3 &amp;v) {
<span class="line"></span>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">vec3</span>(t*v.e[<span class="hljs-number">0</span>], t*v.e[<span class="hljs-number">1</span>], t*v.e[<span class="hljs-number">2</span>]);
<span class="line"></span>}
<span class="line"></span>
<span class="line"></span><span class="hljs-keyword">inline</span> vec3 <span class="hljs-keyword">operator</span>*(<span class="hljs-type">const</span> vec3 &amp;v, <span class="hljs-type">double</span> t) {
<span class="line"></span>    <span class="hljs-keyword">return</span> t * v;
<span class="line"></span>}
<span class="line"></span>
<span class="line"></span><span class="hljs-keyword">inline</span> vec3 <span class="hljs-keyword">operator</span>/(vec3 v, <span class="hljs-type">double</span> t) {
<span class="line"></span>    <span class="hljs-keyword">return</span> (<span class="hljs-number">1</span>/t) * v;
<span class="line"></span>}
<span class="line"></span>
<span class="line"></span><span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-type">double</span> <span class="hljs-title">dot</span><span class="hljs-params">(<span class="hljs-type">const</span> vec3 &amp;u, <span class="hljs-type">const</span> vec3 &amp;v)</span> </span>{
<span class="line"></span>    <span class="hljs-keyword">return</span> u.e[<span class="hljs-number">0</span>] * v.e[<span class="hljs-number">0</span>]
<span class="line"></span>         + u.e[<span class="hljs-number">1</span>] * v.e[<span class="hljs-number">1</span>]
<span class="line"></span>         + u.e[<span class="hljs-number">2</span>] * v.e[<span class="hljs-number">2</span>];
<span class="line"></span>}
<span class="line"></span>
<span class="line"></span><span class="hljs-function"><span class="hljs-keyword">inline</span> vec3 <span class="hljs-title">cross</span><span class="hljs-params">(<span class="hljs-type">const</span> vec3 &amp;u, <span class="hljs-type">const</span> vec3 &amp;v)</span> </span>{
<span class="line"></span>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">vec3</span>(u.e[<span class="hljs-number">1</span>] * v.e[<span class="hljs-number">2</span>] - u.e[<span class="hljs-number">2</span>] * v.e[<span class="hljs-number">1</span>],
<span class="line"></span>                u.e[<span class="hljs-number">2</span>] * v.e[<span class="hljs-number">0</span>] - u.e[<span class="hljs-number">0</span>] * v.e[<span class="hljs-number">2</span>],
<span class="line"></span>                u.e[<span class="hljs-number">0</span>] * v.e[<span class="hljs-number">1</span>] - u.e[<span class="hljs-number">1</span>] * v.e[<span class="hljs-number">0</span>]);
<span class="line"></span>}
<span class="line"></span>
<span class="line"></span><span class="hljs-function"><span class="hljs-keyword">inline</span> vec3 <span class="hljs-title">unit_vector</span><span class="hljs-params">(vec3 v)</span> </span>{
<span class="line"></span>    <span class="hljs-keyword">return</span> v / v.<span class="hljs-built_in">length</span>();
<span class="line"></span>}
<span class="line"></span>
<span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span></code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_vec3-class">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;4:</b> <kbd>[vec3.h]</kbd> vec3 definitions and helper functions</div></center>
<p>


We use <code>double</code> here, but some ray tracers use <code>float</code>. <code>double</code> has greater precision and range,
but is twice the size compared to <code>float</code>. This increase in size may be important if you're
programming in limited memory conditions (such as hardware shaders). Either one is fine — follow
your own tastes.

</p>
<a class="target" name="colorutilityfunctions">&nbsp;</a><a class="target" name="thevec3class/colorutilityfunctions">&nbsp;</a><a class="target" name="toc3.1">&nbsp;</a><h2>Color Utility Functions</h2>
<p>

Using our new <code>vec3</code> class, we'll create a new <code>color.h</code> header file and define a utility function
that writes a single pixel's color out to the standard output stream.

</p><pre class="listing tilde"><code><span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">ifndef</span> COLOR_H</span>
<span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">define</span> COLOR_H</span>
<span class="line"></span>
<span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"vec3.h"</span></span>
<span class="line"></span>
<span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>
<span class="line"></span>
<span class="line"></span><span class="hljs-keyword">using</span> color = vec3;
<span class="line"></span>
<span class="line"></span><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">write_color</span><span class="hljs-params">(std::ostream &amp;out, color pixel_color)</span> </span>{
<span class="line"></span>    <span class="hljs-comment">// Write the translated [0,255] value of each color component.</span>
<span class="line"></span>    out &lt;&lt; <span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">int</span>&gt;(<span class="hljs-number">255.999</span> * pixel_color.<span class="hljs-built_in">x</span>()) &lt;&lt; <span class="hljs-string">' '</span>
<span class="line"></span>        &lt;&lt; <span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">int</span>&gt;(<span class="hljs-number">255.999</span> * pixel_color.<span class="hljs-built_in">y</span>()) &lt;&lt; <span class="hljs-string">' '</span>
<span class="line"></span>        &lt;&lt; <span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">int</span>&gt;(<span class="hljs-number">255.999</span> * pixel_color.<span class="hljs-built_in">z</span>()) &lt;&lt; <span class="hljs-string">'\n'</span>;
<span class="line"></span>}
<span class="line"></span>
<span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span></code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_color">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;5:</b> <kbd>[color.h]</kbd> color utility functions</div></center>
<p>


</p><div class="together">
Now we can change our main to use both of these:

<p></p><pre class="listing tilde"><code><div class=" highlight"><span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"color.h"</span></span>
<span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"vec3.h"</span></span></div><span class="line"></span>
<span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>
<span class="line"></span>
<span class="line"></span><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
<span class="line"></span>
<span class="line"></span>    <span class="hljs-comment">// Image</span>
<span class="line"></span>
<span class="line"></span>    <span class="hljs-type">int</span> image_width = <span class="hljs-number">256</span>;
<span class="line"></span>    <span class="hljs-type">int</span> image_height = <span class="hljs-number">256</span>;
<span class="line"></span>
<span class="line"></span>    <span class="hljs-comment">// Render</span>
<span class="line"></span>
<span class="line"></span>    std::cout &lt;&lt; <span class="hljs-string">"P3\n"</span> &lt;&lt; image_width &lt;&lt; <span class="hljs-string">' '</span> &lt;&lt; image_height &lt;&lt; <span class="hljs-string">"\n255\n"</span>;
<span class="line"></span>
<span class="line"></span>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> j = <span class="hljs-number">0</span>; j &lt; image_height; ++j) {
<span class="line"></span>        std::clog &lt;&lt; <span class="hljs-string">"\rScanlines remaining: "</span> &lt;&lt; (image_height - j) &lt;&lt; <span class="hljs-string">' '</span> &lt;&lt; std::flush;
<span class="line"></span>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; image_width; ++i) {<div class=" highlight"><span class="line"></span>            <span class="hljs-keyword">auto</span> pixel_color = <span class="hljs-built_in">color</span>(<span class="hljs-built_in">double</span>(i)/(image_width<span class="hljs-number">-1</span>), <span class="hljs-built_in">double</span>(j)/(image_height<span class="hljs-number">-1</span>), <span class="hljs-number">0</span>);
<span class="line"></span>            <span class="hljs-built_in">write_color</span>(std::cout, pixel_color);</div><span class="line"></span>        }
<span class="line"></span>    }
<span class="line"></span>
<span class="line"></span>    std::clog &lt;&lt; <span class="hljs-string">"\rDone.                 \n"</span>;
<span class="line"></span>}</code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_ppm-2">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;6:</b> <kbd>[main.cc]</kbd> Final code for the first PPM image</div></center>
<p>


</p></div>

<p></p><p>

And you should get the exact same picture as before.

</p>
<a class="target" name="rays,asimplecamera,andbackground">&nbsp;</a><a class="target" name="rays,asimplecamera,andbackground">&nbsp;</a><a class="target" name="toc4">&nbsp;</a><h1>Rays, a Simple Camera, and Background</h1>

<a class="target" name="therayclass">&nbsp;</a><a class="target" name="rays,asimplecamera,andbackground/therayclass">&nbsp;</a><a class="target" name="toc4.1">&nbsp;</a><h2>The ray Class</h2>
<p>

The one thing that all ray tracers have is a ray class and a computation of what color is seen along
a ray. Let’s think of a ray as a function <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-2-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;P&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;A&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;b&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-3" style="width: 7.916em; display: inline-block;"><span style="display: inline-block; position: relative; width: 6.351em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.518em, 1006.31em, 2.821em, -1000em); top: -2.419em; left: 0em;"><span class="mrow" id="MathJax-Span-4"><span class="texatom" id="MathJax-Span-5"><span class="mrow" id="MathJax-Span-6"><span class="mi" id="MathJax-Span-7" style="font-family: MathJax_Main; font-weight: bold;">P</span></span></span><span class="mo" id="MathJax-Span-8" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-9" style="font-family: MathJax_Math; font-style: italic;">t</span><span class="mo" id="MathJax-Span-10" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-11" style="font-family: MathJax_Main; padding-left: 0.278em;">=</span><span class="texatom" id="MathJax-Span-12" style="padding-left: 0.278em;"><span class="mrow" id="MathJax-Span-13"><span class="mi" id="MathJax-Span-14" style="font-family: MathJax_Main; font-weight: bold;">A</span></span></span><span class="mo" id="MathJax-Span-15" style="font-family: MathJax_Main; padding-left: 0.222em;">+</span><span class="mi" id="MathJax-Span-16" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.222em;">t</span><span class="texatom" id="MathJax-Span-17"><span class="mrow" id="MathJax-Span-18"><span class="mi" id="MathJax-Span-19" style="font-family: MathJax_Main; font-weight: bold;">b</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.419em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.365em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">P</mi></mrow><mo stretchy="false">(</mo><mi>t</mi><mo stretchy="false">)</mo><mo>=</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">A</mi></mrow><mo>+</mo><mi>t</mi><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">b</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-2">\mathbf{P}(t) = \mathbf{A} + t \mathbf{b}</script>. Here
<span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-3-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;P&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-20" style="width: 1.011em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.806em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.431em, 1000.74em, 2.419em, -1000em); top: -2.268em; left: 0em;"><span class="mrow" id="MathJax-Span-21"><span class="texatom" id="MathJax-Span-22"><span class="mrow" id="MathJax-Span-23"><span class="mi" id="MathJax-Span-24" style="font-family: MathJax_Main; font-weight: bold;">P</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.268em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.063em; border-left: 0px solid; width: 0px; height: 0.976em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">P</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-3">\mathbf{P}</script> is a 3D position along a line in 3D. <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-4-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;A&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-25" style="width: 1.061em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.857em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.419em, 1000.82em, 2.419em, -1000em); top: -2.268em; left: 0em;"><span class="mrow" id="MathJax-Span-26"><span class="texatom" id="MathJax-Span-27"><span class="mrow" id="MathJax-Span-28"><span class="mi" id="MathJax-Span-29" style="font-family: MathJax_Main; font-weight: bold;">A</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.268em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.063em; border-left: 0px solid; width: 0px; height: 0.991em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">A</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-4">\mathbf{A}</script> is the ray origin and <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-5-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;b&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-30" style="width: 0.809em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.655em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.423em, 1000.62em, 2.425em, -1000em); top: -2.268em; left: 0em;"><span class="mrow" id="MathJax-Span-31"><span class="texatom" id="MathJax-Span-32"><span class="mrow" id="MathJax-Span-33"><span class="mi" id="MathJax-Span-34" style="font-family: MathJax_Main; font-weight: bold;">b</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.268em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.07em; border-left: 0px solid; width: 0px; height: 0.993em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">b</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-5">\mathbf{b}</script> is
the ray direction. The ray parameter <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-6-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-35" style="width: 0.456em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.353em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.441em, 1000.32em, 2.38em, -1000em); top: -2.218em; left: 0em;"><span class="mrow" id="MathJax-Span-36"><span class="mi" id="MathJax-Span-37" style="font-family: MathJax_Math; font-style: italic;">t</span></span><span style="display: inline-block; width: 0px; height: 2.218em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.076em; border-left: 0px solid; width: 0px; height: 0.915em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>t</mi></math></span></span><script type="math/tex" id="MathJax-Element-6">t</script> is a real number (<code>double</code> in the code). Plug in a
different <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-7-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-38" style="width: 0.456em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.353em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.441em, 1000.32em, 2.38em, -1000em); top: -2.218em; left: 0em;"><span class="mrow" id="MathJax-Span-39"><span class="mi" id="MathJax-Span-40" style="font-family: MathJax_Math; font-style: italic;">t</span></span><span style="display: inline-block; width: 0px; height: 2.218em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.076em; border-left: 0px solid; width: 0px; height: 0.915em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>t</mi></math></span></span><script type="math/tex" id="MathJax-Element-7">t</script> and <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-8-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;P&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-41" style="width: 2.371em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.915em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.417em, 1001.82em, 2.72em, -1000em); top: -2.319em; left: 0em;"><span class="mrow" id="MathJax-Span-42"><span class="texatom" id="MathJax-Span-43"><span class="mrow" id="MathJax-Span-44"><span class="mi" id="MathJax-Span-45" style="font-family: MathJax_Main; font-weight: bold;">P</span></span></span><span class="mo" id="MathJax-Span-46" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-47" style="font-family: MathJax_Math; font-style: italic;">t</span><span class="mo" id="MathJax-Span-48" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.319em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.365em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">P</mi></mrow><mo stretchy="false">(</mo><mi>t</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-8">\mathbf{P}(t)</script> moves the point along the ray. Add in negative <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-9-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-49" style="width: 0.456em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.353em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.441em, 1000.32em, 2.38em, -1000em); top: -2.218em; left: 0em;"><span class="mrow" id="MathJax-Span-50"><span class="mi" id="MathJax-Span-51" style="font-family: MathJax_Math; font-style: italic;">t</span></span><span style="display: inline-block; width: 0px; height: 2.218em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.076em; border-left: 0px solid; width: 0px; height: 0.915em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>t</mi></math></span></span><script type="math/tex" id="MathJax-Element-9">t</script> values and you
can go anywhere on the 3D line. For positive <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-10-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-52" style="width: 0.456em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.353em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.441em, 1000.32em, 2.38em, -1000em); top: -2.218em; left: 0em;"><span class="mrow" id="MathJax-Span-53"><span class="mi" id="MathJax-Span-54" style="font-family: MathJax_Math; font-style: italic;">t</span></span><span style="display: inline-block; width: 0px; height: 2.218em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.076em; border-left: 0px solid; width: 0px; height: 0.915em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>t</mi></math></span></span><script type="math/tex" id="MathJax-Element-10">t</script>, you get only the parts in front of <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-11-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;A&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-55" style="width: 1.061em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.857em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.419em, 1000.82em, 2.419em, -1000em); top: -2.268em; left: 0em;"><span class="mrow" id="MathJax-Span-56"><span class="texatom" id="MathJax-Span-57"><span class="mrow" id="MathJax-Span-58"><span class="mi" id="MathJax-Span-59" style="font-family: MathJax_Main; font-weight: bold;">A</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.268em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.063em; border-left: 0px solid; width: 0px; height: 0.991em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">A</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-11">\mathbf{A}</script>,
and this is what is often called a half-line or a ray.

</p><p>

  </p><center><div class="image" style=""><a href="https://raytracing.github.io/images/fig-1.02-lerp.jpg" target="_blank"><img class="markdeep" src="Ray%20Tracing%20in%20One%20Weekend_files/fig-1.02-lerp.jpg"></a><center><span class="imagecaption"><a class="target" name="figure_lerp">&nbsp;</a><b style="font-style:normal;">Figure&nbsp;2:</b> Linear interpolation</span></center></div></center>

<p></p><p>

</p><div class="together">
We can represent the idea of a ray as a class, and represent the function <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-12-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;P&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-60" style="width: 2.371em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.915em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.417em, 1001.82em, 2.72em, -1000em); top: -2.319em; left: 0em;"><span class="mrow" id="MathJax-Span-61"><span class="texatom" id="MathJax-Span-62"><span class="mrow" id="MathJax-Span-63"><span class="mi" id="MathJax-Span-64" style="font-family: MathJax_Main; font-weight: bold;">P</span></span></span><span class="mo" id="MathJax-Span-65" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-66" style="font-family: MathJax_Math; font-style: italic;">t</span><span class="mo" id="MathJax-Span-67" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.319em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.365em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">P</mi></mrow><mo stretchy="false">(</mo><mi>t</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-12">\mathbf{P}(t)</script> as a
function that we'll call <code>ray::at(t)</code>:

<p></p><pre class="listing tilde"><code><span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">ifndef</span> RAY_H</span>
<span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">define</span> RAY_H</span>
<span class="line"></span>
<span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"vec3.h"</span></span>
<span class="line"></span>
<span class="line"></span><span class="hljs-keyword">class</span> <span class="hljs-title class_">ray</span> {
<span class="line"></span>  <span class="hljs-keyword">public</span>:
<span class="line"></span>    <span class="hljs-built_in">ray</span>() {}
<span class="line"></span>
<span class="line"></span>    <span class="hljs-built_in">ray</span>(<span class="hljs-type">const</span> point3&amp; origin, <span class="hljs-type">const</span> vec3&amp; direction) : <span class="hljs-built_in">orig</span>(origin), <span class="hljs-built_in">dir</span>(direction) {}
<span class="line"></span>
<span class="line"></span>    <span class="hljs-function">point3 <span class="hljs-title">origin</span><span class="hljs-params">()</span> <span class="hljs-type">const</span>  </span>{ <span class="hljs-keyword">return</span> orig; }
<span class="line"></span>    <span class="hljs-function">vec3 <span class="hljs-title">direction</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>{ <span class="hljs-keyword">return</span> dir; }
<span class="line"></span>
<span class="line"></span>    <span class="hljs-function">point3 <span class="hljs-title">at</span><span class="hljs-params">(<span class="hljs-type">double</span> t)</span> <span class="hljs-type">const</span> </span>{
<span class="line"></span>        <span class="hljs-keyword">return</span> orig + t*dir;
<span class="line"></span>    }
<span class="line"></span>
<span class="line"></span>  <span class="hljs-keyword">private</span>:
<span class="line"></span>    point3 orig;
<span class="line"></span>    vec3 dir;
<span class="line"></span>};
<span class="line"></span>
<span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span></code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_ray-initial">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;7:</b> <kbd>[ray.h]</kbd> The ray class</div></center>
<p>


</p></div>

<p></p>
<a class="target" name="sendingraysintothescene">&nbsp;</a><a class="target" name="rays,asimplecamera,andbackground/sendingraysintothescene">&nbsp;</a><a class="target" name="toc4.2">&nbsp;</a><h2>Sending Rays Into the Scene</h2>
<p>

Now we are ready to turn the corner and make a ray tracer.
At its core, a ray tracer sends rays through pixels and computes the color seen in the direction of
those rays. The involved steps are

</p><p>

</p><ol start="1">
    <li class="number">Calculate the ray from the “eye” through the pixel,
</li>
    <li class="number">Determine which objects the ray intersects, and
</li>
    <li class="number">Compute a color for the closest intersection point.</li></ol>

<p></p><p>

When first developing a ray tracer, I always do a simple camera for getting the code up and running.

</p><p>

I’ve often gotten into trouble using square images for debugging because I transpose <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-13-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-68" style="width: 0.708em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.554em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.625em, 1000.5em, 2.38em, -1000em); top: -2.218em; left: 0em;"><span class="mrow" id="MathJax-Span-69"><span class="mi" id="MathJax-Span-70" style="font-family: MathJax_Math; font-style: italic;">x</span></span><span style="display: inline-block; width: 0px; height: 2.218em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.076em; border-left: 0px solid; width: 0px; height: 0.687em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>x</mi></math></span></span><script type="math/tex" id="MathJax-Element-13">x</script> and <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-14-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-71" style="width: 0.658em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.504em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.625em, 1000.5em, 2.574em, -1000em); top: -2.218em; left: 0em;"><span class="mrow" id="MathJax-Span-72"><span class="mi" id="MathJax-Span-73" style="font-family: MathJax_Math; font-style: italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.006em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.218em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.317em; border-left: 0px solid; width: 0px; height: 0.927em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>y</mi></math></span></span><script type="math/tex" id="MathJax-Element-14">y</script> too
often, so we’ll use a non-square image.
A square image has a 1∶1 aspect ratio, because its width is the same as its height.
Since we want a non-square image, we'll choose 16∶9 because it's so common.
A 16∶9 aspect ratio means that the ratio of image width to image height is 16∶9.
Put another way, given an image with a 16∶9 aspect ratio,

</p><p>

  <span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-15-Frame" tabindex="0" style="text-align: center; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mtext&gt;width&lt;/mtext&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;/&lt;/mo&gt;&lt;/mrow&gt;&lt;mtext&gt;height&lt;/mtext&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;16&lt;/mn&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;/&lt;/mo&gt;&lt;/mrow&gt;&lt;mn&gt;9&lt;/mn&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;1.7778&lt;/mn&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-74" style="width: 16.333em; display: inline-block;"><span style="display: inline-block; position: relative; width: 13.155em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.317em, 1013.11em, 2.619em, -1000em); top: -2.218em; left: 0em;"><span class="mrow" id="MathJax-Span-75"><span class="mtext" id="MathJax-Span-76" style="font-family: MathJax_Main;">width</span><span class="texatom" id="MathJax-Span-77"><span class="mrow" id="MathJax-Span-78"><span class="mo" id="MathJax-Span-79" style="font-family: MathJax_Main;">/</span></span></span><span class="mtext" id="MathJax-Span-80" style="font-family: MathJax_Main;">height</span><span class="mo" id="MathJax-Span-81" style="font-family: MathJax_Main; padding-left: 0.278em;">=</span><span class="mn" id="MathJax-Span-82" style="font-family: MathJax_Main; padding-left: 0.278em;">16</span><span class="texatom" id="MathJax-Span-83"><span class="mrow" id="MathJax-Span-84"><span class="mo" id="MathJax-Span-85" style="font-family: MathJax_Main;">/</span></span></span><span class="mn" id="MathJax-Span-86" style="font-family: MathJax_Main;">9</span><span class="mo" id="MathJax-Span-87" style="font-family: MathJax_Main; padding-left: 0.278em;">=</span><span class="mn" id="MathJax-Span-88" style="font-family: MathJax_Main; padding-left: 0.278em;">1.7778</span></span><span style="display: inline-block; width: 0px; height: 2.218em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.365em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mtext>width</mtext><mrow class="MJX-TeXAtom-ORD"><mo>/</mo></mrow><mtext>height</mtext><mo>=</mo><mn>16</mn><mrow class="MJX-TeXAtom-ORD"><mo>/</mo></mrow><mn>9</mn><mo>=</mo><mn>1.7778</mn></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-15">\text{width} / \text{height} = 16 / 9 = 1.7778</script>

</p><p>

For a practical example, an image 800 pixels wide by 400 pixels high has a 2∶1 aspect ratio.

</p><p>

The image's aspect ratio can be determined from the ratio of its height to its width.
However, since we have a given aspect ratio in mind, it's easier to set the image's width and the
aspect ratio, and then using this to calculate for its height.
This way, we can scale up or down the image by changing the image width, and it won't throw off our
desired aspect ratio.
We do have to make sure that when we solve for the image height the resulting height is at least 1.

</p><p>

In addition to setting up the pixel dimensions for the rendered image, we also need to set up a
virtual <em class="underscore">viewport</em> through which to pass our scene rays.
The viewport is a virtual rectangle in the 3D world that contains the grid of image pixel locations.
If pixels are spaced the same distance horizontally as they are vertically, the viewport that
bounds them will have the same aspect ratio as the rendered image.
The distance between two adjacent pixels is called the pixel spacing, and square pixels is the
standard.

</p><p>

To start things off, we'll choose an arbitrary viewport height of 2.0, and scale the viewport width
to give us the desired aspect ratio.
Here's a snippet of what this code will look like:

</p><pre class="listing tilde"><code><span class="line"></span><span class="hljs-keyword">auto</span> aspect_ratio = <span class="hljs-number">16.0</span> / <span class="hljs-number">9.0</span>;
<span class="line"></span><span class="hljs-type">int</span> image_width = <span class="hljs-number">400</span>;
<span class="line"></span>
<span class="line"></span><span class="hljs-comment">// Calculate the image height, and ensure that it's at least 1.</span>
<span class="line"></span><span class="hljs-type">int</span> image_height = <span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">int</span>&gt;(image_width / aspect_ratio);
<span class="line"></span>image_height = (image_height &lt; <span class="hljs-number">1</span>) ? <span class="hljs-number">1</span> : image_height;
<span class="line"></span>
<span class="line"></span><span class="hljs-comment">// Viewport widths less than one are ok since they are real valued.</span>
<span class="line"></span><span class="hljs-keyword">auto</span> viewport_height = <span class="hljs-number">2.0</span>;
<span class="line"></span><span class="hljs-keyword">auto</span> viewport_width = viewport_height * (<span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">double</span>&gt;(image_width)/image_height);</code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_image-setup">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;8:</b> Rendered image setup</div></center>
<p>


If you're wondering why we don't just use <code>aspect_ratio</code> when computing <code>viewport_width</code>, it's
because the value set to <code>aspect_ratio</code> is the ideal ratio, it may not be the <em class="underscore">actual</em> ratio
between <code>image_width</code> and <code>image_height</code>. If <code>image_height</code> was allowed to be real valued—rather
than just an integer—then it would fine to use <code>aspect_ratio</code>. But the <em class="underscore">actual</em> ratio
between <code>image_width</code> and <code>image_height</code> can vary based on two parts of the code. First,
<code>integer_height</code> is rounded down to the nearest integer, which can increase the ratio. Second, we
don't allow <code>integer_height</code> to be less than one, which can also change the actual aspect ratio.

</p><p>

Note that <code>aspect_ratio</code> is an ideal ratio, which we approximate as best as possible with the
integer-based ratio of image width over image height.
In order for our viewport proportions to exactly match our image proportions, we use the calculated
image aspect ratio to determine our final viewport width.

</p><p>

Next we will define the camera center: a point in 3D space from which all scene rays will originate
(this is also commonly referred to as the <em class="underscore">eye point</em>).
The vector from the camera center to the viewport center will be orthogonal to the viewport.
We'll initially set the distance between the viewport and the camera center point to be one unit.
This distance is often referred to as the <em class="underscore">focal length</em>.

</p><p>

For simplicity we'll start with the camera center at <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-16-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-89" style="width: 3.934em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.175em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.317em, 1003.08em, 2.619em, -1000em); top: -2.218em; left: 0em;"><span class="mrow" id="MathJax-Span-90"><span class="mo" id="MathJax-Span-91" style="font-family: MathJax_Main;">(</span><span class="mn" id="MathJax-Span-92" style="font-family: MathJax_Main;">0</span><span class="mo" id="MathJax-Span-93" style="font-family: MathJax_Main;">,</span><span class="mn" id="MathJax-Span-94" style="font-family: MathJax_Main; padding-left: 0.167em;">0</span><span class="mo" id="MathJax-Span-95" style="font-family: MathJax_Main;">,</span><span class="mn" id="MathJax-Span-96" style="font-family: MathJax_Main; padding-left: 0.167em;">0</span><span class="mo" id="MathJax-Span-97" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.218em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.365em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">(</mo><mn>0</mn><mo>,</mo><mn>0</mn><mo>,</mo><mn>0</mn><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-16">(0,0,0)</script>.
We'll also have the y-axis go up, the x-axis to the right, and the negative z-axis pointing in the
viewing direction. (This is commonly referred to as <em class="underscore">right-handed coordinates</em>.)

</p><p>

  </p><center><div class="image" style=""><a href="https://raytracing.github.io/images/fig-1.03-cam-geom.jpg" target="_blank"><img class="markdeep" src="Ray%20Tracing%20in%20One%20Weekend_files/fig-1.03-cam-geom.jpg"></a><center><span class="imagecaption"><a class="target" name="figure_camera-geom">&nbsp;</a><b style="font-style:normal;">Figure&nbsp;3:</b> Camera geometry</span></center></div></center>

<p></p><p>

Now the inevitable tricky part.
While our 3D space has the conventions above, this conflicts with our image coordinates,
where we want to have the zeroth pixel in the top-left and work our way down to the last pixel at
the bottom right.
This means that our image coordinate Y-axis is inverted: Y increases going down the image.

</p><p>

As we scan our image, we will start at the upper left pixel (pixel <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-17-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-98" style="width: 1.817em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.462em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.401em, 1001.42em, 2.563em, -1000em); top: -2.218em; left: 0em;"><span class="mrow" id="MathJax-Span-99"><span class="mn" id="MathJax-Span-100" style="font-family: MathJax_Main;">0</span><span class="mo" id="MathJax-Span-101" style="font-family: MathJax_Main;">,</span><span class="mn" id="MathJax-Span-102" style="font-family: MathJax_Main; padding-left: 0.167em;">0</span></span><span style="display: inline-block; width: 0px; height: 2.218em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.303em; border-left: 0px solid; width: 0px; height: 1.191em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>0</mn><mo>,</mo><mn>0</mn></math></span></span><script type="math/tex" id="MathJax-Element-17">0,0</script>), scan left-to-right across
each row, and then scan row-by-row, top-to-bottom.
To help navigate the pixel grid, we'll use a vector from the left edge to the right edge
(<span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-18-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;msub&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;V&lt;/mi&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;u&lt;/mi&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-103" style="width: 1.767em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.411em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(0.171em, 1001.41em, 1.314em, -1000em); top: -1.008em; left: 0em;"><span class="mrow" id="MathJax-Span-104"><span class="texatom" id="MathJax-Span-105"><span class="mrow" id="MathJax-Span-106"><span class="msubsup" id="MathJax-Span-107"><span style="display: inline-block; position: relative; width: 1.396em; height: 0px;"><span style="position: absolute; clip: rect(3.145em, 1000.84em, 4.14em, -1000em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-108" style="font-family: MathJax_Main; font-weight: bold;">V</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; top: -3.832em; left: 0.869em;"><span class="mi" id="MathJax-Span-109" style="font-size: 70.7%; font-family: MathJax_Main; font-weight: bold;">u</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 1.008em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.254em; border-left: 0px solid; width: 0px; height: 1.167em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><msub><mi mathvariant="bold">V</mi><mi mathvariant="bold">u</mi></msub></mrow></math></span></span><script type="math/tex" id="MathJax-Element-18">\mathbf{V_u}</script>), and a vector from the upper edge to the lower edge (<span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-19-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;msub&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;V&lt;/mi&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;v&lt;/mi&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-110" style="width: 1.716em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.361em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(0.171em, 1001.36em, 1.311em, -1000em); top: -1.008em; left: 0em;"><span class="mrow" id="MathJax-Span-111"><span class="texatom" id="MathJax-Span-112"><span class="mrow" id="MathJax-Span-113"><span class="msubsup" id="MathJax-Span-114"><span style="display: inline-block; position: relative; width: 1.373em; height: 0px;"><span style="position: absolute; clip: rect(3.145em, 1000.84em, 4.14em, -1000em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-115" style="font-family: MathJax_Main; font-weight: bold;">V</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; top: -3.832em; left: 0.869em;"><span class="mi" id="MathJax-Span-116" style="font-size: 70.7%; font-family: MathJax_Main; font-weight: bold;">v</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 1.008em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.251em; border-left: 0px solid; width: 0px; height: 1.164em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><msub><mi mathvariant="bold">V</mi><mi mathvariant="bold">v</mi></msub></mrow></math></span></span><script type="math/tex" id="MathJax-Element-19">\mathbf{V_v}</script>).

</p><p>

Our pixel grid will be inset from the viewport edges by half the pixel-to-pixel distance.
This way, our viewport area is evenly divided into width × height identical regions.
Here's what our viewport and pixel grid look like:

</p><p>

  </p><center><div class="image" style=""><a href="https://raytracing.github.io/images/fig-1.04-pixel-grid.jpg" target="_blank"><img class="markdeep" src="Ray%20Tracing%20in%20One%20Weekend_files/fig-1.04-pixel-grid.jpg"></a><center><span class="imagecaption"><a class="target" name="figure_pixel-grid">&nbsp;</a><b style="font-style:normal;">Figure&nbsp;4:</b> Viewport and pixel grid</span></center></div></center>

<p></p><p>

In this figure, we have the viewport, the pixel grid for a 7×5 resolution image, the viewport
upper left corner <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-20-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;Q&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-117" style="width: 1.061em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.857em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.421em, 1000.8em, 2.612em, -1000em); top: -2.268em; left: 0em;"><span class="mrow" id="MathJax-Span-118"><span class="texatom" id="MathJax-Span-119"><span class="mrow" id="MathJax-Span-120"><span class="mi" id="MathJax-Span-121" style="font-family: MathJax_Main; font-weight: bold;">Q</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.268em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.302em; border-left: 0px solid; width: 0px; height: 1.227em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">Q</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-20">\mathbf{Q}</script>, the pixel <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-21-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;msub&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;P&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mn mathvariant=&quot;bold&quot;&gt;0&lt;/mn&gt;&lt;mo mathvariant=&quot;bold&quot;&gt;,&lt;/mo&gt;&lt;mn mathvariant=&quot;bold&quot;&gt;0&lt;/mn&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-122" style="width: 2.371em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.915em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(0.171em, 1001.92em, 1.446em, -1000em); top: -1.008em; left: 0em;"><span class="mrow" id="MathJax-Span-123"><span class="texatom" id="MathJax-Span-124"><span class="mrow" id="MathJax-Span-125"><span class="msubsup" id="MathJax-Span-126"><span style="display: inline-block; position: relative; width: 1.9em; height: 0px;"><span style="position: absolute; clip: rect(3.145em, 1000.72em, 4.133em, -1000em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-127" style="font-family: MathJax_Main; font-weight: bold;">P</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; top: -3.832em; left: 0.786em;"><span class="texatom" id="MathJax-Span-128"><span class="mrow" id="MathJax-Span-129"><span class="mn" id="MathJax-Span-130" style="font-size: 70.7%; font-family: MathJax_Main; font-weight: bold;">0</span><span class="mo" id="MathJax-Span-131" style="font-size: 70.7%; font-family: MathJax_Main; font-weight: bold;">,</span><span class="mn" id="MathJax-Span-132" style="font-size: 70.7%; font-family: MathJax_Main; font-weight: bold;">0</span></span></span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 1.008em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.419em; border-left: 0px solid; width: 0px; height: 1.332em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><msub><mi mathvariant="bold">P</mi><mrow class="MJX-TeXAtom-ORD"><mn mathvariant="bold">0</mn><mo mathvariant="bold">,</mo><mn mathvariant="bold">0</mn></mrow></msub></mrow></math></span></span><script type="math/tex" id="MathJax-Element-21">\mathbf{P_{0,0}}</script> location, the viewport vector
<span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-22-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;msub&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;V&lt;/mi&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;u&lt;/mi&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-133" style="width: 1.767em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.411em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(0.171em, 1001.41em, 1.314em, -1000em); top: -1.008em; left: 0em;"><span class="mrow" id="MathJax-Span-134"><span class="texatom" id="MathJax-Span-135"><span class="mrow" id="MathJax-Span-136"><span class="msubsup" id="MathJax-Span-137"><span style="display: inline-block; position: relative; width: 1.396em; height: 0px;"><span style="position: absolute; clip: rect(3.145em, 1000.84em, 4.14em, -1000em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-138" style="font-family: MathJax_Main; font-weight: bold;">V</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; top: -3.832em; left: 0.869em;"><span class="mi" id="MathJax-Span-139" style="font-size: 70.7%; font-family: MathJax_Main; font-weight: bold;">u</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 1.008em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.254em; border-left: 0px solid; width: 0px; height: 1.167em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><msub><mi mathvariant="bold">V</mi><mi mathvariant="bold">u</mi></msub></mrow></math></span></span><script type="math/tex" id="MathJax-Element-22">\mathbf{V_u}</script> (<code>viewport_u</code>), the viewport vector <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-23-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;msub&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;V&lt;/mi&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;v&lt;/mi&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-140" style="width: 1.716em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.361em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(0.171em, 1001.36em, 1.311em, -1000em); top: -1.008em; left: 0em;"><span class="mrow" id="MathJax-Span-141"><span class="texatom" id="MathJax-Span-142"><span class="mrow" id="MathJax-Span-143"><span class="msubsup" id="MathJax-Span-144"><span style="display: inline-block; position: relative; width: 1.373em; height: 0px;"><span style="position: absolute; clip: rect(3.145em, 1000.84em, 4.14em, -1000em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-145" style="font-family: MathJax_Main; font-weight: bold;">V</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; top: -3.832em; left: 0.869em;"><span class="mi" id="MathJax-Span-146" style="font-size: 70.7%; font-family: MathJax_Main; font-weight: bold;">v</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 1.008em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.251em; border-left: 0px solid; width: 0px; height: 1.164em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><msub><mi mathvariant="bold">V</mi><mi mathvariant="bold">v</mi></msub></mrow></math></span></span><script type="math/tex" id="MathJax-Element-23">\mathbf{V_v}</script> (<code>viewport_v</code>), and the pixel
delta vectors <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-24-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;&amp;#x0394;&lt;/mi&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;u&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-147" style="width: 2.019em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.613em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.419em, 1001.6em, 2.425em, -1000em); top: -2.268em; left: 0em;"><span class="mrow" id="MathJax-Span-148"><span class="texatom" id="MathJax-Span-149"><span class="mrow" id="MathJax-Span-150"><span class="mi" id="MathJax-Span-151" style="font-family: MathJax_Main; font-weight: bold;">Δ</span><span class="mi" id="MathJax-Span-152" style="font-family: MathJax_Main; font-weight: bold;">u</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.268em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.07em; border-left: 0px solid; width: 0px; height: 0.998em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">Δ</mi><mi mathvariant="bold">u</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-24">\mathbf{\Delta u}</script> and <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-25-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;&amp;#x0394;&lt;/mi&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;v&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-153" style="width: 1.968em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.563em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.419em, 1001.54em, 2.422em, -1000em); top: -2.268em; left: 0em;"><span class="mrow" id="MathJax-Span-154"><span class="texatom" id="MathJax-Span-155"><span class="mrow" id="MathJax-Span-156"><span class="mi" id="MathJax-Span-157" style="font-family: MathJax_Main; font-weight: bold;">Δ</span><span class="mi" id="MathJax-Span-158" style="font-family: MathJax_Main; font-weight: bold;">v</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.268em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.066em; border-left: 0px solid; width: 0px; height: 0.994em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">Δ</mi><mi mathvariant="bold">v</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-25">\mathbf{\Delta v}</script>.

</p><p>

</p><div class="together">
Drawing from all of this, here's the code that implements the camera.
We'll stub in a function <code>ray_color(const ray&amp; r)</code> that returns the color for a given scene ray
  — which we'll set to always return black for now.

<p></p><pre class="listing tilde"><code><span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"color.h"</span></span><div class=" highlight"><span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"ray.h"</span></span></div><span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"vec3.h"</span></span>
<span class="line"></span>
<span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>
<span class="line"></span>
<span class="line"></span><div class=" highlight"><span class="line"></span><span class="hljs-function">color <span class="hljs-title">ray_color</span><span class="hljs-params">(<span class="hljs-type">const</span> ray&amp; r)</span> </span>{
<span class="line"></span>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">color</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);
<span class="line"></span>}</div><span class="line"></span>
<span class="line"></span><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
<span class="line"></span>
<span class="line"></span>    <span class="hljs-comment">// Image</span>
<span class="line"></span>
<span class="line"></span><div class=" highlight"><span class="line"></span>    <span class="hljs-keyword">auto</span> aspect_ratio = <span class="hljs-number">16.0</span> / <span class="hljs-number">9.0</span>;
<span class="line"></span>    <span class="hljs-type">int</span> image_width = <span class="hljs-number">400</span>;
<span class="line"></span>
<span class="line"></span>    <span class="hljs-comment">// Calculate the image height, and ensure that it's at least 1.</span>
<span class="line"></span>    <span class="hljs-type">int</span> image_height = <span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">int</span>&gt;(image_width / aspect_ratio);
<span class="line"></span>    image_height = (image_height &lt; <span class="hljs-number">1</span>) ? <span class="hljs-number">1</span> : image_height;
<span class="line"></span>
<span class="line"></span>    <span class="hljs-comment">// Camera</span>
<span class="line"></span>
<span class="line"></span>    <span class="hljs-keyword">auto</span> focal_length = <span class="hljs-number">1.0</span>;
<span class="line"></span>    <span class="hljs-keyword">auto</span> viewport_height = <span class="hljs-number">2.0</span>;
<span class="line"></span>    <span class="hljs-keyword">auto</span> viewport_width = viewport_height * (<span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">double</span>&gt;(image_width)/image_height);
<span class="line"></span>    <span class="hljs-keyword">auto</span> camera_center = <span class="hljs-built_in">point3</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);
<span class="line"></span>
<span class="line"></span>    <span class="hljs-comment">// Calculate the vectors across the horizontal and down the vertical viewport edges.</span>
<span class="line"></span>    <span class="hljs-keyword">auto</span> viewport_u = <span class="hljs-built_in">vec3</span>(viewport_width, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);
<span class="line"></span>    <span class="hljs-keyword">auto</span> viewport_v = <span class="hljs-built_in">vec3</span>(<span class="hljs-number">0</span>, -viewport_height, <span class="hljs-number">0</span>);
<span class="line"></span>
<span class="line"></span>    <span class="hljs-comment">// Calculate the horizontal and vertical delta vectors from pixel to pixel.</span>
<span class="line"></span>    <span class="hljs-keyword">auto</span> pixel_delta_u = viewport_u / image_width;
<span class="line"></span>    <span class="hljs-keyword">auto</span> pixel_delta_v = viewport_v / image_height;
<span class="line"></span>
<span class="line"></span>    <span class="hljs-comment">// Calculate the location of the upper left pixel.</span>
<span class="line"></span>    <span class="hljs-keyword">auto</span> viewport_upper_left = camera_center
<span class="line"></span>                             - <span class="hljs-built_in">vec3</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, focal_length) - viewport_u/<span class="hljs-number">2</span> - viewport_v/<span class="hljs-number">2</span>;
<span class="line"></span>    <span class="hljs-keyword">auto</span> pixel00_loc = viewport_upper_left + <span class="hljs-number">0.5</span> * (pixel_delta_u + pixel_delta_v);</div><span class="line"></span>
<span class="line"></span>    <span class="hljs-comment">// Render</span>
<span class="line"></span>
<span class="line"></span>    std::cout &lt;&lt; <span class="hljs-string">"P3\n"</span> &lt;&lt; image_width &lt;&lt; <span class="hljs-string">" "</span> &lt;&lt; image_height &lt;&lt; <span class="hljs-string">"\n255\n"</span>;
<span class="line"></span>
<span class="line"></span>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> j = <span class="hljs-number">0</span>; j &lt; image_height; ++j) {
<span class="line"></span>        std::clog &lt;&lt; <span class="hljs-string">"\rScanlines remaining: "</span> &lt;&lt; (image_height - j) &lt;&lt; <span class="hljs-string">' '</span> &lt;&lt; std::flush;
<span class="line"></span>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; image_width; ++i) {<div class=" highlight"><span class="line"></span>            <span class="hljs-keyword">auto</span> pixel_center = pixel00_loc + (i * pixel_delta_u) + (j * pixel_delta_v);
<span class="line"></span>            <span class="hljs-keyword">auto</span> ray_direction = pixel_center - camera_center;
<span class="line"></span>            <span class="hljs-function">ray <span class="hljs-title">r</span><span class="hljs-params">(camera_center, ray_direction)</span></span>;
<span class="line"></span>
<span class="line"></span>            color pixel_color = <span class="hljs-built_in">ray_color</span>(r);</div><span class="line"></span>            <span class="hljs-built_in">write_color</span>(std::cout, pixel_color);
<span class="line"></span>        }
<span class="line"></span>    }
<span class="line"></span>
<span class="line"></span>    std::clog &lt;&lt; <span class="hljs-string">"\rDone.                 \n"</span>;
<span class="line"></span>}</code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_creating-rays">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;9:</b> <kbd>[main.cc]</kbd> Creating scene rays</div></center>
<p>


</p></div>

<p></p><p>

Notice that in the code above, I didn't make <code>ray_direction</code> a unit vector, because I think not
doing that makes for simpler and slightly faster code.

</p><p>

Now we'll fill in the <code>ray_color(ray)</code> function to implement a simple gradient.
This function will linearly blend white and blue depending on the height of the <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-26-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-159" style="width: 0.658em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.504em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.625em, 1000.5em, 2.574em, -1000em); top: -2.218em; left: 0em;"><span class="mrow" id="MathJax-Span-160"><span class="mi" id="MathJax-Span-161" style="font-family: MathJax_Math; font-style: italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.006em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.218em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.317em; border-left: 0px solid; width: 0px; height: 0.927em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>y</mi></math></span></span><script type="math/tex" id="MathJax-Element-26">y</script> coordinate
<em class="underscore">after</em> scaling the ray direction to unit length (so <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-27-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mn&gt;1.0&lt;/mn&gt;&lt;mo&gt;&amp;lt;&lt;/mo&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mo&gt;&amp;lt;&lt;/mo&gt;&lt;mn&gt;1.0&lt;/mn&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-162" style="width: 8.067em; display: inline-block;"><span style="display: inline-block; position: relative; width: 6.502em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.451em, 1006.46em, 2.624em, -1000em); top: -2.268em; left: 0em;"><span class="mrow" id="MathJax-Span-163"><span class="mo" id="MathJax-Span-164" style="font-family: MathJax_Main;">−</span><span class="mn" id="MathJax-Span-165" style="font-family: MathJax_Main;">1.0</span><span class="mo" id="MathJax-Span-166" style="font-family: MathJax_Main; padding-left: 0.278em;">&lt;</span><span class="mi" id="MathJax-Span-167" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.278em;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.006em;"></span></span><span class="mo" id="MathJax-Span-168" style="font-family: MathJax_Main; padding-left: 0.278em;">&lt;</span><span class="mn" id="MathJax-Span-169" style="font-family: MathJax_Main; padding-left: 0.278em;">1.0</span></span><span style="display: inline-block; width: 0px; height: 2.268em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.317em; border-left: 0px solid; width: 0px; height: 1.205em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>−</mo><mn>1.0</mn><mo>&lt;</mo><mi>y</mi><mo>&lt;</mo><mn>1.0</mn></math></span></span><script type="math/tex" id="MathJax-Element-27">-1.0 < y < 1.0</script>).
Because we're looking at the <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-28-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-170" style="width: 0.658em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.504em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.625em, 1000.5em, 2.574em, -1000em); top: -2.218em; left: 0em;"><span class="mrow" id="MathJax-Span-171"><span class="mi" id="MathJax-Span-172" style="font-family: MathJax_Math; font-style: italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.006em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.218em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.317em; border-left: 0px solid; width: 0px; height: 0.927em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>y</mi></math></span></span><script type="math/tex" id="MathJax-Element-28">y</script> height after normalizing the vector, you'll notice a horizontal
gradient to the color in addition to the vertical gradient.

</p><p>

I'll use a standard graphics trick to linearly scale <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-29-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mn&gt;0.0&lt;/mn&gt;&lt;mo&gt;&amp;#x2264;&lt;/mo&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mo&gt;&amp;#x2264;&lt;/mo&gt;&lt;mn&gt;1.0&lt;/mn&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-173" style="width: 7.16em; display: inline-block;"><span style="display: inline-block; position: relative; width: 5.746em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.451em, 1005.71em, 2.557em, -1000em); top: -2.268em; left: 0em;"><span class="mrow" id="MathJax-Span-174"><span class="mn" id="MathJax-Span-175" style="font-family: MathJax_Main;">0.0</span><span class="mo" id="MathJax-Span-176" style="font-family: MathJax_Main; padding-left: 0.278em;">≤</span><span class="mi" id="MathJax-Span-177" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.278em;">a</span><span class="mo" id="MathJax-Span-178" style="font-family: MathJax_Main; padding-left: 0.278em;">≤</span><span class="mn" id="MathJax-Span-179" style="font-family: MathJax_Main; padding-left: 0.278em;">1.0</span></span><span style="display: inline-block; width: 0px; height: 2.268em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.234em; border-left: 0px solid; width: 0px; height: 1.122em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>0.0</mn><mo>≤</mo><mi>a</mi><mo>≤</mo><mn>1.0</mn></math></span></span><script type="math/tex" id="MathJax-Element-29">0.0 ≤ a ≤ 1.0</script>.
When <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-30-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;1.0&lt;/mn&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-180" style="width: 3.884em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.125em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.451em, 1003.09em, 2.441em, -1000em); top: -2.268em; left: 0em;"><span class="mrow" id="MathJax-Span-181"><span class="mi" id="MathJax-Span-182" style="font-family: MathJax_Math; font-style: italic;">a</span><span class="mo" id="MathJax-Span-183" style="font-family: MathJax_Main; padding-left: 0.278em;">=</span><span class="mn" id="MathJax-Span-184" style="font-family: MathJax_Main; padding-left: 0.278em;">1.0</span></span><span style="display: inline-block; width: 0px; height: 2.268em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.09em; border-left: 0px solid; width: 0px; height: 0.978em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>a</mi><mo>=</mo><mn>1.0</mn></math></span></span><script type="math/tex" id="MathJax-Element-30">a = 1.0</script>, I want blue.
When <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-31-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;0.0&lt;/mn&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-185" style="width: 3.884em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.125em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.451em, 1003.09em, 2.441em, -1000em); top: -2.268em; left: 0em;"><span class="mrow" id="MathJax-Span-186"><span class="mi" id="MathJax-Span-187" style="font-family: MathJax_Math; font-style: italic;">a</span><span class="mo" id="MathJax-Span-188" style="font-family: MathJax_Main; padding-left: 0.278em;">=</span><span class="mn" id="MathJax-Span-189" style="font-family: MathJax_Main; padding-left: 0.278em;">0.0</span></span><span style="display: inline-block; width: 0px; height: 2.268em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.09em; border-left: 0px solid; width: 0px; height: 0.978em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>a</mi><mo>=</mo><mn>0.0</mn></math></span></span><script type="math/tex" id="MathJax-Element-31">a = 0.0</script>, I want white.
In between, I want a blend.
This forms a “linear blend”, or “linear interpolation”.
This is commonly referred to as a <em class="underscore">lerp</em> between two values.
A lerp is always of the form

</p><p>

  <span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-32-Frame" tabindex="0" style="text-align: center; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;b&lt;/mi&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;l&lt;/mi&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;e&lt;/mi&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;n&lt;/mi&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;d&lt;/mi&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;e&lt;/mi&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;d&lt;/mi&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;V&lt;/mi&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;a&lt;/mi&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;l&lt;/mi&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;u&lt;/mi&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;e&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;s&lt;/mi&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;t&lt;/mi&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;a&lt;/mi&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;r&lt;/mi&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;t&lt;/mi&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;V&lt;/mi&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;a&lt;/mi&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;l&lt;/mi&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;u&lt;/mi&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;e&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;e&lt;/mi&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;n&lt;/mi&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;d&lt;/mi&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;V&lt;/mi&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;a&lt;/mi&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;l&lt;/mi&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;u&lt;/mi&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;e&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-190" style="width: 27.472em; display: inline-block;"><span style="display: inline-block; position: relative; width: 22.127em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.518em, 1022.06em, 2.821em, -1000em); top: -2.419em; left: 0em;"><span class="mrow" id="MathJax-Span-191"><span class="texatom" id="MathJax-Span-192"><span class="mrow" id="MathJax-Span-193"><span class="mi" id="MathJax-Span-194" style="font-family: MathJax_Main; font-style: italic;">b</span><span class="mi" id="MathJax-Span-195" style="font-family: MathJax_Main; font-style: italic;">l</span><span class="mi" id="MathJax-Span-196" style="font-family: MathJax_Main; font-style: italic;">e</span><span class="mi" id="MathJax-Span-197" style="font-family: MathJax_Main; font-style: italic;">n</span><span class="mi" id="MathJax-Span-198" style="font-family: MathJax_Main; font-style: italic;">d</span><span class="mi" id="MathJax-Span-199" style="font-family: MathJax_Main; font-style: italic;">e</span><span class="mi" id="MathJax-Span-200" style="font-family: MathJax_Main; font-style: italic;">d</span><span class="mi" id="MathJax-Span-201" style="font-family: MathJax_Main; font-style: italic;">V</span><span class="mi" id="MathJax-Span-202" style="font-family: MathJax_Main; font-style: italic;">a</span><span class="mi" id="MathJax-Span-203" style="font-family: MathJax_Main; font-style: italic;">l</span><span class="mi" id="MathJax-Span-204" style="font-family: MathJax_Main; font-style: italic;">u</span><span class="mi" id="MathJax-Span-205" style="font-family: MathJax_Main; font-style: italic;">e</span></span></span><span class="mo" id="MathJax-Span-206" style="font-family: MathJax_Main; padding-left: 0.278em;">=</span><span class="mo" id="MathJax-Span-207" style="font-family: MathJax_Main; padding-left: 0.278em;">(</span><span class="mn" id="MathJax-Span-208" style="font-family: MathJax_Main;">1</span><span class="mo" id="MathJax-Span-209" style="font-family: MathJax_Main; padding-left: 0.222em;">−</span><span class="mi" id="MathJax-Span-210" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.222em;">a</span><span class="mo" id="MathJax-Span-211" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-212" style="font-family: MathJax_Main; padding-left: 0.222em;">⋅</span><span class="texatom" id="MathJax-Span-213" style="padding-left: 0.222em;"><span class="mrow" id="MathJax-Span-214"><span class="mi" id="MathJax-Span-215" style="font-family: MathJax_Main; font-style: italic;">s</span><span class="mi" id="MathJax-Span-216" style="font-family: MathJax_Main; font-style: italic;">t</span><span class="mi" id="MathJax-Span-217" style="font-family: MathJax_Main; font-style: italic;">a</span><span class="mi" id="MathJax-Span-218" style="font-family: MathJax_Main; font-style: italic;">r</span><span class="mi" id="MathJax-Span-219" style="font-family: MathJax_Main; font-style: italic;">t</span><span class="mi" id="MathJax-Span-220" style="font-family: MathJax_Main; font-style: italic;">V</span><span class="mi" id="MathJax-Span-221" style="font-family: MathJax_Main; font-style: italic;">a</span><span class="mi" id="MathJax-Span-222" style="font-family: MathJax_Main; font-style: italic;">l</span><span class="mi" id="MathJax-Span-223" style="font-family: MathJax_Main; font-style: italic;">u</span><span class="mi" id="MathJax-Span-224" style="font-family: MathJax_Main; font-style: italic;">e</span></span></span><span class="mo" id="MathJax-Span-225" style="font-family: MathJax_Main; padding-left: 0.222em;">+</span><span class="mi" id="MathJax-Span-226" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.222em;">a</span><span class="mo" id="MathJax-Span-227" style="font-family: MathJax_Main; padding-left: 0.222em;">⋅</span><span class="texatom" id="MathJax-Span-228" style="padding-left: 0.222em;"><span class="mrow" id="MathJax-Span-229"><span class="mi" id="MathJax-Span-230" style="font-family: MathJax_Main; font-style: italic;">e</span><span class="mi" id="MathJax-Span-231" style="font-family: MathJax_Main; font-style: italic;">n</span><span class="mi" id="MathJax-Span-232" style="font-family: MathJax_Main; font-style: italic;">d</span><span class="mi" id="MathJax-Span-233" style="font-family: MathJax_Main; font-style: italic;">V</span><span class="mi" id="MathJax-Span-234" style="font-family: MathJax_Main; font-style: italic;">a</span><span class="mi" id="MathJax-Span-235" style="font-family: MathJax_Main; font-style: italic;">l</span><span class="mi" id="MathJax-Span-236" style="font-family: MathJax_Main; font-style: italic;">u</span><span class="mi" id="MathJax-Span-237" style="font-family: MathJax_Main; font-style: italic;">e</span></span></span><span class="mo" id="MathJax-Span-238" style="font-family: MathJax_Main;">,</span></span><span style="display: inline-block; width: 0px; height: 2.419em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.365em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow class="MJX-TeXAtom-ORD"><mi class="MJX-tex-mathit" mathvariant="italic">b</mi><mi class="MJX-tex-mathit" mathvariant="italic">l</mi><mi class="MJX-tex-mathit" mathvariant="italic">e</mi><mi class="MJX-tex-mathit" mathvariant="italic">n</mi><mi class="MJX-tex-mathit" mathvariant="italic">d</mi><mi class="MJX-tex-mathit" mathvariant="italic">e</mi><mi class="MJX-tex-mathit" mathvariant="italic">d</mi><mi class="MJX-tex-mathit" mathvariant="italic">V</mi><mi class="MJX-tex-mathit" mathvariant="italic">a</mi><mi class="MJX-tex-mathit" mathvariant="italic">l</mi><mi class="MJX-tex-mathit" mathvariant="italic">u</mi><mi class="MJX-tex-mathit" mathvariant="italic">e</mi></mrow><mo>=</mo><mo stretchy="false">(</mo><mn>1</mn><mo>−</mo><mi>a</mi><mo stretchy="false">)</mo><mo>⋅</mo><mrow class="MJX-TeXAtom-ORD"><mi class="MJX-tex-mathit" mathvariant="italic">s</mi><mi class="MJX-tex-mathit" mathvariant="italic">t</mi><mi class="MJX-tex-mathit" mathvariant="italic">a</mi><mi class="MJX-tex-mathit" mathvariant="italic">r</mi><mi class="MJX-tex-mathit" mathvariant="italic">t</mi><mi class="MJX-tex-mathit" mathvariant="italic">V</mi><mi class="MJX-tex-mathit" mathvariant="italic">a</mi><mi class="MJX-tex-mathit" mathvariant="italic">l</mi><mi class="MJX-tex-mathit" mathvariant="italic">u</mi><mi class="MJX-tex-mathit" mathvariant="italic">e</mi></mrow><mo>+</mo><mi>a</mi><mo>⋅</mo><mrow class="MJX-TeXAtom-ORD"><mi class="MJX-tex-mathit" mathvariant="italic">e</mi><mi class="MJX-tex-mathit" mathvariant="italic">n</mi><mi class="MJX-tex-mathit" mathvariant="italic">d</mi><mi class="MJX-tex-mathit" mathvariant="italic">V</mi><mi class="MJX-tex-mathit" mathvariant="italic">a</mi><mi class="MJX-tex-mathit" mathvariant="italic">l</mi><mi class="MJX-tex-mathit" mathvariant="italic">u</mi><mi class="MJX-tex-mathit" mathvariant="italic">e</mi></mrow><mo>,</mo></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-32"> \mathit{blendedValue} = (1-a)\cdot\mathit{startValue} + a\cdot\mathit{endValue}, </script>

</p><p>

with <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-33-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-239" style="width: 0.708em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.554em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.626em, 1000.53em, 2.379em, -1000em); top: -2.218em; left: 0em;"><span class="mrow" id="MathJax-Span-240"><span class="mi" id="MathJax-Span-241" style="font-family: MathJax_Math; font-style: italic;">a</span></span><span style="display: inline-block; width: 0px; height: 2.218em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.075em; border-left: 0px solid; width: 0px; height: 0.684em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>a</mi></math></span></span><script type="math/tex" id="MathJax-Element-33">a</script> going from zero to one.

</p><p>

</p><div class="together">
Putting all this together, here's what we get:

<p></p><pre class="listing tilde"><code><span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"color.h"</span></span>
<span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"ray.h"</span></span>
<span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"vec3.h"</span></span>
<span class="line"></span>
<span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span><span class="hljs-function">color <span class="hljs-title">ray_color</span><span class="hljs-params">(<span class="hljs-type">const</span> ray&amp; r)</span> </span>{<div class=" highlight"><span class="line"></span>    vec3 unit_direction = <span class="hljs-built_in">unit_vector</span>(r.<span class="hljs-built_in">direction</span>());
<span class="line"></span>    <span class="hljs-keyword">auto</span> a = <span class="hljs-number">0.5</span>*(unit_direction.<span class="hljs-built_in">y</span>() + <span class="hljs-number">1.0</span>);
<span class="line"></span>    <span class="hljs-keyword">return</span> (<span class="hljs-number">1.0</span>-a)*<span class="hljs-built_in">color</span>(<span class="hljs-number">1.0</span>, <span class="hljs-number">1.0</span>, <span class="hljs-number">1.0</span>) + a*<span class="hljs-built_in">color</span>(<span class="hljs-number">0.5</span>, <span class="hljs-number">0.7</span>, <span class="hljs-number">1.0</span>);</div><span class="line"></span>}
<span class="line"></span>
<span class="line"></span>...</code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_main-blue-white-blend">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;10:</b> <kbd>[main.cc]</kbd> Rendering a blue-to-white gradient</div></center>
<p>


</p></div>

<p></p><p>

</p><div class="together">
In our case this produces:

<p></p><p>

  </p><center><div class="image" style=""><a href="https://raytracing.github.io/images/img-1.02-blue-to-white.png" target="_blank"><img class="markdeep pixel" src="Ray%20Tracing%20in%20One%20Weekend_files/img-1.02-blue-to-white.png"></a><center><span class="imagecaption"><span class="num">Image 2:</span> A blue-to-white gradient depending on ray Y coordinate
  </span></center></div></center>

<p></p><p>

</p></div>

<p></p>
<a class="target" name="addingasphere">&nbsp;</a><a class="target" name="addingasphere">&nbsp;</a><a class="target" name="toc5">&nbsp;</a><h1>Adding a Sphere</h1>
<p>

Let’s add a single object to our ray tracer. People often use spheres in ray tracers because
calculating whether a ray hits a sphere is relatively simple.

</p>
<a class="target" name="ray-sphereintersection">&nbsp;</a><a class="target" name="addingasphere/ray-sphereintersection">&nbsp;</a><a class="target" name="toc5.1">&nbsp;</a><h2>Ray-Sphere Intersection</h2>
<p>

The equation for a sphere of radius <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-34-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-242" style="width: 0.557em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.454em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.625em, 1000.43em, 2.38em, -1000em); top: -2.218em; left: 0em;"><span class="mrow" id="MathJax-Span-243"><span class="mi" id="MathJax-Span-244" style="font-family: MathJax_Math; font-style: italic;">r</span></span><span style="display: inline-block; width: 0px; height: 2.218em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.076em; border-left: 0px solid; width: 0px; height: 0.687em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>r</mi></math></span></span><script type="math/tex" id="MathJax-Element-34">r</script> that is centered at the origin is an important mathematical
equation:

</p><p>

    <span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-35-Frame" tabindex="0" style="text-align: center; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;msup&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-245" style="width: 9.378em; display: inline-block;"><span style="display: inline-block; position: relative; width: 7.56em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.334em, 1007.56em, 2.725em, -1000em); top: -2.369em; left: 0em;"><span class="mrow" id="MathJax-Span-246"><span class="msubsup" id="MathJax-Span-247"><span style="display: inline-block; position: relative; width: 1.001em; height: 0px;"><span style="position: absolute; clip: rect(3.389em, 1000.52em, 4.144em, -1000em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-248" style="font-family: MathJax_Math; font-style: italic;">x</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; top: -4.395em; left: 0.572em;"><span class="mn" id="MathJax-Span-249" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span></span><span class="mo" id="MathJax-Span-250" style="font-family: MathJax_Main; padding-left: 0.222em;">+</span><span class="msubsup" id="MathJax-Span-251" style="padding-left: 0.222em;"><span style="display: inline-block; position: relative; width: 0.976em; height: 0px;"><span style="position: absolute; clip: rect(3.389em, 1000.5em, 4.338em, -1000em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-252" style="font-family: MathJax_Math; font-style: italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.006em;"></span></span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; top: -4.395em; left: 0.548em;"><span class="mn" id="MathJax-Span-253" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span></span><span class="mo" id="MathJax-Span-254" style="font-family: MathJax_Main; padding-left: 0.222em;">+</span><span class="msubsup" id="MathJax-Span-255" style="padding-left: 0.222em;"><span style="display: inline-block; position: relative; width: 0.947em; height: 0px;"><span style="position: absolute; clip: rect(3.389em, 1000.47em, 4.144em, -1000em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-256" style="font-family: MathJax_Math; font-style: italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; top: -4.395em; left: 0.519em;"><span class="mn" id="MathJax-Span-257" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span></span><span class="mo" id="MathJax-Span-258" style="font-family: MathJax_Main; padding-left: 0.278em;">=</span><span class="msubsup" id="MathJax-Span-259" style="padding-left: 0.278em;"><span style="display: inline-block; position: relative; width: 0.88em; height: 0px;"><span style="position: absolute; clip: rect(3.389em, 1000.43em, 4.144em, -1000em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-260" style="font-family: MathJax_Math; font-style: italic;">r</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; top: -4.395em; left: 0.451em;"><span class="mn" id="MathJax-Span-261" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.369em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.317em; border-left: 0px solid; width: 0px; height: 1.475em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><msup><mi>x</mi><mn>2</mn></msup><mo>+</mo><msup><mi>y</mi><mn>2</mn></msup><mo>+</mo><msup><mi>z</mi><mn>2</mn></msup><mo>=</mo><msup><mi>r</mi><mn>2</mn></msup></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-35"> x^2 + y^2 + z^2 = r^2 </script>

</p><p>

You can also think of this as saying that if a given point <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-36-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-262" style="width: 4.035em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.226em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.367em, 1003.13em, 2.669em, -1000em); top: -2.268em; left: 0em;"><span class="mrow" id="MathJax-Span-263"><span class="mo" id="MathJax-Span-264" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-265" style="font-family: MathJax_Math; font-style: italic;">x</span><span class="mo" id="MathJax-Span-266" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-267" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.167em;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.006em;"></span></span><span class="mo" id="MathJax-Span-268" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-269" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.167em;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-270" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.268em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.365em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">(</mo><mi>x</mi><mo>,</mo><mi>y</mi><mo>,</mo><mi>z</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-36">(x,y,z)</script> is on
the sphere, then <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-37-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msup&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-271" style="width: 9.378em; display: inline-block;"><span style="display: inline-block; position: relative; width: 7.56em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.384em, 1007.56em, 2.725em, -1000em); top: -2.369em; left: 0em;"><span class="mrow" id="MathJax-Span-272"><span class="msubsup" id="MathJax-Span-273"><span style="display: inline-block; position: relative; width: 1.001em; height: 0px;"><span style="position: absolute; clip: rect(3.389em, 1000.52em, 4.144em, -1000em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-274" style="font-family: MathJax_Math; font-style: italic;">x</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; top: -4.345em; left: 0.572em;"><span class="mn" id="MathJax-Span-275" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span></span><span class="mo" id="MathJax-Span-276" style="font-family: MathJax_Main; padding-left: 0.222em;">+</span><span class="msubsup" id="MathJax-Span-277" style="padding-left: 0.222em;"><span style="display: inline-block; position: relative; width: 0.976em; height: 0px;"><span style="position: absolute; clip: rect(3.389em, 1000.5em, 4.338em, -1000em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-278" style="font-family: MathJax_Math; font-style: italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.006em;"></span></span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; top: -4.345em; left: 0.548em;"><span class="mn" id="MathJax-Span-279" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span></span><span class="mo" id="MathJax-Span-280" style="font-family: MathJax_Main; padding-left: 0.222em;">+</span><span class="msubsup" id="MathJax-Span-281" style="padding-left: 0.222em;"><span style="display: inline-block; position: relative; width: 0.947em; height: 0px;"><span style="position: absolute; clip: rect(3.389em, 1000.47em, 4.144em, -1000em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-282" style="font-family: MathJax_Math; font-style: italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; top: -4.345em; left: 0.519em;"><span class="mn" id="MathJax-Span-283" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span></span><span class="mo" id="MathJax-Span-284" style="font-family: MathJax_Main; padding-left: 0.278em;">=</span><span class="msubsup" id="MathJax-Span-285" style="padding-left: 0.278em;"><span style="display: inline-block; position: relative; width: 0.88em; height: 0px;"><span style="position: absolute; clip: rect(3.389em, 1000.43em, 4.144em, -1000em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-286" style="font-family: MathJax_Math; font-style: italic;">r</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; top: -4.345em; left: 0.451em;"><span class="mn" id="MathJax-Span-287" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.369em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.317em; border-left: 0px solid; width: 0px; height: 1.413em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mi>x</mi><mn>2</mn></msup><mo>+</mo><msup><mi>y</mi><mn>2</mn></msup><mo>+</mo><msup><mi>z</mi><mn>2</mn></msup><mo>=</mo><msup><mi>r</mi><mn>2</mn></msup></math></span></span><script type="math/tex" id="MathJax-Element-37">x^2 + y^2 + z^2 = r^2</script>. If a given point <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-38-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-288" style="width: 4.035em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.226em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.367em, 1003.13em, 2.669em, -1000em); top: -2.268em; left: 0em;"><span class="mrow" id="MathJax-Span-289"><span class="mo" id="MathJax-Span-290" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-291" style="font-family: MathJax_Math; font-style: italic;">x</span><span class="mo" id="MathJax-Span-292" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-293" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.167em;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.006em;"></span></span><span class="mo" id="MathJax-Span-294" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-295" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.167em;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-296" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.268em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.365em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">(</mo><mi>x</mi><mo>,</mo><mi>y</mi><mo>,</mo><mi>z</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-38">(x,y,z)</script> is <em class="underscore">inside</em> the sphere, then
<span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-39-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msup&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;mo&gt;&amp;lt;&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-297" style="width: 9.378em; display: inline-block;"><span style="display: inline-block; position: relative; width: 7.56em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.384em, 1007.56em, 2.725em, -1000em); top: -2.369em; left: 0em;"><span class="mrow" id="MathJax-Span-298"><span class="msubsup" id="MathJax-Span-299"><span style="display: inline-block; position: relative; width: 1.001em; height: 0px;"><span style="position: absolute; clip: rect(3.389em, 1000.52em, 4.144em, -1000em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-300" style="font-family: MathJax_Math; font-style: italic;">x</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; top: -4.345em; left: 0.572em;"><span class="mn" id="MathJax-Span-301" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span></span><span class="mo" id="MathJax-Span-302" style="font-family: MathJax_Main; padding-left: 0.222em;">+</span><span class="msubsup" id="MathJax-Span-303" style="padding-left: 0.222em;"><span style="display: inline-block; position: relative; width: 0.976em; height: 0px;"><span style="position: absolute; clip: rect(3.389em, 1000.5em, 4.338em, -1000em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-304" style="font-family: MathJax_Math; font-style: italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.006em;"></span></span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; top: -4.345em; left: 0.548em;"><span class="mn" id="MathJax-Span-305" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span></span><span class="mo" id="MathJax-Span-306" style="font-family: MathJax_Main; padding-left: 0.222em;">+</span><span class="msubsup" id="MathJax-Span-307" style="padding-left: 0.222em;"><span style="display: inline-block; position: relative; width: 0.947em; height: 0px;"><span style="position: absolute; clip: rect(3.389em, 1000.47em, 4.144em, -1000em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-308" style="font-family: MathJax_Math; font-style: italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; top: -4.345em; left: 0.519em;"><span class="mn" id="MathJax-Span-309" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span></span><span class="mo" id="MathJax-Span-310" style="font-family: MathJax_Main; padding-left: 0.278em;">&lt;</span><span class="msubsup" id="MathJax-Span-311" style="padding-left: 0.278em;"><span style="display: inline-block; position: relative; width: 0.88em; height: 0px;"><span style="position: absolute; clip: rect(3.389em, 1000.43em, 4.144em, -1000em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-312" style="font-family: MathJax_Math; font-style: italic;">r</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; top: -4.345em; left: 0.451em;"><span class="mn" id="MathJax-Span-313" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.369em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.317em; border-left: 0px solid; width: 0px; height: 1.413em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mi>x</mi><mn>2</mn></msup><mo>+</mo><msup><mi>y</mi><mn>2</mn></msup><mo>+</mo><msup><mi>z</mi><mn>2</mn></msup><mo>&lt;</mo><msup><mi>r</mi><mn>2</mn></msup></math></span></span><script type="math/tex" id="MathJax-Element-39">x^2 + y^2 + z^2 < r^2</script>, and if a given point <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-40-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-314" style="width: 4.035em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.226em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.367em, 1003.13em, 2.669em, -1000em); top: -2.268em; left: 0em;"><span class="mrow" id="MathJax-Span-315"><span class="mo" id="MathJax-Span-316" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-317" style="font-family: MathJax_Math; font-style: italic;">x</span><span class="mo" id="MathJax-Span-318" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-319" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.167em;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.006em;"></span></span><span class="mo" id="MathJax-Span-320" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-321" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.167em;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-322" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.268em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.365em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">(</mo><mi>x</mi><mo>,</mo><mi>y</mi><mo>,</mo><mi>z</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-40">(x,y,z)</script> is <em class="underscore">outside</em> the sphere, then
<span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-41-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msup&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;mo&gt;&amp;gt;&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-323" style="width: 9.378em; display: inline-block;"><span style="display: inline-block; position: relative; width: 7.56em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.384em, 1007.56em, 2.725em, -1000em); top: -2.369em; left: 0em;"><span class="mrow" id="MathJax-Span-324"><span class="msubsup" id="MathJax-Span-325"><span style="display: inline-block; position: relative; width: 1.001em; height: 0px;"><span style="position: absolute; clip: rect(3.389em, 1000.52em, 4.144em, -1000em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-326" style="font-family: MathJax_Math; font-style: italic;">x</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; top: -4.345em; left: 0.572em;"><span class="mn" id="MathJax-Span-327" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span></span><span class="mo" id="MathJax-Span-328" style="font-family: MathJax_Main; padding-left: 0.222em;">+</span><span class="msubsup" id="MathJax-Span-329" style="padding-left: 0.222em;"><span style="display: inline-block; position: relative; width: 0.976em; height: 0px;"><span style="position: absolute; clip: rect(3.389em, 1000.5em, 4.338em, -1000em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-330" style="font-family: MathJax_Math; font-style: italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.006em;"></span></span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; top: -4.345em; left: 0.548em;"><span class="mn" id="MathJax-Span-331" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span></span><span class="mo" id="MathJax-Span-332" style="font-family: MathJax_Main; padding-left: 0.222em;">+</span><span class="msubsup" id="MathJax-Span-333" style="padding-left: 0.222em;"><span style="display: inline-block; position: relative; width: 0.947em; height: 0px;"><span style="position: absolute; clip: rect(3.389em, 1000.47em, 4.144em, -1000em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-334" style="font-family: MathJax_Math; font-style: italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; top: -4.345em; left: 0.519em;"><span class="mn" id="MathJax-Span-335" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span></span><span class="mo" id="MathJax-Span-336" style="font-family: MathJax_Main; padding-left: 0.278em;">&gt;</span><span class="msubsup" id="MathJax-Span-337" style="padding-left: 0.278em;"><span style="display: inline-block; position: relative; width: 0.88em; height: 0px;"><span style="position: absolute; clip: rect(3.389em, 1000.43em, 4.144em, -1000em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-338" style="font-family: MathJax_Math; font-style: italic;">r</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; top: -4.345em; left: 0.451em;"><span class="mn" id="MathJax-Span-339" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.369em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.317em; border-left: 0px solid; width: 0px; height: 1.413em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mi>x</mi><mn>2</mn></msup><mo>+</mo><msup><mi>y</mi><mn>2</mn></msup><mo>+</mo><msup><mi>z</mi><mn>2</mn></msup><mo>&gt;</mo><msup><mi>r</mi><mn>2</mn></msup></math></span></span><script type="math/tex" id="MathJax-Element-41">x^2 + y^2 + z^2 > r^2</script>.

</p><p>

If we want to allow the sphere center to be at an arbitrary point <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-42-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;C&lt;/mi&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;C&lt;/mi&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;C&lt;/mi&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-340" style="width: 6.404em; display: inline-block;"><span style="display: inline-block; position: relative; width: 5.141em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.468em, 1005.05em, 2.815em, -1000em); top: -2.369em; left: 0em;"><span class="mrow" id="MathJax-Span-341"><span class="mo" id="MathJax-Span-342" style="font-family: MathJax_Main;">(</span><span class="msubsup" id="MathJax-Span-343"><span style="display: inline-block; position: relative; width: 1.194em; height: 0px;"><span style="position: absolute; clip: rect(3.126em, 1000.76em, 4.155em, -1000em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-344" style="font-family: MathJax_Math; font-style: italic;">C<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.045em;"></span></span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; top: -3.832em; left: 0.715em;"><span class="mi" id="MathJax-Span-345" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">x</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span></span><span class="mo" id="MathJax-Span-346" style="font-family: MathJax_Main;">,</span><span class="msubsup" id="MathJax-Span-347" style="padding-left: 0.167em;"><span style="display: inline-block; position: relative; width: 1.141em; height: 0px;"><span style="position: absolute; clip: rect(3.126em, 1000.76em, 4.155em, -1000em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-348" style="font-family: MathJax_Math; font-style: italic;">C<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.045em;"></span></span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; top: -3.832em; left: 0.715em;"><span class="mi" id="MathJax-Span-349" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.004em;"></span></span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span></span><span class="mo" id="MathJax-Span-350" style="font-family: MathJax_Main;">,</span><span class="msubsup" id="MathJax-Span-351" style="padding-left: 0.167em;"><span style="display: inline-block; position: relative; width: 1.121em; height: 0px;"><span style="position: absolute; clip: rect(3.126em, 1000.76em, 4.155em, -1000em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-352" style="font-family: MathJax_Math; font-style: italic;">C<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.045em;"></span></span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; top: -3.832em; left: 0.715em;"><span class="mi" id="MathJax-Span-353" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span></span><span class="mo" id="MathJax-Span-354" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.369em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.428em; border-left: 0px solid; width: 0px; height: 1.421em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">(</mo><msub><mi>C</mi><mi>x</mi></msub><mo>,</mo><msub><mi>C</mi><mi>y</mi></msub><mo>,</mo><msub><mi>C</mi><mi>z</mi></msub><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-42">(C_x, C_y, C_z)</script>, then the
equation becomes a lot less nice:

</p><p>

  <span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-43-Frame" tabindex="0" style="text-align: center; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;C&lt;/mi&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;/msub&gt;&lt;msup&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;C&lt;/mi&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;/msub&gt;&lt;msup&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;C&lt;/mi&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;/msub&gt;&lt;msup&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-355" style="width: 21.021em; display: inline-block;"><span style="display: inline-block; position: relative; width: 16.935em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.384em, 1016.94em, 2.866em, -1000em); top: -2.419em; left: 0em;"><span class="mrow" id="MathJax-Span-356"><span class="mo" id="MathJax-Span-357" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-358" style="font-family: MathJax_Math; font-style: italic;">x</span><span class="mo" id="MathJax-Span-359" style="font-family: MathJax_Main; padding-left: 0.222em;">−</span><span class="msubsup" id="MathJax-Span-360" style="padding-left: 0.222em;"><span style="display: inline-block; position: relative; width: 1.194em; height: 0px;"><span style="position: absolute; clip: rect(3.126em, 1000.76em, 4.155em, -1000em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-361" style="font-family: MathJax_Math; font-style: italic;">C<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.045em;"></span></span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; top: -3.832em; left: 0.715em;"><span class="mi" id="MathJax-Span-362" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">x</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-363"><span style="display: inline-block; position: relative; width: 0.818em; height: 0px;"><span style="position: absolute; clip: rect(3.081em, 1000.29em, 4.383em, -1000em); top: -3.982em; left: 0em;"><span class="mo" id="MathJax-Span-364" style="font-family: MathJax_Main;">)</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; top: -4.395em; left: 0.389em;"><span class="mn" id="MathJax-Span-365" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span></span><span class="mo" id="MathJax-Span-366" style="font-family: MathJax_Main; padding-left: 0.222em;">+</span><span class="mo" id="MathJax-Span-367" style="font-family: MathJax_Main; padding-left: 0.222em;">(</span><span class="mi" id="MathJax-Span-368" style="font-family: MathJax_Math; font-style: italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.006em;"></span></span><span class="mo" id="MathJax-Span-369" style="font-family: MathJax_Main; padding-left: 0.222em;">−</span><span class="msubsup" id="MathJax-Span-370" style="padding-left: 0.222em;"><span style="display: inline-block; position: relative; width: 1.141em; height: 0px;"><span style="position: absolute; clip: rect(3.126em, 1000.76em, 4.155em, -1000em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-371" style="font-family: MathJax_Math; font-style: italic;">C<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.045em;"></span></span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; top: -3.832em; left: 0.715em;"><span class="mi" id="MathJax-Span-372" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.004em;"></span></span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-373"><span style="display: inline-block; position: relative; width: 0.818em; height: 0px;"><span style="position: absolute; clip: rect(3.081em, 1000.29em, 4.383em, -1000em); top: -3.982em; left: 0em;"><span class="mo" id="MathJax-Span-374" style="font-family: MathJax_Main;">)</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; top: -4.395em; left: 0.389em;"><span class="mn" id="MathJax-Span-375" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span></span><span class="mo" id="MathJax-Span-376" style="font-family: MathJax_Main; padding-left: 0.222em;">+</span><span class="mo" id="MathJax-Span-377" style="font-family: MathJax_Main; padding-left: 0.222em;">(</span><span class="mi" id="MathJax-Span-378" style="font-family: MathJax_Math; font-style: italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-379" style="font-family: MathJax_Main; padding-left: 0.222em;">−</span><span class="msubsup" id="MathJax-Span-380" style="padding-left: 0.222em;"><span style="display: inline-block; position: relative; width: 1.121em; height: 0px;"><span style="position: absolute; clip: rect(3.126em, 1000.76em, 4.155em, -1000em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-381" style="font-family: MathJax_Math; font-style: italic;">C<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.045em;"></span></span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; top: -3.832em; left: 0.715em;"><span class="mi" id="MathJax-Span-382" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-383"><span style="display: inline-block; position: relative; width: 0.818em; height: 0px;"><span style="position: absolute; clip: rect(3.081em, 1000.29em, 4.383em, -1000em); top: -3.982em; left: 0em;"><span class="mo" id="MathJax-Span-384" style="font-family: MathJax_Main;">)</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; top: -4.395em; left: 0.389em;"><span class="mn" id="MathJax-Span-385" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span></span><span class="mo" id="MathJax-Span-386" style="font-family: MathJax_Main; padding-left: 0.278em;">=</span><span class="msubsup" id="MathJax-Span-387" style="padding-left: 0.278em;"><span style="display: inline-block; position: relative; width: 0.88em; height: 0px;"><span style="position: absolute; clip: rect(3.389em, 1000.43em, 4.144em, -1000em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-388" style="font-family: MathJax_Math; font-style: italic;">r</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; top: -4.395em; left: 0.451em;"><span class="mn" id="MathJax-Span-389" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.419em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.428em; border-left: 0px solid; width: 0px; height: 1.587em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mo stretchy="false">(</mo><mi>x</mi><mo>−</mo><msub><mi>C</mi><mi>x</mi></msub><msup><mo stretchy="false">)</mo><mn>2</mn></msup><mo>+</mo><mo stretchy="false">(</mo><mi>y</mi><mo>−</mo><msub><mi>C</mi><mi>y</mi></msub><msup><mo stretchy="false">)</mo><mn>2</mn></msup><mo>+</mo><mo stretchy="false">(</mo><mi>z</mi><mo>−</mo><msub><mi>C</mi><mi>z</mi></msub><msup><mo stretchy="false">)</mo><mn>2</mn></msup><mo>=</mo><msup><mi>r</mi><mn>2</mn></msup></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-43"> (x - C_x)^2 + (y - C_y)^2 + (z - C_z)^2 = r^2 </script>

</p><p>

In graphics, you almost always want your formulas to be in terms of vectors so that all the
<span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-44-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-390" style="width: 0.708em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.554em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.625em, 1000.5em, 2.38em, -1000em); top: -2.218em; left: 0em;"><span class="mrow" id="MathJax-Span-391"><span class="mi" id="MathJax-Span-392" style="font-family: MathJax_Math; font-style: italic;">x</span></span><span style="display: inline-block; width: 0px; height: 2.218em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.076em; border-left: 0px solid; width: 0px; height: 0.687em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>x</mi></math></span></span><script type="math/tex" id="MathJax-Element-44">x</script>/<span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-45-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-393" style="width: 0.658em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.504em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.625em, 1000.5em, 2.574em, -1000em); top: -2.218em; left: 0em;"><span class="mrow" id="MathJax-Span-394"><span class="mi" id="MathJax-Span-395" style="font-family: MathJax_Math; font-style: italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.006em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.218em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.317em; border-left: 0px solid; width: 0px; height: 0.927em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>y</mi></math></span></span><script type="math/tex" id="MathJax-Element-45">y</script>/<span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-46-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-396" style="width: 0.557em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.454em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.625em, 1000.45em, 2.38em, -1000em); top: -2.218em; left: 0em;"><span class="mrow" id="MathJax-Span-397"><span class="mi" id="MathJax-Span-398" style="font-family: MathJax_Math; font-style: italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.218em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.076em; border-left: 0px solid; width: 0px; height: 0.687em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>z</mi></math></span></span><script type="math/tex" id="MathJax-Element-46">z</script> stuff can be simply represented using a <code>vec3</code> class. You might note that the vector
from center <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-47-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;C&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;C&lt;/mi&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;C&lt;/mi&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;C&lt;/mi&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-399" style="width: 9.075em; display: inline-block;"><span style="display: inline-block; position: relative; width: 7.308em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.468em, 1007.21em, 2.815em, -1000em); top: -2.369em; left: 0em;"><span class="mrow" id="MathJax-Span-400"><span class="texatom" id="MathJax-Span-401"><span class="mrow" id="MathJax-Span-402"><span class="mi" id="MathJax-Span-403" style="font-family: MathJax_Main; font-weight: bold;">C</span></span></span><span class="mo" id="MathJax-Span-404" style="font-family: MathJax_Main; padding-left: 0.278em;">=</span><span class="mo" id="MathJax-Span-405" style="font-family: MathJax_Main; padding-left: 0.278em;">(</span><span class="msubsup" id="MathJax-Span-406"><span style="display: inline-block; position: relative; width: 1.194em; height: 0px;"><span style="position: absolute; clip: rect(3.126em, 1000.76em, 4.155em, -1000em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-407" style="font-family: MathJax_Math; font-style: italic;">C<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.045em;"></span></span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; top: -3.832em; left: 0.715em;"><span class="mi" id="MathJax-Span-408" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">x</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span></span><span class="mo" id="MathJax-Span-409" style="font-family: MathJax_Main;">,</span><span class="msubsup" id="MathJax-Span-410" style="padding-left: 0.167em;"><span style="display: inline-block; position: relative; width: 1.141em; height: 0px;"><span style="position: absolute; clip: rect(3.126em, 1000.76em, 4.155em, -1000em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-411" style="font-family: MathJax_Math; font-style: italic;">C<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.045em;"></span></span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; top: -3.832em; left: 0.715em;"><span class="mi" id="MathJax-Span-412" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.004em;"></span></span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span></span><span class="mo" id="MathJax-Span-413" style="font-family: MathJax_Main;">,</span><span class="msubsup" id="MathJax-Span-414" style="padding-left: 0.167em;"><span style="display: inline-block; position: relative; width: 1.121em; height: 0px;"><span style="position: absolute; clip: rect(3.126em, 1000.76em, 4.155em, -1000em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-415" style="font-family: MathJax_Math; font-style: italic;">C<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.045em;"></span></span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; top: -3.832em; left: 0.715em;"><span class="mi" id="MathJax-Span-416" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span></span><span class="mo" id="MathJax-Span-417" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.369em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.428em; border-left: 0px solid; width: 0px; height: 1.421em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">C</mi></mrow><mo>=</mo><mo stretchy="false">(</mo><msub><mi>C</mi><mi>x</mi></msub><mo>,</mo><msub><mi>C</mi><mi>y</mi></msub><mo>,</mo><msub><mi>C</mi><mi>z</mi></msub><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-47">\mathbf{C} = (C_x, C_y, C_z)</script> to point <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-48-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;P&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-418" style="width: 6.656em; display: inline-block;"><span style="display: inline-block; position: relative; width: 5.343em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.417em, 1005.25em, 2.72em, -1000em); top: -2.319em; left: 0em;"><span class="mrow" id="MathJax-Span-419"><span class="texatom" id="MathJax-Span-420"><span class="mrow" id="MathJax-Span-421"><span class="mi" id="MathJax-Span-422" style="font-family: MathJax_Main; font-weight: bold;">P</span></span></span><span class="mo" id="MathJax-Span-423" style="font-family: MathJax_Main; padding-left: 0.278em;">=</span><span class="mo" id="MathJax-Span-424" style="font-family: MathJax_Main; padding-left: 0.278em;">(</span><span class="mi" id="MathJax-Span-425" style="font-family: MathJax_Math; font-style: italic;">x</span><span class="mo" id="MathJax-Span-426" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-427" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.167em;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.006em;"></span></span><span class="mo" id="MathJax-Span-428" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-429" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.167em;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-430" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.319em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.365em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">P</mi></mrow><mo>=</mo><mo stretchy="false">(</mo><mi>x</mi><mo>,</mo><mi>y</mi><mo>,</mo><mi>z</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-48">\mathbf{P} = (x,y,z)</script> is
<span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-49-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;P&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;C&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-431" style="width: 4.539em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.629em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.468em, 1003.53em, 2.77em, -1000em); top: -2.369em; left: 0em;"><span class="mrow" id="MathJax-Span-432"><span class="mo" id="MathJax-Span-433" style="font-family: MathJax_Main;">(</span><span class="texatom" id="MathJax-Span-434"><span class="mrow" id="MathJax-Span-435"><span class="mi" id="MathJax-Span-436" style="font-family: MathJax_Main; font-weight: bold;">P</span></span></span><span class="mo" id="MathJax-Span-437" style="font-family: MathJax_Main; padding-left: 0.222em;">−</span><span class="texatom" id="MathJax-Span-438" style="padding-left: 0.222em;"><span class="mrow" id="MathJax-Span-439"><span class="mi" id="MathJax-Span-440" style="font-family: MathJax_Main; font-weight: bold;">C</span></span></span><span class="mo" id="MathJax-Span-441" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.369em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.365em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">P</mi></mrow><mo>−</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">C</mi></mrow><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-49">(\mathbf{P} - \mathbf{C})</script>. If we use the definition of the dot product:

</p><p>

  <span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-50-Frame" tabindex="0" style="text-align: center; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;P&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;C&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;P&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;C&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;C&lt;/mi&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;/msub&gt;&lt;msup&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;C&lt;/mi&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;/msub&gt;&lt;msup&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;C&lt;/mi&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;/msub&gt;&lt;msup&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-442" style="width: 29.791em; display: inline-block;"><span style="display: inline-block; position: relative; width: 23.992em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.384em, 1023.99em, 2.866em, -1000em); top: -2.419em; left: 0em;"><span class="mrow" id="MathJax-Span-443"><span class="mo" id="MathJax-Span-444" style="font-family: MathJax_Main;">(</span><span class="texatom" id="MathJax-Span-445"><span class="mrow" id="MathJax-Span-446"><span class="mi" id="MathJax-Span-447" style="font-family: MathJax_Main; font-weight: bold;">P</span></span></span><span class="mo" id="MathJax-Span-448" style="font-family: MathJax_Main; padding-left: 0.222em;">−</span><span class="texatom" id="MathJax-Span-449" style="padding-left: 0.222em;"><span class="mrow" id="MathJax-Span-450"><span class="mi" id="MathJax-Span-451" style="font-family: MathJax_Main; font-weight: bold;">C</span></span></span><span class="mo" id="MathJax-Span-452" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-453" style="font-family: MathJax_Main; padding-left: 0.222em;">⋅</span><span class="mo" id="MathJax-Span-454" style="font-family: MathJax_Main; padding-left: 0.222em;">(</span><span class="texatom" id="MathJax-Span-455"><span class="mrow" id="MathJax-Span-456"><span class="mi" id="MathJax-Span-457" style="font-family: MathJax_Main; font-weight: bold;">P</span></span></span><span class="mo" id="MathJax-Span-458" style="font-family: MathJax_Main; padding-left: 0.222em;">−</span><span class="texatom" id="MathJax-Span-459" style="padding-left: 0.222em;"><span class="mrow" id="MathJax-Span-460"><span class="mi" id="MathJax-Span-461" style="font-family: MathJax_Main; font-weight: bold;">C</span></span></span><span class="mo" id="MathJax-Span-462" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-463" style="font-family: MathJax_Main; padding-left: 0.278em;">=</span><span class="mo" id="MathJax-Span-464" style="font-family: MathJax_Main; padding-left: 0.278em;">(</span><span class="mi" id="MathJax-Span-465" style="font-family: MathJax_Math; font-style: italic;">x</span><span class="mo" id="MathJax-Span-466" style="font-family: MathJax_Main; padding-left: 0.222em;">−</span><span class="msubsup" id="MathJax-Span-467" style="padding-left: 0.222em;"><span style="display: inline-block; position: relative; width: 1.194em; height: 0px;"><span style="position: absolute; clip: rect(3.126em, 1000.76em, 4.155em, -1000em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-468" style="font-family: MathJax_Math; font-style: italic;">C<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.045em;"></span></span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; top: -3.832em; left: 0.715em;"><span class="mi" id="MathJax-Span-469" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">x</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-470"><span style="display: inline-block; position: relative; width: 0.818em; height: 0px;"><span style="position: absolute; clip: rect(3.081em, 1000.29em, 4.383em, -1000em); top: -3.982em; left: 0em;"><span class="mo" id="MathJax-Span-471" style="font-family: MathJax_Main;">)</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; top: -4.395em; left: 0.389em;"><span class="mn" id="MathJax-Span-472" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span></span><span class="mo" id="MathJax-Span-473" style="font-family: MathJax_Main; padding-left: 0.222em;">+</span><span class="mo" id="MathJax-Span-474" style="font-family: MathJax_Main; padding-left: 0.222em;">(</span><span class="mi" id="MathJax-Span-475" style="font-family: MathJax_Math; font-style: italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.006em;"></span></span><span class="mo" id="MathJax-Span-476" style="font-family: MathJax_Main; padding-left: 0.222em;">−</span><span class="msubsup" id="MathJax-Span-477" style="padding-left: 0.222em;"><span style="display: inline-block; position: relative; width: 1.141em; height: 0px;"><span style="position: absolute; clip: rect(3.126em, 1000.76em, 4.155em, -1000em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-478" style="font-family: MathJax_Math; font-style: italic;">C<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.045em;"></span></span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; top: -3.832em; left: 0.715em;"><span class="mi" id="MathJax-Span-479" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.004em;"></span></span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-480"><span style="display: inline-block; position: relative; width: 0.818em; height: 0px;"><span style="position: absolute; clip: rect(3.081em, 1000.29em, 4.383em, -1000em); top: -3.982em; left: 0em;"><span class="mo" id="MathJax-Span-481" style="font-family: MathJax_Main;">)</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; top: -4.395em; left: 0.389em;"><span class="mn" id="MathJax-Span-482" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span></span><span class="mo" id="MathJax-Span-483" style="font-family: MathJax_Main; padding-left: 0.222em;">+</span><span class="mo" id="MathJax-Span-484" style="font-family: MathJax_Main; padding-left: 0.222em;">(</span><span class="mi" id="MathJax-Span-485" style="font-family: MathJax_Math; font-style: italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-486" style="font-family: MathJax_Main; padding-left: 0.222em;">−</span><span class="msubsup" id="MathJax-Span-487" style="padding-left: 0.222em;"><span style="display: inline-block; position: relative; width: 1.121em; height: 0px;"><span style="position: absolute; clip: rect(3.126em, 1000.76em, 4.155em, -1000em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-488" style="font-family: MathJax_Math; font-style: italic;">C<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.045em;"></span></span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; top: -3.832em; left: 0.715em;"><span class="mi" id="MathJax-Span-489" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-490"><span style="display: inline-block; position: relative; width: 0.818em; height: 0px;"><span style="position: absolute; clip: rect(3.081em, 1000.29em, 4.383em, -1000em); top: -3.982em; left: 0em;"><span class="mo" id="MathJax-Span-491" style="font-family: MathJax_Main;">)</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; top: -4.395em; left: 0.389em;"><span class="mn" id="MathJax-Span-492" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.419em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.428em; border-left: 0px solid; width: 0px; height: 1.587em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">P</mi></mrow><mo>−</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">C</mi></mrow><mo stretchy="false">)</mo><mo>⋅</mo><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">P</mi></mrow><mo>−</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">C</mi></mrow><mo stretchy="false">)</mo><mo>=</mo><mo stretchy="false">(</mo><mi>x</mi><mo>−</mo><msub><mi>C</mi><mi>x</mi></msub><msup><mo stretchy="false">)</mo><mn>2</mn></msup><mo>+</mo><mo stretchy="false">(</mo><mi>y</mi><mo>−</mo><msub><mi>C</mi><mi>y</mi></msub><msup><mo stretchy="false">)</mo><mn>2</mn></msup><mo>+</mo><mo stretchy="false">(</mo><mi>z</mi><mo>−</mo><msub><mi>C</mi><mi>z</mi></msub><msup><mo stretchy="false">)</mo><mn>2</mn></msup></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-50"> (\mathbf{P} - \mathbf{C}) \cdot (\mathbf{P} - \mathbf{C})
     = (x - C_x)^2 + (y - C_y)^2 + (z - C_z)^2
  </script>

</p><p>

Then we can rewrite the equation of the sphere in vector form as:

</p><p>

  <span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-51-Frame" tabindex="0" style="text-align: center; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;P&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;C&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;P&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;C&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-493" style="width: 12.654em; display: inline-block;"><span style="display: inline-block; position: relative; width: 10.181em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.334em, 1010.18em, 2.77em, -1000em); top: -2.369em; left: 0em;"><span class="mrow" id="MathJax-Span-494"><span class="mo" id="MathJax-Span-495" style="font-family: MathJax_Main;">(</span><span class="texatom" id="MathJax-Span-496"><span class="mrow" id="MathJax-Span-497"><span class="mi" id="MathJax-Span-498" style="font-family: MathJax_Main; font-weight: bold;">P</span></span></span><span class="mo" id="MathJax-Span-499" style="font-family: MathJax_Main; padding-left: 0.222em;">−</span><span class="texatom" id="MathJax-Span-500" style="padding-left: 0.222em;"><span class="mrow" id="MathJax-Span-501"><span class="mi" id="MathJax-Span-502" style="font-family: MathJax_Main; font-weight: bold;">C</span></span></span><span class="mo" id="MathJax-Span-503" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-504" style="font-family: MathJax_Main; padding-left: 0.222em;">⋅</span><span class="mo" id="MathJax-Span-505" style="font-family: MathJax_Main; padding-left: 0.222em;">(</span><span class="texatom" id="MathJax-Span-506"><span class="mrow" id="MathJax-Span-507"><span class="mi" id="MathJax-Span-508" style="font-family: MathJax_Main; font-weight: bold;">P</span></span></span><span class="mo" id="MathJax-Span-509" style="font-family: MathJax_Main; padding-left: 0.222em;">−</span><span class="texatom" id="MathJax-Span-510" style="padding-left: 0.222em;"><span class="mrow" id="MathJax-Span-511"><span class="mi" id="MathJax-Span-512" style="font-family: MathJax_Main; font-weight: bold;">C</span></span></span><span class="mo" id="MathJax-Span-513" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-514" style="font-family: MathJax_Main; padding-left: 0.278em;">=</span><span class="msubsup" id="MathJax-Span-515" style="padding-left: 0.278em;"><span style="display: inline-block; position: relative; width: 0.88em; height: 0px;"><span style="position: absolute; clip: rect(3.389em, 1000.43em, 4.144em, -1000em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-516" style="font-family: MathJax_Math; font-style: italic;">r</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; top: -4.395em; left: 0.451em;"><span class="mn" id="MathJax-Span-517" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.369em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.531em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">P</mi></mrow><mo>−</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">C</mi></mrow><mo stretchy="false">)</mo><mo>⋅</mo><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">P</mi></mrow><mo>−</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">C</mi></mrow><mo stretchy="false">)</mo><mo>=</mo><msup><mi>r</mi><mn>2</mn></msup></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-51"> (\mathbf{P} - \mathbf{C}) \cdot (\mathbf{P} - \mathbf{C}) = r^2 </script>

</p><p>

We can read this as “any point <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-52-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;P&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-518" style="width: 1.011em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.806em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.431em, 1000.74em, 2.419em, -1000em); top: -2.268em; left: 0em;"><span class="mrow" id="MathJax-Span-519"><span class="texatom" id="MathJax-Span-520"><span class="mrow" id="MathJax-Span-521"><span class="mi" id="MathJax-Span-522" style="font-family: MathJax_Main; font-weight: bold;">P</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.268em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.063em; border-left: 0px solid; width: 0px; height: 0.976em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">P</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-52">\mathbf{P}</script> that satisfies this equation is on the sphere”. We want
to know if our ray <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-53-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;P&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;A&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;b&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-523" style="width: 7.916em; display: inline-block;"><span style="display: inline-block; position: relative; width: 6.351em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.518em, 1006.31em, 2.821em, -1000em); top: -2.419em; left: 0em;"><span class="mrow" id="MathJax-Span-524"><span class="texatom" id="MathJax-Span-525"><span class="mrow" id="MathJax-Span-526"><span class="mi" id="MathJax-Span-527" style="font-family: MathJax_Main; font-weight: bold;">P</span></span></span><span class="mo" id="MathJax-Span-528" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-529" style="font-family: MathJax_Math; font-style: italic;">t</span><span class="mo" id="MathJax-Span-530" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-531" style="font-family: MathJax_Main; padding-left: 0.278em;">=</span><span class="texatom" id="MathJax-Span-532" style="padding-left: 0.278em;"><span class="mrow" id="MathJax-Span-533"><span class="mi" id="MathJax-Span-534" style="font-family: MathJax_Main; font-weight: bold;">A</span></span></span><span class="mo" id="MathJax-Span-535" style="font-family: MathJax_Main; padding-left: 0.222em;">+</span><span class="mi" id="MathJax-Span-536" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.222em;">t</span><span class="texatom" id="MathJax-Span-537"><span class="mrow" id="MathJax-Span-538"><span class="mi" id="MathJax-Span-539" style="font-family: MathJax_Main; font-weight: bold;">b</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.419em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.365em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">P</mi></mrow><mo stretchy="false">(</mo><mi>t</mi><mo stretchy="false">)</mo><mo>=</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">A</mi></mrow><mo>+</mo><mi>t</mi><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">b</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-53">\mathbf{P}(t) = \mathbf{A} + t\mathbf{b}</script> ever hits the sphere anywhere. If it
does hit the sphere, there is some <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-54-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-540" style="width: 0.456em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.353em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.441em, 1000.32em, 2.38em, -1000em); top: -2.218em; left: 0em;"><span class="mrow" id="MathJax-Span-541"><span class="mi" id="MathJax-Span-542" style="font-family: MathJax_Math; font-style: italic;">t</span></span><span style="display: inline-block; width: 0px; height: 2.218em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.076em; border-left: 0px solid; width: 0px; height: 0.915em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>t</mi></math></span></span><script type="math/tex" id="MathJax-Element-54">t</script> for which <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-55-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;P&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-543" style="width: 2.371em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.915em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.417em, 1001.82em, 2.72em, -1000em); top: -2.319em; left: 0em;"><span class="mrow" id="MathJax-Span-544"><span class="texatom" id="MathJax-Span-545"><span class="mrow" id="MathJax-Span-546"><span class="mi" id="MathJax-Span-547" style="font-family: MathJax_Main; font-weight: bold;">P</span></span></span><span class="mo" id="MathJax-Span-548" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-549" style="font-family: MathJax_Math; font-style: italic;">t</span><span class="mo" id="MathJax-Span-550" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.319em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.365em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">P</mi></mrow><mo stretchy="false">(</mo><mi>t</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-55">\mathbf{P}(t)</script> satisfies the sphere equation. So
we are looking for any <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-56-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-551" style="width: 0.456em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.353em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.441em, 1000.32em, 2.38em, -1000em); top: -2.218em; left: 0em;"><span class="mrow" id="MathJax-Span-552"><span class="mi" id="MathJax-Span-553" style="font-family: MathJax_Math; font-style: italic;">t</span></span><span style="display: inline-block; width: 0px; height: 2.218em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.076em; border-left: 0px solid; width: 0px; height: 0.915em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>t</mi></math></span></span><script type="math/tex" id="MathJax-Element-56">t</script> where this is true:

</p><p>

  <span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-57-Frame" tabindex="0" style="text-align: center; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;P&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;C&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;P&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;C&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-554" style="width: 15.476em; display: inline-block;"><span style="display: inline-block; position: relative; width: 12.45em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.384em, 1012.45em, 2.821em, -1000em); top: -2.419em; left: 0em;"><span class="mrow" id="MathJax-Span-555"><span class="mo" id="MathJax-Span-556" style="font-family: MathJax_Main;">(</span><span class="texatom" id="MathJax-Span-557"><span class="mrow" id="MathJax-Span-558"><span class="mi" id="MathJax-Span-559" style="font-family: MathJax_Main; font-weight: bold;">P</span></span></span><span class="mo" id="MathJax-Span-560" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-561" style="font-family: MathJax_Math; font-style: italic;">t</span><span class="mo" id="MathJax-Span-562" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-563" style="font-family: MathJax_Main; padding-left: 0.222em;">−</span><span class="texatom" id="MathJax-Span-564" style="padding-left: 0.222em;"><span class="mrow" id="MathJax-Span-565"><span class="mi" id="MathJax-Span-566" style="font-family: MathJax_Main; font-weight: bold;">C</span></span></span><span class="mo" id="MathJax-Span-567" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-568" style="font-family: MathJax_Main; padding-left: 0.222em;">⋅</span><span class="mo" id="MathJax-Span-569" style="font-family: MathJax_Main; padding-left: 0.222em;">(</span><span class="texatom" id="MathJax-Span-570"><span class="mrow" id="MathJax-Span-571"><span class="mi" id="MathJax-Span-572" style="font-family: MathJax_Main; font-weight: bold;">P</span></span></span><span class="mo" id="MathJax-Span-573" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-574" style="font-family: MathJax_Math; font-style: italic;">t</span><span class="mo" id="MathJax-Span-575" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-576" style="font-family: MathJax_Main; padding-left: 0.222em;">−</span><span class="texatom" id="MathJax-Span-577" style="padding-left: 0.222em;"><span class="mrow" id="MathJax-Span-578"><span class="mi" id="MathJax-Span-579" style="font-family: MathJax_Main; font-weight: bold;">C</span></span></span><span class="mo" id="MathJax-Span-580" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-581" style="font-family: MathJax_Main; padding-left: 0.278em;">=</span><span class="msubsup" id="MathJax-Span-582" style="padding-left: 0.278em;"><span style="display: inline-block; position: relative; width: 0.88em; height: 0px;"><span style="position: absolute; clip: rect(3.389em, 1000.43em, 4.144em, -1000em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-583" style="font-family: MathJax_Math; font-style: italic;">r</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; top: -4.395em; left: 0.451em;"><span class="mn" id="MathJax-Span-584" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.419em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.531em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">P</mi></mrow><mo stretchy="false">(</mo><mi>t</mi><mo stretchy="false">)</mo><mo>−</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">C</mi></mrow><mo stretchy="false">)</mo><mo>⋅</mo><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">P</mi></mrow><mo stretchy="false">(</mo><mi>t</mi><mo stretchy="false">)</mo><mo>−</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">C</mi></mrow><mo stretchy="false">)</mo><mo>=</mo><msup><mi>r</mi><mn>2</mn></msup></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-57"> (\mathbf{P}(t) - \mathbf{C}) \cdot (\mathbf{P}(t) - \mathbf{C}) = r^2 </script>

</p><p>

which can be found by replacing <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-58-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;P&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-585" style="width: 2.371em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.915em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.417em, 1001.82em, 2.72em, -1000em); top: -2.319em; left: 0em;"><span class="mrow" id="MathJax-Span-586"><span class="texatom" id="MathJax-Span-587"><span class="mrow" id="MathJax-Span-588"><span class="mi" id="MathJax-Span-589" style="font-family: MathJax_Main; font-weight: bold;">P</span></span></span><span class="mo" id="MathJax-Span-590" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-591" style="font-family: MathJax_Math; font-style: italic;">t</span><span class="mo" id="MathJax-Span-592" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.319em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.365em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">P</mi></mrow><mo stretchy="false">(</mo><mi>t</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-58">\mathbf{P}(t)</script> with its expanded form:

</p><p>

  <span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-59-Frame" tabindex="0" style="text-align: center; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;A&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;b&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;C&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;A&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;b&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;C&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-593" style="width: 20.265em; display: inline-block;"><span style="display: inline-block; position: relative; width: 16.331em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.384em, 1016.33em, 2.821em, -1000em); top: -2.419em; left: 0em;"><span class="mrow" id="MathJax-Span-594"><span class="mo" id="MathJax-Span-595" style="font-family: MathJax_Main;">(</span><span class="mo" id="MathJax-Span-596" style="font-family: MathJax_Main;">(</span><span class="texatom" id="MathJax-Span-597"><span class="mrow" id="MathJax-Span-598"><span class="mi" id="MathJax-Span-599" style="font-family: MathJax_Main; font-weight: bold;">A</span></span></span><span class="mo" id="MathJax-Span-600" style="font-family: MathJax_Main; padding-left: 0.222em;">+</span><span class="mi" id="MathJax-Span-601" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.222em;">t</span><span class="texatom" id="MathJax-Span-602"><span class="mrow" id="MathJax-Span-603"><span class="mi" id="MathJax-Span-604" style="font-family: MathJax_Main; font-weight: bold;">b</span></span></span><span class="mo" id="MathJax-Span-605" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-606" style="font-family: MathJax_Main; padding-left: 0.222em;">−</span><span class="texatom" id="MathJax-Span-607" style="padding-left: 0.222em;"><span class="mrow" id="MathJax-Span-608"><span class="mi" id="MathJax-Span-609" style="font-family: MathJax_Main; font-weight: bold;">C</span></span></span><span class="mo" id="MathJax-Span-610" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-611" style="font-family: MathJax_Main; padding-left: 0.222em;">⋅</span><span class="mo" id="MathJax-Span-612" style="font-family: MathJax_Main; padding-left: 0.222em;">(</span><span class="mo" id="MathJax-Span-613" style="font-family: MathJax_Main;">(</span><span class="texatom" id="MathJax-Span-614"><span class="mrow" id="MathJax-Span-615"><span class="mi" id="MathJax-Span-616" style="font-family: MathJax_Main; font-weight: bold;">A</span></span></span><span class="mo" id="MathJax-Span-617" style="font-family: MathJax_Main; padding-left: 0.222em;">+</span><span class="mi" id="MathJax-Span-618" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.222em;">t</span><span class="texatom" id="MathJax-Span-619"><span class="mrow" id="MathJax-Span-620"><span class="mi" id="MathJax-Span-621" style="font-family: MathJax_Main; font-weight: bold;">b</span></span></span><span class="mo" id="MathJax-Span-622" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-623" style="font-family: MathJax_Main; padding-left: 0.222em;">−</span><span class="texatom" id="MathJax-Span-624" style="padding-left: 0.222em;"><span class="mrow" id="MathJax-Span-625"><span class="mi" id="MathJax-Span-626" style="font-family: MathJax_Main; font-weight: bold;">C</span></span></span><span class="mo" id="MathJax-Span-627" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-628" style="font-family: MathJax_Main; padding-left: 0.278em;">=</span><span class="msubsup" id="MathJax-Span-629" style="padding-left: 0.278em;"><span style="display: inline-block; position: relative; width: 0.88em; height: 0px;"><span style="position: absolute; clip: rect(3.389em, 1000.43em, 4.144em, -1000em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-630" style="font-family: MathJax_Math; font-style: italic;">r</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; top: -4.395em; left: 0.451em;"><span class="mn" id="MathJax-Span-631" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.419em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.531em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mo stretchy="false">(</mo><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">A</mi></mrow><mo>+</mo><mi>t</mi><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">b</mi></mrow><mo stretchy="false">)</mo><mo>−</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">C</mi></mrow><mo stretchy="false">)</mo><mo>⋅</mo><mo stretchy="false">(</mo><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">A</mi></mrow><mo>+</mo><mi>t</mi><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">b</mi></mrow><mo stretchy="false">)</mo><mo>−</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">C</mi></mrow><mo stretchy="false">)</mo><mo>=</mo><msup><mi>r</mi><mn>2</mn></msup></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-59"> ((\mathbf{A} + t \mathbf{b}) - \mathbf{C})
      \cdot ((\mathbf{A} + t \mathbf{b}) - \mathbf{C}) = r^2 </script>

</p><p>

We have three vectors on the left dotted by three vectors on the right. If we solved for the full
dot product we would get nine vectors. You can definitely go through and write everything out, but
we don't need to work that hard. If you remember, we want to solve for <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-60-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-632" style="width: 0.456em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.353em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.441em, 1000.32em, 2.38em, -1000em); top: -2.218em; left: 0em;"><span class="mrow" id="MathJax-Span-633"><span class="mi" id="MathJax-Span-634" style="font-family: MathJax_Math; font-style: italic;">t</span></span><span style="display: inline-block; width: 0px; height: 2.218em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.076em; border-left: 0px solid; width: 0px; height: 0.915em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>t</mi></math></span></span><script type="math/tex" id="MathJax-Element-60">t</script>, so we'll separate the
terms based on whether there is a <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-61-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-635" style="width: 0.456em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.353em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.441em, 1000.32em, 2.38em, -1000em); top: -2.218em; left: 0em;"><span class="mrow" id="MathJax-Span-636"><span class="mi" id="MathJax-Span-637" style="font-family: MathJax_Math; font-style: italic;">t</span></span><span style="display: inline-block; width: 0px; height: 2.218em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.076em; border-left: 0px solid; width: 0px; height: 0.915em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>t</mi></math></span></span><script type="math/tex" id="MathJax-Element-61">t</script> or not:

</p><p>

  <span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-62-Frame" tabindex="0" style="text-align: center; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;b&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;A&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;C&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;b&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;A&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;C&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-638" style="width: 20.265em; display: inline-block;"><span style="display: inline-block; position: relative; width: 16.331em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.384em, 1016.33em, 2.821em, -1000em); top: -2.419em; left: 0em;"><span class="mrow" id="MathJax-Span-639"><span class="mo" id="MathJax-Span-640" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-641" style="font-family: MathJax_Math; font-style: italic;">t</span><span class="texatom" id="MathJax-Span-642"><span class="mrow" id="MathJax-Span-643"><span class="mi" id="MathJax-Span-644" style="font-family: MathJax_Main; font-weight: bold;">b</span></span></span><span class="mo" id="MathJax-Span-645" style="font-family: MathJax_Main; padding-left: 0.222em;">+</span><span class="mo" id="MathJax-Span-646" style="font-family: MathJax_Main; padding-left: 0.222em;">(</span><span class="texatom" id="MathJax-Span-647"><span class="mrow" id="MathJax-Span-648"><span class="mi" id="MathJax-Span-649" style="font-family: MathJax_Main; font-weight: bold;">A</span></span></span><span class="mo" id="MathJax-Span-650" style="font-family: MathJax_Main; padding-left: 0.222em;">−</span><span class="texatom" id="MathJax-Span-651" style="padding-left: 0.222em;"><span class="mrow" id="MathJax-Span-652"><span class="mi" id="MathJax-Span-653" style="font-family: MathJax_Main; font-weight: bold;">C</span></span></span><span class="mo" id="MathJax-Span-654" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-655" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-656" style="font-family: MathJax_Main; padding-left: 0.222em;">⋅</span><span class="mo" id="MathJax-Span-657" style="font-family: MathJax_Main; padding-left: 0.222em;">(</span><span class="mi" id="MathJax-Span-658" style="font-family: MathJax_Math; font-style: italic;">t</span><span class="texatom" id="MathJax-Span-659"><span class="mrow" id="MathJax-Span-660"><span class="mi" id="MathJax-Span-661" style="font-family: MathJax_Main; font-weight: bold;">b</span></span></span><span class="mo" id="MathJax-Span-662" style="font-family: MathJax_Main; padding-left: 0.222em;">+</span><span class="mo" id="MathJax-Span-663" style="font-family: MathJax_Main; padding-left: 0.222em;">(</span><span class="texatom" id="MathJax-Span-664"><span class="mrow" id="MathJax-Span-665"><span class="mi" id="MathJax-Span-666" style="font-family: MathJax_Main; font-weight: bold;">A</span></span></span><span class="mo" id="MathJax-Span-667" style="font-family: MathJax_Main; padding-left: 0.222em;">−</span><span class="texatom" id="MathJax-Span-668" style="padding-left: 0.222em;"><span class="mrow" id="MathJax-Span-669"><span class="mi" id="MathJax-Span-670" style="font-family: MathJax_Main; font-weight: bold;">C</span></span></span><span class="mo" id="MathJax-Span-671" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-672" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-673" style="font-family: MathJax_Main; padding-left: 0.278em;">=</span><span class="msubsup" id="MathJax-Span-674" style="padding-left: 0.278em;"><span style="display: inline-block; position: relative; width: 0.88em; height: 0px;"><span style="position: absolute; clip: rect(3.389em, 1000.43em, 4.144em, -1000em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-675" style="font-family: MathJax_Math; font-style: italic;">r</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; top: -4.395em; left: 0.451em;"><span class="mn" id="MathJax-Span-676" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.419em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.531em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mo stretchy="false">(</mo><mi>t</mi><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">b</mi></mrow><mo>+</mo><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">A</mi></mrow><mo>−</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">C</mi></mrow><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mo>⋅</mo><mo stretchy="false">(</mo><mi>t</mi><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">b</mi></mrow><mo>+</mo><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">A</mi></mrow><mo>−</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">C</mi></mrow><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mo>=</mo><msup><mi>r</mi><mn>2</mn></msup></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-62"> (t \mathbf{b} + (\mathbf{A} - \mathbf{C}))
      \cdot (t \mathbf{b} + (\mathbf{A} - \mathbf{C})) = r^2 </script>

</p><p>

And now we follow the rules of vector algebra to distribute the dot product:

</p><p>

  <span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-63-Frame" tabindex="0" style="text-align: center; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;msup&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;b&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;b&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;b&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;A&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;C&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;A&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;C&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;A&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;C&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-677" style="width: 26.666em; display: inline-block;"><span style="display: inline-block; position: relative; width: 21.472em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.384em, 1021.47em, 2.821em, -1000em); top: -2.419em; left: 0em;"><span class="mrow" id="MathJax-Span-678"><span class="msubsup" id="MathJax-Span-679"><span style="display: inline-block; position: relative; width: 0.79em; height: 0px;"><span style="position: absolute; clip: rect(3.205em, 1000.33em, 4.144em, -1000em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-680" style="font-family: MathJax_Math; font-style: italic;">t</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; top: -4.395em; left: 0.361em;"><span class="mn" id="MathJax-Span-681" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span></span><span class="texatom" id="MathJax-Span-682"><span class="mrow" id="MathJax-Span-683"><span class="mi" id="MathJax-Span-684" style="font-family: MathJax_Main; font-weight: bold;">b</span></span></span><span class="mo" id="MathJax-Span-685" style="font-family: MathJax_Main; padding-left: 0.222em;">⋅</span><span class="texatom" id="MathJax-Span-686" style="padding-left: 0.222em;"><span class="mrow" id="MathJax-Span-687"><span class="mi" id="MathJax-Span-688" style="font-family: MathJax_Main; font-weight: bold;">b</span></span></span><span class="mo" id="MathJax-Span-689" style="font-family: MathJax_Main; padding-left: 0.222em;">+</span><span class="mn" id="MathJax-Span-690" style="font-family: MathJax_Main; padding-left: 0.222em;">2</span><span class="mi" id="MathJax-Span-691" style="font-family: MathJax_Math; font-style: italic;">t</span><span class="texatom" id="MathJax-Span-692"><span class="mrow" id="MathJax-Span-693"><span class="mi" id="MathJax-Span-694" style="font-family: MathJax_Main; font-weight: bold;">b</span></span></span><span class="mo" id="MathJax-Span-695" style="font-family: MathJax_Main; padding-left: 0.222em;">⋅</span><span class="mo" id="MathJax-Span-696" style="font-family: MathJax_Main; padding-left: 0.222em;">(</span><span class="texatom" id="MathJax-Span-697"><span class="mrow" id="MathJax-Span-698"><span class="mi" id="MathJax-Span-699" style="font-family: MathJax_Main; font-weight: bold;">A</span></span></span><span class="mo" id="MathJax-Span-700" style="font-family: MathJax_Main; padding-left: 0.222em;">−</span><span class="texatom" id="MathJax-Span-701" style="padding-left: 0.222em;"><span class="mrow" id="MathJax-Span-702"><span class="mi" id="MathJax-Span-703" style="font-family: MathJax_Main; font-weight: bold;">C</span></span></span><span class="mo" id="MathJax-Span-704" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-705" style="font-family: MathJax_Main; padding-left: 0.222em;">+</span><span class="mo" id="MathJax-Span-706" style="font-family: MathJax_Main; padding-left: 0.222em;">(</span><span class="texatom" id="MathJax-Span-707"><span class="mrow" id="MathJax-Span-708"><span class="mi" id="MathJax-Span-709" style="font-family: MathJax_Main; font-weight: bold;">A</span></span></span><span class="mo" id="MathJax-Span-710" style="font-family: MathJax_Main; padding-left: 0.222em;">−</span><span class="texatom" id="MathJax-Span-711" style="padding-left: 0.222em;"><span class="mrow" id="MathJax-Span-712"><span class="mi" id="MathJax-Span-713" style="font-family: MathJax_Main; font-weight: bold;">C</span></span></span><span class="mo" id="MathJax-Span-714" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-715" style="font-family: MathJax_Main; padding-left: 0.222em;">⋅</span><span class="mo" id="MathJax-Span-716" style="font-family: MathJax_Main; padding-left: 0.222em;">(</span><span class="texatom" id="MathJax-Span-717"><span class="mrow" id="MathJax-Span-718"><span class="mi" id="MathJax-Span-719" style="font-family: MathJax_Main; font-weight: bold;">A</span></span></span><span class="mo" id="MathJax-Span-720" style="font-family: MathJax_Main; padding-left: 0.222em;">−</span><span class="texatom" id="MathJax-Span-721" style="padding-left: 0.222em;"><span class="mrow" id="MathJax-Span-722"><span class="mi" id="MathJax-Span-723" style="font-family: MathJax_Main; font-weight: bold;">C</span></span></span><span class="mo" id="MathJax-Span-724" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-725" style="font-family: MathJax_Main; padding-left: 0.278em;">=</span><span class="msubsup" id="MathJax-Span-726" style="padding-left: 0.278em;"><span style="display: inline-block; position: relative; width: 0.88em; height: 0px;"><span style="position: absolute; clip: rect(3.389em, 1000.43em, 4.144em, -1000em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-727" style="font-family: MathJax_Math; font-style: italic;">r</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; top: -4.395em; left: 0.451em;"><span class="mn" id="MathJax-Span-728" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.419em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.531em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><msup><mi>t</mi><mn>2</mn></msup><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">b</mi></mrow><mo>⋅</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">b</mi></mrow><mo>+</mo><mn>2</mn><mi>t</mi><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">b</mi></mrow><mo>⋅</mo><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">A</mi></mrow><mo>−</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">C</mi></mrow><mo stretchy="false">)</mo><mo>+</mo><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">A</mi></mrow><mo>−</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">C</mi></mrow><mo stretchy="false">)</mo><mo>⋅</mo><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">A</mi></mrow><mo>−</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">C</mi></mrow><mo stretchy="false">)</mo><mo>=</mo><msup><mi>r</mi><mn>2</mn></msup></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-63"> t^2 \mathbf{b} \cdot \mathbf{b}
     + 2t \mathbf{b} \cdot (\mathbf{A}-\mathbf{C})
     + (\mathbf{A}-\mathbf{C}) \cdot (\mathbf{A}-\mathbf{C}) = r^2
  </script>

</p><p>

Move the square of the radius over to the left hand side:

</p><p>

  <span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-64-Frame" tabindex="0" style="text-align: center; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;msup&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;b&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;b&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;b&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;A&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;C&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;A&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;C&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;A&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;C&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-729" style="width: 28.783em; display: inline-block;"><span style="display: inline-block; position: relative; width: 23.185em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.384em, 1023.15em, 2.821em, -1000em); top: -2.419em; left: 0em;"><span class="mrow" id="MathJax-Span-730"><span class="msubsup" id="MathJax-Span-731"><span style="display: inline-block; position: relative; width: 0.79em; height: 0px;"><span style="position: absolute; clip: rect(3.205em, 1000.33em, 4.144em, -1000em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-732" style="font-family: MathJax_Math; font-style: italic;">t</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; top: -4.395em; left: 0.361em;"><span class="mn" id="MathJax-Span-733" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span></span><span class="texatom" id="MathJax-Span-734"><span class="mrow" id="MathJax-Span-735"><span class="mi" id="MathJax-Span-736" style="font-family: MathJax_Main; font-weight: bold;">b</span></span></span><span class="mo" id="MathJax-Span-737" style="font-family: MathJax_Main; padding-left: 0.222em;">⋅</span><span class="texatom" id="MathJax-Span-738" style="padding-left: 0.222em;"><span class="mrow" id="MathJax-Span-739"><span class="mi" id="MathJax-Span-740" style="font-family: MathJax_Main; font-weight: bold;">b</span></span></span><span class="mo" id="MathJax-Span-741" style="font-family: MathJax_Main; padding-left: 0.222em;">+</span><span class="mn" id="MathJax-Span-742" style="font-family: MathJax_Main; padding-left: 0.222em;">2</span><span class="mi" id="MathJax-Span-743" style="font-family: MathJax_Math; font-style: italic;">t</span><span class="texatom" id="MathJax-Span-744"><span class="mrow" id="MathJax-Span-745"><span class="mi" id="MathJax-Span-746" style="font-family: MathJax_Main; font-weight: bold;">b</span></span></span><span class="mo" id="MathJax-Span-747" style="font-family: MathJax_Main; padding-left: 0.222em;">⋅</span><span class="mo" id="MathJax-Span-748" style="font-family: MathJax_Main; padding-left: 0.222em;">(</span><span class="texatom" id="MathJax-Span-749"><span class="mrow" id="MathJax-Span-750"><span class="mi" id="MathJax-Span-751" style="font-family: MathJax_Main; font-weight: bold;">A</span></span></span><span class="mo" id="MathJax-Span-752" style="font-family: MathJax_Main; padding-left: 0.222em;">−</span><span class="texatom" id="MathJax-Span-753" style="padding-left: 0.222em;"><span class="mrow" id="MathJax-Span-754"><span class="mi" id="MathJax-Span-755" style="font-family: MathJax_Main; font-weight: bold;">C</span></span></span><span class="mo" id="MathJax-Span-756" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-757" style="font-family: MathJax_Main; padding-left: 0.222em;">+</span><span class="mo" id="MathJax-Span-758" style="font-family: MathJax_Main; padding-left: 0.222em;">(</span><span class="texatom" id="MathJax-Span-759"><span class="mrow" id="MathJax-Span-760"><span class="mi" id="MathJax-Span-761" style="font-family: MathJax_Main; font-weight: bold;">A</span></span></span><span class="mo" id="MathJax-Span-762" style="font-family: MathJax_Main; padding-left: 0.222em;">−</span><span class="texatom" id="MathJax-Span-763" style="padding-left: 0.222em;"><span class="mrow" id="MathJax-Span-764"><span class="mi" id="MathJax-Span-765" style="font-family: MathJax_Main; font-weight: bold;">C</span></span></span><span class="mo" id="MathJax-Span-766" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-767" style="font-family: MathJax_Main; padding-left: 0.222em;">⋅</span><span class="mo" id="MathJax-Span-768" style="font-family: MathJax_Main; padding-left: 0.222em;">(</span><span class="texatom" id="MathJax-Span-769"><span class="mrow" id="MathJax-Span-770"><span class="mi" id="MathJax-Span-771" style="font-family: MathJax_Main; font-weight: bold;">A</span></span></span><span class="mo" id="MathJax-Span-772" style="font-family: MathJax_Main; padding-left: 0.222em;">−</span><span class="texatom" id="MathJax-Span-773" style="padding-left: 0.222em;"><span class="mrow" id="MathJax-Span-774"><span class="mi" id="MathJax-Span-775" style="font-family: MathJax_Main; font-weight: bold;">C</span></span></span><span class="mo" id="MathJax-Span-776" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-777" style="font-family: MathJax_Main; padding-left: 0.222em;">−</span><span class="msubsup" id="MathJax-Span-778" style="padding-left: 0.222em;"><span style="display: inline-block; position: relative; width: 0.88em; height: 0px;"><span style="position: absolute; clip: rect(3.389em, 1000.43em, 4.144em, -1000em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-779" style="font-family: MathJax_Math; font-style: italic;">r</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; top: -4.395em; left: 0.451em;"><span class="mn" id="MathJax-Span-780" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span></span><span class="mo" id="MathJax-Span-781" style="font-family: MathJax_Main; padding-left: 0.278em;">=</span><span class="mn" id="MathJax-Span-782" style="font-family: MathJax_Main; padding-left: 0.278em;">0</span></span><span style="display: inline-block; width: 0px; height: 2.419em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.531em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><msup><mi>t</mi><mn>2</mn></msup><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">b</mi></mrow><mo>⋅</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">b</mi></mrow><mo>+</mo><mn>2</mn><mi>t</mi><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">b</mi></mrow><mo>⋅</mo><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">A</mi></mrow><mo>−</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">C</mi></mrow><mo stretchy="false">)</mo><mo>+</mo><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">A</mi></mrow><mo>−</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">C</mi></mrow><mo stretchy="false">)</mo><mo>⋅</mo><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">A</mi></mrow><mo>−</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">C</mi></mrow><mo stretchy="false">)</mo><mo>−</mo><msup><mi>r</mi><mn>2</mn></msup><mo>=</mo><mn>0</mn></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-64"> t^2 \mathbf{b} \cdot \mathbf{b}
     + 2t \mathbf{b} \cdot (\mathbf{A}-\mathbf{C})
     + (\mathbf{A}-\mathbf{C}) \cdot (\mathbf{A}-\mathbf{C}) - r^2 = 0
  </script>

</p><p>

It's hard to make out what exactly this equation is, but the vectors and <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-65-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-783" style="width: 0.557em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.454em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.625em, 1000.43em, 2.38em, -1000em); top: -2.218em; left: 0em;"><span class="mrow" id="MathJax-Span-784"><span class="mi" id="MathJax-Span-785" style="font-family: MathJax_Math; font-style: italic;">r</span></span><span style="display: inline-block; width: 0px; height: 2.218em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.076em; border-left: 0px solid; width: 0px; height: 0.687em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>r</mi></math></span></span><script type="math/tex" id="MathJax-Element-65">r</script> in that equation are
all constant and known. Furthermore, the only vectors that we have are reduced to scalars by dot
product. The only unknown is <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-66-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-786" style="width: 0.456em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.353em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.441em, 1000.32em, 2.38em, -1000em); top: -2.218em; left: 0em;"><span class="mrow" id="MathJax-Span-787"><span class="mi" id="MathJax-Span-788" style="font-family: MathJax_Math; font-style: italic;">t</span></span><span style="display: inline-block; width: 0px; height: 2.218em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.076em; border-left: 0px solid; width: 0px; height: 0.915em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>t</mi></math></span></span><script type="math/tex" id="MathJax-Element-66">t</script>, and we have a <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-67-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msup&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-789" style="width: 1.011em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.806em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(0.023em, 1000.81em, 1.17em, -1000em); top: -1.008em; left: 0em;"><span class="mrow" id="MathJax-Span-790"><span class="msubsup" id="MathJax-Span-791"><span style="display: inline-block; position: relative; width: 0.79em; height: 0px;"><span style="position: absolute; clip: rect(3.205em, 1000.33em, 4.144em, -1000em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-792" style="font-family: MathJax_Math; font-style: italic;">t</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; top: -4.345em; left: 0.361em;"><span class="mn" id="MathJax-Span-793" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 1.008em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.076em; border-left: 0px solid; width: 0px; height: 1.173em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mi>t</mi><mn>2</mn></msup></math></span></span><script type="math/tex" id="MathJax-Element-67">t^2</script>, which means that this equation is quadratic.
You can solve for a quadratic equation by using the quadratic formula:

</p><p>

  <span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-68-Frame" tabindex="0" style="text-align: center; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mfrac&gt;&lt;mrow&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mi&gt;b&lt;/mi&gt;&lt;mo&gt;&amp;#x00B1;&lt;/mo&gt;&lt;msqrt&gt;&lt;msup&gt;&lt;mi&gt;b&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mn&gt;4&lt;/mn&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mi&gt;c&lt;/mi&gt;&lt;/msqrt&gt;&lt;/mrow&gt;&lt;mrow&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;/mrow&gt;&lt;/mfrac&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-794" style="width: 8.873em; display: inline-block;"><span style="display: inline-block; position: relative; width: 7.157em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(-0.671em, 1007.16em, 1.855em, -1000em); top: -1.008em; left: 0em;"><span class="mrow" id="MathJax-Span-795"><span class="mfrac" id="MathJax-Span-796"><span style="display: inline-block; position: relative; width: 6.924em; height: 0px; margin-right: 0.12em; margin-left: 0.12em;"><span style="position: absolute; clip: rect(2.979em, 1006.8em, 4.281em, -1000em); top: -4.658em; left: 50%; margin-left: -3.402em;"><span class="mrow" id="MathJax-Span-797"><span class="mo" id="MathJax-Span-798" style="font-family: MathJax_Main;">−</span><span class="mi" id="MathJax-Span-799" style="font-family: MathJax_Math; font-style: italic;">b</span><span class="mo" id="MathJax-Span-800" style="font-family: MathJax_Main; padding-left: 0.222em;">±</span><span class="msqrt" id="MathJax-Span-801" style="padding-left: 0.222em;"><span style="display: inline-block; position: relative; width: 4.375em; height: 0px;"><span style="position: absolute; clip: rect(3.071em, 1003.54em, 4.215em, -1000em); top: -3.982em; left: 0.833em;"><span class="mrow" id="MathJax-Span-802"><span class="msubsup" id="MathJax-Span-803"><span style="display: inline-block; position: relative; width: 0.858em; height: 0px;"><span style="position: absolute; clip: rect(3.137em, 1000.42em, 4.144em, -1000em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-804" style="font-family: MathJax_Math; font-style: italic;">b</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; top: -4.271em; left: 0.429em;"><span class="mn" id="MathJax-Span-805" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span></span><span class="mo" id="MathJax-Span-806" style="font-family: MathJax_Main; padding-left: 0.222em;">−</span><span class="mn" id="MathJax-Span-807" style="font-family: MathJax_Main; padding-left: 0.222em;">4</span><span class="mi" id="MathJax-Span-808" style="font-family: MathJax_Math; font-style: italic;">a</span><span class="mi" id="MathJax-Span-809" style="font-family: MathJax_Math; font-style: italic;">c</span></span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; clip: rect(3.558em, 1003.48em, 3.905em, -1000em); top: -4.561em; left: 0.833em;"><span style="display: inline-block; position: relative; width: 3.483em; height: 0px;"><span style="position: absolute; font-family: MathJax_Main; top: -3.982em; left: -0.084em;">−<span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; font-family: MathJax_Main; top: -3.982em; left: 2.789em;">−<span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.982em; left: 0.388em;">−<span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.982em; left: 0.885em;">−<span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.982em; left: 1.382em;">−<span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.982em; left: 1.879em;">−<span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.982em; left: 2.376em;">−<span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; clip: rect(3.031em, 1000.85em, 4.333em, -1000em); top: -4.034em; left: 0em;"><span style="font-family: MathJax_Main;">√</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; clip: rect(3.165em, 1001.01em, 4.143em, -1000em); top: -3.296em; left: 50%; margin-left: -0.514em;"><span class="mrow" id="MathJax-Span-810"><span class="mn" id="MathJax-Span-811" style="font-family: MathJax_Main;">2</span><span class="mi" id="MathJax-Span-812" style="font-family: MathJax_Math; font-style: italic;">a</span></span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; clip: rect(0.844em, 1006.92em, 1.21em, -1000em); top: -1.278em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 6.924em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.058em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 1.008em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.925em; border-left: 0px solid; width: 0px; height: 2.883em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mfrac><mrow><mo>−</mo><mi>b</mi><mo>±</mo><msqrt><msup><mi>b</mi><mn>2</mn></msup><mo>−</mo><mn>4</mn><mi>a</mi><mi>c</mi></msqrt></mrow><mrow><mn>2</mn><mi>a</mi></mrow></mfrac></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-68"> \frac{-b \pm \sqrt{b^2 - 4ac}}{2a} </script>

</p><p>

Where for ray-sphere intersection the <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-69-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-813" style="width: 0.708em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.554em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.626em, 1000.53em, 2.379em, -1000em); top: -2.218em; left: 0em;"><span class="mrow" id="MathJax-Span-814"><span class="mi" id="MathJax-Span-815" style="font-family: MathJax_Math; font-style: italic;">a</span></span><span style="display: inline-block; width: 0px; height: 2.218em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.075em; border-left: 0px solid; width: 0px; height: 0.684em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>a</mi></math></span></span><script type="math/tex" id="MathJax-Element-69">a</script>/<span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-70-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;b&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-816" style="width: 0.557em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.454em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.373em, 1000.45em, 2.38em, -1000em); top: -2.218em; left: 0em;"><span class="mrow" id="MathJax-Span-817"><span class="mi" id="MathJax-Span-818" style="font-family: MathJax_Math; font-style: italic;">b</span></span><span style="display: inline-block; width: 0px; height: 2.218em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.076em; border-left: 0px solid; width: 0px; height: 0.999em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>b</mi></math></span></span><script type="math/tex" id="MathJax-Element-70">b</script>/<span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-71-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;c&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-819" style="width: 0.557em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.454em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.625em, 1000.45em, 2.38em, -1000em); top: -2.218em; left: 0em;"><span class="mrow" id="MathJax-Span-820"><span class="mi" id="MathJax-Span-821" style="font-family: MathJax_Math; font-style: italic;">c</span></span><span style="display: inline-block; width: 0px; height: 2.218em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.076em; border-left: 0px solid; width: 0px; height: 0.687em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>c</mi></math></span></span><script type="math/tex" id="MathJax-Element-71">c</script> values are:

</p><p>

  <span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-72-Frame" tabindex="0" style="text-align: center; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;b&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;b&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-822" style="width: 4.841em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.881em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.574em, 1003.84em, 2.581em, -1000em); top: -2.419em; left: 0em;"><span class="mrow" id="MathJax-Span-823"><span class="mi" id="MathJax-Span-824" style="font-family: MathJax_Math; font-style: italic;">a</span><span class="mo" id="MathJax-Span-825" style="font-family: MathJax_Main; padding-left: 0.278em;">=</span><span class="texatom" id="MathJax-Span-826" style="padding-left: 0.278em;"><span class="mrow" id="MathJax-Span-827"><span class="mi" id="MathJax-Span-828" style="font-family: MathJax_Main; font-weight: bold;">b</span></span></span><span class="mo" id="MathJax-Span-829" style="font-family: MathJax_Main; padding-left: 0.222em;">⋅</span><span class="texatom" id="MathJax-Span-830" style="padding-left: 0.222em;"><span class="mrow" id="MathJax-Span-831"><span class="mi" id="MathJax-Span-832" style="font-family: MathJax_Main; font-weight: bold;">b</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.419em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.075em; border-left: 0px solid; width: 0px; height: 0.998em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>a</mi><mo>=</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">b</mi></mrow><mo>⋅</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">b</mi></mrow></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-72"> a = \mathbf{b} \cdot \mathbf{b} </script>
  <span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-73-Frame" tabindex="0" style="text-align: center; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mi&gt;b&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;b&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;A&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;C&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-833" style="width: 9.075em; display: inline-block;"><span style="display: inline-block; position: relative; width: 7.308em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.518em, 1007.21em, 2.821em, -1000em); top: -2.419em; left: 0em;"><span class="mrow" id="MathJax-Span-834"><span class="mi" id="MathJax-Span-835" style="font-family: MathJax_Math; font-style: italic;">b</span><span class="mo" id="MathJax-Span-836" style="font-family: MathJax_Main; padding-left: 0.278em;">=</span><span class="mn" id="MathJax-Span-837" style="font-family: MathJax_Main; padding-left: 0.278em;">2</span><span class="texatom" id="MathJax-Span-838"><span class="mrow" id="MathJax-Span-839"><span class="mi" id="MathJax-Span-840" style="font-family: MathJax_Main; font-weight: bold;">b</span></span></span><span class="mo" id="MathJax-Span-841" style="font-family: MathJax_Main; padding-left: 0.222em;">⋅</span><span class="mo" id="MathJax-Span-842" style="font-family: MathJax_Main; padding-left: 0.222em;">(</span><span class="texatom" id="MathJax-Span-843"><span class="mrow" id="MathJax-Span-844"><span class="mi" id="MathJax-Span-845" style="font-family: MathJax_Main; font-weight: bold;">A</span></span></span><span class="mo" id="MathJax-Span-846" style="font-family: MathJax_Main; padding-left: 0.222em;">−</span><span class="texatom" id="MathJax-Span-847" style="padding-left: 0.222em;"><span class="mrow" id="MathJax-Span-848"><span class="mi" id="MathJax-Span-849" style="font-family: MathJax_Main; font-weight: bold;">C</span></span></span><span class="mo" id="MathJax-Span-850" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.419em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.365em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>b</mi><mo>=</mo><mn>2</mn><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">b</mi></mrow><mo>⋅</mo><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">A</mi></mrow><mo>−</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">C</mi></mrow><mo stretchy="false">)</mo></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-73"> b = 2 \mathbf{b} \cdot (\mathbf{A}-\mathbf{C}) </script>
  <span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-74-Frame" tabindex="0" style="text-align: center; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mi&gt;c&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;A&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;C&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;A&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;C&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-851" style="width: 14.871em; display: inline-block;"><span style="display: inline-block; position: relative; width: 11.996em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.384em, 1012em, 2.821em, -1000em); top: -2.419em; left: 0em;"><span class="mrow" id="MathJax-Span-852"><span class="mi" id="MathJax-Span-853" style="font-family: MathJax_Math; font-style: italic;">c</span><span class="mo" id="MathJax-Span-854" style="font-family: MathJax_Main; padding-left: 0.278em;">=</span><span class="mo" id="MathJax-Span-855" style="font-family: MathJax_Main; padding-left: 0.278em;">(</span><span class="texatom" id="MathJax-Span-856"><span class="mrow" id="MathJax-Span-857"><span class="mi" id="MathJax-Span-858" style="font-family: MathJax_Main; font-weight: bold;">A</span></span></span><span class="mo" id="MathJax-Span-859" style="font-family: MathJax_Main; padding-left: 0.222em;">−</span><span class="texatom" id="MathJax-Span-860" style="padding-left: 0.222em;"><span class="mrow" id="MathJax-Span-861"><span class="mi" id="MathJax-Span-862" style="font-family: MathJax_Main; font-weight: bold;">C</span></span></span><span class="mo" id="MathJax-Span-863" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-864" style="font-family: MathJax_Main; padding-left: 0.222em;">⋅</span><span class="mo" id="MathJax-Span-865" style="font-family: MathJax_Main; padding-left: 0.222em;">(</span><span class="texatom" id="MathJax-Span-866"><span class="mrow" id="MathJax-Span-867"><span class="mi" id="MathJax-Span-868" style="font-family: MathJax_Main; font-weight: bold;">A</span></span></span><span class="mo" id="MathJax-Span-869" style="font-family: MathJax_Main; padding-left: 0.222em;">−</span><span class="texatom" id="MathJax-Span-870" style="padding-left: 0.222em;"><span class="mrow" id="MathJax-Span-871"><span class="mi" id="MathJax-Span-872" style="font-family: MathJax_Main; font-weight: bold;">C</span></span></span><span class="mo" id="MathJax-Span-873" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-874" style="font-family: MathJax_Main; padding-left: 0.222em;">−</span><span class="msubsup" id="MathJax-Span-875" style="padding-left: 0.222em;"><span style="display: inline-block; position: relative; width: 0.88em; height: 0px;"><span style="position: absolute; clip: rect(3.389em, 1000.43em, 4.144em, -1000em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-876" style="font-family: MathJax_Math; font-style: italic;">r</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; top: -4.395em; left: 0.451em;"><span class="mn" id="MathJax-Span-877" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.419em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.531em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>c</mi><mo>=</mo><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">A</mi></mrow><mo>−</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">C</mi></mrow><mo stretchy="false">)</mo><mo>⋅</mo><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">A</mi></mrow><mo>−</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">C</mi></mrow><mo stretchy="false">)</mo><mo>−</mo><msup><mi>r</mi><mn>2</mn></msup></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-74"> c = (\mathbf{A}-\mathbf{C}) \cdot (\mathbf{A}-\mathbf{C}) - r^2 </script>

</p><p>

Using all of the above you can solve for <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-75-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-878" style="width: 0.456em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.353em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.441em, 1000.32em, 2.38em, -1000em); top: -2.218em; left: 0em;"><span class="mrow" id="MathJax-Span-879"><span class="mi" id="MathJax-Span-880" style="font-family: MathJax_Math; font-style: italic;">t</span></span><span style="display: inline-block; width: 0px; height: 2.218em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.076em; border-left: 0px solid; width: 0px; height: 0.915em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>t</mi></math></span></span><script type="math/tex" id="MathJax-Element-75">t</script>, but there is a square root part that can be either
positive (meaning two real solutions), negative (meaning no real solutions), or zero (meaning one
real solution). In graphics, the algebra almost always relates very directly to the geometry. What
we have is:

</p><p>

  </p><center><div class="image" style=""><a href="https://raytracing.github.io/images/fig-1.05-ray-sphere.jpg" target="_blank"><img class="markdeep" src="Ray%20Tracing%20in%20One%20Weekend_files/fig-1.05-ray-sphere.jpg"></a><center><span class="imagecaption"><a class="target" name="figure_ray-sphere">&nbsp;</a><b style="font-style:normal;">Figure&nbsp;5:</b> Ray-sphere intersection results</span></center></div></center>

<p></p>
<a class="target" name="creatingourfirstraytracedimage">&nbsp;</a><a class="target" name="addingasphere/creatingourfirstraytracedimage">&nbsp;</a><a class="target" name="toc5.2">&nbsp;</a><h2>Creating Our First Raytraced Image</h2>
<p>

If we take that math and hard-code it into our program, we can test our code by placing a small
sphere at −1 on the z-axis and then coloring red any pixel that intersects it.

</p><pre class="listing tilde"><code><div class=" highlight"><span class="line"></span><span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">hit_sphere</span><span class="hljs-params">(<span class="hljs-type">const</span> point3&amp; center, <span class="hljs-type">double</span> radius, <span class="hljs-type">const</span> ray&amp; r)</span> </span>{
<span class="line"></span>    vec3 oc = r.<span class="hljs-built_in">origin</span>() - center;
<span class="line"></span>    <span class="hljs-keyword">auto</span> a = <span class="hljs-built_in">dot</span>(r.<span class="hljs-built_in">direction</span>(), r.<span class="hljs-built_in">direction</span>());
<span class="line"></span>    <span class="hljs-keyword">auto</span> b = <span class="hljs-number">2.0</span> * <span class="hljs-built_in">dot</span>(oc, r.<span class="hljs-built_in">direction</span>());
<span class="line"></span>    <span class="hljs-keyword">auto</span> c = <span class="hljs-built_in">dot</span>(oc, oc) - radius*radius;
<span class="line"></span>    <span class="hljs-keyword">auto</span> discriminant = b*b - <span class="hljs-number">4</span>*a*c;
<span class="line"></span>    <span class="hljs-keyword">return</span> (discriminant &gt;= <span class="hljs-number">0</span>);
<span class="line"></span>}</div><span class="line"></span>
<span class="line"></span><span class="line"></span><span class="hljs-function">color <span class="hljs-title">ray_color</span><span class="hljs-params">(<span class="hljs-type">const</span> ray&amp; r)</span> </span>{<div class=" highlight"><span class="line"></span>    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">hit_sphere</span>(<span class="hljs-built_in">point3</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">-1</span>), <span class="hljs-number">0.5</span>, r))
<span class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">color</span>(<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);</div><span class="line"></span>
<span class="line"></span>    vec3 unit_direction = <span class="hljs-built_in">unit_vector</span>(r.<span class="hljs-built_in">direction</span>());
<span class="line"></span>    <span class="hljs-keyword">auto</span> a = <span class="hljs-number">0.5</span>*(unit_direction.<span class="hljs-built_in">y</span>() + <span class="hljs-number">1.0</span>);
<span class="line"></span>    <span class="hljs-keyword">return</span> (<span class="hljs-number">1.0</span>-a)*<span class="hljs-built_in">color</span>(<span class="hljs-number">1.0</span>, <span class="hljs-number">1.0</span>, <span class="hljs-number">1.0</span>) + a*<span class="hljs-built_in">color</span>(<span class="hljs-number">0.5</span>, <span class="hljs-number">0.7</span>, <span class="hljs-number">1.0</span>);
<span class="line"></span>}</code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_main-red-sphere">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;11:</b> <kbd>[main.cc]</kbd> Rendering a red sphere</div></center>
<p>


</p><div class="together">
What we get is this:

<p></p><p>

  </p><center><div class="image" style=""><a href="https://raytracing.github.io/images/img-1.03-red-sphere.png" target="_blank"><img class="markdeep pixel" src="Ray%20Tracing%20in%20One%20Weekend_files/img-1.03-red-sphere.png"></a><center><span class="imagecaption"><span class="num">Image 3:</span> A simple red sphere
  </span></center></div></center>

<p></p><p>

</p></div>

<p></p><p>

Now this lacks all sorts of things — like shading, reflection rays, and more than one object —
but we are closer to halfway done than we are to our start! One thing to be aware of is that we
are testing to see if a ray intersects with the sphere by solving the quadratic equation and seeing
if a solution exists, but solutions with negative values of <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-76-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-881" style="width: 0.456em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.353em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.441em, 1000.32em, 2.38em, -1000em); top: -2.218em; left: 0em;"><span class="mrow" id="MathJax-Span-882"><span class="mi" id="MathJax-Span-883" style="font-family: MathJax_Math; font-style: italic;">t</span></span><span style="display: inline-block; width: 0px; height: 2.218em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.076em; border-left: 0px solid; width: 0px; height: 0.915em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>t</mi></math></span></span><script type="math/tex" id="MathJax-Element-76">t</script> work just fine. If you change your
sphere center to <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-77-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-884" style="width: 3.833em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.075em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.451em, 1003em, 2.501em, -1000em); top: -2.268em; left: 0em;"><span class="mrow" id="MathJax-Span-885"><span class="mi" id="MathJax-Span-886" style="font-family: MathJax_Math; font-style: italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-887" style="font-family: MathJax_Main; padding-left: 0.278em;">=</span><span class="mo" id="MathJax-Span-888" style="font-family: MathJax_Main; padding-left: 0.278em;">+</span><span class="mn" id="MathJax-Span-889" style="font-family: MathJax_Main;">1</span></span><span style="display: inline-block; width: 0px; height: 2.268em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.164em; border-left: 0px solid; width: 0px; height: 1.053em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>z</mi><mo>=</mo><mo>+</mo><mn>1</mn></math></span></span><script type="math/tex" id="MathJax-Element-77">z = +1</script> you will get exactly the same picture because this solution doesn't
distinguish between objects <em class="underscore">in front of the camera</em> and objects <em class="underscore">behind the camera</em>. This is not a
feature! We’ll fix those issues next.

</p>
<a class="target" name="surfacenormalsandmultipleobjects">&nbsp;</a><a class="target" name="surfacenormalsandmultipleobjects">&nbsp;</a><a class="target" name="toc6">&nbsp;</a><h1>Surface Normals and Multiple Objects</h1>

<a class="target" name="shadingwithsurfacenormals">&nbsp;</a><a class="target" name="surfacenormalsandmultipleobjects/shadingwithsurfacenormals">&nbsp;</a><a class="target" name="toc6.1">&nbsp;</a><h2>Shading with Surface Normals</h2>
<p>

First, let’s get ourselves a surface normal so we can shade. This is a vector that is perpendicular
to the surface at the point of intersection.

</p><p>

We have a key design decision to make for normal vectors in our code: whether normal vectors will
have an arbitrary length, or will be normalized to unit length.

</p><p>

It is tempting to skip the expensive square root operation involved in normalizing the vector, in
case it's not needed.
In practice, however, there are three important observations.
First, if a unit-length normal vector is <em class="underscore">ever</em> required, then you might as well do it up front
once, instead of over and over again “just in case” for every location where unit-length is
required.
Second, we <em class="underscore">do</em> require unit-length normal vectors in several places.
Third, if you require normal vectors to be unit length, then you can often efficiently generate that
vector with an understanding of the specific geometry class, in its constructor, or in the <code>hit()</code>
function.
For example, sphere normals can be made unit length simply by dividing by the sphere radius,
avoiding the square root entirely.

</p><p>

Given all of this, we will adopt the policy that all normal vectors will be of unit length.

</p><p>

For a sphere, the outward normal is in the direction of the hit point minus the center:

</p><p>

  </p><center><div class="image" style=""><a href="https://raytracing.github.io/images/fig-1.06-sphere-normal.jpg" target="_blank"><img class="markdeep" src="Ray%20Tracing%20in%20One%20Weekend_files/fig-1.06-sphere-normal.jpg"></a><center><span class="imagecaption"><a class="target" name="figure_sphere-normal">&nbsp;</a><b style="font-style:normal;">Figure&nbsp;6:</b> Sphere surface-normal geometry</span></center></div></center>

<p></p><p>

On the earth, this means that the vector from the earth’s center to you points straight up. Let’s
throw that into the code now, and shade it. We don’t have any lights or anything yet, so let’s just
visualize the normals with a color map.
A common trick used for visualizing normals (because it’s easy and somewhat intuitive to assume
<span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-78-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-890" style="width: 0.809em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.655em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.667em, 1000.64em, 2.419em, -1000em); top: -2.268em; left: 0em;"><span class="mrow" id="MathJax-Span-891"><span class="texatom" id="MathJax-Span-892"><span class="mrow" id="MathJax-Span-893"><span class="mi" id="MathJax-Span-894" style="font-family: MathJax_Main; font-weight: bold;">n</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.268em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.063em; border-left: 0px solid; width: 0px; height: 0.683em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">n</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-78">\mathbf{n}</script> is a unit length vector — so each component is between −1 and 1) is to map each
component to the interval from 0 to 1, and then map <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-79-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-895" style="width: 4.035em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.226em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.367em, 1003.13em, 2.669em, -1000em); top: -2.268em; left: 0em;"><span class="mrow" id="MathJax-Span-896"><span class="mo" id="MathJax-Span-897" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-898" style="font-family: MathJax_Math; font-style: italic;">x</span><span class="mo" id="MathJax-Span-899" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-900" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.167em;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.006em;"></span></span><span class="mo" id="MathJax-Span-901" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-902" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.167em;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-903" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.268em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.365em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">(</mo><mi>x</mi><mo>,</mo><mi>y</mi><mo>,</mo><mi>z</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-79">(x, y, z)</script> to <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-80-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;r&lt;/mi&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;e&lt;/mi&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;d&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;g&lt;/mi&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;r&lt;/mi&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;e&lt;/mi&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;e&lt;/mi&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;b&lt;/mi&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;l&lt;/mi&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;u&lt;/mi&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;e&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-904" style="width: 8.873em; display: inline-block;"><span style="display: inline-block; position: relative; width: 7.157em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.518em, 1007.06em, 2.821em, -1000em); top: -2.419em; left: 0em;"><span class="mrow" id="MathJax-Span-905"><span class="mo" id="MathJax-Span-906" style="font-family: MathJax_Main;">(</span><span class="texatom" id="MathJax-Span-907"><span class="mrow" id="MathJax-Span-908"><span class="mi" id="MathJax-Span-909" style="font-family: MathJax_Main; font-style: italic;">r</span><span class="mi" id="MathJax-Span-910" style="font-family: MathJax_Main; font-style: italic;">e</span><span class="mi" id="MathJax-Span-911" style="font-family: MathJax_Main; font-style: italic;">d</span></span></span><span class="mo" id="MathJax-Span-912" style="font-family: MathJax_Main;">,</span><span class="texatom" id="MathJax-Span-913" style="padding-left: 0.167em;"><span class="mrow" id="MathJax-Span-914"><span class="mi" id="MathJax-Span-915" style="font-family: MathJax_Main; font-style: italic;">g</span><span class="mi" id="MathJax-Span-916" style="font-family: MathJax_Main; font-style: italic;">r</span><span class="mi" id="MathJax-Span-917" style="font-family: MathJax_Main; font-style: italic;">e</span><span class="mi" id="MathJax-Span-918" style="font-family: MathJax_Main; font-style: italic;">e</span><span class="mi" id="MathJax-Span-919" style="font-family: MathJax_Main; font-style: italic;">n</span></span></span><span class="mo" id="MathJax-Span-920" style="font-family: MathJax_Main;">,</span><span class="texatom" id="MathJax-Span-921" style="padding-left: 0.167em;"><span class="mrow" id="MathJax-Span-922"><span class="mi" id="MathJax-Span-923" style="font-family: MathJax_Main; font-style: italic;">b</span><span class="mi" id="MathJax-Span-924" style="font-family: MathJax_Main; font-style: italic;">l</span><span class="mi" id="MathJax-Span-925" style="font-family: MathJax_Main; font-style: italic;">u</span><span class="mi" id="MathJax-Span-926" style="font-family: MathJax_Main; font-style: italic;">e</span></span></span><span class="mo" id="MathJax-Span-927" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.419em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.365em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mi class="MJX-tex-mathit" mathvariant="italic">r</mi><mi class="MJX-tex-mathit" mathvariant="italic">e</mi><mi class="MJX-tex-mathit" mathvariant="italic">d</mi></mrow><mo>,</mo><mrow class="MJX-TeXAtom-ORD"><mi class="MJX-tex-mathit" mathvariant="italic">g</mi><mi class="MJX-tex-mathit" mathvariant="italic">r</mi><mi class="MJX-tex-mathit" mathvariant="italic">e</mi><mi class="MJX-tex-mathit" mathvariant="italic">e</mi><mi class="MJX-tex-mathit" mathvariant="italic">n</mi></mrow><mo>,</mo><mrow class="MJX-TeXAtom-ORD"><mi class="MJX-tex-mathit" mathvariant="italic">b</mi><mi class="MJX-tex-mathit" mathvariant="italic">l</mi><mi class="MJX-tex-mathit" mathvariant="italic">u</mi><mi class="MJX-tex-mathit" mathvariant="italic">e</mi></mrow><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-80">(\mathit{red}, \mathit{green},
\mathit{blue})</script>.
For the normal, we need the hit point, not just whether we hit or not (which is all we're
calculating at the moment).
We only have one sphere in the scene, and it's directly in front of the camera, so we won't worry
about negative values of <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-81-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-928" style="width: 0.456em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.353em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.441em, 1000.32em, 2.38em, -1000em); top: -2.218em; left: 0em;"><span class="mrow" id="MathJax-Span-929"><span class="mi" id="MathJax-Span-930" style="font-family: MathJax_Math; font-style: italic;">t</span></span><span style="display: inline-block; width: 0px; height: 2.218em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.076em; border-left: 0px solid; width: 0px; height: 0.915em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>t</mi></math></span></span><script type="math/tex" id="MathJax-Element-81">t</script> yet.
We'll just assume the closest hit point (smallest <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-82-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-931" style="width: 0.456em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.353em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.441em, 1000.32em, 2.38em, -1000em); top: -2.218em; left: 0em;"><span class="mrow" id="MathJax-Span-932"><span class="mi" id="MathJax-Span-933" style="font-family: MathJax_Math; font-style: italic;">t</span></span><span style="display: inline-block; width: 0px; height: 2.218em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.076em; border-left: 0px solid; width: 0px; height: 0.915em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>t</mi></math></span></span><script type="math/tex" id="MathJax-Element-82">t</script>) is the one that we want.
These changes in the code let us compute and visualize <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-83-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-934" style="width: 0.809em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.655em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.667em, 1000.64em, 2.419em, -1000em); top: -2.268em; left: 0em;"><span class="mrow" id="MathJax-Span-935"><span class="texatom" id="MathJax-Span-936"><span class="mrow" id="MathJax-Span-937"><span class="mi" id="MathJax-Span-938" style="font-family: MathJax_Main; font-weight: bold;">n</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.268em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.063em; border-left: 0px solid; width: 0px; height: 0.683em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">n</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-83">\mathbf{n}</script>:

</p><pre class="listing tilde"><code><div class=" highlight"><span class="line"></span><span class="hljs-function"><span class="hljs-type">double</span> <span class="hljs-title">hit_sphere</span><span class="hljs-params">(<span class="hljs-type">const</span> point3&amp; center, <span class="hljs-type">double</span> radius, <span class="hljs-type">const</span> ray&amp; r)</span> </span>{</div><span class="line"></span>    vec3 oc = r.<span class="hljs-built_in">origin</span>() - center;
<span class="line"></span>    <span class="hljs-keyword">auto</span> a = <span class="hljs-built_in">dot</span>(r.<span class="hljs-built_in">direction</span>(), r.<span class="hljs-built_in">direction</span>());
<span class="line"></span>    <span class="hljs-keyword">auto</span> b = <span class="hljs-number">2.0</span> * <span class="hljs-built_in">dot</span>(oc, r.<span class="hljs-built_in">direction</span>());
<span class="line"></span>    <span class="hljs-keyword">auto</span> c = <span class="hljs-built_in">dot</span>(oc, oc) - radius*radius;
<span class="line"></span>    <span class="hljs-keyword">auto</span> discriminant = b*b - <span class="hljs-number">4</span>*a*c;
<span class="line"></span>
<span class="line"></span><div class=" highlight"><span class="line"></span>    <span class="hljs-keyword">if</span> (discriminant &lt; <span class="hljs-number">0</span>) {
<span class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-number">-1.0</span>;
<span class="line"></span>    } <span class="hljs-keyword">else</span> {
<span class="line"></span>        <span class="hljs-built_in">return</span> (-b - <span class="hljs-built_in">sqrt</span>(discriminant) ) / (<span class="hljs-number">2.0</span>*a);
<span class="line"></span>    }</div><span class="line"></span>}
<span class="line"></span>
<span class="line"></span><span class="hljs-function">color <span class="hljs-title">ray_color</span><span class="hljs-params">(<span class="hljs-type">const</span> ray&amp; r)</span> </span>{<div class=" highlight"><span class="line"></span>    <span class="hljs-keyword">auto</span> t = <span class="hljs-built_in">hit_sphere</span>(<span class="hljs-built_in">point3</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">-1</span>), <span class="hljs-number">0.5</span>, r);
<span class="line"></span>    <span class="hljs-keyword">if</span> (t &gt; <span class="hljs-number">0.0</span>) {
<span class="line"></span>        vec3 N = <span class="hljs-built_in">unit_vector</span>(r.<span class="hljs-built_in">at</span>(t) - <span class="hljs-built_in">vec3</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">-1</span>));
<span class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-number">0.5</span>*<span class="hljs-built_in">color</span>(N.<span class="hljs-built_in">x</span>()+<span class="hljs-number">1</span>, N.<span class="hljs-built_in">y</span>()+<span class="hljs-number">1</span>, N.<span class="hljs-built_in">z</span>()+<span class="hljs-number">1</span>);
<span class="line"></span>    }</div><span class="line"></span>
<span class="line"></span>    vec3 unit_direction = <span class="hljs-built_in">unit_vector</span>(r.<span class="hljs-built_in">direction</span>());
<span class="line"></span>    <span class="hljs-keyword">auto</span> a = <span class="hljs-number">0.5</span>*(unit_direction.<span class="hljs-built_in">y</span>() + <span class="hljs-number">1.0</span>);
<span class="line"></span>    <span class="hljs-keyword">return</span> (<span class="hljs-number">1.0</span>-a)*<span class="hljs-built_in">color</span>(<span class="hljs-number">1.0</span>, <span class="hljs-number">1.0</span>, <span class="hljs-number">1.0</span>) + a*<span class="hljs-built_in">color</span>(<span class="hljs-number">0.5</span>, <span class="hljs-number">0.7</span>, <span class="hljs-number">1.0</span>);
<span class="line"></span>}</code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_render-surface-normal">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;12:</b> <kbd>[main.cc]</kbd> Rendering surface normals on a sphere</div></center>
<p>


</p><div class="together">
And that yields this picture:

<p></p><p>

  </p><center><div class="image" style=""><a href="https://raytracing.github.io/images/img-1.04-normals-sphere.png" target="_blank"><img class="markdeep pixel" src="Ray%20Tracing%20in%20One%20Weekend_files/img-1.04-normals-sphere.png"></a><center><span class="imagecaption"><span class="num">Image 4:</span> A sphere colored according to its normal vectors
  </span></center></div></center>

<p></p><p>

</p></div>

<p></p>
<a class="target" name="simplifyingtheray-sphereintersectioncode">&nbsp;</a><a class="target" name="surfacenormalsandmultipleobjects/simplifyingtheray-sphereintersectioncode">&nbsp;</a><a class="target" name="toc6.2">&nbsp;</a><h2>Simplifying the Ray-Sphere Intersection Code</h2>
<p>

Let’s revisit the ray-sphere function:

</p><pre class="listing tilde"><code><span class="line"></span><span class="hljs-function"><span class="hljs-type">double</span> <span class="hljs-title">hit_sphere</span><span class="hljs-params">(<span class="hljs-type">const</span> point3&amp; center, <span class="hljs-type">double</span> radius, <span class="hljs-type">const</span> ray&amp; r)</span> </span>{
<span class="line"></span>    vec3 oc = r.<span class="hljs-built_in">origin</span>() - center;
<span class="line"></span>    <span class="hljs-keyword">auto</span> a = <span class="hljs-built_in">dot</span>(r.<span class="hljs-built_in">direction</span>(), r.<span class="hljs-built_in">direction</span>());
<span class="line"></span>    <span class="hljs-keyword">auto</span> b = <span class="hljs-number">2.0</span> * <span class="hljs-built_in">dot</span>(oc, r.<span class="hljs-built_in">direction</span>());
<span class="line"></span>    <span class="hljs-keyword">auto</span> c = <span class="hljs-built_in">dot</span>(oc, oc) - radius*radius;
<span class="line"></span>    <span class="hljs-keyword">auto</span> discriminant = b*b - <span class="hljs-number">4</span>*a*c;
<span class="line"></span>
<span class="line"></span>    <span class="hljs-keyword">if</span> (discriminant &lt; <span class="hljs-number">0</span>) {
<span class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-number">-1.0</span>;
<span class="line"></span>    } <span class="hljs-keyword">else</span> {
<span class="line"></span>        <span class="hljs-built_in">return</span> (-b - <span class="hljs-built_in">sqrt</span>(discriminant) ) / (<span class="hljs-number">2.0</span>*a);
<span class="line"></span>    }
<span class="line"></span>}</code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_ray-sphere-before">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;13:</b> <kbd>[main.cc]</kbd> Ray-sphere intersection code (before)</div></center>
<p>


First, recall that a vector dotted with itself is equal to the squared length of that vector.

</p><p>

Second, notice how the equation for <code>b</code> has a factor of two in it. Consider what happens to the
quadratic equation if <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-84-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;b&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;mi&gt;h&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-939" style="width: 3.531em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.823em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.423em, 1002.8em, 2.43em, -1000em); top: -2.268em; left: 0em;"><span class="mrow" id="MathJax-Span-940"><span class="mi" id="MathJax-Span-941" style="font-family: MathJax_Math; font-style: italic;">b</span><span class="mo" id="MathJax-Span-942" style="font-family: MathJax_Main; padding-left: 0.278em;">=</span><span class="mn" id="MathJax-Span-943" style="font-family: MathJax_Main; padding-left: 0.278em;">2</span><span class="mi" id="MathJax-Span-944" style="font-family: MathJax_Math; font-style: italic;">h</span></span><span style="display: inline-block; width: 0px; height: 2.268em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.076em; border-left: 0px solid; width: 0px; height: 0.999em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>b</mi><mo>=</mo><mn>2</mn><mi>h</mi></math></span></span><script type="math/tex" id="MathJax-Element-84">b = 2h</script>:

</p><p>

  <span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-85-Frame" tabindex="0" style="text-align: center; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mfrac&gt;&lt;mrow&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mi&gt;b&lt;/mi&gt;&lt;mo&gt;&amp;#x00B1;&lt;/mo&gt;&lt;msqrt&gt;&lt;msup&gt;&lt;mi&gt;b&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mn&gt;4&lt;/mn&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mi&gt;c&lt;/mi&gt;&lt;/msqrt&gt;&lt;/mrow&gt;&lt;mrow&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;/mrow&gt;&lt;/mfrac&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-945" style="width: 8.873em; display: inline-block;"><span style="display: inline-block; position: relative; width: 7.157em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(-0.671em, 1007.16em, 1.855em, -1000em); top: -1.008em; left: 0em;"><span class="mrow" id="MathJax-Span-946"><span class="mfrac" id="MathJax-Span-947"><span style="display: inline-block; position: relative; width: 6.924em; height: 0px; margin-right: 0.12em; margin-left: 0.12em;"><span style="position: absolute; clip: rect(2.979em, 1006.8em, 4.281em, -1000em); top: -4.658em; left: 50%; margin-left: -3.402em;"><span class="mrow" id="MathJax-Span-948"><span class="mo" id="MathJax-Span-949" style="font-family: MathJax_Main;">−</span><span class="mi" id="MathJax-Span-950" style="font-family: MathJax_Math; font-style: italic;">b</span><span class="mo" id="MathJax-Span-951" style="font-family: MathJax_Main; padding-left: 0.222em;">±</span><span class="msqrt" id="MathJax-Span-952" style="padding-left: 0.222em;"><span style="display: inline-block; position: relative; width: 4.375em; height: 0px;"><span style="position: absolute; clip: rect(3.071em, 1003.54em, 4.215em, -1000em); top: -3.982em; left: 0.833em;"><span class="mrow" id="MathJax-Span-953"><span class="msubsup" id="MathJax-Span-954"><span style="display: inline-block; position: relative; width: 0.858em; height: 0px;"><span style="position: absolute; clip: rect(3.137em, 1000.42em, 4.144em, -1000em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-955" style="font-family: MathJax_Math; font-style: italic;">b</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; top: -4.271em; left: 0.429em;"><span class="mn" id="MathJax-Span-956" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span></span><span class="mo" id="MathJax-Span-957" style="font-family: MathJax_Main; padding-left: 0.222em;">−</span><span class="mn" id="MathJax-Span-958" style="font-family: MathJax_Main; padding-left: 0.222em;">4</span><span class="mi" id="MathJax-Span-959" style="font-family: MathJax_Math; font-style: italic;">a</span><span class="mi" id="MathJax-Span-960" style="font-family: MathJax_Math; font-style: italic;">c</span></span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; clip: rect(3.558em, 1003.48em, 3.905em, -1000em); top: -4.561em; left: 0.833em;"><span style="display: inline-block; position: relative; width: 3.483em; height: 0px;"><span style="position: absolute; font-family: MathJax_Main; top: -3.982em; left: -0.084em;">−<span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; font-family: MathJax_Main; top: -3.982em; left: 2.789em;">−<span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.982em; left: 0.388em;">−<span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.982em; left: 0.885em;">−<span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.982em; left: 1.382em;">−<span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.982em; left: 1.879em;">−<span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.982em; left: 2.376em;">−<span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; clip: rect(3.031em, 1000.85em, 4.333em, -1000em); top: -4.034em; left: 0em;"><span style="font-family: MathJax_Main;">√</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; clip: rect(3.165em, 1001.01em, 4.143em, -1000em); top: -3.296em; left: 50%; margin-left: -0.514em;"><span class="mrow" id="MathJax-Span-961"><span class="mn" id="MathJax-Span-962" style="font-family: MathJax_Main;">2</span><span class="mi" id="MathJax-Span-963" style="font-family: MathJax_Math; font-style: italic;">a</span></span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; clip: rect(0.844em, 1006.92em, 1.21em, -1000em); top: -1.278em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 6.924em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.058em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 1.008em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.925em; border-left: 0px solid; width: 0px; height: 2.883em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mfrac><mrow><mo>−</mo><mi>b</mi><mo>±</mo><msqrt><msup><mi>b</mi><mn>2</mn></msup><mo>−</mo><mn>4</mn><mi>a</mi><mi>c</mi></msqrt></mrow><mrow><mn>2</mn><mi>a</mi></mrow></mfrac></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-85"> \frac{-b \pm \sqrt{b^2 - 4ac}}{2a} </script>

</p><p>

  <span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-86-Frame" tabindex="0" style="text-align: center; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mfrac&gt;&lt;mrow&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;mi&gt;h&lt;/mi&gt;&lt;mo&gt;&amp;#x00B1;&lt;/mo&gt;&lt;msqrt&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;mi&gt;h&lt;/mi&gt;&lt;msup&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mn&gt;4&lt;/mn&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mi&gt;c&lt;/mi&gt;&lt;/msqrt&gt;&lt;/mrow&gt;&lt;mrow&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;/mrow&gt;&lt;/mfrac&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-964" style="width: 13.007em; display: inline-block;"><span style="display: inline-block; position: relative; width: 10.484em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(0.552em, 1010.48em, 3.216em, -1000em); top: -2.369em; left: 0em;"><span class="mrow" id="MathJax-Span-965"><span class="mo" id="MathJax-Span-966" style="font-family: MathJax_Main;">=</span><span class="mfrac" id="MathJax-Span-967" style="padding-left: 0.278em;"><span style="display: inline-block; position: relative; width: 9.163em; height: 0px; margin-right: 0.12em; margin-left: 0.12em;"><span style="position: absolute; clip: rect(2.963em, 1009.04em, 4.465em, -1000em); top: -4.78em; left: 50%; margin-left: -4.521em;"><span class="mrow" id="MathJax-Span-968"><span class="mo" id="MathJax-Span-969" style="font-family: MathJax_Main;">−</span><span class="mn" id="MathJax-Span-970" style="font-family: MathJax_Main;">2</span><span class="mi" id="MathJax-Span-971" style="font-family: MathJax_Math; font-style: italic;">h</span><span class="mo" id="MathJax-Span-972" style="font-family: MathJax_Main; padding-left: 0.222em;">±</span><span class="msqrt" id="MathJax-Span-973" style="padding-left: 0.222em;"><span style="display: inline-block; position: relative; width: 5.967em; height: 0px;"><span style="position: absolute; clip: rect(3.071em, 1004.96em, 4.383em, -1000em); top: -3.982em; left: 1em;"><span class="mrow" id="MathJax-Span-974"><span class="mo" id="MathJax-Span-975" style="font-family: MathJax_Main;">(</span><span class="mn" id="MathJax-Span-976" style="font-family: MathJax_Main;">2</span><span class="mi" id="MathJax-Span-977" style="font-family: MathJax_Math; font-style: italic;">h</span><span class="msubsup" id="MathJax-Span-978"><span style="display: inline-block; position: relative; width: 0.818em; height: 0px;"><span style="position: absolute; clip: rect(3.081em, 1000.29em, 4.383em, -1000em); top: -3.982em; left: 0em;"><span class="mo" id="MathJax-Span-979" style="font-family: MathJax_Main;">)</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; top: -4.271em; left: 0.389em;"><span class="mn" id="MathJax-Span-980" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span></span><span class="mo" id="MathJax-Span-981" style="font-family: MathJax_Main; padding-left: 0.222em;">−</span><span class="mn" id="MathJax-Span-982" style="font-family: MathJax_Main; padding-left: 0.222em;">4</span><span class="mi" id="MathJax-Span-983" style="font-family: MathJax_Math; font-style: italic;">a</span><span class="mi" id="MathJax-Span-984" style="font-family: MathJax_Math; font-style: italic;">c</span></span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; clip: rect(3.558em, 1004.91em, 3.905em, -1000em); top: -4.577em; left: 1em;"><span style="display: inline-block; position: relative; width: 4.908em; height: 0px;"><span style="position: absolute; font-family: MathJax_Main; top: -3.982em; left: -0.084em;">−<span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; font-family: MathJax_Main; top: -3.982em; left: 4.214em;">−<span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.982em; left: 0.442em;">−<span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.982em; left: 0.993em;">−<span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.982em; left: 1.543em;">−<span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.982em; left: 2.094em;">−<span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.982em; left: 2.645em;">−<span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.982em; left: 3.196em;">−<span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.982em; left: 3.747em;">−<span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; clip: rect(2.981em, 1001.02em, 4.483em, -1000em); top: -4em; left: 0em;"><span style="font-family: MathJax_Size1;">√</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; clip: rect(3.165em, 1001.01em, 4.143em, -1000em); top: -3.296em; left: 50%; margin-left: -0.514em;"><span class="mrow" id="MathJax-Span-985"><span class="mn" id="MathJax-Span-986" style="font-family: MathJax_Main;">2</span><span class="mi" id="MathJax-Span-987" style="font-family: MathJax_Math; font-style: italic;">a</span></span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; clip: rect(0.844em, 1009.16em, 1.21em, -1000em); top: -1.278em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 9.163em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.058em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.369em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.925em; border-left: 0px solid; width: 0px; height: 3.054em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mo>=</mo><mfrac><mrow><mo>−</mo><mn>2</mn><mi>h</mi><mo>±</mo><msqrt><mo stretchy="false">(</mo><mn>2</mn><mi>h</mi><msup><mo stretchy="false">)</mo><mn>2</mn></msup><mo>−</mo><mn>4</mn><mi>a</mi><mi>c</mi></msqrt></mrow><mrow><mn>2</mn><mi>a</mi></mrow></mfrac></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-86"> = \frac{-2h \pm \sqrt{(2h)^2 - 4ac}}{2a} </script>

</p><p>

  <span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-87-Frame" tabindex="0" style="text-align: center; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mfrac&gt;&lt;mrow&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;mi&gt;h&lt;/mi&gt;&lt;mo&gt;&amp;#x00B1;&lt;/mo&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;msqrt&gt;&lt;msup&gt;&lt;mi&gt;h&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mi&gt;c&lt;/mi&gt;&lt;/msqrt&gt;&lt;/mrow&gt;&lt;mrow&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;/mrow&gt;&lt;/mfrac&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-988" style="width: 11.192em; display: inline-block;"><span style="display: inline-block; position: relative; width: 9.022em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(0.69em, 1009.02em, 3.216em, -1000em); top: -2.369em; left: 0em;"><span class="mrow" id="MathJax-Span-989"><span class="mo" id="MathJax-Span-990" style="font-family: MathJax_Main;">=</span><span class="mfrac" id="MathJax-Span-991" style="padding-left: 0.278em;"><span style="display: inline-block; position: relative; width: 7.718em; height: 0px; margin-right: 0.12em; margin-left: 0.12em;"><span style="position: absolute; clip: rect(2.979em, 1007.59em, 4.281em, -1000em); top: -4.658em; left: 50%; margin-left: -3.799em;"><span class="mrow" id="MathJax-Span-992"><span class="mo" id="MathJax-Span-993" style="font-family: MathJax_Main;">−</span><span class="mn" id="MathJax-Span-994" style="font-family: MathJax_Main;">2</span><span class="mi" id="MathJax-Span-995" style="font-family: MathJax_Math; font-style: italic;">h</span><span class="mo" id="MathJax-Span-996" style="font-family: MathJax_Main; padding-left: 0.222em;">±</span><span class="mn" id="MathJax-Span-997" style="font-family: MathJax_Main; padding-left: 0.222em;">2</span><span class="msqrt" id="MathJax-Span-998"><span style="display: inline-block; position: relative; width: 4.022em; height: 0px;"><span style="position: absolute; clip: rect(3.071em, 1003.19em, 4.215em, -1000em); top: -3.982em; left: 0.833em;"><span class="mrow" id="MathJax-Span-999"><span class="msubsup" id="MathJax-Span-1000"><span style="display: inline-block; position: relative; width: 1.005em; height: 0px;"><span style="position: absolute; clip: rect(3.137em, 1000.56em, 4.144em, -1000em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-1001" style="font-family: MathJax_Math; font-style: italic;">h</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; top: -4.271em; left: 0.576em;"><span class="mn" id="MathJax-Span-1002" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span></span><span class="mo" id="MathJax-Span-1003" style="font-family: MathJax_Main; padding-left: 0.222em;">−</span><span class="mi" id="MathJax-Span-1004" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.222em;">a</span><span class="mi" id="MathJax-Span-1005" style="font-family: MathJax_Math; font-style: italic;">c</span></span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; clip: rect(3.558em, 1003.13em, 3.905em, -1000em); top: -4.561em; left: 0.833em;"><span style="display: inline-block; position: relative; width: 3.13em; height: 0px;"><span style="position: absolute; font-family: MathJax_Main; top: -3.982em; left: -0.084em;">−<span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; font-family: MathJax_Main; top: -3.982em; left: 2.436em;">−<span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.982em; left: 0.417em;">−<span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.982em; left: 0.942em;">−<span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.982em; left: 1.468em;">−<span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.982em; left: 1.994em;">−<span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; clip: rect(3.031em, 1000.85em, 4.333em, -1000em); top: -4.034em; left: 0em;"><span style="font-family: MathJax_Main;">√</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; clip: rect(3.165em, 1001.01em, 4.143em, -1000em); top: -3.296em; left: 50%; margin-left: -0.514em;"><span class="mrow" id="MathJax-Span-1006"><span class="mn" id="MathJax-Span-1007" style="font-family: MathJax_Main;">2</span><span class="mi" id="MathJax-Span-1008" style="font-family: MathJax_Math; font-style: italic;">a</span></span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; clip: rect(0.844em, 1007.72em, 1.21em, -1000em); top: -1.278em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 7.718em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.058em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.369em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.925em; border-left: 0px solid; width: 0px; height: 2.883em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mo>=</mo><mfrac><mrow><mo>−</mo><mn>2</mn><mi>h</mi><mo>±</mo><mn>2</mn><msqrt><msup><mi>h</mi><mn>2</mn></msup><mo>−</mo><mi>a</mi><mi>c</mi></msqrt></mrow><mrow><mn>2</mn><mi>a</mi></mrow></mfrac></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-87"> = \frac{-2h \pm 2\sqrt{h^2 - ac}}{2a} </script>

</p><p>

  <span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-88-Frame" tabindex="0" style="text-align: center; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mfrac&gt;&lt;mrow&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mi&gt;h&lt;/mi&gt;&lt;mo&gt;&amp;#x00B1;&lt;/mo&gt;&lt;msqrt&gt;&lt;msup&gt;&lt;mi&gt;h&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mi&gt;c&lt;/mi&gt;&lt;/msqrt&gt;&lt;/mrow&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;/mfrac&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1009" style="width: 9.932em; display: inline-block;"><span style="display: inline-block; position: relative; width: 8.014em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(0.69em, 1008.01em, 3.216em, -1000em); top: -2.369em; left: 0em;"><span class="mrow" id="MathJax-Span-1010"><span class="mo" id="MathJax-Span-1011" style="font-family: MathJax_Main;">=</span><span class="mfrac" id="MathJax-Span-1012" style="padding-left: 0.278em;"><span style="display: inline-block; position: relative; width: 6.718em; height: 0px; margin-right: 0.12em; margin-left: 0.12em;"><span style="position: absolute; clip: rect(2.979em, 1006.59em, 4.281em, -1000em); top: -4.658em; left: 50%; margin-left: -3.299em;"><span class="mrow" id="MathJax-Span-1013"><span class="mo" id="MathJax-Span-1014" style="font-family: MathJax_Main;">−</span><span class="mi" id="MathJax-Span-1015" style="font-family: MathJax_Math; font-style: italic;">h</span><span class="mo" id="MathJax-Span-1016" style="font-family: MathJax_Main; padding-left: 0.222em;">±</span><span class="msqrt" id="MathJax-Span-1017" style="padding-left: 0.222em;"><span style="display: inline-block; position: relative; width: 4.022em; height: 0px;"><span style="position: absolute; clip: rect(3.071em, 1003.19em, 4.215em, -1000em); top: -3.982em; left: 0.833em;"><span class="mrow" id="MathJax-Span-1018"><span class="msubsup" id="MathJax-Span-1019"><span style="display: inline-block; position: relative; width: 1.005em; height: 0px;"><span style="position: absolute; clip: rect(3.137em, 1000.56em, 4.144em, -1000em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-1020" style="font-family: MathJax_Math; font-style: italic;">h</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; top: -4.271em; left: 0.576em;"><span class="mn" id="MathJax-Span-1021" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span></span><span class="mo" id="MathJax-Span-1022" style="font-family: MathJax_Main; padding-left: 0.222em;">−</span><span class="mi" id="MathJax-Span-1023" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.222em;">a</span><span class="mi" id="MathJax-Span-1024" style="font-family: MathJax_Math; font-style: italic;">c</span></span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; clip: rect(3.558em, 1003.13em, 3.905em, -1000em); top: -4.561em; left: 0.833em;"><span style="display: inline-block; position: relative; width: 3.13em; height: 0px;"><span style="position: absolute; font-family: MathJax_Main; top: -3.982em; left: -0.084em;">−<span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; font-family: MathJax_Main; top: -3.982em; left: 2.436em;">−<span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.982em; left: 0.417em;">−<span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.982em; left: 0.942em;">−<span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.982em; left: 1.468em;">−<span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.982em; left: 1.994em;">−<span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; clip: rect(3.031em, 1000.85em, 4.333em, -1000em); top: -4.034em; left: 0em;"><span style="font-family: MathJax_Main;">√</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; clip: rect(3.39em, 1000.51em, 4.143em, -1000em); top: -3.296em; left: 50%; margin-left: -0.265em;"><span class="mi" id="MathJax-Span-1025" style="font-family: MathJax_Math; font-style: italic;">a</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; clip: rect(0.844em, 1006.72em, 1.21em, -1000em); top: -1.278em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 6.718em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.058em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.369em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.925em; border-left: 0px solid; width: 0px; height: 2.883em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mo>=</mo><mfrac><mrow><mo>−</mo><mi>h</mi><mo>±</mo><msqrt><msup><mi>h</mi><mn>2</mn></msup><mo>−</mo><mi>a</mi><mi>c</mi></msqrt></mrow><mi>a</mi></mfrac></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-88"> = \frac{-h \pm \sqrt{h^2 - ac}}{a} </script>

</p><p>

</p><div class="together">
Using these observations, we can now simplify the sphere-intersection code to this:

<p></p><pre class="listing tilde"><code><span class="line"></span><span class="hljs-function"><span class="hljs-type">double</span> <span class="hljs-title">hit_sphere</span><span class="hljs-params">(<span class="hljs-type">const</span> point3&amp; center, <span class="hljs-type">double</span> radius, <span class="hljs-type">const</span> ray&amp; r)</span> </span>{
<span class="line"></span>    vec3 oc = r.<span class="hljs-built_in">origin</span>() - center;<div class=" highlight"><span class="line"></span>    <span class="hljs-keyword">auto</span> a = r.<span class="hljs-built_in">direction</span>().<span class="hljs-built_in">length_squared</span>();
<span class="line"></span>    <span class="hljs-keyword">auto</span> half_b = <span class="hljs-built_in">dot</span>(oc, r.<span class="hljs-built_in">direction</span>());
<span class="line"></span>    <span class="hljs-keyword">auto</span> c = oc.<span class="hljs-built_in">length_squared</span>() - radius*radius;
<span class="line"></span>    <span class="hljs-keyword">auto</span> discriminant = half_b*half_b - a*c;</div><span class="line"></span>
<span class="line"></span>    <span class="hljs-keyword">if</span> (discriminant &lt; <span class="hljs-number">0</span>) {
<span class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-number">-1.0</span>;
<span class="line"></span>    } <span class="hljs-keyword">else</span> {<div class=" highlight"><span class="line"></span>        <span class="hljs-keyword">return</span> (-half_b - <span class="hljs-built_in">sqrt</span>(discriminant) ) / a;</div><span class="line"></span>    }
<span class="line"></span>}</code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_ray-sphere-after">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;14:</b> <kbd>[main.cc]</kbd> Ray-sphere intersection code (after)</div></center>
<p>


</p></div>

<p></p>
<a class="target" name="anabstractionforhittableobjects">&nbsp;</a><a class="target" name="surfacenormalsandmultipleobjects/anabstractionforhittableobjects">&nbsp;</a><a class="target" name="toc6.3">&nbsp;</a><h2>An Abstraction for Hittable Objects</h2>
<p>

Now, how about more than one sphere? While it is tempting to have an array of spheres, a very clean
solution is to make an “abstract class” for anything a ray might hit, and make both a sphere and a
list of spheres just something that can be hit. What that class should be called is something of a
quandary — calling it an “object” would be good if not for “object oriented” programming.
“Surface” is often used, with the weakness being maybe we will want volumes (fog, clouds, stuff
like that). “hittable” emphasizes the member function that unites them. I don’t love any of these,
but we'll go with “hittable”.

</p><p>

This <code>hittable</code> abstract class will have a <code>hit</code> function that takes in a ray. Most ray tracers
have found it convenient to add a valid interval for hits <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-89-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;m&lt;/mi&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;i&lt;/mi&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1026" style="width: 2.019em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.613em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(0.231em, 1001.61em, 1.317em, -1000em); top: -1.008em; left: 0em;"><span class="mrow" id="MathJax-Span-1027"><span class="msubsup" id="MathJax-Span-1028"><span style="display: inline-block; position: relative; width: 1.629em; height: 0px;"><span style="position: absolute; clip: rect(3.205em, 1000.33em, 4.144em, -1000em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-1029" style="font-family: MathJax_Math; font-style: italic;">t</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; top: -3.832em; left: 0.361em;"><span class="texatom" id="MathJax-Span-1030"><span class="mrow" id="MathJax-Span-1031"><span class="texatom" id="MathJax-Span-1032"><span class="mrow" id="MathJax-Span-1033"><span class="mi" id="MathJax-Span-1034" style="font-size: 70.7%; font-family: MathJax_Main; font-style: italic;">m</span><span class="mi" id="MathJax-Span-1035" style="font-size: 70.7%; font-family: MathJax_Main; font-style: italic;">i</span><span class="mi" id="MathJax-Span-1036" style="font-size: 70.7%; font-family: MathJax_Main; font-style: italic;">n</span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 1.008em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.258em; border-left: 0px solid; width: 0px; height: 1.097em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>t</mi><mrow class="MJX-TeXAtom-ORD"><mrow class="MJX-TeXAtom-ORD"><mi class="MJX-tex-mathit" mathvariant="italic">m</mi><mi class="MJX-tex-mathit" mathvariant="italic">i</mi><mi class="MJX-tex-mathit" mathvariant="italic">n</mi></mrow></mrow></msub></math></span></span><script type="math/tex" id="MathJax-Element-89">t_{\mathit{min}}</script> to <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-90-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;m&lt;/mi&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;a&lt;/mi&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;x&lt;/mi&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1037" style="width: 2.119em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.714em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(0.231em, 1001.71em, 1.317em, -1000em); top: -1.008em; left: 0em;"><span class="mrow" id="MathJax-Span-1038"><span class="msubsup" id="MathJax-Span-1039"><span style="display: inline-block; position: relative; width: 1.704em; height: 0px;"><span style="position: absolute; clip: rect(3.205em, 1000.33em, 4.144em, -1000em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-1040" style="font-family: MathJax_Math; font-style: italic;">t</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; top: -3.832em; left: 0.361em;"><span class="texatom" id="MathJax-Span-1041"><span class="mrow" id="MathJax-Span-1042"><span class="texatom" id="MathJax-Span-1043"><span class="mrow" id="MathJax-Span-1044"><span class="mi" id="MathJax-Span-1045" style="font-size: 70.7%; font-family: MathJax_Main; font-style: italic;">m</span><span class="mi" id="MathJax-Span-1046" style="font-size: 70.7%; font-family: MathJax_Main; font-style: italic;">a</span><span class="mi" id="MathJax-Span-1047" style="font-size: 70.7%; font-family: MathJax_Main; font-style: italic;">x</span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 1.008em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.258em; border-left: 0px solid; width: 0px; height: 1.097em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>t</mi><mrow class="MJX-TeXAtom-ORD"><mrow class="MJX-TeXAtom-ORD"><mi class="MJX-tex-mathit" mathvariant="italic">m</mi><mi class="MJX-tex-mathit" mathvariant="italic">a</mi><mi class="MJX-tex-mathit" mathvariant="italic">x</mi></mrow></mrow></msub></math></span></span><script type="math/tex" id="MathJax-Element-90">t_{\mathit{max}}</script>,
so the hit only “counts” if <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-91-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;m&lt;/mi&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;i&lt;/mi&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo&gt;&amp;lt;&lt;/mo&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo&gt;&amp;lt;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;m&lt;/mi&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;a&lt;/mi&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;x&lt;/mi&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1048" style="width: 7.916em; display: inline-block;"><span style="display: inline-block; position: relative; width: 6.351em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.642em, 1006.35em, 2.728em, -1000em); top: -2.419em; left: 0em;"><span class="mrow" id="MathJax-Span-1049"><span class="msubsup" id="MathJax-Span-1050"><span style="display: inline-block; position: relative; width: 1.629em; height: 0px;"><span style="position: absolute; clip: rect(3.205em, 1000.33em, 4.144em, -1000em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-1051" style="font-family: MathJax_Math; font-style: italic;">t</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; top: -3.832em; left: 0.361em;"><span class="texatom" id="MathJax-Span-1052"><span class="mrow" id="MathJax-Span-1053"><span class="texatom" id="MathJax-Span-1054"><span class="mrow" id="MathJax-Span-1055"><span class="mi" id="MathJax-Span-1056" style="font-size: 70.7%; font-family: MathJax_Main; font-style: italic;">m</span><span class="mi" id="MathJax-Span-1057" style="font-size: 70.7%; font-family: MathJax_Main; font-style: italic;">i</span><span class="mi" id="MathJax-Span-1058" style="font-size: 70.7%; font-family: MathJax_Main; font-style: italic;">n</span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span></span><span class="mo" id="MathJax-Span-1059" style="font-family: MathJax_Main; padding-left: 0.278em;">&lt;</span><span class="mi" id="MathJax-Span-1060" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.278em;">t</span><span class="mo" id="MathJax-Span-1061" style="font-family: MathJax_Main; padding-left: 0.278em;">&lt;</span><span class="msubsup" id="MathJax-Span-1062" style="padding-left: 0.278em;"><span style="display: inline-block; position: relative; width: 1.704em; height: 0px;"><span style="position: absolute; clip: rect(3.205em, 1000.33em, 4.144em, -1000em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-1063" style="font-family: MathJax_Math; font-style: italic;">t</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; top: -3.832em; left: 0.361em;"><span class="texatom" id="MathJax-Span-1064"><span class="mrow" id="MathJax-Span-1065"><span class="texatom" id="MathJax-Span-1066"><span class="mrow" id="MathJax-Span-1067"><span class="mi" id="MathJax-Span-1068" style="font-size: 70.7%; font-family: MathJax_Main; font-style: italic;">m</span><span class="mi" id="MathJax-Span-1069" style="font-size: 70.7%; font-family: MathJax_Main; font-style: italic;">a</span><span class="mi" id="MathJax-Span-1070" style="font-size: 70.7%; font-family: MathJax_Main; font-style: italic;">x</span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.419em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.258em; border-left: 0px solid; width: 0px; height: 1.097em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>t</mi><mrow class="MJX-TeXAtom-ORD"><mrow class="MJX-TeXAtom-ORD"><mi class="MJX-tex-mathit" mathvariant="italic">m</mi><mi class="MJX-tex-mathit" mathvariant="italic">i</mi><mi class="MJX-tex-mathit" mathvariant="italic">n</mi></mrow></mrow></msub><mo>&lt;</mo><mi>t</mi><mo>&lt;</mo><msub><mi>t</mi><mrow class="MJX-TeXAtom-ORD"><mrow class="MJX-TeXAtom-ORD"><mi class="MJX-tex-mathit" mathvariant="italic">m</mi><mi class="MJX-tex-mathit" mathvariant="italic">a</mi><mi class="MJX-tex-mathit" mathvariant="italic">x</mi></mrow></mrow></msub></math></span></span><script type="math/tex" id="MathJax-Element-91">t_{\mathit{min}} < t < t_{\mathit{max}}</script>. For the initial rays this is
positive <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-92-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1071" style="width: 0.456em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.353em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.441em, 1000.32em, 2.38em, -1000em); top: -2.218em; left: 0em;"><span class="mrow" id="MathJax-Span-1072"><span class="mi" id="MathJax-Span-1073" style="font-family: MathJax_Math; font-style: italic;">t</span></span><span style="display: inline-block; width: 0px; height: 2.218em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.076em; border-left: 0px solid; width: 0px; height: 0.915em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>t</mi></math></span></span><script type="math/tex" id="MathJax-Element-92">t</script>, but as we will see, it can simplify our code to have an interval
<span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-93-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;m&lt;/mi&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;i&lt;/mi&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1074" style="width: 2.019em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.613em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(0.231em, 1001.61em, 1.317em, -1000em); top: -1.008em; left: 0em;"><span class="mrow" id="MathJax-Span-1075"><span class="msubsup" id="MathJax-Span-1076"><span style="display: inline-block; position: relative; width: 1.629em; height: 0px;"><span style="position: absolute; clip: rect(3.205em, 1000.33em, 4.144em, -1000em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-1077" style="font-family: MathJax_Math; font-style: italic;">t</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; top: -3.832em; left: 0.361em;"><span class="texatom" id="MathJax-Span-1078"><span class="mrow" id="MathJax-Span-1079"><span class="texatom" id="MathJax-Span-1080"><span class="mrow" id="MathJax-Span-1081"><span class="mi" id="MathJax-Span-1082" style="font-size: 70.7%; font-family: MathJax_Main; font-style: italic;">m</span><span class="mi" id="MathJax-Span-1083" style="font-size: 70.7%; font-family: MathJax_Main; font-style: italic;">i</span><span class="mi" id="MathJax-Span-1084" style="font-size: 70.7%; font-family: MathJax_Main; font-style: italic;">n</span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 1.008em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.258em; border-left: 0px solid; width: 0px; height: 1.097em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>t</mi><mrow class="MJX-TeXAtom-ORD"><mrow class="MJX-TeXAtom-ORD"><mi class="MJX-tex-mathit" mathvariant="italic">m</mi><mi class="MJX-tex-mathit" mathvariant="italic">i</mi><mi class="MJX-tex-mathit" mathvariant="italic">n</mi></mrow></mrow></msub></math></span></span><script type="math/tex" id="MathJax-Element-93">t_{\mathit{min}}</script> to <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-94-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;m&lt;/mi&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;a&lt;/mi&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;x&lt;/mi&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1085" style="width: 2.119em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.714em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(0.231em, 1001.71em, 1.317em, -1000em); top: -1.008em; left: 0em;"><span class="mrow" id="MathJax-Span-1086"><span class="msubsup" id="MathJax-Span-1087"><span style="display: inline-block; position: relative; width: 1.704em; height: 0px;"><span style="position: absolute; clip: rect(3.205em, 1000.33em, 4.144em, -1000em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-1088" style="font-family: MathJax_Math; font-style: italic;">t</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; top: -3.832em; left: 0.361em;"><span class="texatom" id="MathJax-Span-1089"><span class="mrow" id="MathJax-Span-1090"><span class="texatom" id="MathJax-Span-1091"><span class="mrow" id="MathJax-Span-1092"><span class="mi" id="MathJax-Span-1093" style="font-size: 70.7%; font-family: MathJax_Main; font-style: italic;">m</span><span class="mi" id="MathJax-Span-1094" style="font-size: 70.7%; font-family: MathJax_Main; font-style: italic;">a</span><span class="mi" id="MathJax-Span-1095" style="font-size: 70.7%; font-family: MathJax_Main; font-style: italic;">x</span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 1.008em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.258em; border-left: 0px solid; width: 0px; height: 1.097em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>t</mi><mrow class="MJX-TeXAtom-ORD"><mrow class="MJX-TeXAtom-ORD"><mi class="MJX-tex-mathit" mathvariant="italic">m</mi><mi class="MJX-tex-mathit" mathvariant="italic">a</mi><mi class="MJX-tex-mathit" mathvariant="italic">x</mi></mrow></mrow></msub></math></span></span><script type="math/tex" id="MathJax-Element-94">t_{\mathit{max}}</script>. One design question is whether to do things like compute
the normal if we hit something. We might end up hitting something closer as we do our search, and we
will only need the normal of the closest thing. I will go with the simple solution and compute a
bundle of stuff I will store in some structure. Here’s the abstract class:

</p><pre class="listing tilde"><code><span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">ifndef</span> HITTABLE_H</span>
<span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">define</span> HITTABLE_H</span>
<span class="line"></span>
<span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"ray.h"</span></span>
<span class="line"></span>
<span class="line"></span><span class="hljs-keyword">class</span> <span class="hljs-title class_">hit_record</span> {
<span class="line"></span>  <span class="hljs-keyword">public</span>:
<span class="line"></span>    point3 p;
<span class="line"></span>    vec3 normal;
<span class="line"></span>    <span class="hljs-type">double</span> t;
<span class="line"></span>};
<span class="line"></span>
<span class="line"></span><span class="hljs-keyword">class</span> <span class="hljs-title class_">hittable</span> {
<span class="line"></span>  <span class="hljs-keyword">public</span>:
<span class="line"></span>    <span class="hljs-keyword">virtual</span> ~<span class="hljs-built_in">hittable</span>() = <span class="hljs-keyword">default</span>;
<span class="line"></span>
<span class="line"></span>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">bool</span> <span class="hljs-title">hit</span><span class="hljs-params">(<span class="hljs-type">const</span> ray&amp; r, <span class="hljs-type">double</span> ray_tmin, <span class="hljs-type">double</span> ray_tmax, hit_record&amp; rec)</span> <span class="hljs-type">const</span> </span>= <span class="hljs-number">0</span>;
<span class="line"></span>};
<span class="line"></span>
<span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span></code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_hittable-initial">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;15:</b> <kbd>[hittable.h]</kbd> The hittable class</div></center>
<p>


</p><div class="together">
And here’s the sphere:

<p></p><pre class="listing tilde"><code><span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">ifndef</span> SPHERE_H</span>
<span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">define</span> SPHERE_H</span>
<span class="line"></span>
<span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"hittable.h"</span></span>
<span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"vec3.h"</span></span>
<span class="line"></span>
<span class="line"></span><span class="hljs-keyword">class</span> <span class="hljs-title class_">sphere</span> : <span class="hljs-keyword">public</span> hittable {
<span class="line"></span>  <span class="hljs-keyword">public</span>:
<span class="line"></span>    <span class="hljs-built_in">sphere</span>(point3 _center, <span class="hljs-type">double</span> _radius) : <span class="hljs-built_in">center</span>(_center), <span class="hljs-built_in">radius</span>(_radius) {}
<span class="line"></span>
<span class="line"></span>    <span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">hit</span><span class="hljs-params">(<span class="hljs-type">const</span> ray&amp; r, <span class="hljs-type">double</span> ray_tmin, <span class="hljs-type">double</span> ray_tmax, hit_record&amp; rec)</span> <span class="hljs-type">const</span> <span class="hljs-keyword">override</span> </span>{
<span class="line"></span>        vec3 oc = r.<span class="hljs-built_in">origin</span>() - center;
<span class="line"></span>        <span class="hljs-keyword">auto</span> a = r.<span class="hljs-built_in">direction</span>().<span class="hljs-built_in">length_squared</span>();
<span class="line"></span>        <span class="hljs-keyword">auto</span> half_b = <span class="hljs-built_in">dot</span>(oc, r.<span class="hljs-built_in">direction</span>());
<span class="line"></span>        <span class="hljs-keyword">auto</span> c = oc.<span class="hljs-built_in">length_squared</span>() - radius*radius;
<span class="line"></span>
<span class="line"></span>        <span class="hljs-keyword">auto</span> discriminant = half_b*half_b - a*c;
<span class="line"></span>        <span class="hljs-keyword">if</span> (discriminant &lt; <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
<span class="line"></span>        <span class="hljs-keyword">auto</span> sqrtd = <span class="hljs-built_in">sqrt</span>(discriminant);
<span class="line"></span>
<span class="line"></span>        <span class="hljs-comment">// Find the nearest root that lies in the acceptable range.</span>
<span class="line"></span>        <span class="hljs-keyword">auto</span> root = (-half_b - sqrtd) / a;
<span class="line"></span>        <span class="hljs-keyword">if</span> (root &lt;= ray_tmin || ray_tmax &lt;= root) {
<span class="line"></span>            root = (-half_b + sqrtd) / a;
<span class="line"></span>            <span class="hljs-keyword">if</span> (root &lt;= ray_tmin || ray_tmax &lt;= root)
<span class="line"></span>                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
<span class="line"></span>        }
<span class="line"></span>
<span class="line"></span>        rec.t = root;
<span class="line"></span>        rec.p = r.<span class="hljs-built_in">at</span>(rec.t);
<span class="line"></span>        rec.normal = (rec.p - center) / radius;
<span class="line"></span>
<span class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
<span class="line"></span>    }
<span class="line"></span>
<span class="line"></span>  <span class="hljs-keyword">private</span>:
<span class="line"></span>    point3 center;
<span class="line"></span>    <span class="hljs-type">double</span> radius;
<span class="line"></span>};
<span class="line"></span>
<span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span></code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_sphere-initial">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;16:</b> <kbd>[sphere.h]</kbd> The sphere class</div></center>
<p>


</p></div>

<p></p>
<a class="target" name="frontfacesversusbackfaces">&nbsp;</a><a class="target" name="surfacenormalsandmultipleobjects/frontfacesversusbackfaces">&nbsp;</a><a class="target" name="toc6.4">&nbsp;</a><h2>Front Faces Versus Back Faces</h2>
<p>

The second design decision for normals is whether they should always point out. At present, the
normal found will always be in the direction of the center to the intersection point (the normal
points out). If the ray intersects the sphere from the outside, the normal points against the ray.
If the ray intersects the sphere from the inside, the normal (which always points out) points with
the ray. Alternatively, we can have the normal always point against the ray. If the ray is outside
the sphere, the normal will point outward, but if the ray is inside the sphere, the normal will
point inward.

</p><p>

  </p><center><div class="image" style=""><a href="https://raytracing.github.io/images/fig-1.07-normal-sides.jpg" target="_blank"><img class="markdeep" src="Ray%20Tracing%20in%20One%20Weekend_files/fig-1.07-normal-sides.jpg"></a><center><span class="imagecaption"><a class="target" name="figure_normal-sides">&nbsp;</a><b style="font-style:normal;">Figure&nbsp;7:</b> Possible directions for sphere surface-normal geometry
  </span></center></div></center>

<p></p><p>

We need to choose one of these possibilities because we will eventually want to determine which
side of the surface that the ray is coming from. This is important for objects that are rendered
differently on each side, like the text on a two-sided sheet of paper, or for objects that have an
inside and an outside, like glass balls.

</p><p>

If we decide to have the normals always point out, then we will need to determine which side the
ray is on when we color it. We can figure this out by comparing the ray with the normal. If the ray
and the normal face in the same direction, the ray is inside the object, if the ray and the normal
face in the opposite direction, then the ray is outside the object. This can be determined by
taking the dot product of the two vectors, where if their dot is positive, the ray is inside the
sphere.

</p><pre class="listing tilde"><code><span class="line"></span><span class="hljs-keyword">if</span> (<span class="hljs-built_in">dot</span>(ray_direction, outward_normal) &gt; <span class="hljs-number">0.0</span>) {
<span class="line"></span>    <span class="hljs-comment">// ray is inside the sphere</span>
<span class="line"></span>    ...
<span class="line"></span>} <span class="hljs-keyword">else</span> {
<span class="line"></span>    <span class="hljs-comment">// ray is outside the sphere</span>
<span class="line"></span>    ...
<span class="line"></span>}</code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_ray-normal-comparison">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;17:</b> Comparing the ray and the normal</div></center>
<p>


</p><div class="together">
If we decide to have the normals always point against the ray, we won't be able to use the dot
product to determine which side of the surface the ray is on. Instead, we would need to store that
information:

<p></p><pre class="listing tilde"><code><span class="line"></span><span class="hljs-type">bool</span> front_face;
<span class="line"></span><span class="hljs-keyword">if</span> (<span class="hljs-built_in">dot</span>(ray_direction, outward_normal) &gt; <span class="hljs-number">0.0</span>) {
<span class="line"></span>    <span class="hljs-comment">// ray is inside the sphere</span>
<span class="line"></span>    normal = -outward_normal;
<span class="line"></span>    front_face = <span class="hljs-literal">false</span>;
<span class="line"></span>} <span class="hljs-keyword">else</span> {
<span class="line"></span>    <span class="hljs-comment">// ray is outside the sphere</span>
<span class="line"></span>    normal = outward_normal;
<span class="line"></span>    front_face = <span class="hljs-literal">true</span>;
<span class="line"></span>}</code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_normals-point-against">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;18:</b> Remembering the side of the surface</div></center>
<p>


</p></div>

<p></p><p>

We can set things up so that normals always point “outward” from the surface, or always point
against the incident ray. This decision is determined by whether you want to determine the side of
the surface at the time of geometry intersection or at the time of coloring. In this book we have
more material types than we have geometry types, so we'll go for less work and put the determination
at geometry time. This is simply a matter of preference, and you'll see both implementations in the
literature.

</p><p>

We add the <code>front_face</code> bool to the <code>hit_record</code> class.
We'll also add a function to solve this calculation for us: <code>set_face_normal()</code>.
For convenience we will assume that the vector passed to the new <code>set_face_normal()</code> function is of
unit length.
We could always normalize the parameter explicitly, but it's more efficient if the geometry code
does this, as it's usually easier when you know more about the specific geometry.

</p><pre class="listing tilde"><code><span class="line"></span><span class="hljs-keyword">class</span> <span class="hljs-title class_">hit_record</span> {
<span class="line"></span>  <span class="hljs-keyword">public</span>:
<span class="line"></span>    point3 p;
<span class="line"></span>    vec3 normal;
<span class="line"></span>    <span class="hljs-type">double</span> t;<div class=" highlight"><span class="line"></span>    <span class="hljs-type">bool</span> front_face;
<span class="line"></span>
<span class="line"></span>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">set_face_normal</span><span class="hljs-params">(<span class="hljs-type">const</span> ray&amp; r, <span class="hljs-type">const</span> vec3&amp; outward_normal)</span> </span>{
<span class="line"></span>        <span class="hljs-comment">// Sets the hit record normal vector.</span>
<span class="line"></span>        <span class="hljs-comment">// <span class="hljs-doctag">NOTE:</span> the parameter `outward_normal` is assumed to have unit length.</span>
<span class="line"></span>
<span class="line"></span>        front_face = <span class="hljs-built_in">dot</span>(r.<span class="hljs-built_in">direction</span>(), outward_normal) &lt; <span class="hljs-number">0</span>;
<span class="line"></span>        normal = front_face ? outward_normal : -outward_normal;
<span class="line"></span>    }</div><span class="line"></span>};</code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_front-face-tracking">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;19:</b> <kbd>[hittable.h]</kbd>
        Adding front-face tracking to hit_record</div></center>
<p>


</p><div class="together">
And then we add the surface side determination to the class:

<p></p><pre class="listing tilde"><code><span class="line"></span><span class="hljs-keyword">class</span> <span class="hljs-title class_">sphere</span> : <span class="hljs-keyword">public</span> hittable {
<span class="line"></span>  <span class="hljs-keyword">public</span>:
<span class="line"></span>    ...
<span class="line"></span>    <span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">hit</span><span class="hljs-params">(<span class="hljs-type">const</span> ray&amp; r, <span class="hljs-type">double</span> ray_tmin, <span class="hljs-type">double</span> ray_tmax, hit_record&amp; rec)</span> <span class="hljs-type">const</span> </span>{
<span class="line"></span>        ...
<span class="line"></span>
<span class="line"></span>        rec.t = root;
<span class="line"></span>        rec.p = r.<span class="hljs-built_in">at</span>(rec.t);<div class=" highlight"><span class="line"></span>        vec3 outward_normal = (rec.p - center) / radius;
<span class="line"></span>        rec.<span class="hljs-built_in">set_face_normal</span>(r, outward_normal);</div><span class="line"></span>
<span class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
<span class="line"></span>    }
<span class="line"></span>    ...
<span class="line"></span>};</code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_sphere-final">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;20:</b> <kbd>[sphere.h]</kbd> The sphere class with normal determination</div></center>
<p>


</p></div>

<p></p>
<a class="target" name="alistofhittableobjects">&nbsp;</a><a class="target" name="surfacenormalsandmultipleobjects/alistofhittableobjects">&nbsp;</a><a class="target" name="toc6.5">&nbsp;</a><h2>A List of Hittable Objects</h2>
<p>

We have a generic object called a <code>hittable</code> that the ray can intersect with. We now add a class
that stores a list of <code>hittable</code>s:

</p><pre class="listing tilde"><code><span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">ifndef</span> HITTABLE_LIST_H</span>
<span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">define</span> HITTABLE_LIST_H</span>
<span class="line"></span>
<span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"hittable.h"</span></span>
<span class="line"></span>
<span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;memory&gt;</span></span>
<span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;vector&gt;</span></span>
<span class="line"></span>
<span class="line"></span><span class="hljs-keyword">using</span> std::shared_ptr;
<span class="line"></span><span class="hljs-keyword">using</span> std::make_shared;
<span class="line"></span>
<span class="line"></span><span class="hljs-keyword">class</span> <span class="hljs-title class_">hittable_list</span> : <span class="hljs-keyword">public</span> hittable {
<span class="line"></span>  <span class="hljs-keyword">public</span>:
<span class="line"></span>    std::vector&lt;shared_ptr&lt;hittable&gt;&gt; objects;
<span class="line"></span>
<span class="line"></span>    <span class="hljs-built_in">hittable_list</span>() {}
<span class="line"></span>    <span class="hljs-built_in">hittable_list</span>(shared_ptr&lt;hittable&gt; object) { <span class="hljs-built_in">add</span>(object); }
<span class="line"></span>
<span class="line"></span>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">clear</span><span class="hljs-params">()</span> </span>{ objects.<span class="hljs-built_in">clear</span>(); }
<span class="line"></span>
<span class="line"></span>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">add</span><span class="hljs-params">(shared_ptr&lt;hittable&gt; object)</span> </span>{
<span class="line"></span>        objects.<span class="hljs-built_in">push_back</span>(object);
<span class="line"></span>    }
<span class="line"></span>
<span class="line"></span>    <span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">hit</span><span class="hljs-params">(<span class="hljs-type">const</span> ray&amp; r, <span class="hljs-type">double</span> ray_tmin, <span class="hljs-type">double</span> ray_tmax, hit_record&amp; rec)</span> <span class="hljs-type">const</span> <span class="hljs-keyword">override</span> </span>{
<span class="line"></span>        hit_record temp_rec;
<span class="line"></span>        <span class="hljs-type">bool</span> hit_anything = <span class="hljs-literal">false</span>;
<span class="line"></span>        <span class="hljs-keyword">auto</span> closest_so_far = ray_tmax;
<span class="line"></span>
<span class="line"></span>        <span class="hljs-keyword">for</span> (<span class="hljs-type">const</span> <span class="hljs-keyword">auto</span>&amp; object : objects) {
<span class="line"></span>            <span class="hljs-keyword">if</span> (object-&gt;<span class="hljs-built_in">hit</span>(r, ray_tmin, closest_so_far, temp_rec)) {
<span class="line"></span>                hit_anything = <span class="hljs-literal">true</span>;
<span class="line"></span>                closest_so_far = temp_rec.t;
<span class="line"></span>                rec = temp_rec;
<span class="line"></span>            }
<span class="line"></span>        }
<span class="line"></span>
<span class="line"></span>        <span class="hljs-keyword">return</span> hit_anything;
<span class="line"></span>    }
<span class="line"></span>};
<span class="line"></span>
<span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span></code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_hittable-list-initial">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;21:</b> <kbd>[hittable_list.h]</kbd> The hittable_list class</div></center>

<a class="target" name="somenewc++features">&nbsp;</a><a class="target" name="surfacenormalsandmultipleobjects/somenewc++features">&nbsp;</a><a class="target" name="toc6.6">&nbsp;</a><h2>Some New C++ Features</h2>
<p>

The <code>hittable_list</code> class code uses two C++ features that may trip you up if you're not normally a
C++ programmer: <code>vector</code> and <code>shared_ptr</code>.

</p><p>

<code>shared_ptr&lt;type&gt;</code> is a pointer to some allocated type, with reference-counting semantics.
Every time you assign its value to another shared pointer (usually with a simple assignment), the
reference count is incremented. As shared pointers go out of scope (like at the end of a block or
function), the reference count is decremented. Once the count goes to zero, the object is safely
deleted.

</p><p>

</p><div class="together">
Typically, a shared pointer is first initialized with a newly-allocated object, something like this:

<p></p><pre class="listing tilde"><code><span class="line"></span>shared_ptr&lt;<span class="hljs-type">double</span>&gt; double_ptr = <span class="hljs-built_in">make_shared</span>&lt;<span class="hljs-type">double</span>&gt;(<span class="hljs-number">0.37</span>);
<span class="line"></span>shared_ptr&lt;vec3&gt;   vec3_ptr   = <span class="hljs-built_in">make_shared</span>&lt;vec3&gt;(<span class="hljs-number">1.414214</span>, <span class="hljs-number">2.718281</span>, <span class="hljs-number">1.618034</span>);
<span class="line"></span>shared_ptr&lt;sphere&gt; sphere_ptr = <span class="hljs-built_in">make_shared</span>&lt;sphere&gt;(<span class="hljs-built_in">point3</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>), <span class="hljs-number">1.0</span>);</code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_shared-ptr">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;22:</b> An example allocation using shared_ptr</div></center>
<p>


</p></div>

<p></p><p>

<code>make_shared&lt;thing&gt;(thing_constructor_params ...)</code> allocates a new instance of type <code>thing</code>, using
the constructor parameters. It returns a <code>shared_ptr&lt;thing&gt;</code>.

</p><p>

</p><div class="together">
Since the type can be automatically deduced by the return type of <code>make_shared&lt;type&gt;(...)</code>, the
above lines can be more simply expressed using C++'s <code>auto</code> type specifier:

<p></p><pre class="listing tilde"><code><span class="line"></span><span class="hljs-keyword">auto</span> double_ptr = <span class="hljs-built_in">make_shared</span>&lt;<span class="hljs-type">double</span>&gt;(<span class="hljs-number">0.37</span>);
<span class="line"></span><span class="hljs-keyword">auto</span> vec3_ptr   = <span class="hljs-built_in">make_shared</span>&lt;vec3&gt;(<span class="hljs-number">1.414214</span>, <span class="hljs-number">2.718281</span>, <span class="hljs-number">1.618034</span>);
<span class="line"></span><span class="hljs-keyword">auto</span> sphere_ptr = <span class="hljs-built_in">make_shared</span>&lt;sphere&gt;(<span class="hljs-built_in">point3</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>), <span class="hljs-number">1.0</span>);</code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_shared-ptr-auto">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;23:</b> An example allocation using shared_ptr with auto type</div></center>
<p>


</p></div>

<p></p><p>

We'll use shared pointers in our code, because it allows multiple geometries to share a common
instance (for example, a bunch of spheres that all use the same color material), and because
it makes memory management automatic and easier to reason about.

</p><p>

<code>std::shared_ptr</code> is included with the <code>&lt;memory&gt;</code> header.

</p><p>

The second C++ feature you may be unfamiliar with is <code>std::vector</code>. This is a generic array-like
collection of an arbitrary type. Above, we use a collection of pointers to <code>hittable</code>. <code>std::vector</code>
automatically grows as more values are added: <code>objects.push_back(object)</code> adds a value to the end of
the <code>std::vector</code> member variable <code>objects</code>.

</p><p>

<code>std::vector</code> is included with the <code>&lt;vector&gt;</code> header.

</p><p>

Finally, the <code>using</code> statements in <a href="#listing_hittable-list-initial">listing&nbsp;21</a> tell the compiler that we'll be
getting <code>shared_ptr</code> and <code>make_shared</code> from the <code>std</code> library, so we don't need to prefix these with
<code>std::</code> every time we reference them.

</p>
<a class="target" name="commonconstantsandutilityfunctions">&nbsp;</a><a class="target" name="surfacenormalsandmultipleobjects/commonconstantsandutilityfunctions">&nbsp;</a><a class="target" name="toc6.7">&nbsp;</a><h2>Common Constants and Utility Functions</h2>
<p>

We need some math constants that we conveniently define in their own header file. For now we only
need infinity, but we will also throw our own definition of pi in there, which we will need later.
There is no standard portable definition of pi, so we just define our own constant for it. We'll
throw common useful constants and future utility functions in <code>rtweekend.h</code>, our general main header
file.

</p><pre class="listing tilde"><code><span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">ifndef</span> RTWEEKEND_H</span>
<span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">define</span> RTWEEKEND_H</span>
<span class="line"></span>
<span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cmath&gt;</span></span>
<span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;limits&gt;</span></span>
<span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;memory&gt;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span><span class="hljs-comment">// Usings</span>
<span class="line"></span>
<span class="line"></span><span class="hljs-keyword">using</span> std::shared_ptr;
<span class="line"></span><span class="hljs-keyword">using</span> std::make_shared;
<span class="line"></span><span class="hljs-keyword">using</span> std::sqrt;
<span class="line"></span>
<span class="line"></span><span class="hljs-comment">// Constants</span>
<span class="line"></span>
<span class="line"></span><span class="hljs-type">const</span> <span class="hljs-type">double</span> infinity = std::numeric_limits&lt;<span class="hljs-type">double</span>&gt;::<span class="hljs-built_in">infinity</span>();
<span class="line"></span><span class="hljs-type">const</span> <span class="hljs-type">double</span> pi = <span class="hljs-number">3.1415926535897932385</span>;
<span class="line"></span>
<span class="line"></span><span class="hljs-comment">// Utility Functions</span>
<span class="line"></span>
<span class="line"></span><span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-type">double</span> <span class="hljs-title">degrees_to_radians</span><span class="hljs-params">(<span class="hljs-type">double</span> degrees)</span> </span>{
<span class="line"></span>    <span class="hljs-keyword">return</span> degrees * pi / <span class="hljs-number">180.0</span>;
<span class="line"></span>}
<span class="line"></span>
<span class="line"></span><span class="hljs-comment">// Common Headers</span>
<span class="line"></span>
<span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"ray.h"</span></span>
<span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"vec3.h"</span></span>
<span class="line"></span>
<span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span></code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_rtweekend-initial">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;24:</b> <kbd>[rtweekend.h]</kbd> The rtweekend.h common header</div></center>
<p>


</p><div class="together">
And the new main:

<p></p><pre class="listing tilde"><code><div class=" highlight"><span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"rtweekend.h"</span></span></div><span class="line"></span>
<span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"color.h"</span></span><div class=" highlight"><span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"hittable.h"</span></span>
<span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"hittable_list.h"</span></span>
<span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"sphere.h"</span></span></div><span class="line"></span>
<span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>
<span class="line"></span>
<span class="line"></span><div class=" delete"><span class="line"></span><span class="hljs-function"><span class="hljs-type">double</span> <span class="hljs-title">hit_sphere</span><span class="hljs-params">(<span class="hljs-type">const</span> point3&amp; center, <span class="hljs-type">double</span> radius, <span class="hljs-type">const</span> ray&amp; r)</span> </span>{
<span class="line"></span>    ...
<span class="line"></span>}</div><span class="line"></span>
<span class="line"></span><div class=" highlight"><span class="line"></span><span class="hljs-function">color <span class="hljs-title">ray_color</span><span class="hljs-params">(<span class="hljs-type">const</span> ray&amp; r, <span class="hljs-type">const</span> hittable&amp; world)</span> </span>{
<span class="line"></span>    hit_record rec;
<span class="line"></span>    <span class="hljs-keyword">if</span> (world.<span class="hljs-built_in">hit</span>(r, <span class="hljs-number">0</span>, infinity, rec)) {
<span class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-number">0.5</span> * (rec.normal + <span class="hljs-built_in">color</span>(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>));
<span class="line"></span>    }</div><span class="line"></span>
<span class="line"></span>    vec3 unit_direction = <span class="hljs-built_in">unit_vector</span>(r.<span class="hljs-built_in">direction</span>());
<span class="line"></span>    <span class="hljs-keyword">auto</span> a = <span class="hljs-number">0.5</span>*(unit_direction.<span class="hljs-built_in">y</span>() + <span class="hljs-number">1.0</span>);
<span class="line"></span>    <span class="hljs-keyword">return</span> (<span class="hljs-number">1.0</span>-a)*<span class="hljs-built_in">color</span>(<span class="hljs-number">1.0</span>, <span class="hljs-number">1.0</span>, <span class="hljs-number">1.0</span>) + a*<span class="hljs-built_in">color</span>(<span class="hljs-number">0.5</span>, <span class="hljs-number">0.7</span>, <span class="hljs-number">1.0</span>);
<span class="line"></span>}
<span class="line"></span>
<span class="line"></span><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
<span class="line"></span>
<span class="line"></span>    <span class="hljs-comment">// Image</span>
<span class="line"></span>
<span class="line"></span>    <span class="hljs-keyword">auto</span> aspect_ratio = <span class="hljs-number">16.0</span> / <span class="hljs-number">9.0</span>;
<span class="line"></span>    <span class="hljs-type">int</span> image_width = <span class="hljs-number">400</span>;
<span class="line"></span>
<span class="line"></span>    <span class="hljs-comment">// Calculate the image height, and ensure that it's at least 1.</span>
<span class="line"></span>    <span class="hljs-type">int</span> image_height = <span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">int</span>&gt;(image_width / aspect_ratio);
<span class="line"></span>    image_height = (image_height &lt; <span class="hljs-number">1</span>) ? <span class="hljs-number">1</span> : image_height;
<span class="line"></span>
<span class="line"></span><div class=" highlight"><span class="line"></span>    <span class="hljs-comment">// World</span>
<span class="line"></span>
<span class="line"></span>    hittable_list world;
<span class="line"></span>
<span class="line"></span>    world.<span class="hljs-built_in">add</span>(<span class="hljs-built_in">make_shared</span>&lt;sphere&gt;(<span class="hljs-built_in">point3</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">-1</span>), <span class="hljs-number">0.5</span>));
<span class="line"></span>    world.<span class="hljs-built_in">add</span>(<span class="hljs-built_in">make_shared</span>&lt;sphere&gt;(<span class="hljs-built_in">point3</span>(<span class="hljs-number">0</span>,<span class="hljs-number">-100.5</span>,<span class="hljs-number">-1</span>), <span class="hljs-number">100</span>));</div><span class="line"></span>
<span class="line"></span>    <span class="hljs-comment">// Camera</span>
<span class="line"></span>
<span class="line"></span>    <span class="hljs-keyword">auto</span> focal_length = <span class="hljs-number">1.0</span>;
<span class="line"></span>    <span class="hljs-keyword">auto</span> viewport_height = <span class="hljs-number">2.0</span>;
<span class="line"></span>    <span class="hljs-keyword">auto</span> viewport_width = viewport_height * (<span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">double</span>&gt;(image_width)/image_height);
<span class="line"></span>    <span class="hljs-keyword">auto</span> camera_center = <span class="hljs-built_in">point3</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);
<span class="line"></span>
<span class="line"></span>    <span class="hljs-comment">// Calculate the vectors across the horizontal and down the vertical viewport edges.</span>
<span class="line"></span>    <span class="hljs-keyword">auto</span> viewport_u = <span class="hljs-built_in">vec3</span>(viewport_width, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);
<span class="line"></span>    <span class="hljs-keyword">auto</span> viewport_v = <span class="hljs-built_in">vec3</span>(<span class="hljs-number">0</span>, -viewport_height, <span class="hljs-number">0</span>);
<span class="line"></span>
<span class="line"></span>    <span class="hljs-comment">// Calculate the horizontal and vertical delta vectors from pixel to pixel.</span>
<span class="line"></span>    <span class="hljs-keyword">auto</span> pixel_delta_u = viewport_u / image_width;
<span class="line"></span>    <span class="hljs-keyword">auto</span> pixel_delta_v = viewport_v / image_height;
<span class="line"></span>
<span class="line"></span>    <span class="hljs-comment">// Calculate the location of the upper left pixel.</span>
<span class="line"></span>    <span class="hljs-keyword">auto</span> viewport_upper_left = camera_center
<span class="line"></span>                             - <span class="hljs-built_in">vec3</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, focal_length) - viewport_u/<span class="hljs-number">2</span> - viewport_v/<span class="hljs-number">2</span>;
<span class="line"></span>    <span class="hljs-keyword">auto</span> pixel00_loc = viewport_upper_left + <span class="hljs-number">0.5</span> * (pixel_delta_u + pixel_delta_v);
<span class="line"></span>
<span class="line"></span>    <span class="hljs-comment">// Render</span>
<span class="line"></span>
<span class="line"></span>    std::cout &lt;&lt; <span class="hljs-string">"P3\n"</span> &lt;&lt; image_width &lt;&lt; <span class="hljs-string">' '</span> &lt;&lt; image_height &lt;&lt; <span class="hljs-string">"\n255\n"</span>;
<span class="line"></span>
<span class="line"></span>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> j = <span class="hljs-number">0</span>; j &lt; image_height; ++j) {
<span class="line"></span>        std::clog &lt;&lt; <span class="hljs-string">"\rScanlines remaining: "</span> &lt;&lt; (image_height - j) &lt;&lt; <span class="hljs-string">' '</span> &lt;&lt; std::flush;
<span class="line"></span>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; image_width; ++i) {
<span class="line"></span>            <span class="hljs-keyword">auto</span> pixel_center = pixel00_loc + (i * pixel_delta_u) + (j * pixel_delta_v);
<span class="line"></span>            <span class="hljs-keyword">auto</span> ray_direction = pixel_center - camera_center;
<span class="line"></span>            <span class="hljs-function">ray <span class="hljs-title">r</span><span class="hljs-params">(camera_center, ray_direction)</span></span>;
<span class="line"></span>
<span class="line"></span><div class=" highlight"><span class="line"></span>            color pixel_color = <span class="hljs-built_in">ray_color</span>(r, world);</div><span class="line"></span>            <span class="hljs-built_in">write_color</span>(std::cout, pixel_color);
<span class="line"></span>        }
<span class="line"></span>    }
<span class="line"></span>
<span class="line"></span>    std::clog &lt;&lt; <span class="hljs-string">"\rDone.                 \n"</span>;
<span class="line"></span>}</code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_main-with-rtweekend-h">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;25:</b> <kbd>[main.cc]</kbd> The new main with hittables</div></center>
<p>


</p></div>

<p></p><p>

This yields a picture that is really just a visualization of where the spheres are located along
with their surface normal. This is often a great way to view any flaws or specific characteristics
of a geometric model.

</p><p>

  </p><center><div class="image" style=""><a href="https://raytracing.github.io/images/img-1.05-normals-sphere-ground.png" target="_blank"><img class="markdeep pixel" src="Ray%20Tracing%20in%20One%20Weekend_files/img-1.05-normals-sphere-ground.png"></a><center><span class="imagecaption"><span class="num">Image 5:</span> Resulting render of normals-colored sphere with ground
  </span></center></div></center>

<p></p>
<a class="target" name="anintervalclass">&nbsp;</a><a class="target" name="surfacenormalsandmultipleobjects/anintervalclass">&nbsp;</a><a class="target" name="toc6.8">&nbsp;</a><h2>An Interval Class</h2>
<p>

Before we continue, we'll implement an interval class to manage real-valued intervals with a minimum
and a maximum. We'll end up using this class quite often as we proceed.

</p><pre class="listing tilde"><code><span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">ifndef</span> INTERVAL_H</span>
<span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">define</span> INTERVAL_H</span>
<span class="line"></span>
<span class="line"></span><span class="hljs-keyword">class</span> <span class="hljs-title class_">interval</span> {
<span class="line"></span>  <span class="hljs-keyword">public</span>:
<span class="line"></span>    <span class="hljs-type">double</span> min, max;
<span class="line"></span>
<span class="line"></span>    <span class="hljs-built_in">interval</span>() : <span class="hljs-built_in">min</span>(+infinity), <span class="hljs-built_in">max</span>(-infinity) {} <span class="hljs-comment">// Default interval is empty</span>
<span class="line"></span>
<span class="line"></span>    <span class="hljs-built_in">interval</span>(<span class="hljs-type">double</span> _min, <span class="hljs-type">double</span> _max) : <span class="hljs-built_in">min</span>(_min), <span class="hljs-built_in">max</span>(_max) {}
<span class="line"></span>
<span class="line"></span>    <span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">contains</span><span class="hljs-params">(<span class="hljs-type">double</span> x)</span> <span class="hljs-type">const</span> </span>{
<span class="line"></span>        <span class="hljs-keyword">return</span> min &lt;= x &amp;&amp; x &lt;= max;
<span class="line"></span>    }
<span class="line"></span>
<span class="line"></span>    <span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">surrounds</span><span class="hljs-params">(<span class="hljs-type">double</span> x)</span> <span class="hljs-type">const</span> </span>{
<span class="line"></span>        <span class="hljs-keyword">return</span> min &lt; x &amp;&amp; x &lt; max;
<span class="line"></span>    }
<span class="line"></span>
<span class="line"></span>    <span class="hljs-type">static</span> <span class="hljs-type">const</span> interval empty, universe;
<span class="line"></span>};
<span class="line"></span>
<span class="line"></span><span class="hljs-function"><span class="hljs-type">const</span> <span class="hljs-type">static</span> interval <span class="hljs-title">empty</span>   <span class="hljs-params">(+infinity, -infinity)</span></span>;
<span class="line"></span><span class="hljs-function"><span class="hljs-type">const</span> <span class="hljs-type">static</span> interval <span class="hljs-title">universe</span><span class="hljs-params">(-infinity, +infinity)</span></span>;
<span class="line"></span>
<span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span></code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_interval-initial">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;26:</b> <kbd>[interval.h]</kbd> Introducing the new interval class</div></center>
<pre class="listing tilde"><code><span class="line"></span><span class="hljs-comment">// Common Headers</span>
<span class="line"></span>
<span class="line"></span><div class=" Highlight"><span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"interval.h"</span></span></div><span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"ray.h"</span></span>
<span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"vec3.h"</span></span></code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_interval-rtweekend">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;27:</b> <kbd>[rtweekend.h]</kbd> Including the new interval class</div></center>
<pre class="listing tilde"><code><span class="line"></span><span class="hljs-keyword">class</span> <span class="hljs-title class_">hittable</span> {
<span class="line"></span>  <span class="hljs-keyword">public</span>:
<span class="line"></span>    ...<div class=" highlight"><span class="line"></span>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">bool</span> <span class="hljs-title">hit</span><span class="hljs-params">(<span class="hljs-type">const</span> ray&amp; r, interval <span class="hljs-type">ray_t</span>, hit_record&amp; rec)</span> <span class="hljs-type">const</span> </span>= <span class="hljs-number">0</span>;</div><span class="line"></span>};</code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_hittable-with-interval">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;28:</b> <kbd>[hittable.h]</kbd> hittable::hit() using interval</div></center>
<pre class="listing tilde"><code><span class="line"></span><span class="hljs-keyword">class</span> <span class="hljs-title class_">hittable_list</span> : <span class="hljs-keyword">public</span> hittable {
<span class="line"></span>  <span class="hljs-keyword">public</span>:
<span class="line"></span>    ...<div class=" highlight"><span class="line"></span>    <span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">hit</span><span class="hljs-params">(<span class="hljs-type">const</span> ray&amp; r, interval <span class="hljs-type">ray_t</span>, hit_record&amp; rec)</span> <span class="hljs-type">const</span> <span class="hljs-keyword">override</span> </span>{</div><span class="line"></span>        hit_record temp_rec;
<span class="line"></span>        <span class="hljs-type">bool</span> hit_anything = <span class="hljs-literal">false</span>;<div class=" highlight"><span class="line"></span>        <span class="hljs-keyword">auto</span> closest_so_far = <span class="hljs-type">ray_t</span>.max;</div><span class="line"></span>
<span class="line"></span>        <span class="hljs-keyword">for</span> (<span class="hljs-type">const</span> <span class="hljs-keyword">auto</span>&amp; object : objects) {<div class=" highlight"><span class="line"></span>            <span class="hljs-keyword">if</span> (object-&gt;<span class="hljs-built_in">hit</span>(r, <span class="hljs-built_in">interval</span>(<span class="hljs-type">ray_t</span>.min, closest_so_far), temp_rec)) {</div><span class="line"></span>                hit_anything = <span class="hljs-literal">true</span>;
<span class="line"></span>                closest_so_far = temp_rec.t;
<span class="line"></span>                rec = temp_rec;
<span class="line"></span>            }
<span class="line"></span>        }
<span class="line"></span>
<span class="line"></span>        <span class="hljs-keyword">return</span> hit_anything;
<span class="line"></span>    }
<span class="line"></span>    ...
<span class="line"></span>};</code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_hittable-list-with-interval">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;29:</b> <kbd>[hittable_list.h]</kbd>
        hittable_list::hit() using interval</div></center>
<pre class="listing tilde"><code><span class="line"></span><span class="hljs-keyword">class</span> <span class="hljs-title class_">sphere</span> : <span class="hljs-keyword">public</span> hittable {
<span class="line"></span>  <span class="hljs-keyword">public</span>:
<span class="line"></span>    ...<div class=" highlight"><span class="line"></span>    <span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">hit</span><span class="hljs-params">(<span class="hljs-type">const</span> ray&amp; r, interval <span class="hljs-type">ray_t</span>, hit_record&amp; rec)</span> <span class="hljs-type">const</span> <span class="hljs-keyword">override</span> </span>{</div><span class="line"></span>        ...
<span class="line"></span>
<span class="line"></span>        <span class="hljs-comment">// Find the nearest root that lies in the acceptable range.</span>
<span class="line"></span>        <span class="hljs-keyword">auto</span> root = (-half_b - sqrtd) / a;<div class=" highlight"><span class="line"></span>        <span class="hljs-keyword">if</span> (!<span class="hljs-type">ray_t</span>.<span class="hljs-built_in">surrounds</span>(root)) {</div><span class="line"></span>            root = (-half_b + sqrtd) / a;<div class=" highlight"><span class="line"></span>            <span class="hljs-keyword">if</span> (!<span class="hljs-type">ray_t</span>.<span class="hljs-built_in">surrounds</span>(root))</div><span class="line"></span>                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
<span class="line"></span>        }
<span class="line"></span>        ...
<span class="line"></span>    }
<span class="line"></span>    ...
<span class="line"></span>};</code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_sphere-with-interval">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;30:</b> <kbd>[sphere.h]</kbd> sphere using interval</div></center>
<pre class="listing tilde"><code><span class="line"></span>...
<span class="line"></span><span class="hljs-function">color <span class="hljs-title">ray_color</span><span class="hljs-params">(<span class="hljs-type">const</span> ray&amp; r, <span class="hljs-type">const</span> hittable&amp; world)</span> </span>{
<span class="line"></span>    hit_record rec;<div class=" highlight"><span class="line"></span>    <span class="hljs-keyword">if</span> (world.<span class="hljs-built_in">hit</span>(r, <span class="hljs-built_in">interval</span>(<span class="hljs-number">0</span>, infinity), rec)) {</div><span class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-number">0.5</span> * (rec.normal + <span class="hljs-built_in">color</span>(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>));
<span class="line"></span>    }
<span class="line"></span>
<span class="line"></span>    vec3 unit_direction = <span class="hljs-built_in">unit_vector</span>(r.<span class="hljs-built_in">direction</span>());
<span class="line"></span>    <span class="hljs-keyword">auto</span> a = <span class="hljs-number">0.5</span>*(unit_direction.<span class="hljs-built_in">y</span>() + <span class="hljs-number">1.0</span>);
<span class="line"></span>    <span class="hljs-keyword">return</span> (<span class="hljs-number">1.0</span>-a)*<span class="hljs-built_in">color</span>(<span class="hljs-number">1.0</span>, <span class="hljs-number">1.0</span>, <span class="hljs-number">1.0</span>) + a*<span class="hljs-built_in">color</span>(<span class="hljs-number">0.5</span>, <span class="hljs-number">0.7</span>, <span class="hljs-number">1.0</span>);
<span class="line"></span>}
<span class="line"></span>...</code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_main-with-interval">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;31:</b> <kbd>[main.cc]</kbd> The new main using interval</div></center>

<a class="target" name="movingcameracodeintoitsownclass">&nbsp;</a><a class="target" name="movingcameracodeintoitsownclass">&nbsp;</a><a class="target" name="toc7">&nbsp;</a><h1>Moving Camera Code Into Its Own Class</h1>
<p>

Before continuing, now is a good time to consolidate our camera and scene-render code into a single
new class: the <code>camera</code> class.
The camera class will be responsible for two important jobs:

</p><p>

</p><ol start="1">
  <li class="number">Construct and dispatch rays into the world.
</li>
  <li class="number">Use the results of these rays to construct the rendered image.</li></ol>

<p></p><p>

In this refactoring, we'll collect the <code>ray_color()</code> function, along with the image, camera, and
render sections of our main program.
The new camera class will contain two public methods <code>initialize()</code> and <code>render()</code>, plus two
private helper methods <code>get_ray()</code> and <code>ray_color()</code>.

</p><p>

Ultimately, the camera will follow the simplest usage pattern that we could think of: it will be
default constructed no arguments, then the owning code will modify the camera's public variables
through simple assignment, and finally everything is initialized by a call to the <code>initialize()</code>
function. This pattern is chosen instead of the owner calling a constructor with a ton of parameters
or by defining and calling a bunch of setter methods. Instead, the owning code only needs to set
what it explicitly cares about. Finally, we could either have the owning code call <code>initialize()</code>,
or just have the camera call this function automatically at the start of <code>render()</code>. We'll use the
second approach.

</p><p>

After main creates a camera and sets default values, it will call the <code>render()</code> method.
The <code>render()</code> method will prepare the camera for rendering and then execute the render loop.

</p><p>

</p><div class="together">
Here's the skeleton of our new <code>camera</code> class:

<p></p><pre class="listing tilde"><code><span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">ifndef</span> CAMERA_H</span>
<span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">define</span> CAMERA_H</span>
<span class="line"></span>
<span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"rtweekend.h"</span></span>
<span class="line"></span>
<span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"color.h"</span></span>
<span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"hittable.h"</span></span>
<span class="line"></span>
<span class="line"></span><span class="hljs-keyword">class</span> <span class="hljs-title class_">camera</span> {
<span class="line"></span>  <span class="hljs-keyword">public</span>:
<span class="line"></span>    <span class="hljs-comment">/* Public Camera Parameters Here */</span>
<span class="line"></span>
<span class="line"></span>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">render</span><span class="hljs-params">(<span class="hljs-type">const</span> hittable&amp; world)</span> </span>{
<span class="line"></span>        ...
<span class="line"></span>    }
<span class="line"></span>
<span class="line"></span>  <span class="hljs-keyword">private</span>:
<span class="line"></span>    <span class="hljs-comment">/* Private Camera Variables Here */</span>
<span class="line"></span>
<span class="line"></span>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">initialize</span><span class="hljs-params">()</span> </span>{
<span class="line"></span>        ...
<span class="line"></span>    }
<span class="line"></span>
<span class="line"></span>    <span class="hljs-function">color <span class="hljs-title">ray_color</span><span class="hljs-params">(<span class="hljs-type">const</span> ray&amp; r, <span class="hljs-type">const</span> hittable&amp; world)</span> <span class="hljs-type">const</span> </span>{
<span class="line"></span>        ...
<span class="line"></span>    }
<span class="line"></span>};
<span class="line"></span>
<span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span></code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_camera-skeleton">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;32:</b> <kbd>[camera.h]</kbd> The camera class skeleton</div></center>
<p>


</p></div>

<p></p><p>

</p><div class="together">
To begin with, let's fill in the <code>ray_color()</code> function from <code>main.cc</code>:

<p></p><pre class="listing tilde"><code><span class="line"></span><span class="hljs-keyword">class</span> <span class="hljs-title class_">camera</span> {
<span class="line"></span>  ...
<span class="line"></span>
<span class="line"></span>  <span class="hljs-keyword">private</span>:
<span class="line"></span>    ...
<span class="line"></span>
<span class="line"></span><div class=" highlight"><span class="line"></span>    <span class="hljs-function">color <span class="hljs-title">ray_color</span><span class="hljs-params">(<span class="hljs-type">const</span> ray&amp; r, <span class="hljs-type">const</span> hittable&amp; world)</span> <span class="hljs-type">const</span> </span>{
<span class="line"></span>        hit_record rec;
<span class="line"></span>
<span class="line"></span>        <span class="hljs-keyword">if</span> (world.<span class="hljs-built_in">hit</span>(r, <span class="hljs-built_in">interval</span>(<span class="hljs-number">0</span>, infinity), rec)) {
<span class="line"></span>            <span class="hljs-keyword">return</span> <span class="hljs-number">0.5</span> * (rec.normal + <span class="hljs-built_in">color</span>(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>));
<span class="line"></span>        }
<span class="line"></span>
<span class="line"></span>        vec3 unit_direction = <span class="hljs-built_in">unit_vector</span>(r.<span class="hljs-built_in">direction</span>());
<span class="line"></span>        <span class="hljs-keyword">auto</span> a = <span class="hljs-number">0.5</span>*(unit_direction.<span class="hljs-built_in">y</span>() + <span class="hljs-number">1.0</span>);
<span class="line"></span>        <span class="hljs-keyword">return</span> (<span class="hljs-number">1.0</span>-a)*<span class="hljs-built_in">color</span>(<span class="hljs-number">1.0</span>, <span class="hljs-number">1.0</span>, <span class="hljs-number">1.0</span>) + a*<span class="hljs-built_in">color</span>(<span class="hljs-number">0.5</span>, <span class="hljs-number">0.7</span>, <span class="hljs-number">1.0</span>);
<span class="line"></span>    }</div><span class="line"></span>};
<span class="line"></span>
<span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span></code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_camera-ray-color">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;33:</b> <kbd>[camera.h]</kbd> The camera::ray_color function</div></center>
<p>


</p></div>

<p></p><p>

</p><div class="together">
Now we move almost everything from the <code>main()</code> function into our new camera class.
The only thing remaining in the <code>main()</code> function is the world construction.
Here's the camera class with newly migrated code:

<p></p><pre class="listing tilde"><code><span class="line"></span>...
<span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"rtweekend.h"</span></span>
<span class="line"></span>
<span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"color.h"</span></span>
<span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"hittable.h"</span></span>
<span class="line"></span>
<span class="line"></span><div class=" highlight"><span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span></div><span class="line"></span>
<span class="line"></span><span class="hljs-keyword">class</span> <span class="hljs-title class_">camera</span> {
<span class="line"></span>  <span class="hljs-keyword">public</span>:<div class=" highlight"><span class="line"></span>    <span class="hljs-type">double</span> aspect_ratio = <span class="hljs-number">1.0</span>;  <span class="hljs-comment">// Ratio of image width over height</span>
<span class="line"></span>    <span class="hljs-type">int</span>    image_width  = <span class="hljs-number">100</span>;  <span class="hljs-comment">// Rendered image width in pixel count</span>
<span class="line"></span>
<span class="line"></span>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">render</span><span class="hljs-params">(<span class="hljs-type">const</span> hittable&amp; world)</span> </span>{
<span class="line"></span>        <span class="hljs-built_in">initialize</span>();
<span class="line"></span>
<span class="line"></span>        std::cout &lt;&lt; <span class="hljs-string">"P3\n"</span> &lt;&lt; image_width &lt;&lt; <span class="hljs-string">' '</span> &lt;&lt; image_height &lt;&lt; <span class="hljs-string">"\n255\n"</span>;
<span class="line"></span>
<span class="line"></span>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> j = <span class="hljs-number">0</span>; j &lt; image_height; ++j) {
<span class="line"></span>            std::clog &lt;&lt; <span class="hljs-string">"\rScanlines remaining: "</span> &lt;&lt; (image_height - j) &lt;&lt; <span class="hljs-string">' '</span> &lt;&lt; std::flush;
<span class="line"></span>            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; image_width; ++i) {
<span class="line"></span>                <span class="hljs-keyword">auto</span> pixel_center = pixel00_loc + (i * pixel_delta_u) + (j * pixel_delta_v);
<span class="line"></span>                <span class="hljs-keyword">auto</span> ray_direction = pixel_center - center;
<span class="line"></span>                <span class="hljs-function">ray <span class="hljs-title">r</span><span class="hljs-params">(center, ray_direction)</span></span>;
<span class="line"></span>
<span class="line"></span>                color pixel_color = <span class="hljs-built_in">ray_color</span>(r, world);
<span class="line"></span>                <span class="hljs-built_in">write_color</span>(std::cout, pixel_color);
<span class="line"></span>            }
<span class="line"></span>        }
<span class="line"></span>
<span class="line"></span>        std::clog &lt;&lt; <span class="hljs-string">"\rDone.                 \n"</span>;
<span class="line"></span>    }</div><span class="line"></span>
<span class="line"></span>  <span class="hljs-keyword">private</span>:<div class=" highlight"><span class="line"></span>    <span class="hljs-type">int</span>    image_height;   <span class="hljs-comment">// Rendered image height</span>
<span class="line"></span>    point3 center;         <span class="hljs-comment">// Camera center</span>
<span class="line"></span>    point3 pixel00_loc;    <span class="hljs-comment">// Location of pixel 0, 0</span>
<span class="line"></span>    vec3   pixel_delta_u;  <span class="hljs-comment">// Offset to pixel to the right</span>
<span class="line"></span>    vec3   pixel_delta_v;  <span class="hljs-comment">// Offset to pixel below</span>
<span class="line"></span>
<span class="line"></span>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">initialize</span><span class="hljs-params">()</span> </span>{
<span class="line"></span>        image_height = <span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">int</span>&gt;(image_width / aspect_ratio);
<span class="line"></span>        image_height = (image_height &lt; <span class="hljs-number">1</span>) ? <span class="hljs-number">1</span> : image_height;
<span class="line"></span>
<span class="line"></span>        center = <span class="hljs-built_in">point3</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);
<span class="line"></span>
<span class="line"></span>        <span class="hljs-comment">// Determine viewport dimensions.</span>
<span class="line"></span>        <span class="hljs-keyword">auto</span> focal_length = <span class="hljs-number">1.0</span>;
<span class="line"></span>        <span class="hljs-keyword">auto</span> viewport_height = <span class="hljs-number">2.0</span>;
<span class="line"></span>        <span class="hljs-keyword">auto</span> viewport_width = viewport_height * (<span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">double</span>&gt;(image_width)/image_height);
<span class="line"></span>
<span class="line"></span>        <span class="hljs-comment">// Calculate the vectors across the horizontal and down the vertical viewport edges.</span>
<span class="line"></span>        <span class="hljs-keyword">auto</span> viewport_u = <span class="hljs-built_in">vec3</span>(viewport_width, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);
<span class="line"></span>        <span class="hljs-keyword">auto</span> viewport_v = <span class="hljs-built_in">vec3</span>(<span class="hljs-number">0</span>, -viewport_height, <span class="hljs-number">0</span>);
<span class="line"></span>
<span class="line"></span>        <span class="hljs-comment">// Calculate the horizontal and vertical delta vectors from pixel to pixel.</span>
<span class="line"></span>        pixel_delta_u = viewport_u / image_width;
<span class="line"></span>        pixel_delta_v = viewport_v / image_height;
<span class="line"></span>
<span class="line"></span>        <span class="hljs-comment">// Calculate the location of the upper left pixel.</span>
<span class="line"></span>        <span class="hljs-keyword">auto</span> viewport_upper_left =
<span class="line"></span>            center - <span class="hljs-built_in">vec3</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, focal_length) - viewport_u/<span class="hljs-number">2</span> - viewport_v/<span class="hljs-number">2</span>;
<span class="line"></span>        pixel00_loc = viewport_upper_left + <span class="hljs-number">0.5</span> * (pixel_delta_u + pixel_delta_v);
<span class="line"></span>    }</div><span class="line"></span>
<span class="line"></span>    <span class="hljs-function">color <span class="hljs-title">ray_color</span><span class="hljs-params">(<span class="hljs-type">const</span> ray&amp; r, <span class="hljs-type">const</span> hittable&amp; world)</span> <span class="hljs-type">const</span> </span>{
<span class="line"></span>        ...
<span class="line"></span>    }
<span class="line"></span>};
<span class="line"></span>
<span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span></code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_camera-working">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;34:</b> <kbd>[camera.h]</kbd> The working camera class</div></center>
<p>


</p></div>

<p></p><p>

</p><div class="together">
And here's the much reduced main:

<p></p><pre class="listing tilde"><code><div class=" highlight"><span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"rtweekend.h"</span></span>
<span class="line"></span>
<span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"camera.h"</span></span>
<span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"hittable_list.h"</span></span>
<span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"sphere.h"</span></span>
<span class="line"></span>
<span class="line"></span><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
<span class="line"></span>    hittable_list world;
<span class="line"></span>
<span class="line"></span>    world.<span class="hljs-built_in">add</span>(<span class="hljs-built_in">make_shared</span>&lt;sphere&gt;(<span class="hljs-built_in">point3</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">-1</span>), <span class="hljs-number">0.5</span>));
<span class="line"></span>    world.<span class="hljs-built_in">add</span>(<span class="hljs-built_in">make_shared</span>&lt;sphere&gt;(<span class="hljs-built_in">point3</span>(<span class="hljs-number">0</span>,<span class="hljs-number">-100.5</span>,<span class="hljs-number">-1</span>), <span class="hljs-number">100</span>));
<span class="line"></span>
<span class="line"></span>    camera cam;
<span class="line"></span>
<span class="line"></span>    cam.aspect_ratio = <span class="hljs-number">16.0</span> / <span class="hljs-number">9.0</span>;
<span class="line"></span>    cam.image_width  = <span class="hljs-number">400</span>;
<span class="line"></span>
<span class="line"></span>    cam.<span class="hljs-built_in">render</span>(world);
<span class="line"></span>}</div></code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_main-with-new-camera">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;35:</b> <kbd>[main.cc]</kbd> The new main, using the new camera</div></center>
<p>


</p></div>

<p></p><p>

Running this newly refactored program should give us the same rendered image as before.

</p>
<a class="target" name="antialiasing">&nbsp;</a><a class="target" name="antialiasing">&nbsp;</a><a class="target" name="toc8">&nbsp;</a><h1>Antialiasing</h1>
<p>

If you zoom into the rendered images so far, you might notice the harsh “stair step” nature of edges
in our rendered images.
This stair-stepping is commonly referred to as “aliasing”, or “jaggies”.
When a real camera takes a picture, there are usually no jaggies along edges, because the edge
pixels are a blend of some foreground and some background.
Consider that unlike our rendered images, a true image of the world is continuous.
Put another way, the world (and any true image of it) has effectively infinite resolution.
We can get the same effect by averaging a bunch of samples for each pixel.

</p><p>

With a single ray through the center of each pixel, we are performing what is commonly called <em class="underscore">point
sampling</em>.
The problem with point sampling can be illustrated by rendering a small checkerboard far away.
If this checkerboard consists of an 8×8 grid of black and white tiles, but only four rays hit
it, then all four rays might intersect only white tiles, or only black, or some odd combination.
In the real world, when we perceive a checkerboard far away with our eyes, we perceive it as a gray
color, instead of sharp points of black and white.
That's because our eyes are naturally doing what we want our ray tracer to do: integrate the
(continuous function of) light falling on a particular (discrete) region of our rendered image.

</p><p>

Clearly we don't gain anything by just resampling the same ray through the pixel center multiple
times — we'd just get the same result each time.
Instead, we want to sample the light falling <em class="underscore">around</em> the pixel, and then integrate those samples to
approximate the true continuous result.
So, how do we integrate the light falling around the pixel?

</p><p>

We'll adopt the simplest model: sampling the square region centered at the pixel that extends
halfway to each of the four neighboring pixels.
This is not the optimal approach, but it is the most straight-forward.
(See <a href="https://www.researchgate.net/publication/244986797"><em class="underscore">A Pixel is Not a Little Square</em></a> for a deeper dive into this topic.)

</p><p>

  </p><center><div class="image" style=""><a href="https://raytracing.github.io/images/fig-1.08-pixel-samples.jpg" target="_blank"><img class="markdeep" src="Ray%20Tracing%20in%20One%20Weekend_files/fig-1.08-pixel-samples.jpg"></a><center><span class="imagecaption"><a class="target" name="figure_pixel-samples">&nbsp;</a><b style="font-style:normal;">Figure&nbsp;8:</b> Pixel samples</span></center></div></center>

<p></p>
<a class="target" name="somerandomnumberutilities">&nbsp;</a><a class="target" name="antialiasing/somerandomnumberutilities">&nbsp;</a><a class="target" name="toc8.1">&nbsp;</a><h2>Some Random Number Utilities</h2>
<p>

We're going to need need a random number generator that returns real random numbers.
This function should return a canonical random number, which by convention falls in the range
<span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-95-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;mo&gt;&amp;#x2264;&lt;/mo&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mo&gt;&amp;lt;&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1096" style="width: 5.345em; display: inline-block;"><span style="display: inline-block; position: relative; width: 4.284em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.451em, 1004.21em, 2.557em, -1000em); top: -2.268em; left: 0em;"><span class="mrow" id="MathJax-Span-1097"><span class="mn" id="MathJax-Span-1098" style="font-family: MathJax_Main;">0</span><span class="mo" id="MathJax-Span-1099" style="font-family: MathJax_Main; padding-left: 0.278em;">≤</span><span class="mi" id="MathJax-Span-1100" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.278em;">n</span><span class="mo" id="MathJax-Span-1101" style="font-family: MathJax_Main; padding-left: 0.278em;">&lt;</span><span class="mn" id="MathJax-Span-1102" style="font-family: MathJax_Main; padding-left: 0.278em;">1</span></span><span style="display: inline-block; width: 0px; height: 2.268em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.234em; border-left: 0px solid; width: 0px; height: 1.122em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>0</mn><mo>≤</mo><mi>n</mi><mo>&lt;</mo><mn>1</mn></math></span></span><script type="math/tex" id="MathJax-Element-95">0 ≤ n < 1</script>.
The “less than” before the 1 is important, as we will sometimes take advantage of that.

</p><p>

A simple approach to this is to use the <code>rand()</code> function that can be found in <code>&lt;cstdlib&gt;</code>, which
returns a random integer in the range 0 and <code>RAND_MAX</code>.
Hence we can get a real random number as desired with the following code snippet, added to
<code>rtweekend.h</code>:

</p><pre class="listing tilde"><code><span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cmath&gt;</span></span><div class=" Highlight"><span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cstdlib&gt;</span></span></div><span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;limits&gt;</span></span>
<span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;memory&gt;</span></span>
<span class="line"></span>...
<span class="line"></span>
<span class="line"></span><span class="hljs-comment">// Utility Functions</span>
<span class="line"></span>
<span class="line"></span><span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-type">double</span> <span class="hljs-title">degrees_to_radians</span><span class="hljs-params">(<span class="hljs-type">double</span> degrees)</span> </span>{
<span class="line"></span>    <span class="hljs-keyword">return</span> degrees * pi / <span class="hljs-number">180.0</span>;
<span class="line"></span>}
<span class="line"></span>
<span class="line"></span><div class=" Highlight"><span class="line"></span><span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-type">double</span> <span class="hljs-title">random_double</span><span class="hljs-params">()</span> </span>{
<span class="line"></span>    <span class="hljs-comment">// Returns a random real in [0,1).</span>
<span class="line"></span>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">rand</span>() / (RAND_MAX + <span class="hljs-number">1.0</span>);
<span class="line"></span>}
<span class="line"></span>
<span class="line"></span><span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-type">double</span> <span class="hljs-title">random_double</span><span class="hljs-params">(<span class="hljs-type">double</span> min, <span class="hljs-type">double</span> max)</span> </span>{
<span class="line"></span>    <span class="hljs-comment">// Returns a random real in [min,max).</span>
<span class="line"></span>    <span class="hljs-keyword">return</span> min + (max-min)*<span class="hljs-built_in">random_double</span>();
<span class="line"></span>}</div></code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_random-double">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;36:</b> <kbd>[rtweekend.h]</kbd> random_double() functions</div></center>
<p>


C++ did not traditionally have a standard random number generator, but newer versions of C++ have
addressed this issue with the <code>&lt;random&gt;</code> header (if imperfectly according to some experts).
If you want to use this, you can obtain a random number with the conditions we need as follows:

</p><pre class="listing tilde"><code><span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;random&gt;</span></span>
<span class="line"></span>
<span class="line"></span><span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-type">double</span> <span class="hljs-title">random_double</span><span class="hljs-params">()</span> </span>{
<span class="line"></span>    <span class="hljs-function"><span class="hljs-type">static</span> std::uniform_real_distribution&lt;<span class="hljs-type">double</span>&gt; <span class="hljs-title">distribution</span><span class="hljs-params">(<span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>)</span></span>;
<span class="line"></span>    <span class="hljs-type">static</span> std::mt19937 generator;
<span class="line"></span>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">distribution</span>(generator);
<span class="line"></span>}</code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_random-double-alt">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;37:</b> <kbd>[rtweekend.h]</kbd> random_double(), alternate implemenation</div></center>

<a class="target" name="generatingpixelswithmultiplesamples">&nbsp;</a><a class="target" name="antialiasing/generatingpixelswithmultiplesamples">&nbsp;</a><a class="target" name="toc8.2">&nbsp;</a><h2>Generating Pixels with Multiple Samples</h2>
<p>

For a single pixel composed of multiple samples, we'll select samples from the area surrounding the
pixel and average the resulting light (color) values together.

</p><p>

First we'll update the <code>write_color()</code> function to account for the number of samples we use: we need
to find the average across all of the samples that we take.
To do this, we'll add the full color from each iteration, and then finish with a single division (by
the number of samples) at the end, before writing out the color.
To ensure that the color components of the final result remain within the proper <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-96-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;[&lt;/mo&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo stretchy=&quot;false&quot;&gt;]&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1103" style="width: 2.523em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.016em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.317em, 1001.9em, 2.619em, -1000em); top: -2.218em; left: 0em;"><span class="mrow" id="MathJax-Span-1104"><span class="mo" id="MathJax-Span-1105" style="font-family: MathJax_Main;">[</span><span class="mn" id="MathJax-Span-1106" style="font-family: MathJax_Main;">0</span><span class="mo" id="MathJax-Span-1107" style="font-family: MathJax_Main;">,</span><span class="mn" id="MathJax-Span-1108" style="font-family: MathJax_Main; padding-left: 0.167em;">1</span><span class="mo" id="MathJax-Span-1109" style="font-family: MathJax_Main;">]</span></span><span style="display: inline-block; width: 0px; height: 2.218em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.365em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">[</mo><mn>0</mn><mo>,</mo><mn>1</mn><mo stretchy="false">]</mo></math></span></span><script type="math/tex" id="MathJax-Element-96">[0,1]</script> bounds,
we'll add and use a small helper function: <code>interval::clamp(x)</code>.

</p><pre class="listing tilde"><code><span class="line"></span><span class="hljs-keyword">class</span> <span class="hljs-title class_">interval</span> {
<span class="line"></span>  <span class="hljs-keyword">public</span>:
<span class="line"></span>    ...
<span class="line"></span>
<span class="line"></span>    <span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">surrounds</span><span class="hljs-params">(<span class="hljs-type">double</span> x)</span> <span class="hljs-type">const</span> </span>{
<span class="line"></span>        <span class="hljs-keyword">return</span> min &lt; x &amp;&amp; x &lt; max;
<span class="line"></span>    }
<span class="line"></span>
<span class="line"></span><div class=" highlight"><span class="line"></span>    <span class="hljs-function"><span class="hljs-type">double</span> <span class="hljs-title">clamp</span><span class="hljs-params">(<span class="hljs-type">double</span> x)</span> <span class="hljs-type">const</span> </span>{
<span class="line"></span>        <span class="hljs-keyword">if</span> (x &lt; min) <span class="hljs-keyword">return</span> min;
<span class="line"></span>        <span class="hljs-keyword">if</span> (x &gt; max) <span class="hljs-keyword">return</span> max;
<span class="line"></span>        <span class="hljs-keyword">return</span> x;
<span class="line"></span>    }</div><span class="line"></span>    ...
<span class="line"></span>};</code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_clamp">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;38:</b> <kbd>[interval.h]</kbd> The interval::clamp() utility function</div></center>
<p>


And here's the updated <code>write_color()</code> function that takes the sum total of all light for the pixel
and the number of samples involved:

</p><pre class="listing tilde"><code><div class=" highlight"><span class="line"></span><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">write_color</span><span class="hljs-params">(std::ostream &amp;out, color pixel_color, <span class="hljs-type">int</span> samples_per_pixel)</span> </span>{
<span class="line"></span>    <span class="hljs-keyword">auto</span> r = pixel_color.<span class="hljs-built_in">x</span>();
<span class="line"></span>    <span class="hljs-keyword">auto</span> g = pixel_color.<span class="hljs-built_in">y</span>();
<span class="line"></span>    <span class="hljs-keyword">auto</span> b = pixel_color.<span class="hljs-built_in">z</span>();
<span class="line"></span>
<span class="line"></span>    <span class="hljs-comment">// Divide the color by the number of samples.</span>
<span class="line"></span>    <span class="hljs-keyword">auto</span> scale = <span class="hljs-number">1.0</span> / samples_per_pixel;
<span class="line"></span>    r *= scale;
<span class="line"></span>    g *= scale;
<span class="line"></span>    b *= scale;
<span class="line"></span>
<span class="line"></span>    <span class="hljs-comment">// Write the translated [0,255] value of each color component.</span>
<span class="line"></span>    <span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-type">const</span> interval <span class="hljs-title">intensity</span><span class="hljs-params">(<span class="hljs-number">0.000</span>, <span class="hljs-number">0.999</span>)</span></span>;
<span class="line"></span>    out &lt;&lt; <span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">int</span>&gt;(<span class="hljs-number">256</span> * intensity.<span class="hljs-built_in">clamp</span>(r)) &lt;&lt; <span class="hljs-string">' '</span>
<span class="line"></span>        &lt;&lt; <span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">int</span>&gt;(<span class="hljs-number">256</span> * intensity.<span class="hljs-built_in">clamp</span>(g)) &lt;&lt; <span class="hljs-string">' '</span>
<span class="line"></span>        &lt;&lt; <span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">int</span>&gt;(<span class="hljs-number">256</span> * intensity.<span class="hljs-built_in">clamp</span>(b)) &lt;&lt; <span class="hljs-string">'\n'</span>;
<span class="line"></span>}</div></code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_write-color-clamped">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;39:</b> <kbd>[color.h]</kbd> The multi-sample write_color() function</div></center>
<p>


Now let's update the camera class to define and use a new <code>camera::get_ray(i,j)</code> function, which
will generate different samples for each pixel.
This function will use a new helper function <code>pixel_sample_square()</code> that generates a random sample
point within the unit square centered at the origin.
We then transform the random sample from this ideal square back to the particular pixel we're
currently sampling.

</p><pre class="listing tilde"><code><span class="line"></span><span class="hljs-keyword">class</span> <span class="hljs-title class_">camera</span> {
<span class="line"></span>  <span class="hljs-keyword">public</span>:
<span class="line"></span>    <span class="hljs-type">double</span> aspect_ratio      = <span class="hljs-number">1.0</span>;  <span class="hljs-comment">// Ratio of image width over height</span>
<span class="line"></span>    <span class="hljs-type">int</span>    image_width       = <span class="hljs-number">100</span>;  <span class="hljs-comment">// Rendered image width in pixel count</span><div class=" highlight"><span class="line"></span>    <span class="hljs-type">int</span>    samples_per_pixel = <span class="hljs-number">10</span>;   <span class="hljs-comment">// Count of random samples for each pixel</span></div><span class="line"></span>
<span class="line"></span>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">render</span><span class="hljs-params">(<span class="hljs-type">const</span> hittable&amp; world)</span> </span>{
<span class="line"></span>        <span class="hljs-built_in">initialize</span>();
<span class="line"></span>
<span class="line"></span>        std::cout &lt;&lt; <span class="hljs-string">"P3\n"</span> &lt;&lt; image_width &lt;&lt; <span class="hljs-string">' '</span> &lt;&lt; image_height &lt;&lt; <span class="hljs-string">"\n255\n"</span>;
<span class="line"></span>
<span class="line"></span>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> j = <span class="hljs-number">0</span>; j &lt; image_height; ++j) {
<span class="line"></span>            std::clog &lt;&lt; <span class="hljs-string">"\rScanlines remaining: "</span> &lt;&lt; (image_height - j) &lt;&lt; <span class="hljs-string">' '</span> &lt;&lt; std::flush;
<span class="line"></span>            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; image_width; ++i) {<div class=" highlight"><span class="line"></span>                <span class="hljs-function">color <span class="hljs-title">pixel_color</span><span class="hljs-params">(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>)</span></span>;
<span class="line"></span>                <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> sample = <span class="hljs-number">0</span>; sample &lt; samples_per_pixel; ++sample) {
<span class="line"></span>                    ray r = <span class="hljs-built_in">get_ray</span>(i, j);
<span class="line"></span>                    pixel_color += <span class="hljs-built_in">ray_color</span>(r, world);
<span class="line"></span>                }
<span class="line"></span>                <span class="hljs-built_in">write_color</span>(std::cout, pixel_color, samples_per_pixel);</div><span class="line"></span>            }
<span class="line"></span>        }
<span class="line"></span>
<span class="line"></span>        std::clog &lt;&lt; <span class="hljs-string">"\rDone.                 \n"</span>;
<span class="line"></span>    }
<span class="line"></span>    ...
<span class="line"></span>  <span class="hljs-keyword">private</span>:
<span class="line"></span>    ...
<span class="line"></span>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">initialize</span><span class="hljs-params">()</span> </span>{
<span class="line"></span>      ...
<span class="line"></span>    }
<span class="line"></span>
<span class="line"></span><div class=" highlight"><span class="line"></span>    <span class="hljs-function">ray <span class="hljs-title">get_ray</span><span class="hljs-params">(<span class="hljs-type">int</span> i, <span class="hljs-type">int</span> j)</span> <span class="hljs-type">const</span> </span>{
<span class="line"></span>        <span class="hljs-comment">// Get a randomly sampled camera ray for the pixel at location i,j.</span>
<span class="line"></span>
<span class="line"></span>        <span class="hljs-keyword">auto</span> pixel_center = pixel00_loc + (i * pixel_delta_u) + (j * pixel_delta_v);
<span class="line"></span>        <span class="hljs-keyword">auto</span> pixel_sample = pixel_center + <span class="hljs-built_in">pixel_sample_square</span>();
<span class="line"></span>
<span class="line"></span>        <span class="hljs-keyword">auto</span> ray_origin = center;
<span class="line"></span>        <span class="hljs-keyword">auto</span> ray_direction = pixel_sample - ray_origin;
<span class="line"></span>
<span class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">ray</span>(ray_origin, ray_direction);
<span class="line"></span>    }
<span class="line"></span>
<span class="line"></span>    <span class="hljs-function">vec3 <span class="hljs-title">pixel_sample_square</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>{
<span class="line"></span>        <span class="hljs-comment">// Returns a random point in the square surrounding a pixel at the origin.</span>
<span class="line"></span>        <span class="hljs-keyword">auto</span> px = <span class="hljs-number">-0.5</span> + <span class="hljs-built_in">random_double</span>();
<span class="line"></span>        <span class="hljs-keyword">auto</span> py = <span class="hljs-number">-0.5</span> + <span class="hljs-built_in">random_double</span>();
<span class="line"></span>        <span class="hljs-keyword">return</span> (px * pixel_delta_u) + (py * pixel_delta_v);
<span class="line"></span>    }</div><span class="line"></span>
<span class="line"></span>    ...
<span class="line"></span>};
<span class="line"></span>
<span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span></code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_camera-spp">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;40:</b> <kbd>[camera.h]</kbd> Camera with samples-per-pixel parameter</div></center>
<p>




(In addition to the new <code>pixel_sample_square()</code> function above, you'll also find the function
<code>pixel_sample_disk()</code> in the Github source code. This is included in case you'd like to experiment
with non-square pixels, but we won't be using it in this book. <code>pixel_sample_disk()</code> depends on the
function <code>random_in_unit_disk()</code> which is defined later on.)

</p><p>

</p><div class="together">
Main is updated to set the new camera parameter.

<p></p><pre class="listing tilde"><code><span class="line"></span><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
<span class="line"></span>    ...
<span class="line"></span>
<span class="line"></span>    camera cam;
<span class="line"></span>
<span class="line"></span>    cam.aspect_ratio      = <span class="hljs-number">16.0</span> / <span class="hljs-number">9.0</span>;
<span class="line"></span>    cam.image_width       = <span class="hljs-number">400</span>;<div class=" highlight"><span class="line"></span>    cam.samples_per_pixel = <span class="hljs-number">100</span>;</div><span class="line"></span>
<span class="line"></span>    cam.<span class="hljs-built_in">render</span>(world);
<span class="line"></span>}</code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_main-spp">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;41:</b> <kbd>[main.cc]</kbd> Setting the new samples-per-pixel parameter</div></center>
<p>


</p></div>

<p></p><p>

</p><div class="together">
Zooming into the image that is produced, we can see the difference in edge pixels.

<p></p><p>

  </p><center><div class="image" style=""><a href="https://raytracing.github.io/images/img-1.06-antialias-before-after.png" target="_blank"><img class="markdeep pixel" src="Ray%20Tracing%20in%20One%20Weekend_files/img-1.06-antialias-before-after.png"></a><center><span class="imagecaption"><span class="num">Image 6:</span> Before and after antialiasing
  </span></center></div></center>

<p></p><p>

</p></div>

<p></p>
<a class="target" name="diffusematerials">&nbsp;</a><a class="target" name="diffusematerials">&nbsp;</a><a class="target" name="toc9">&nbsp;</a><h1>Diffuse Materials</h1>
<p>

Now that we have objects and multiple rays per pixel, we can make some realistic looking materials.
We’ll start with diffuse materials (also called <em class="underscore">matte</em>). One question is whether we mix and match
geometry and materials (so that we can assign a material to multiple spheres, or vice versa) or if
geometry and materials are tightly bound (which could be useful for procedural objects where the
geometry and material are linked). We’ll go with separate — which is usual in most renderers — but
do be aware that there are alternative approaches.

</p>
<a class="target" name="asimplediffusematerial">&nbsp;</a><a class="target" name="diffusematerials/asimplediffusematerial">&nbsp;</a><a class="target" name="toc9.1">&nbsp;</a><h2>A Simple Diffuse Material</h2>
<p>

Diffuse objects that don’t emit their own light merely take on the color of their surroundings, but
they do modulate that with their own intrinsic color. Light that reflects off a diffuse surface has
its direction randomized, so, if we send three rays into a crack between two diffuse surfaces they will
each have different random behavior:

</p><p>

  </p><center><div class="image" style=""><a href="https://raytracing.github.io/images/fig-1.09-light-bounce.jpg" target="_blank"><img class="markdeep" src="Ray%20Tracing%20in%20One%20Weekend_files/fig-1.09-light-bounce.jpg"></a><center><span class="imagecaption"><a class="target" name="figure_light-bounce">&nbsp;</a><b style="font-style:normal;">Figure&nbsp;9:</b> Light ray bounces</span></center></div></center>

<p></p><p>

They might also be absorbed rather than reflected. The darker the surface, the more likely
the ray is absorbed (that’s why it's dark!). Really any algorithm that randomizes direction will
produce surfaces that look matte. Let's start with the most intuitive: a surface that randomly
bounces a ray equally in all directions. For this material, a ray that hits the surface has an
equal probability of bouncing in any direction away from the surface.

</p><p>

  </p><center><div class="image" style=""><a href="https://raytracing.github.io/images/fig-1.10-random-vec-horizon.jpg" target="_blank"><img class="markdeep" src="Ray%20Tracing%20in%20One%20Weekend_files/fig-1.10-random-vec-horizon.jpg"></a><center><span class="imagecaption"><a class="target" name="figure_random-vec-hor">&nbsp;</a><b style="font-style:normal;">Figure&nbsp;10:</b> Equal reflection above the horizon
  </span></center></div></center>

<p></p><p>

This very intuitive material is the simplest kind of diffuse and — indeed — many of the first
raytracing papers used this diffuse method (before adopting a more accurate method that we'll be
implementing a little bit later). We don't currently have a way to randomly reflect a ray, so we'll
need to add a few functions to our vector utility header. The first thing we need is the ability to
generate arbitrary random vectors:

</p><pre class="listing tilde"><code><span class="line"></span><span class="hljs-keyword">class</span> <span class="hljs-title class_">vec3</span> {
<span class="line"></span>  <span class="hljs-keyword">public</span>:
<span class="line"></span>    ...
<span class="line"></span>
<span class="line"></span>    <span class="hljs-function"><span class="hljs-type">double</span> <span class="hljs-title">length_squared</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>{
<span class="line"></span>        <span class="hljs-keyword">return</span> e[<span class="hljs-number">0</span>]*e[<span class="hljs-number">0</span>] + e[<span class="hljs-number">1</span>]*e[<span class="hljs-number">1</span>] + e[<span class="hljs-number">2</span>]*e[<span class="hljs-number">2</span>];
<span class="line"></span>    }
<span class="line"></span>
<span class="line"></span><div class=" Highlight"><span class="line"></span>    <span class="hljs-function"><span class="hljs-type">static</span> vec3 <span class="hljs-title">random</span><span class="hljs-params">()</span> </span>{
<span class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">vec3</span>(<span class="hljs-built_in">random_double</span>(), <span class="hljs-built_in">random_double</span>(), <span class="hljs-built_in">random_double</span>());
<span class="line"></span>    }
<span class="line"></span>
<span class="line"></span>    <span class="hljs-function"><span class="hljs-type">static</span> vec3 <span class="hljs-title">random</span><span class="hljs-params">(<span class="hljs-type">double</span> min, <span class="hljs-type">double</span> max)</span> </span>{
<span class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">vec3</span>(<span class="hljs-built_in">random_double</span>(min,max), <span class="hljs-built_in">random_double</span>(min,max), <span class="hljs-built_in">random_double</span>(min,max));
<span class="line"></span>    }</div><span class="line"></span>};</code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_vec-rand-util">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;42:</b> <kbd>[vec3.h]</kbd> vec3 random utility functions</div></center>
<p>


Then we need to figure out how to manipulate a random vector so that we only get results that are on
the surface of a hemisphere. There are analytical methods of doing this, but they are actually
surprisingly complicated to understand, and quite a bit complicated to implement. Instead, we'll use
what is typically the easiest algorithm: A rejection method. A rejection method works by repeatedly
generating random samples until we produce a sample that meets the desired criteria. In other words,
keep rejecting samples until you find a good one.

</p><p>

There are many equally valid ways of generating a random vector on a hemisphere using the rejection
method, but for our purposes we will go with the simplest, which is:

</p><p>

</p><ol start="1">
<li class="number">Generate a random vector inside of the unit sphere
</li>
<li class="number">Normalize this vector
</li>
<li class="number">Invert the normalized vector if it falls onto the wrong hemisphere</li></ol>

<p></p><p>

</p><div class="together">
First, we will use a rejection method to generate the random vector inside of the unit sphere. Pick
a random point in the unit cube, where <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-97-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1110" style="width: 0.708em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.554em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.625em, 1000.5em, 2.38em, -1000em); top: -2.218em; left: 0em;"><span class="mrow" id="MathJax-Span-1111"><span class="mi" id="MathJax-Span-1112" style="font-family: MathJax_Math; font-style: italic;">x</span></span><span style="display: inline-block; width: 0px; height: 2.218em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.076em; border-left: 0px solid; width: 0px; height: 0.687em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>x</mi></math></span></span><script type="math/tex" id="MathJax-Element-97">x</script>, <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-98-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1113" style="width: 0.658em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.504em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.625em, 1000.5em, 2.574em, -1000em); top: -2.218em; left: 0em;"><span class="mrow" id="MathJax-Span-1114"><span class="mi" id="MathJax-Span-1115" style="font-family: MathJax_Math; font-style: italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.006em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.218em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.317em; border-left: 0px solid; width: 0px; height: 0.927em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>y</mi></math></span></span><script type="math/tex" id="MathJax-Element-98">y</script>, and <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-99-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1116" style="width: 0.557em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.454em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.625em, 1000.45em, 2.38em, -1000em); top: -2.218em; left: 0em;"><span class="mrow" id="MathJax-Span-1117"><span class="mi" id="MathJax-Span-1118" style="font-family: MathJax_Math; font-style: italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.218em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.076em; border-left: 0px solid; width: 0px; height: 0.687em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>z</mi></math></span></span><script type="math/tex" id="MathJax-Element-99">z</script> all range from −1 to +1, and reject this
point if it is outside the unit sphere.

<p></p><p>

  </p><center><div class="image" style=""><a href="https://raytracing.github.io/images/fig-1.11-sphere-vec.jpg" target="_blank"><img class="markdeep" src="Ray%20Tracing%20in%20One%20Weekend_files/fig-1.11-sphere-vec.jpg"></a><center><span class="imagecaption"><a class="target" name="figure_sphere-vec">&nbsp;</a><b style="font-style:normal;">Figure&nbsp;11:</b> Two vectors were rejected before finding a good one
  </span></center></div></center>

<p></p><pre class="listing tilde"><code><span class="line"></span>...
<span class="line"></span>
<span class="line"></span><span class="hljs-function"><span class="hljs-keyword">inline</span> vec3 <span class="hljs-title">unit_vector</span><span class="hljs-params">(vec3 v)</span> </span>{
<span class="line"></span>    <span class="hljs-keyword">return</span> v / v.<span class="hljs-built_in">length</span>();
<span class="line"></span>}
<span class="line"></span>
<span class="line"></span><div class=" Highlight"><span class="line"></span><span class="hljs-function"><span class="hljs-keyword">inline</span> vec3 <span class="hljs-title">random_in_unit_sphere</span><span class="hljs-params">()</span> </span>{
<span class="line"></span>    <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
<span class="line"></span>        <span class="hljs-keyword">auto</span> p = vec3::<span class="hljs-built_in">random</span>(<span class="hljs-number">-1</span>,<span class="hljs-number">1</span>);
<span class="line"></span>        <span class="hljs-keyword">if</span> (p.<span class="hljs-built_in">length_squared</span>() &lt; <span class="hljs-number">1</span>)
<span class="line"></span>            <span class="hljs-keyword">return</span> p;
<span class="line"></span>    }
<span class="line"></span>}</div></code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_random-in-unit-sphere">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;43:</b> <kbd>[vec3.h]</kbd> The random_in_unit_sphere() function</div></center>
<p>


</p></div>

<p></p><p>

</p><div class="together">
Once we have a random vector in the unit sphere we need to normalize it to get a vector <em class="underscore">on</em> the
unit sphere.

<p></p><p>

  </p><center><div class="image" style=""><a href="https://raytracing.github.io/images/fig-1.12-sphere-unit-vec.jpg" target="_blank"><img class="markdeep" src="Ray%20Tracing%20in%20One%20Weekend_files/fig-1.12-sphere-unit-vec.jpg"></a><center><span class="imagecaption"><a class="target" name="figure_sphere-vec">&nbsp;</a><b style="font-style:normal;">Figure&nbsp;12:</b> The accepted random vector is normalized to produce a unit vector
  </span></center></div></center>

<p></p><pre class="listing tilde"><code><span class="line"></span>...
<span class="line"></span>
<span class="line"></span><span class="hljs-function"><span class="hljs-keyword">inline</span> vec3 <span class="hljs-title">random_in_unit_sphere</span><span class="hljs-params">()</span> </span>{
<span class="line"></span>    <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
<span class="line"></span>        <span class="hljs-keyword">auto</span> p = vec3::<span class="hljs-built_in">random</span>(<span class="hljs-number">-1</span>,<span class="hljs-number">1</span>);
<span class="line"></span>        <span class="hljs-keyword">if</span> (p.<span class="hljs-built_in">length_squared</span>() &lt; <span class="hljs-number">1</span>)
<span class="line"></span>            <span class="hljs-keyword">return</span> p;
<span class="line"></span>    }
<span class="line"></span>}
<span class="line"></span>
<span class="line"></span><div class=" Highlight"><span class="line"></span><span class="hljs-function"><span class="hljs-keyword">inline</span> vec3 <span class="hljs-title">random_unit_vector</span><span class="hljs-params">()</span> </span>{
<span class="line"></span>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">unit_vector</span>(<span class="hljs-built_in">random_in_unit_sphere</span>());
<span class="line"></span>}</div></code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_random-unit-vec">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;44:</b> <kbd>[vec3.h]</kbd> Random vector on the unit sphere</div></center>
<p>


</p></div>

<p></p><p>

</p><div class="together">
And now that we have a random vector on the surface of the unit sphere, we can determine if it is on
the correct hemisphere by comparing against the surface normal:

<p></p><p>

  </p><center><div class="image" style=""><a href="https://raytracing.github.io/images/fig-1.13-surface-normal.jpg" target="_blank"><img class="markdeep" src="Ray%20Tracing%20in%20One%20Weekend_files/fig-1.13-surface-normal.jpg"></a><center><span class="imagecaption"><a class="target" name="figure_normal-hor">&nbsp;</a><b style="font-style:normal;">Figure&nbsp;13:</b> The normal vector tells us which hemisphere we need
  </span></center></div></center>

<p></p><p>

</p></div>

<p></p><p>

</p><div class="together">
We can take the dot product of the surface normal and our random vector to determine if it's in the
correct hemisphere. If the dot product is positive, then the vector is in the correct hemisphere. If
the dot product is negative, then we need to invert the vector.

<p></p><pre class="listing tilde"><code><span class="line"></span>...
<span class="line"></span>
<span class="line"></span><span class="hljs-function"><span class="hljs-keyword">inline</span> vec3 <span class="hljs-title">random_unit_vector</span><span class="hljs-params">()</span> </span>{
<span class="line"></span>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">unit_vector</span>(<span class="hljs-built_in">random_in_unit_sphere</span>());
<span class="line"></span>}
<span class="line"></span>
<span class="line"></span><div class=" Highlight"><span class="line"></span><span class="hljs-function"><span class="hljs-keyword">inline</span> vec3 <span class="hljs-title">random_on_hemisphere</span><span class="hljs-params">(<span class="hljs-type">const</span> vec3&amp; normal)</span> </span>{
<span class="line"></span>    vec3 on_unit_sphere = <span class="hljs-built_in">random_unit_vector</span>();
<span class="line"></span>    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">dot</span>(on_unit_sphere, normal) &gt; <span class="hljs-number">0.0</span>) <span class="hljs-comment">// In the same hemisphere as the normal</span>
<span class="line"></span>        <span class="hljs-keyword">return</span> on_unit_sphere;
<span class="line"></span>    <span class="hljs-keyword">else</span>
<span class="line"></span>        <span class="hljs-keyword">return</span> -on_unit_sphere;
<span class="line"></span>}</div></code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_random-in-hemisphere">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;45:</b> <kbd>[vec3.h]</kbd> The random_in_hemisphere() function</div></center>
<p>


</p></div>

<p></p><p>

If a ray bounces off of a material and keeps 100% of its color, then we say that the material is
<em class="underscore">white</em>. If a ray bounces off of a material and keeps 0% of its color, then we say that the
material is black. As a first demonstration of our new diffuse material we'll set the <code>ray_color</code>
function to return 50% of the color from a bounce. We should expect to get a nice gray color.

</p><pre class="listing tilde"><code><span class="line"></span><span class="hljs-keyword">class</span> <span class="hljs-title class_">camera</span> {
<span class="line"></span>  ...
<span class="line"></span>  <span class="hljs-keyword">private</span>:
<span class="line"></span>    ...
<span class="line"></span>    <span class="hljs-function">color <span class="hljs-title">ray_color</span><span class="hljs-params">(<span class="hljs-type">const</span> ray&amp; r, <span class="hljs-type">const</span> hittable&amp; world)</span> <span class="hljs-type">const</span> </span>{
<span class="line"></span>        hit_record rec;
<span class="line"></span>
<span class="line"></span>        <span class="hljs-keyword">if</span> (world.<span class="hljs-built_in">hit</span>(r, <span class="hljs-built_in">interval</span>(<span class="hljs-number">0</span>, infinity), rec)) {<div class=" highlight"><span class="line"></span>            vec3 direction = <span class="hljs-built_in">random_on_hemisphere</span>(rec.normal);
<span class="line"></span>            <span class="hljs-keyword">return</span> <span class="hljs-number">0.5</span> * <span class="hljs-built_in">ray_color</span>(<span class="hljs-built_in">ray</span>(rec.p, direction), world);</div><span class="line"></span>        }
<span class="line"></span>
<span class="line"></span>        vec3 unit_direction = <span class="hljs-built_in">unit_vector</span>(r.<span class="hljs-built_in">direction</span>());
<span class="line"></span>        <span class="hljs-keyword">auto</span> a = <span class="hljs-number">0.5</span>*(unit_direction.<span class="hljs-built_in">y</span>() + <span class="hljs-number">1.0</span>);
<span class="line"></span>        <span class="hljs-keyword">return</span> (<span class="hljs-number">1.0</span>-a)*<span class="hljs-built_in">color</span>(<span class="hljs-number">1.0</span>, <span class="hljs-number">1.0</span>, <span class="hljs-number">1.0</span>) + a*<span class="hljs-built_in">color</span>(<span class="hljs-number">0.5</span>, <span class="hljs-number">0.7</span>, <span class="hljs-number">1.0</span>);
<span class="line"></span>    }
<span class="line"></span>};</code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_ray-color-random-unit">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;46:</b> <kbd>[camera.h]</kbd>
        ray_color() using a random ray direction</div></center>
<p>


</p><div class="together">
... Indeed we do get rather nice gray spheres:

<p></p><p>

  </p><center><div class="image" style=""><a href="https://raytracing.github.io/images/img-1.07-first-diffuse.png" target="_blank"><img class="markdeep pixel" src="Ray%20Tracing%20in%20One%20Weekend_files/img-1.07-first-diffuse.png"></a><center><span class="imagecaption"><span class="num">Image 7:</span> First render of a diffuse sphere
  </span></center></div></center>

<p></p><p>

</p></div>

<p></p>
<a class="target" name="limitingthenumberofchildrays">&nbsp;</a><a class="target" name="diffusematerials/limitingthenumberofchildrays">&nbsp;</a><a class="target" name="toc9.2">&nbsp;</a><h2>Limiting the Number of Child Rays</h2>
<p>

There's one potential problem lurking here. Notice that the <code>ray_color</code> function is recursive. When
will it stop recursing? When it fails to hit anything. In some cases, however, that may be a long
time — long enough to blow the stack. To guard against that, let's limit the maximum recursion
depth, returning no light contribution at the maximum depth:

</p><pre class="listing tilde"><code><span class="line"></span><span class="hljs-keyword">class</span> <span class="hljs-title class_">camera</span> {
<span class="line"></span>  <span class="hljs-keyword">public</span>:
<span class="line"></span>    <span class="hljs-type">double</span> aspect_ratio      = <span class="hljs-number">1.0</span>;  <span class="hljs-comment">// Ratio of image width over height</span>
<span class="line"></span>    <span class="hljs-type">int</span>    image_width       = <span class="hljs-number">100</span>;  <span class="hljs-comment">// Rendered image width in pixel count</span>
<span class="line"></span>    <span class="hljs-type">int</span>    samples_per_pixel = <span class="hljs-number">10</span>;   <span class="hljs-comment">// Count of random samples for each pixel</span><div class=" highlight"><span class="line"></span>    <span class="hljs-type">int</span>    max_depth         = <span class="hljs-number">10</span>;   <span class="hljs-comment">// Maximum number of ray bounces into scene</span></div><span class="line"></span>
<span class="line"></span>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">render</span><span class="hljs-params">(<span class="hljs-type">const</span> hittable&amp; world)</span> </span>{
<span class="line"></span>        <span class="hljs-built_in">initialize</span>();
<span class="line"></span>
<span class="line"></span>        std::cout &lt;&lt; <span class="hljs-string">"P3\n"</span> &lt;&lt; image_width &lt;&lt; <span class="hljs-string">' '</span> &lt;&lt; image_height &lt;&lt; <span class="hljs-string">"\n255\n"</span>;
<span class="line"></span>
<span class="line"></span>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> j = <span class="hljs-number">0</span>; j &lt; image_height; ++j) {
<span class="line"></span>            std::clog &lt;&lt; <span class="hljs-string">"\rScanlines remaining: "</span> &lt;&lt; (image_height - j) &lt;&lt; <span class="hljs-string">' '</span> &lt;&lt; std::flush;
<span class="line"></span>            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; image_width; ++i) {
<span class="line"></span>                <span class="hljs-function">color <span class="hljs-title">pixel_color</span><span class="hljs-params">(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>)</span></span>;
<span class="line"></span>                <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> sample = <span class="hljs-number">0</span>; sample &lt; samples_per_pixel; ++sample) {
<span class="line"></span>                    ray r = <span class="hljs-built_in">get_ray</span>(i, j);<div class=" highlight"><span class="line"></span>                    pixel_color += <span class="hljs-built_in">ray_color</span>(r, max_depth, world);</div><span class="line"></span>                }
<span class="line"></span>                <span class="hljs-built_in">write_color</span>(std::cout, pixel_color, samples_per_pixel);
<span class="line"></span>            }
<span class="line"></span>        }
<span class="line"></span>
<span class="line"></span>        std::clog &lt;&lt; <span class="hljs-string">"\rDone.                 \n"</span>;
<span class="line"></span>    }
<span class="line"></span>    ...
<span class="line"></span>  <span class="hljs-keyword">private</span>:
<span class="line"></span>    ...<div class=" highlight"><span class="line"></span>    <span class="hljs-function">color <span class="hljs-title">ray_color</span><span class="hljs-params">(<span class="hljs-type">const</span> ray&amp; r, <span class="hljs-type">int</span> depth, <span class="hljs-type">const</span> hittable&amp; world)</span> <span class="hljs-type">const</span> </span>{</div><span class="line"></span>        hit_record rec;
<span class="line"></span>
<span class="line"></span><div class=" highlight"><span class="line"></span>        <span class="hljs-comment">// If we've exceeded the ray bounce limit, no more light is gathered.</span>
<span class="line"></span>        <span class="hljs-keyword">if</span> (depth &lt;= <span class="hljs-number">0</span>)
<span class="line"></span>            <span class="hljs-keyword">return</span> <span class="hljs-built_in">color</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);</div><span class="line"></span>
<span class="line"></span>        <span class="hljs-keyword">if</span> (world.<span class="hljs-built_in">hit</span>(r, <span class="hljs-built_in">interval</span>(<span class="hljs-number">0</span>, infinity), rec)) {
<span class="line"></span>            vec3 direction = <span class="hljs-built_in">random_on_hemisphere</span>(rec.normal);<div class=" highlight"><span class="line"></span>            <span class="hljs-keyword">return</span> <span class="hljs-number">0.5</span> * <span class="hljs-built_in">ray_color</span>(<span class="hljs-built_in">ray</span>(rec.p, direction), depth<span class="hljs-number">-1</span>, world);</div><span class="line"></span>        }
<span class="line"></span>
<span class="line"></span>        vec3 unit_direction = <span class="hljs-built_in">unit_vector</span>(r.<span class="hljs-built_in">direction</span>());
<span class="line"></span>        <span class="hljs-keyword">auto</span> a = <span class="hljs-number">0.5</span>*(unit_direction.<span class="hljs-built_in">y</span>() + <span class="hljs-number">1.0</span>);
<span class="line"></span>        <span class="hljs-keyword">return</span> (<span class="hljs-number">1.0</span>-a)*<span class="hljs-built_in">color</span>(<span class="hljs-number">1.0</span>, <span class="hljs-number">1.0</span>, <span class="hljs-number">1.0</span>) + a*<span class="hljs-built_in">color</span>(<span class="hljs-number">0.5</span>, <span class="hljs-number">0.7</span>, <span class="hljs-number">1.0</span>);
<span class="line"></span>    }
<span class="line"></span>};</code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_ray-color-depth">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;47:</b> <kbd>[camera.h]</kbd> camera::ray_color() with depth limiting</div></center>
<p>


</p><div class="together">
Update the main() function to use this new depth limit:

<p></p><pre class="listing tilde"><code><span class="line"></span><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
<span class="line"></span>    ...
<span class="line"></span>
<span class="line"></span>    camera cam;
<span class="line"></span>
<span class="line"></span>    cam.aspect_ratio      = <span class="hljs-number">16.0</span> / <span class="hljs-number">9.0</span>;
<span class="line"></span>    cam.image_width       = <span class="hljs-number">400</span>;
<span class="line"></span>    cam.samples_per_pixel = <span class="hljs-number">100</span>;<div class=" highlight"><span class="line"></span>    cam.max_depth         = <span class="hljs-number">50</span>;</div><span class="line"></span>
<span class="line"></span>    cam.<span class="hljs-built_in">render</span>(world);
<span class="line"></span>}</code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_main-ray-depth">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;48:</b> <kbd>[main.cc]</kbd> Using the new ray depth limiting</div></center>
<p>


</p></div>

<p></p><p>

</p><div class="together">
For this very simple scene we should get basically the same result:

<p></p><p>

  </p><center><div class="image" style=""><a href="https://raytracing.github.io/images/img-1.08-second-diffuse.png" target="_blank"><img class="markdeep pixel" src="Ray%20Tracing%20in%20One%20Weekend_files/img-1.08-second-diffuse.png"></a><center><span class="imagecaption"><span class="num">Image 8:</span> Second render of a diffuse sphere with limited bounces
  </span></center></div></center>

<p></p><p>

</p></div>

<p></p>
<a class="target" name="fixingshadowacne">&nbsp;</a><a class="target" name="diffusematerials/fixingshadowacne">&nbsp;</a><a class="target" name="toc9.3">&nbsp;</a><h2>Fixing Shadow Acne</h2>
<p>

There’s also a subtle bug that we need to address. A ray will attempt to accurately calculate the
intersection point when it intersects with a surface. Unfortunately for us, this calculation is
susceptible to floating point rounding errors which can cause the intersection point to be ever so
slightly off. This means that the origin of the next ray, the ray that is randomly scattered off of
the surface, is unlikely to be perfectly flush with the surface. It might be just above the surface.
It might be just below the surface. If the ray's origin is just below the surface then it could
intersect with that surface again. Which means that it will find the nearest surface at
<span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-100-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;0.00000001&lt;/mn&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1119" style="width: 8.017em; display: inline-block;"><span style="display: inline-block; position: relative; width: 6.452em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.451em, 1006.38em, 2.441em, -1000em); top: -2.268em; left: 0em;"><span class="mrow" id="MathJax-Span-1120"><span class="mi" id="MathJax-Span-1121" style="font-family: MathJax_Math; font-style: italic;">t</span><span class="mo" id="MathJax-Span-1122" style="font-family: MathJax_Main; padding-left: 0.278em;">=</span><span class="mn" id="MathJax-Span-1123" style="font-family: MathJax_Main; padding-left: 0.278em;">0.00000001</span></span><span style="display: inline-block; width: 0px; height: 2.268em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.09em; border-left: 0px solid; width: 0px; height: 0.978em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>t</mi><mo>=</mo><mn>0.00000001</mn></math></span></span><script type="math/tex" id="MathJax-Element-100">t=0.00000001</script> or whatever floating point approximation the hit function gives us. The simplest hack
to address this is just to ignore hits that are very close to the calculated intersection point:

</p><pre class="listing tilde"><code><span class="line"></span><span class="hljs-keyword">class</span> <span class="hljs-title class_">camera</span> {
<span class="line"></span>  ...
<span class="line"></span>  <span class="hljs-keyword">private</span>:
<span class="line"></span>    ...
<span class="line"></span>    <span class="hljs-function">color <span class="hljs-title">ray_color</span><span class="hljs-params">(<span class="hljs-type">const</span> ray&amp; r, <span class="hljs-type">int</span> depth, <span class="hljs-type">const</span> hittable&amp; world)</span> <span class="hljs-type">const</span> </span>{
<span class="line"></span>        hit_record rec;
<span class="line"></span>
<span class="line"></span>        <span class="hljs-comment">// If we've exceeded the ray bounce limit, no more light is gathered.</span>
<span class="line"></span>        <span class="hljs-keyword">if</span> (depth &lt;= <span class="hljs-number">0</span>)
<span class="line"></span>            <span class="hljs-keyword">return</span> <span class="hljs-built_in">color</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);
<span class="line"></span>
<span class="line"></span><div class=" highlight"><span class="line"></span>        <span class="hljs-keyword">if</span> (world.<span class="hljs-built_in">hit</span>(r, <span class="hljs-built_in">interval</span>(<span class="hljs-number">0.001</span>, infinity), rec)) {</div><span class="line"></span>            vec3 direction = <span class="hljs-built_in">random_on_hemisphere</span>(rec.normal);
<span class="line"></span>            <span class="hljs-keyword">return</span> <span class="hljs-number">0.5</span> * <span class="hljs-built_in">ray_color</span>(<span class="hljs-built_in">ray</span>(rec.p, direction), depth<span class="hljs-number">-1</span>, world);
<span class="line"></span>        }
<span class="line"></span>
<span class="line"></span>        vec3 unit_direction = <span class="hljs-built_in">unit_vector</span>(r.<span class="hljs-built_in">direction</span>());
<span class="line"></span>        <span class="hljs-keyword">auto</span> a = <span class="hljs-number">0.5</span>*(unit_direction.<span class="hljs-built_in">y</span>() + <span class="hljs-number">1.0</span>);
<span class="line"></span>        <span class="hljs-keyword">return</span> (<span class="hljs-number">1.0</span>-a)*<span class="hljs-built_in">color</span>(<span class="hljs-number">1.0</span>, <span class="hljs-number">1.0</span>, <span class="hljs-number">1.0</span>) + a*<span class="hljs-built_in">color</span>(<span class="hljs-number">0.5</span>, <span class="hljs-number">0.7</span>, <span class="hljs-number">1.0</span>);
<span class="line"></span>    }
<span class="line"></span>};</code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_reflect-tolerance">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;49:</b> <kbd>[camera.h]</kbd>
        Calculating reflected ray origins with tolerance</div></center>
<p>


</p><div class="together">
This gets rid of the shadow acne problem. Yes it is really called that. Here's the result:

<p></p><p>

  </p><center><div class="image" style=""><a href="https://raytracing.github.io/images/img-1.09-no-acne.png" target="_blank"><img class="markdeep pixel" src="Ray%20Tracing%20in%20One%20Weekend_files/img-1.09-no-acne.png"></a><center><span class="imagecaption"><span class="num">Image 9:</span> Diffuse sphere with no shadow acne
  </span></center></div></center>

<p></p><p>

</p></div>

<p></p>
<a class="target" name="truelambertianreflection">&nbsp;</a><a class="target" name="diffusematerials/truelambertianreflection">&nbsp;</a><a class="target" name="toc9.4">&nbsp;</a><h2>True Lambertian Reflection</h2>
<p>

Scattering reflected rays evenly about the hemisphere produces a nice soft diffuse model, but we can
definitely do better.
A more accurate representation of real diffuse objects is the <em class="underscore">Lambertian</em> distribution.
This distribution scatters reflected rays in a manner that is proportional to <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-101-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;cos&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;&amp;#x03D5;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1124" style="width: 3.38em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.722em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.367em, 1002.63em, 2.669em, -1000em); top: -2.268em; left: 0em;"><span class="mrow" id="MathJax-Span-1125"><span class="mi" id="MathJax-Span-1126" style="font-family: MathJax_Main;">cos</span><span class="mo" id="MathJax-Span-1127"></span><span class="mo" id="MathJax-Span-1128" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-1129" style="font-family: MathJax_Math; font-style: italic;">ϕ</span><span class="mo" id="MathJax-Span-1130" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.268em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.365em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>cos</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>ϕ</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-101">\cos (\phi)</script>, where
<span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-102-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;&amp;#x03D5;&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1131" style="width: 0.759em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.605em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.373em, 1000.59em, 2.574em, -1000em); top: -2.218em; left: 0em;"><span class="mrow" id="MathJax-Span-1132"><span class="mi" id="MathJax-Span-1133" style="font-family: MathJax_Math; font-style: italic;">ϕ</span></span><span style="display: inline-block; width: 0px; height: 2.218em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.317em; border-left: 0px solid; width: 0px; height: 1.24em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>ϕ</mi></math></span></span><script type="math/tex" id="MathJax-Element-102">\phi</script> is the angle between the reflected ray and the surface normal.
This means that a reflected ray is most likely to scatter in a direction near the surface normal,
and less likely to scatter in directions away from the normal.
This non-uniform Lambertian distribution does a better job of modeling material reflection in the
real world than our previous uniform scattering.

</p><p>

We can create this distribution by adding a random unit vector to the normal vector.
At the point of intersection on a surface there is the hit point, <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-103-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;p&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1134" style="width: 0.809em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.655em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.667em, 1000.62em, 2.613em, -1000em); top: -2.268em; left: 0em;"><span class="mrow" id="MathJax-Span-1135"><span class="texatom" id="MathJax-Span-1136"><span class="mrow" id="MathJax-Span-1137"><span class="mi" id="MathJax-Span-1138" style="font-family: MathJax_Main; font-weight: bold;">p</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.268em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.303em; border-left: 0px solid; width: 0px; height: 0.924em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">p</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-103">\mathbf{p}</script>, and there is the
normal of the surface, <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-104-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1139" style="width: 0.809em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.655em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.667em, 1000.64em, 2.419em, -1000em); top: -2.268em; left: 0em;"><span class="mrow" id="MathJax-Span-1140"><span class="texatom" id="MathJax-Span-1141"><span class="mrow" id="MathJax-Span-1142"><span class="mi" id="MathJax-Span-1143" style="font-family: MathJax_Main; font-weight: bold;">n</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.268em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.063em; border-left: 0px solid; width: 0px; height: 0.683em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">n</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-104">\mathbf{n}</script>. At the point of intersection, this surface has exactly two
sides, so there can only be two unique unit spheres tangent to any intersection point (one
unique sphere for each side of the surface). These two unit spheres will be displaced
from the surface by the length of their radius, which is exactly one for a unit sphere.

</p><p>

One sphere will be displaced in the direction of the surface's normal (<span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-105-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1144" style="width: 0.809em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.655em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.667em, 1000.64em, 2.419em, -1000em); top: -2.268em; left: 0em;"><span class="mrow" id="MathJax-Span-1145"><span class="texatom" id="MathJax-Span-1146"><span class="mrow" id="MathJax-Span-1147"><span class="mi" id="MathJax-Span-1148" style="font-family: MathJax_Main; font-weight: bold;">n</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.268em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.063em; border-left: 0px solid; width: 0px; height: 0.683em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">n</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-105">\mathbf{n}</script>) and one sphere
will be displaced in the opposite direction (<span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-106-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo mathvariant=&quot;bold&quot;&gt;&amp;#x2212;&lt;/mo&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1149" style="width: 1.918em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.512em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.667em, 1001.5em, 2.419em, -1000em); top: -2.268em; left: 0em;"><span class="mrow" id="MathJax-Span-1150"><span class="texatom" id="MathJax-Span-1151"><span class="mrow" id="MathJax-Span-1152"><span class="mo" id="MathJax-Span-1153" style="font-family: MathJax_Main; font-weight: bold;">−</span><span class="mi" id="MathJax-Span-1154" style="font-family: MathJax_Main; font-weight: bold;">n</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.268em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.063em; border-left: 0px solid; width: 0px; height: 0.683em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mo mathvariant="bold">−</mo><mi mathvariant="bold">n</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-106">\mathbf{-n}</script>). This leaves us with two spheres of unit
size that will only be <em class="underscore">just</em> touching the surface at the intersection point. From this, one of the
spheres will have its center at <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-107-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;P&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1155" style="width: 4.287em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.427em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.468em, 1003.33em, 2.77em, -1000em); top: -2.369em; left: 0em;"><span class="mrow" id="MathJax-Span-1156"><span class="mo" id="MathJax-Span-1157" style="font-family: MathJax_Main;">(</span><span class="texatom" id="MathJax-Span-1158"><span class="mrow" id="MathJax-Span-1159"><span class="mi" id="MathJax-Span-1160" style="font-family: MathJax_Main; font-weight: bold;">P</span></span></span><span class="mo" id="MathJax-Span-1161" style="font-family: MathJax_Main; padding-left: 0.222em;">+</span><span class="texatom" id="MathJax-Span-1162" style="padding-left: 0.222em;"><span class="mrow" id="MathJax-Span-1163"><span class="mi" id="MathJax-Span-1164" style="font-family: MathJax_Main; font-weight: bold;">n</span></span></span><span class="mo" id="MathJax-Span-1165" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.369em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.365em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">P</mi></mrow><mo>+</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">n</mi></mrow><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-107">(\mathbf{P} + \mathbf{n})</script> and the other sphere will have its
center at <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-108-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;P&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1166" style="width: 4.287em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.427em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.468em, 1003.33em, 2.77em, -1000em); top: -2.369em; left: 0em;"><span class="mrow" id="MathJax-Span-1167"><span class="mo" id="MathJax-Span-1168" style="font-family: MathJax_Main;">(</span><span class="texatom" id="MathJax-Span-1169"><span class="mrow" id="MathJax-Span-1170"><span class="mi" id="MathJax-Span-1171" style="font-family: MathJax_Main; font-weight: bold;">P</span></span></span><span class="mo" id="MathJax-Span-1172" style="font-family: MathJax_Main; padding-left: 0.222em;">−</span><span class="texatom" id="MathJax-Span-1173" style="padding-left: 0.222em;"><span class="mrow" id="MathJax-Span-1174"><span class="mi" id="MathJax-Span-1175" style="font-family: MathJax_Main; font-weight: bold;">n</span></span></span><span class="mo" id="MathJax-Span-1176" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.369em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.365em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">P</mi></mrow><mo>−</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">n</mi></mrow><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-108">(\mathbf{P} - \mathbf{n})</script>. The sphere with a center at <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-109-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;P&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1177" style="width: 4.287em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.427em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.468em, 1003.33em, 2.77em, -1000em); top: -2.369em; left: 0em;"><span class="mrow" id="MathJax-Span-1178"><span class="mo" id="MathJax-Span-1179" style="font-family: MathJax_Main;">(</span><span class="texatom" id="MathJax-Span-1180"><span class="mrow" id="MathJax-Span-1181"><span class="mi" id="MathJax-Span-1182" style="font-family: MathJax_Main; font-weight: bold;">P</span></span></span><span class="mo" id="MathJax-Span-1183" style="font-family: MathJax_Main; padding-left: 0.222em;">−</span><span class="texatom" id="MathJax-Span-1184" style="padding-left: 0.222em;"><span class="mrow" id="MathJax-Span-1185"><span class="mi" id="MathJax-Span-1186" style="font-family: MathJax_Main; font-weight: bold;">n</span></span></span><span class="mo" id="MathJax-Span-1187" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.369em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.365em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">P</mi></mrow><mo>−</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">n</mi></mrow><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-109">(\mathbf{P} - \mathbf{n})</script> is
considered <em class="underscore">inside</em> the surface, whereas the sphere with center <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-110-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;P&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1188" style="width: 4.287em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.427em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.468em, 1003.33em, 2.77em, -1000em); top: -2.369em; left: 0em;"><span class="mrow" id="MathJax-Span-1189"><span class="mo" id="MathJax-Span-1190" style="font-family: MathJax_Main;">(</span><span class="texatom" id="MathJax-Span-1191"><span class="mrow" id="MathJax-Span-1192"><span class="mi" id="MathJax-Span-1193" style="font-family: MathJax_Main; font-weight: bold;">P</span></span></span><span class="mo" id="MathJax-Span-1194" style="font-family: MathJax_Main; padding-left: 0.222em;">+</span><span class="texatom" id="MathJax-Span-1195" style="padding-left: 0.222em;"><span class="mrow" id="MathJax-Span-1196"><span class="mi" id="MathJax-Span-1197" style="font-family: MathJax_Main; font-weight: bold;">n</span></span></span><span class="mo" id="MathJax-Span-1198" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.369em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.365em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">P</mi></mrow><mo>+</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">n</mi></mrow><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-110">(\mathbf{P} + \mathbf{n})</script> is
considered <em class="underscore">outside</em> the surface.

</p><p>

We want to select the tangent unit sphere that is on the same side of the surface as the ray
origin. Pick a random point <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-111-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;S&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1199" style="width: 0.809em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.655em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.42em, 1000.59em, 2.43em, -1000em); top: -2.268em; left: 0em;"><span class="mrow" id="MathJax-Span-1200"><span class="texatom" id="MathJax-Span-1201"><span class="mrow" id="MathJax-Span-1202"><span class="mi" id="MathJax-Span-1203" style="font-family: MathJax_Main; font-weight: bold;">S</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.268em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.076em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">S</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-111">\mathbf{S}</script> on this unit radius sphere and send a ray from the hit
point <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-112-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;P&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1204" style="width: 1.011em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.806em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.431em, 1000.74em, 2.419em, -1000em); top: -2.268em; left: 0em;"><span class="mrow" id="MathJax-Span-1205"><span class="texatom" id="MathJax-Span-1206"><span class="mrow" id="MathJax-Span-1207"><span class="mi" id="MathJax-Span-1208" style="font-family: MathJax_Main; font-weight: bold;">P</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.268em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.063em; border-left: 0px solid; width: 0px; height: 0.976em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">P</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-112">\mathbf{P}</script> to the random point <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-113-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;S&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1209" style="width: 0.809em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.655em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.42em, 1000.59em, 2.43em, -1000em); top: -2.268em; left: 0em;"><span class="mrow" id="MathJax-Span-1210"><span class="texatom" id="MathJax-Span-1211"><span class="mrow" id="MathJax-Span-1212"><span class="mi" id="MathJax-Span-1213" style="font-family: MathJax_Main; font-weight: bold;">S</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.268em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.076em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">S</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-113">\mathbf{S}</script> (this is the vector <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-114-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;S&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;P&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1214" style="width: 4.287em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.427em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.468em, 1003.33em, 2.77em, -1000em); top: -2.369em; left: 0em;"><span class="mrow" id="MathJax-Span-1215"><span class="mo" id="MathJax-Span-1216" style="font-family: MathJax_Main;">(</span><span class="texatom" id="MathJax-Span-1217"><span class="mrow" id="MathJax-Span-1218"><span class="mi" id="MathJax-Span-1219" style="font-family: MathJax_Main; font-weight: bold;">S</span></span></span><span class="mo" id="MathJax-Span-1220" style="font-family: MathJax_Main; padding-left: 0.222em;">−</span><span class="texatom" id="MathJax-Span-1221" style="padding-left: 0.222em;"><span class="mrow" id="MathJax-Span-1222"><span class="mi" id="MathJax-Span-1223" style="font-family: MathJax_Main; font-weight: bold;">P</span></span></span><span class="mo" id="MathJax-Span-1224" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.369em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.365em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">S</mi></mrow><mo>−</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">P</mi></mrow><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-114">(\mathbf{S}-\mathbf{P})</script>):

</p><p>

  </p><center><div class="image" style=""><a href="https://raytracing.github.io/images/fig-1.14-rand-unitvec.jpg" target="_blank"><img class="markdeep" src="Ray%20Tracing%20in%20One%20Weekend_files/fig-1.14-rand-unitvec.jpg"></a><center><span class="imagecaption"><a class="target" name="figure_rand-unitvec">&nbsp;</a><b style="font-style:normal;">Figure&nbsp;14:</b> Randomly generating a vector according to Lambertian distribution
  </span></center></div></center>

<p></p><p>

</p><div class="together">
The change is actually fairly minimal:

<p></p><pre class="listing tilde"><code><span class="line"></span><span class="hljs-keyword">class</span> <span class="hljs-title class_">camera</span> {
<span class="line"></span>    ...
<span class="line"></span>    <span class="hljs-function">color <span class="hljs-title">ray_color</span><span class="hljs-params">(<span class="hljs-type">const</span> ray&amp; r, <span class="hljs-type">int</span> depth, <span class="hljs-type">const</span> hittable&amp; world)</span> <span class="hljs-type">const</span> </span>{
<span class="line"></span>        hit_record rec;
<span class="line"></span>
<span class="line"></span>        <span class="hljs-comment">// If we've exceeded the ray bounce limit, no more light is gathered.</span>
<span class="line"></span>        <span class="hljs-keyword">if</span> (depth &lt;= <span class="hljs-number">0</span>)
<span class="line"></span>            <span class="hljs-keyword">return</span> <span class="hljs-built_in">color</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);
<span class="line"></span>
<span class="line"></span>        <span class="hljs-keyword">if</span> (world.<span class="hljs-built_in">hit</span>(r, <span class="hljs-built_in">interval</span>(<span class="hljs-number">0.001</span>, infinity), rec)) {<div class=" highlight"><span class="line"></span>            vec3 direction = rec.normal + <span class="hljs-built_in">random_unit_vector</span>();</div><span class="line"></span>            <span class="hljs-keyword">return</span> <span class="hljs-number">0.5</span> * <span class="hljs-built_in">ray_color</span>(<span class="hljs-built_in">ray</span>(rec.p, direction), depth<span class="hljs-number">-1</span>, world);
<span class="line"></span>    }
<span class="line"></span>
<span class="line"></span>        vec3 unit_direction = <span class="hljs-built_in">unit_vector</span>(r.<span class="hljs-built_in">direction</span>());
<span class="line"></span>        <span class="hljs-keyword">auto</span> a = <span class="hljs-number">0.5</span>*(unit_direction.<span class="hljs-built_in">y</span>() + <span class="hljs-number">1.0</span>);
<span class="line"></span>        <span class="hljs-keyword">return</span> (<span class="hljs-number">1.0</span>-a)*<span class="hljs-built_in">color</span>(<span class="hljs-number">1.0</span>, <span class="hljs-number">1.0</span>, <span class="hljs-number">1.0</span>) + a*<span class="hljs-built_in">color</span>(<span class="hljs-number">0.5</span>, <span class="hljs-number">0.7</span>, <span class="hljs-number">1.0</span>);
<span class="line"></span>    }
<span class="line"></span>};</code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_ray-color-unit-sphere">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;50:</b> <kbd>[camera.h]</kbd> ray_color() with replacement diffuse</div></center>
<p>


</p></div>

<p></p><p>

</p><div class="together">
After rendering we get a similar image:

<p></p><p>

  </p><center><div class="image" style=""><a href="https://raytracing.github.io/images/img-1.10-correct-lambertian.png" target="_blank"><img class="markdeep pixel" src="Ray%20Tracing%20in%20One%20Weekend_files/img-1.10-correct-lambertian.png"></a><center><span class="imagecaption"><span class="num">Image 10:</span> Correct rendering of Lambertian spheres
  </span></center></div></center>

<p></p><p>

</p></div>

<p></p><p>

It's hard to tell the difference between these two diffuse methods, given that our scene of two
spheres is so simple, but you should be able to notice two important visual differences:

</p><p>

</p><ol start="1">
  <li class="number">The shadows are more pronounced after the change
</li>
  <li class="number">Both spheres are tinted blue from the sky after the change</li></ol>

<p></p><p>

Both of these changes are due to the less uniform scattering of the light rays—more rays are
scattering toward the normal. This means that for diffuse objects, they will appear <em class="underscore">darker</em>
because less light bounces toward the camera. For the shadows, more light bounces straight-up, so
the area underneath the sphere is darker.

</p><p>

Not a lot of common, everyday objects are perfectly diffuse, so our visual intuition of how these
objects behave under light can be poorly formed. As scenes become more complicated over the course
of the book, you are encouraged to switch between the different diffuse renderers presented here.
Most scenes of interest will contain a large amount of diffuse materials. You can gain valuable
insight by understanding the effect of different diffuse methods on the lighting of a scene.

</p>
<a class="target" name="usinggammacorrectionforaccuratecolorintensity">&nbsp;</a><a class="target" name="diffusematerials/usinggammacorrectionforaccuratecolorintensity">&nbsp;</a><a class="target" name="toc9.5">&nbsp;</a><h2>Using Gamma Correction for Accurate Color Intensity</h2>
<p>

Note the shadowing under the sphere. The picture is very dark, but our spheres only absorb half the
energy of each bounce, so they are 50% reflectors. The spheres should look pretty bright (in real
life, a light grey) but they appear to be rather dark. We can see this more clearly if we walk
through the full brightness gamut for our diffuse material. We start by setting the reflectance of
the <code>ray_color</code> function from <code>0.5</code> (50%) to <code>0.1</code> (10%):

</p><pre class="listing tilde"><code><span class="line"></span><span class="hljs-keyword">class</span> <span class="hljs-title class_">camera</span> {
<span class="line"></span>    ...
<span class="line"></span>    <span class="hljs-function">color <span class="hljs-title">ray_color</span><span class="hljs-params">(<span class="hljs-type">const</span> ray&amp; r, <span class="hljs-type">int</span> depth, <span class="hljs-type">const</span> hittable&amp; world)</span> <span class="hljs-type">const</span> </span>{
<span class="line"></span>        hit_record rec;
<span class="line"></span>
<span class="line"></span>        <span class="hljs-comment">// If we've exceeded the ray bounce limit, no more light is gathered.</span>
<span class="line"></span>        <span class="hljs-keyword">if</span> (depth &lt;= <span class="hljs-number">0</span>)
<span class="line"></span>            <span class="hljs-keyword">return</span> <span class="hljs-built_in">color</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);
<span class="line"></span>
<span class="line"></span>        <span class="hljs-keyword">if</span> (world.<span class="hljs-built_in">hit</span>(r, <span class="hljs-built_in">interval</span>(<span class="hljs-number">0.001</span>, infinity), rec)) {
<span class="line"></span>            vec3 direction = rec.normal + <span class="hljs-built_in">random_unit_vector</span>();<div class=" highlight"><span class="line"></span>            <span class="hljs-keyword">return</span> <span class="hljs-number">0.1</span> * <span class="hljs-built_in">ray_color</span>(<span class="hljs-built_in">ray</span>(rec.p, direction), depth<span class="hljs-number">-1</span>, world);</div><span class="line"></span>    }
<span class="line"></span>
<span class="line"></span>        vec3 unit_direction = <span class="hljs-built_in">unit_vector</span>(r.<span class="hljs-built_in">direction</span>());
<span class="line"></span>        <span class="hljs-keyword">auto</span> a = <span class="hljs-number">0.5</span>*(unit_direction.<span class="hljs-built_in">y</span>() + <span class="hljs-number">1.0</span>);
<span class="line"></span>        <span class="hljs-keyword">return</span> (<span class="hljs-number">1.0</span>-a)*<span class="hljs-built_in">color</span>(<span class="hljs-number">1.0</span>, <span class="hljs-number">1.0</span>, <span class="hljs-number">1.0</span>) + a*<span class="hljs-built_in">color</span>(<span class="hljs-number">0.5</span>, <span class="hljs-number">0.7</span>, <span class="hljs-number">1.0</span>);
<span class="line"></span>    }
<span class="line"></span>};</code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_ray-color-gamut">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;51:</b> <kbd>[camera.h]</kbd> ray_color() with 10% reflectance</div></center>
<p>


We render out at this new 10% reflectance. We then set reflectance to 30% and render again. We
repeat for 50%, 70%, and finally 90%. You can overlay these images from left to right in the photo
editor of your choice and you should get a very nice visual representation of the increasing
brightness of your chosen gamut. This is the one that we've been working with so far: 

</p><p>

</p><center><div class="image" style=""><a href="https://raytracing.github.io/images/img-1.11-linear-gamut.png" target="_blank"><img class="markdeep pixel" src="Ray%20Tracing%20in%20One%20Weekend_files/img-1.11-linear-gamut.png"></a><center><span class="imagecaption"><span class="num">Image 11:</span> The gamut of our renderer so far
</span></center></div></center>

<p></p><p>

If you look closely, or if you use a color picker, you should notice that the 50% reflectance
render (the one in the middle) is far too dark to be half-way between white and black (middle-gray).
Indeed, the 70% reflector is closer to middle-gray. The reason for this is that almost all
computer programs assume that an image is “gamma corrected” before being written into an image
file. This means that the 0 to 1 values have some transform applied before being stored as a byte.
Images with data that are written without being transformed are said to be in <em class="underscore">linear space</em>,
whereas images that are transformed are said to be in <em class="underscore">gamma space</em>. It is likely that the image
viewer you are using is expecting an image in gamma space, but we are giving it an image in linear
space. This is the reason why our image appears inaccurately dark.

</p><p>

There are many good reasons for why images should be stored in gamma space, but for our purposes we
just need to be aware of it. We are going to transform our data into gamma space so that our image
viewer can more accurately display our image. As a simple approximation, we can use “gamma 2” as our
transform, which is the power that you use when going from gamma space to linear space. We need to
go from linear space to gamma space, which means taking the inverse of “gamma 2", which means an
exponent of <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-115-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;/&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;g&lt;/mi&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;a&lt;/mi&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;m&lt;/mi&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;m&lt;/mi&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;a&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1225" style="width: 5.144em; display: inline-block;"><span style="display: inline-block; position: relative; width: 4.133em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.367em, 1004.17em, 2.669em, -1000em); top: -2.268em; left: 0em;"><span class="mrow" id="MathJax-Span-1226"><span class="mn" id="MathJax-Span-1227" style="font-family: MathJax_Main;">1</span><span class="texatom" id="MathJax-Span-1228"><span class="mrow" id="MathJax-Span-1229"><span class="mo" id="MathJax-Span-1230" style="font-family: MathJax_Main;">/</span></span></span><span class="texatom" id="MathJax-Span-1231"><span class="mrow" id="MathJax-Span-1232"><span class="mi" id="MathJax-Span-1233" style="font-family: MathJax_Main; font-style: italic;">g</span><span class="mi" id="MathJax-Span-1234" style="font-family: MathJax_Main; font-style: italic;">a</span><span class="mi" id="MathJax-Span-1235" style="font-family: MathJax_Main; font-style: italic;">m</span><span class="mi" id="MathJax-Span-1236" style="font-family: MathJax_Main; font-style: italic;">m</span><span class="mi" id="MathJax-Span-1237" style="font-family: MathJax_Main; font-style: italic;">a</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.268em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.365em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>1</mn><mrow class="MJX-TeXAtom-ORD"><mo>/</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mi class="MJX-tex-mathit" mathvariant="italic">g</mi><mi class="MJX-tex-mathit" mathvariant="italic">a</mi><mi class="MJX-tex-mathit" mathvariant="italic">m</mi><mi class="MJX-tex-mathit" mathvariant="italic">m</mi><mi class="MJX-tex-mathit" mathvariant="italic">a</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-115">1/\mathit{gamma}</script>, which is just the square-root.

</p><pre class="listing tilde"><code><div class=" highlight"><span class="line"></span><span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-type">double</span> <span class="hljs-title">linear_to_gamma</span><span class="hljs-params">(<span class="hljs-type">double</span> linear_component)</span>
<span class="line"></span></span>{
<span class="line"></span>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">sqrt</span>(linear_component);
<span class="line"></span>}</div><span class="line"></span>
<span class="line"></span><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">write_color</span><span class="hljs-params">(std::ostream &amp;out, color pixel_color, <span class="hljs-type">int</span> samples_per_pixel)</span> </span>{
<span class="line"></span>    <span class="hljs-keyword">auto</span> r = pixel_color.<span class="hljs-built_in">x</span>();
<span class="line"></span>    <span class="hljs-keyword">auto</span> g = pixel_color.<span class="hljs-built_in">y</span>();
<span class="line"></span>    <span class="hljs-keyword">auto</span> b = pixel_color.<span class="hljs-built_in">z</span>();
<span class="line"></span>
<span class="line"></span>    <span class="hljs-comment">// Divide the color by the number of samples.</span>
<span class="line"></span>    <span class="hljs-keyword">auto</span> scale = <span class="hljs-number">1.0</span> / samples_per_pixel;
<span class="line"></span>    r *= scale;
<span class="line"></span>    g *= scale;
<span class="line"></span>    b *= scale;
<span class="line"></span>
<span class="line"></span><div class=" highlight"><span class="line"></span>    <span class="hljs-comment">// Apply the linear to gamma transform.</span>
<span class="line"></span>    r = <span class="hljs-built_in">linear_to_gamma</span>(r);
<span class="line"></span>    g = <span class="hljs-built_in">linear_to_gamma</span>(g);
<span class="line"></span>    b = <span class="hljs-built_in">linear_to_gamma</span>(b);</div><span class="line"></span>
<span class="line"></span>    <span class="hljs-comment">// Write the translated [0,255] value of each color component.</span>
<span class="line"></span>    <span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-type">const</span> interval <span class="hljs-title">intensity</span><span class="hljs-params">(<span class="hljs-number">0.000</span>, <span class="hljs-number">0.999</span>)</span></span>;
<span class="line"></span>    out &lt;&lt; <span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">int</span>&gt;(<span class="hljs-number">256</span> * intensity.<span class="hljs-built_in">clamp</span>(r)) &lt;&lt; <span class="hljs-string">' '</span>
<span class="line"></span>        &lt;&lt; <span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">int</span>&gt;(<span class="hljs-number">256</span> * intensity.<span class="hljs-built_in">clamp</span>(g)) &lt;&lt; <span class="hljs-string">' '</span>
<span class="line"></span>        &lt;&lt; <span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">int</span>&gt;(<span class="hljs-number">256</span> * intensity.<span class="hljs-built_in">clamp</span>(b)) &lt;&lt; <span class="hljs-string">'\n'</span>;
<span class="line"></span>}</code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_write-color-gamma">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;52:</b> <kbd>[color.h]</kbd> write_color(), with gamma correction</div></center>
<p>



</p><div class="together">
Using this gamma correction, we now get a much more consistent ramp from darkness to lightness:

<p></p><p>

  </p><center><div class="image" style=""><a href="https://raytracing.github.io/images/img-1.12-gamma-gamut.png" target="_blank"><img class="markdeep pixel" src="Ray%20Tracing%20in%20One%20Weekend_files/img-1.12-gamma-gamut.png"></a><center><span class="imagecaption"><span class="num">Image 12:</span> The gamma-corrected render of two diffuse spheres
  </span></center></div></center>

<p></p><p>

</p></div>

<p></p>
<a class="target" name="metal">&nbsp;</a><a class="target" name="metal">&nbsp;</a><a class="target" name="toc10">&nbsp;</a><h1>Metal</h1>

<a class="target" name="anabstractclassformaterials">&nbsp;</a><a class="target" name="metal/anabstractclassformaterials">&nbsp;</a><a class="target" name="toc10.1">&nbsp;</a><h2>An Abstract Class for Materials</h2>
<p>

If we want different objects to have different materials, we have a design decision. We could have
a universal material type with lots of parameters so any individual material type could just ignore
the parameters that don't affect it. This is not a bad approach. Or we could have an abstract
material class that encapsulates unique behavior. I am a fan of the latter approach. For our
program the material needs to do two things:

</p><p>

</p><ol start="1">
  <li class="number">Produce a scattered ray (or say it absorbed the incident ray).
</li>
  <li class="number">If scattered, say how much the ray should be attenuated.</li></ol>

<p></p><p>

</p><div class="together">
This suggests the abstract class:

<p></p><pre class="listing tilde"><code><span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">ifndef</span> MATERIAL_H</span>
<span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">define</span> MATERIAL_H</span>
<span class="line"></span>
<span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"rtweekend.h"</span></span>
<span class="line"></span>
<span class="line"></span><span class="hljs-keyword">class</span> <span class="hljs-title class_">hit_record</span>;
<span class="line"></span>
<span class="line"></span><span class="hljs-keyword">class</span> <span class="hljs-title class_">material</span> {
<span class="line"></span>  <span class="hljs-keyword">public</span>:
<span class="line"></span>    <span class="hljs-keyword">virtual</span> ~<span class="hljs-built_in">material</span>() = <span class="hljs-keyword">default</span>;
<span class="line"></span>
<span class="line"></span>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">bool</span> <span class="hljs-title">scatter</span><span class="hljs-params">(
<span class="line"></span>        <span class="hljs-type">const</span> ray&amp; r_in, <span class="hljs-type">const</span> hit_record&amp; rec, color&amp; attenuation, ray&amp; scattered)</span> <span class="hljs-type">const</span> </span>= <span class="hljs-number">0</span>;
<span class="line"></span>};
<span class="line"></span>
<span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span></code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_material-initial">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;53:</b> <kbd>[material.h]</kbd> The material class</div></center>
<p>


</p></div>

<p></p>
<a class="target" name="adatastructuretodescriberay-objectintersections">&nbsp;</a><a class="target" name="metal/adatastructuretodescriberay-objectintersections">&nbsp;</a><a class="target" name="toc10.2">&nbsp;</a><h2>A Data Structure to Describe Ray-Object Intersections</h2>
<p>

The <code>hit_record</code> is to avoid a bunch of arguments so we can stuff whatever info we want in there.
You can use arguments instead of an encapsulated type, it’s just a matter of taste. Hittables and
materials need to be able to reference the other's type in code so there is some circularity of the
references. In C++ we add the line <code>class material;</code> to tell the compiler that <code>material</code> is a class
that will be defined later. Since we're just specifying a pointer to the class, the compiler
doesn't need to know the details of the class, solving the circular reference issue.

</p><pre class="listing tilde"><code><span class="line"></span><div class=" highlight"><span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"rtweekend.h"</span></span>
<span class="line"></span>
<span class="line"></span><span class="hljs-keyword">class</span> <span class="hljs-title class_">material</span>;</div><span class="line"></span>
<span class="line"></span><span class="hljs-keyword">class</span> <span class="hljs-title class_">hit_record</span> {
<span class="line"></span>  <span class="hljs-keyword">public</span>:
<span class="line"></span>    point3 p;
<span class="line"></span>    vec3 normal;<div class=" highlight"><span class="line"></span>    shared_ptr&lt;material&gt; mat;</div><span class="line"></span>    <span class="hljs-type">double</span> t;
<span class="line"></span>    <span class="hljs-type">bool</span> front_face;
<span class="line"></span>
<span class="line"></span>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">set_face_normal</span><span class="hljs-params">(<span class="hljs-type">const</span> ray&amp; r, <span class="hljs-type">const</span> vec3&amp; outward_normal)</span> </span>{
<span class="line"></span>        front_face = <span class="hljs-built_in">dot</span>(r.<span class="hljs-built_in">direction</span>(), outward_normal) &lt; <span class="hljs-number">0</span>;
<span class="line"></span>        normal = front_face ? outward_normal : -outward_normal;
<span class="line"></span>    }
<span class="line"></span>};</code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_hit-with-material">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;54:</b> <kbd>[hittable.h]</kbd> Hit record with added material pointer</div></center>
<p>


<code>hit_record</code> is just a way to stuff a bunch of arguments into a class so we can send them as a
group. When a ray hits a surface (a particular sphere for example), the material pointer in the
<code>hit_record</code> will be set to point at the material pointer the sphere was given when it was set up in
<code>main()</code> when we start. When the <code>ray_color()</code> routine gets the <code>hit_record</code> it can call member
functions of the material pointer to find out what ray, if any, is scattered.

</p><p>

</p><div class="together">
To achieve this, <code>hit_record</code> needs to be told the material that is assigned to the sphere.

<p></p><pre class="listing tilde"><code><span class="line"></span><span class="hljs-keyword">class</span> <span class="hljs-title class_">sphere</span> : <span class="hljs-keyword">public</span> hittable {
<span class="line"></span>  <span class="hljs-keyword">public</span>:<div class=" highlight"><span class="line"></span>    <span class="hljs-built_in">sphere</span>(point3 _center, <span class="hljs-type">double</span> _radius, shared_ptr&lt;material&gt; _material)
<span class="line"></span>      : <span class="hljs-built_in">center</span>(_center), <span class="hljs-built_in">radius</span>(_radius), <span class="hljs-built_in">mat</span>(_material) {}</div><span class="line"></span>
<span class="line"></span>    <span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">hit</span><span class="hljs-params">(<span class="hljs-type">const</span> ray&amp; r, interval <span class="hljs-type">ray_t</span>, hit_record&amp; rec)</span> <span class="hljs-type">const</span> <span class="hljs-keyword">override</span> </span>{
<span class="line"></span>        ...
<span class="line"></span>
<span class="line"></span>        rec.t = root;
<span class="line"></span>        rec.p = r.<span class="hljs-built_in">at</span>(rec.t);
<span class="line"></span>        vec3 outward_normal = (rec.p - center) / radius;
<span class="line"></span>        rec.<span class="hljs-built_in">set_face_normal</span>(r, outward_normal);<div class=" highlight"><span class="line"></span>        rec.mat = mat;</div><span class="line"></span>
<span class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
<span class="line"></span>    }
<span class="line"></span>
<span class="line"></span>  <span class="hljs-keyword">private</span>:
<span class="line"></span>    point3 center;
<span class="line"></span>    <span class="hljs-type">double</span> radius;<div class=" highlight"><span class="line"></span>    shared_ptr&lt;material&gt; mat;</div><span class="line"></span>};</code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_sphere-material">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;55:</b> <kbd>[sphere.h]</kbd>
        Ray-sphere intersection with added material information</div></center>
<p>


</p></div>

<p></p>
<a class="target" name="modelinglightscatterandreflectance">&nbsp;</a><a class="target" name="metal/modelinglightscatterandreflectance">&nbsp;</a><a class="target" name="toc10.3">&nbsp;</a><h2>Modeling Light Scatter and Reflectance</h2>
<p>

For the Lambertian (diffuse) case we already have, it can either always scatter and attenuate by
its reflectance <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-116-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;R&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1238" style="width: 0.96em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.756em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.384em, 1000.75em, 2.39em, -1000em); top: -2.218em; left: 0em;"><span class="mrow" id="MathJax-Span-1239"><span class="mi" id="MathJax-Span-1240" style="font-family: MathJax_Math; font-style: italic;">R</span></span><span style="display: inline-block; width: 0px; height: 2.218em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.089em; border-left: 0px solid; width: 0px; height: 0.998em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>R</mi></math></span></span><script type="math/tex" id="MathJax-Element-116">R</script>, or it can sometimes scatter (with probabilty <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-117-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mi&gt;R&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1241" style="width: 3.077em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.47em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.434em, 1002.47em, 2.501em, -1000em); top: -2.268em; left: 0em;"><span class="mrow" id="MathJax-Span-1242"><span class="mn" id="MathJax-Span-1243" style="font-family: MathJax_Main;">1</span><span class="mo" id="MathJax-Span-1244" style="font-family: MathJax_Main; padding-left: 0.222em;">−</span><span class="mi" id="MathJax-Span-1245" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.222em;">R</span></span><span style="display: inline-block; width: 0px; height: 2.268em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.164em; border-left: 0px solid; width: 0px; height: 1.074em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>1</mn><mo>−</mo><mi>R</mi></math></span></span><script type="math/tex" id="MathJax-Element-117">1-R</script>) with no attenuation (where
a ray that isn't scattered is just absorbed into the material). It could also be a mixture of both
those strategies. We will choose to always scatter, so Lambertian materials become this simple class:

</p><pre class="listing tilde"><code><span class="line"></span><span class="hljs-keyword">class</span> <span class="hljs-title class_">material</span> {
<span class="line"></span>    ...
<span class="line"></span>};
<span class="line"></span>
<span class="line"></span><div class=" Highlight"><span class="line"></span><span class="hljs-keyword">class</span> <span class="hljs-title class_">lambertian</span> : <span class="hljs-keyword">public</span> material {
<span class="line"></span>  <span class="hljs-keyword">public</span>:
<span class="line"></span>    <span class="hljs-built_in">lambertian</span>(<span class="hljs-type">const</span> color&amp; a) : <span class="hljs-built_in">albedo</span>(a) {}
<span class="line"></span>
<span class="line"></span>    <span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">scatter</span><span class="hljs-params">(<span class="hljs-type">const</span> ray&amp; r_in, <span class="hljs-type">const</span> hit_record&amp; rec, color&amp; attenuation, ray&amp; scattered)</span>
<span class="line"></span>    <span class="hljs-type">const</span> <span class="hljs-keyword">override</span> </span>{
<span class="line"></span>        <span class="hljs-keyword">auto</span> scatter_direction = rec.normal + <span class="hljs-built_in">random_unit_vector</span>();
<span class="line"></span>        scattered = <span class="hljs-built_in">ray</span>(rec.p, scatter_direction);
<span class="line"></span>        attenuation = albedo;
<span class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
<span class="line"></span>    }
<span class="line"></span>
<span class="line"></span>  <span class="hljs-keyword">private</span>:
<span class="line"></span>    color albedo;
<span class="line"></span>};</div></code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_lambertian-initial">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;56:</b> <kbd>[material.h]</kbd> The new lambertian material class</div></center>
<p>


Note the third option that we could scatter with some fixed probability <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-118-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1246" style="width: 0.658em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.504em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.625em, 1000.5em, 2.563em, -1000em); top: -2.218em; left: 0em;"><span class="mrow" id="MathJax-Span-1247"><span class="mi" id="MathJax-Span-1248" style="font-family: MathJax_Math; font-style: italic;">p</span></span><span style="display: inline-block; width: 0px; height: 2.218em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.303em; border-left: 0px solid; width: 0px; height: 0.914em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>p</mi></math></span></span><script type="math/tex" id="MathJax-Element-118">p</script> and have attenuation be
<span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-119-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;a&lt;/mi&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;l&lt;/mi&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;b&lt;/mi&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;e&lt;/mi&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;d&lt;/mi&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;o&lt;/mi&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;/&lt;/mo&gt;&lt;/mrow&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1249" style="width: 4.64em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.73em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.367em, 1003.72em, 2.669em, -1000em); top: -2.268em; left: 0em;"><span class="mrow" id="MathJax-Span-1250"><span class="texatom" id="MathJax-Span-1251"><span class="mrow" id="MathJax-Span-1252"><span class="mi" id="MathJax-Span-1253" style="font-family: MathJax_Main; font-style: italic;">a</span><span class="mi" id="MathJax-Span-1254" style="font-family: MathJax_Main; font-style: italic;">l</span><span class="mi" id="MathJax-Span-1255" style="font-family: MathJax_Main; font-style: italic;">b</span><span class="mi" id="MathJax-Span-1256" style="font-family: MathJax_Main; font-style: italic;">e</span><span class="mi" id="MathJax-Span-1257" style="font-family: MathJax_Main; font-style: italic;">d</span><span class="mi" id="MathJax-Span-1258" style="font-family: MathJax_Main; font-style: italic;">o</span></span></span><span class="texatom" id="MathJax-Span-1259"><span class="mrow" id="MathJax-Span-1260"><span class="mo" id="MathJax-Span-1261" style="font-family: MathJax_Main;">/</span></span></span><span class="mi" id="MathJax-Span-1262" style="font-family: MathJax_Math; font-style: italic;">p</span></span><span style="display: inline-block; width: 0px; height: 2.268em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.365em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi class="MJX-tex-mathit" mathvariant="italic">a</mi><mi class="MJX-tex-mathit" mathvariant="italic">l</mi><mi class="MJX-tex-mathit" mathvariant="italic">b</mi><mi class="MJX-tex-mathit" mathvariant="italic">e</mi><mi class="MJX-tex-mathit" mathvariant="italic">d</mi><mi class="MJX-tex-mathit" mathvariant="italic">o</mi></mrow><mrow class="MJX-TeXAtom-ORD"><mo>/</mo></mrow><mi>p</mi></math></span></span><script type="math/tex" id="MathJax-Element-119">\mathit{albedo}/p</script>. Your choice.

</p><p>

If you read the code above carefully, you'll notice a small chance of mischief. If the random unit
vector we generate is exactly opposite the normal vector, the two will sum to zero, which will
result in a zero scatter direction vector. This leads to bad scenarios later on (infinities and
NaNs), so we need to intercept the condition before we pass it on.

</p><p>

In service of this, we'll create a new vector method — <code>vec3::near_zero()</code> — that returns true if
the vector is very close to zero in all dimensions.

</p><pre class="listing tilde"><code><span class="line"></span><span class="hljs-keyword">class</span> <span class="hljs-title class_">vec3</span> {
<span class="line"></span>    ...
<span class="line"></span>
<span class="line"></span>    <span class="hljs-function"><span class="hljs-type">double</span> <span class="hljs-title">length_squared</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>{
<span class="line"></span>        <span class="hljs-keyword">return</span> e[<span class="hljs-number">0</span>]*e[<span class="hljs-number">0</span>] + e[<span class="hljs-number">1</span>]*e[<span class="hljs-number">1</span>] + e[<span class="hljs-number">2</span>]*e[<span class="hljs-number">2</span>];
<span class="line"></span>    }
<span class="line"></span>
<span class="line"></span><div class=" Highlight"><span class="line"></span>    <span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">near_zero</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>{
<span class="line"></span>        <span class="hljs-comment">// Return true if the vector is close to zero in all dimensions.</span>
<span class="line"></span>        <span class="hljs-keyword">auto</span> s = <span class="hljs-number">1e-8</span>;
<span class="line"></span>        <span class="hljs-keyword">return</span> (<span class="hljs-built_in">fabs</span>(e[<span class="hljs-number">0</span>]) &lt; s) &amp;&amp; (<span class="hljs-built_in">fabs</span>(e[<span class="hljs-number">1</span>]) &lt; s) &amp;&amp; (<span class="hljs-built_in">fabs</span>(e[<span class="hljs-number">2</span>]) &lt; s);
<span class="line"></span>    }</div><span class="line"></span>
<span class="line"></span>    ...
<span class="line"></span>};</code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_vec3-near-zero">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;57:</b> <kbd>[vec3.h]</kbd> The vec3::near_zero() method</div></center>
<pre class="listing tilde"><code><span class="line"></span><span class="hljs-keyword">class</span> <span class="hljs-title class_">lambertian</span> : <span class="hljs-keyword">public</span> material {
<span class="line"></span>  <span class="hljs-keyword">public</span>:
<span class="line"></span>    <span class="hljs-built_in">lambertian</span>(<span class="hljs-type">const</span> color&amp; a) : <span class="hljs-built_in">albedo</span>(a) {}
<span class="line"></span>
<span class="line"></span>    <span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">scatter</span><span class="hljs-params">(<span class="hljs-type">const</span> ray&amp; r_in, <span class="hljs-type">const</span> hit_record&amp; rec, color&amp; attenuation, ray&amp; scattered)</span>
<span class="line"></span>    <span class="hljs-type">const</span> <span class="hljs-keyword">override</span> </span>{
<span class="line"></span>        <span class="hljs-keyword">auto</span> scatter_direction = rec.normal + <span class="hljs-built_in">random_unit_vector</span>();
<span class="line"></span>
<span class="line"></span><div class=" highlight"><span class="line"></span>        <span class="hljs-comment">// Catch degenerate scatter direction</span>
<span class="line"></span>        <span class="hljs-keyword">if</span> (scatter_direction.<span class="hljs-built_in">near_zero</span>())
<span class="line"></span>            scatter_direction = rec.normal;</div><span class="line"></span>
<span class="line"></span>        scattered = <span class="hljs-built_in">ray</span>(rec.p, scatter_direction);
<span class="line"></span>        attenuation = albedo;
<span class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
<span class="line"></span>    }
<span class="line"></span>
<span class="line"></span>  <span class="hljs-keyword">private</span>:
<span class="line"></span>    color albedo;
<span class="line"></span>};</code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_lambertian-catch-zero">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;58:</b> <kbd>[material.h]</kbd> Lambertian scatter, bullet-proof</div></center>

<a class="target" name="mirroredlightreflection">&nbsp;</a><a class="target" name="metal/mirroredlightreflection">&nbsp;</a><a class="target" name="toc10.4">&nbsp;</a><h2>Mirrored Light Reflection</h2>
<p>

For polished metals the ray won’t be randomly scattered. The key question is: How does a ray get
reflected from a metal mirror? Vector math is our friend here:

</p><p>

  </p><center><div class="image" style=""><a href="https://raytracing.github.io/images/fig-1.15-reflection.jpg" target="_blank"><img class="markdeep" src="Ray%20Tracing%20in%20One%20Weekend_files/fig-1.15-reflection.jpg"></a><center><span class="imagecaption"><a class="target" name="figure_reflection">&nbsp;</a><b style="font-style:normal;">Figure&nbsp;15:</b> Ray reflection</span></center></div></center>

<p></p><p>

The reflected ray direction in red is just <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-120-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;v&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;b&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1263" style="width: 3.682em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.974em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.423em, 1002.94em, 2.501em, -1000em); top: -2.268em; left: 0em;"><span class="mrow" id="MathJax-Span-1264"><span class="texatom" id="MathJax-Span-1265"><span class="mrow" id="MathJax-Span-1266"><span class="mi" id="MathJax-Span-1267" style="font-family: MathJax_Main; font-weight: bold;">v</span></span></span><span class="mo" id="MathJax-Span-1268" style="font-family: MathJax_Main; padding-left: 0.222em;">+</span><span class="mn" id="MathJax-Span-1269" style="font-family: MathJax_Main; padding-left: 0.222em;">2</span><span class="texatom" id="MathJax-Span-1270"><span class="mrow" id="MathJax-Span-1271"><span class="mi" id="MathJax-Span-1272" style="font-family: MathJax_Main; font-weight: bold;">b</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.268em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.164em; border-left: 0px solid; width: 0px; height: 1.087em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">v</mi></mrow><mo>+</mo><mn>2</mn><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">b</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-120">\mathbf{v} + 2\mathbf{b}</script>. In our design, <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-121-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1273" style="width: 0.809em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.655em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.667em, 1000.64em, 2.419em, -1000em); top: -2.268em; left: 0em;"><span class="mrow" id="MathJax-Span-1274"><span class="texatom" id="MathJax-Span-1275"><span class="mrow" id="MathJax-Span-1276"><span class="mi" id="MathJax-Span-1277" style="font-family: MathJax_Main; font-weight: bold;">n</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.268em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.063em; border-left: 0px solid; width: 0px; height: 0.683em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">n</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-121">\mathbf{n}</script>
is a unit vector, but <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-122-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;v&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1278" style="width: 0.759em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.605em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.673em, 1000.58em, 2.422em, -1000em); top: -2.268em; left: 0em;"><span class="mrow" id="MathJax-Span-1279"><span class="texatom" id="MathJax-Span-1280"><span class="mrow" id="MathJax-Span-1281"><span class="mi" id="MathJax-Span-1282" style="font-family: MathJax_Main; font-weight: bold;">v</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.268em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.066em; border-left: 0px solid; width: 0px; height: 0.679em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">v</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-122">\mathbf{v}</script> may not be. The length of <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-123-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;b&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1283" style="width: 0.809em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.655em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.423em, 1000.62em, 2.425em, -1000em); top: -2.268em; left: 0em;"><span class="mrow" id="MathJax-Span-1284"><span class="texatom" id="MathJax-Span-1285"><span class="mrow" id="MathJax-Span-1286"><span class="mi" id="MathJax-Span-1287" style="font-family: MathJax_Main; font-weight: bold;">b</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.268em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.07em; border-left: 0px solid; width: 0px; height: 0.993em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">b</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-123">\mathbf{b}</script> should be <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-124-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;v&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1288" style="width: 2.472em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.966em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.768em, 1001.95em, 2.523em, -1000em); top: -2.369em; left: 0em;"><span class="mrow" id="MathJax-Span-1289"><span class="texatom" id="MathJax-Span-1290"><span class="mrow" id="MathJax-Span-1291"><span class="mi" id="MathJax-Span-1292" style="font-family: MathJax_Main; font-weight: bold;">v</span></span></span><span class="mo" id="MathJax-Span-1293" style="font-family: MathJax_Main; padding-left: 0.222em;">⋅</span><span class="texatom" id="MathJax-Span-1294" style="padding-left: 0.222em;"><span class="mrow" id="MathJax-Span-1295"><span class="mi" id="MathJax-Span-1296" style="font-family: MathJax_Main; font-weight: bold;">n</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.369em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.066em; border-left: 0px solid; width: 0px; height: 0.687em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">v</mi></mrow><mo>⋅</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">n</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-124">\mathbf{v}
\cdot \mathbf{n}</script>. Because <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-125-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;v&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1297" style="width: 0.759em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.605em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.673em, 1000.58em, 2.422em, -1000em); top: -2.268em; left: 0em;"><span class="mrow" id="MathJax-Span-1298"><span class="texatom" id="MathJax-Span-1299"><span class="mrow" id="MathJax-Span-1300"><span class="mi" id="MathJax-Span-1301" style="font-family: MathJax_Main; font-weight: bold;">v</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.268em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.066em; border-left: 0px solid; width: 0px; height: 0.679em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">v</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-125">\mathbf{v}</script> points in, we will need a minus sign, yielding:

</p><pre class="listing tilde"><code><span class="line"></span>...
<span class="line"></span>
<span class="line"></span><span class="hljs-function"><span class="hljs-keyword">inline</span> vec3 <span class="hljs-title">random_on_hemisphere</span><span class="hljs-params">(<span class="hljs-type">const</span> vec3&amp; normal)</span> </span>{
<span class="line"></span>    ...
<span class="line"></span>}
<span class="line"></span>
<span class="line"></span><div class=" Highlight"><span class="line"></span><span class="hljs-function">vec3 <span class="hljs-title">reflect</span><span class="hljs-params">(<span class="hljs-type">const</span> vec3&amp; v, <span class="hljs-type">const</span> vec3&amp; n)</span> </span>{
<span class="line"></span>    <span class="hljs-keyword">return</span> v - <span class="hljs-number">2</span>*<span class="hljs-built_in">dot</span>(v,n)*n;
<span class="line"></span>}</div><span class="line"></span>
<span class="line"></span>...</code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_vec3-reflect">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;59:</b> <kbd>[vec3.h]</kbd> vec3 reflection function</div></center>
<p>


</p><div class="together">
The metal material just reflects rays using that formula:

<p></p><pre class="listing tilde"><code><span class="line"></span>...
<span class="line"></span>
<span class="line"></span><span class="hljs-keyword">class</span> <span class="hljs-title class_">lambertian</span> : <span class="hljs-keyword">public</span> material {
<span class="line"></span>    ...
<span class="line"></span>};
<span class="line"></span>
<span class="line"></span><div class=" Highlight"><span class="line"></span><span class="hljs-keyword">class</span> <span class="hljs-title class_">metal</span> : <span class="hljs-keyword">public</span> material {
<span class="line"></span>  <span class="hljs-keyword">public</span>:
<span class="line"></span>    <span class="hljs-built_in">metal</span>(<span class="hljs-type">const</span> color&amp; a) : <span class="hljs-built_in">albedo</span>(a) {}
<span class="line"></span>
<span class="line"></span>    <span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">scatter</span><span class="hljs-params">(<span class="hljs-type">const</span> ray&amp; r_in, <span class="hljs-type">const</span> hit_record&amp; rec, color&amp; attenuation, ray&amp; scattered)</span>
<span class="line"></span>    <span class="hljs-type">const</span> <span class="hljs-keyword">override</span> </span>{
<span class="line"></span>        vec3 reflected = <span class="hljs-built_in">reflect</span>(<span class="hljs-built_in">unit_vector</span>(r_in.<span class="hljs-built_in">direction</span>()), rec.normal);
<span class="line"></span>        scattered = <span class="hljs-built_in">ray</span>(rec.p, reflected);
<span class="line"></span>        attenuation = albedo;
<span class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
<span class="line"></span>    }
<span class="line"></span>
<span class="line"></span>  <span class="hljs-keyword">private</span>:
<span class="line"></span>    color albedo;
<span class="line"></span>};</div></code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_metal-material">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;60:</b> <kbd>[material.h]</kbd> Metal material with reflectance function</div></center>
<p>


</p></div>

<p></p><p>

</p><div class="together">
We need to modify the <code>ray_color()</code> function for all of our changes:

<p></p><pre class="listing tilde"><code><span class="line"></span>...
<span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"rtweekend.h"</span></span>
<span class="line"></span>
<span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"color.h"</span></span>
<span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"hittable.h"</span></span><div class=" highlight"><span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"material.h"</span></span></div><span class="line"></span>...
<span class="line"></span>
<span class="line"></span><span class="hljs-keyword">class</span> <span class="hljs-title class_">camera</span> {
<span class="line"></span>  ...
<span class="line"></span>  <span class="hljs-keyword">private</span>:
<span class="line"></span>    ...
<span class="line"></span>    <span class="hljs-function">color <span class="hljs-title">ray_color</span><span class="hljs-params">(<span class="hljs-type">const</span> ray&amp; r, <span class="hljs-type">int</span> depth, <span class="hljs-type">const</span> hittable&amp; world)</span> <span class="hljs-type">const</span> </span>{
<span class="line"></span>        hit_record rec;
<span class="line"></span>
<span class="line"></span>        <span class="hljs-comment">// If we've exceeded the ray bounce limit, no more light is gathered.</span>
<span class="line"></span>        <span class="hljs-keyword">if</span> (depth &lt;= <span class="hljs-number">0</span>)
<span class="line"></span>            <span class="hljs-keyword">return</span> <span class="hljs-built_in">color</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);
<span class="line"></span>
<span class="line"></span>        <span class="hljs-keyword">if</span> (world.<span class="hljs-built_in">hit</span>(r, <span class="hljs-built_in">interval</span>(<span class="hljs-number">0.001</span>, infinity), rec)) {<div class=" highlight"><span class="line"></span>            ray scattered;
<span class="line"></span>            color attenuation;
<span class="line"></span>            <span class="hljs-keyword">if</span> (rec.mat-&gt;<span class="hljs-built_in">scatter</span>(r, rec, attenuation, scattered))
<span class="line"></span>                <span class="hljs-keyword">return</span> attenuation * <span class="hljs-built_in">ray_color</span>(scattered, depth<span class="hljs-number">-1</span>, world);
<span class="line"></span>            <span class="hljs-keyword">return</span> <span class="hljs-built_in">color</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);</div><span class="line"></span>        }
<span class="line"></span>
<span class="line"></span>        vec3 unit_direction = <span class="hljs-built_in">unit_vector</span>(r.<span class="hljs-built_in">direction</span>());
<span class="line"></span>        <span class="hljs-keyword">auto</span> a = <span class="hljs-number">0.5</span>*(unit_direction.<span class="hljs-built_in">y</span>() + <span class="hljs-number">1.0</span>);
<span class="line"></span>        <span class="hljs-keyword">return</span> (<span class="hljs-number">1.0</span>-a)*<span class="hljs-built_in">color</span>(<span class="hljs-number">1.0</span>, <span class="hljs-number">1.0</span>, <span class="hljs-number">1.0</span>) + a*<span class="hljs-built_in">color</span>(<span class="hljs-number">0.5</span>, <span class="hljs-number">0.7</span>, <span class="hljs-number">1.0</span>);
<span class="line"></span>    }
<span class="line"></span>};</code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_ray-color-scatter">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;61:</b> <kbd>[camera.h]</kbd> Ray color with scattered reflectance</div></center>
<p>


</p></div>

<p></p>
<a class="target" name="ascenewithmetalspheres">&nbsp;</a><a class="target" name="metal/ascenewithmetalspheres">&nbsp;</a><a class="target" name="toc10.5">&nbsp;</a><h2>A Scene with Metal Spheres</h2>
<p>

Now let’s add some metal spheres to our scene:

</p><pre class="listing tilde"><code><span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"rtweekend.h"</span></span>
<span class="line"></span>
<span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"camera.h"</span></span><div class=" highlight"><span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"color.h"</span></span></div><span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"hittable_list.h"</span></span><div class=" highlight"><span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"material.h"</span></span></div><span class="line"></span><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"sphere.h"</span></span>
<span class="line"></span>
<span class="line"></span><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
<span class="line"></span>    hittable_list world;
<span class="line"></span>
<span class="line"></span><div class=" highlight"><span class="line"></span>    <span class="hljs-keyword">auto</span> material_ground = <span class="hljs-built_in">make_shared</span>&lt;lambertian&gt;(<span class="hljs-built_in">color</span>(<span class="hljs-number">0.8</span>, <span class="hljs-number">0.8</span>, <span class="hljs-number">0.0</span>));
<span class="line"></span>    <span class="hljs-keyword">auto</span> material_center = <span class="hljs-built_in">make_shared</span>&lt;lambertian&gt;(<span class="hljs-built_in">color</span>(<span class="hljs-number">0.7</span>, <span class="hljs-number">0.3</span>, <span class="hljs-number">0.3</span>));
<span class="line"></span>    <span class="hljs-keyword">auto</span> material_left   = <span class="hljs-built_in">make_shared</span>&lt;metal&gt;(<span class="hljs-built_in">color</span>(<span class="hljs-number">0.8</span>, <span class="hljs-number">0.8</span>, <span class="hljs-number">0.8</span>));
<span class="line"></span>    <span class="hljs-keyword">auto</span> material_right  = <span class="hljs-built_in">make_shared</span>&lt;metal&gt;(<span class="hljs-built_in">color</span>(<span class="hljs-number">0.8</span>, <span class="hljs-number">0.6</span>, <span class="hljs-number">0.2</span>));
<span class="line"></span>
<span class="line"></span>    world.<span class="hljs-built_in">add</span>(<span class="hljs-built_in">make_shared</span>&lt;sphere&gt;(<span class="hljs-built_in">point3</span>( <span class="hljs-number">0.0</span>, <span class="hljs-number">-100.5</span>, <span class="hljs-number">-1.0</span>), <span class="hljs-number">100.0</span>, material_ground));
<span class="line"></span>    world.<span class="hljs-built_in">add</span>(<span class="hljs-built_in">make_shared</span>&lt;sphere&gt;(<span class="hljs-built_in">point3</span>( <span class="hljs-number">0.0</span>,    <span class="hljs-number">0.0</span>, <span class="hljs-number">-1.0</span>),   <span class="hljs-number">0.5</span>, material_center));
<span class="line"></span>    world.<span class="hljs-built_in">add</span>(<span class="hljs-built_in">make_shared</span>&lt;sphere&gt;(<span class="hljs-built_in">point3</span>(<span class="hljs-number">-1.0</span>,    <span class="hljs-number">0.0</span>, <span class="hljs-number">-1.0</span>),   <span class="hljs-number">0.5</span>, material_left));
<span class="line"></span>    world.<span class="hljs-built_in">add</span>(<span class="hljs-built_in">make_shared</span>&lt;sphere&gt;(<span class="hljs-built_in">point3</span>( <span class="hljs-number">1.0</span>,    <span class="hljs-number">0.0</span>, <span class="hljs-number">-1.0</span>),   <span class="hljs-number">0.5</span>, material_right));</div><span class="line"></span>
<span class="line"></span>    camera cam;
<span class="line"></span>
<span class="line"></span>    cam.aspect_ratio      = <span class="hljs-number">16.0</span> / <span class="hljs-number">9.0</span>;
<span class="line"></span>    cam.image_width       = <span class="hljs-number">400</span>;
<span class="line"></span>    cam.samples_per_pixel = <span class="hljs-number">100</span>;
<span class="line"></span>    cam.max_depth         = <span class="hljs-number">50</span>;
<span class="line"></span>
<span class="line"></span>    cam.<span class="hljs-built_in">render</span>(world);
<span class="line"></span>}</code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_scene-with-metal">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;62:</b> <kbd>[main.cc]</kbd> Scene with metal spheres</div></center>
<p>


</p><div class="together">
Which gives:

<p></p><p>

  </p><center><div class="image" style=""><a href="https://raytracing.github.io/images/img-1.13-metal-shiny.png" target="_blank"><img class="markdeep pixel" src="Ray%20Tracing%20in%20One%20Weekend_files/img-1.13-metal-shiny.png"></a><center><span class="imagecaption"><span class="num">Image 13:</span> Shiny metal
  </span></center></div></center>

<p></p><p>

</p></div>

<p></p>
<a class="target" name="fuzzyreflection">&nbsp;</a><a class="target" name="metal/fuzzyreflection">&nbsp;</a><a class="target" name="toc10.6">&nbsp;</a><h2>Fuzzy Reflection</h2>
<p>

We can also randomize the reflected direction by using a small sphere and choosing a new endpoint
for the ray.
We'll use a random point from the surface of a sphere centered on the original endpoint, scaled by
the fuzz factor.

</p><p>

  </p><center><div class="image" style=""><a href="https://raytracing.github.io/images/fig-1.16-reflect-fuzzy.jpg" target="_blank"><img class="markdeep" src="Ray%20Tracing%20in%20One%20Weekend_files/fig-1.16-reflect-fuzzy.jpg"></a><center><span class="imagecaption"><a class="target" name="figure_reflect-fuzzy">&nbsp;</a><b style="font-style:normal;">Figure&nbsp;16:</b> Generating fuzzed reflection rays</span></center></div></center>

<p></p><p>

The bigger the sphere, the fuzzier the reflections will be. This suggests adding a fuzziness
parameter that is just the radius of the sphere (so zero is no perturbation). The catch is that for
big spheres or grazing rays, we may scatter below the surface. We can just have the surface
absorb those.

</p><pre class="listing tilde"><code><span class="line"></span><span class="hljs-keyword">class</span> <span class="hljs-title class_">metal</span> : <span class="hljs-keyword">public</span> material {
<span class="line"></span>  <span class="hljs-keyword">public</span>:<div class=" highlight"><span class="line"></span>    <span class="hljs-built_in">metal</span>(<span class="hljs-type">const</span> color&amp; a, <span class="hljs-type">double</span> f) : <span class="hljs-built_in">albedo</span>(a), <span class="hljs-built_in">fuzz</span>(f &lt; <span class="hljs-number">1</span> ? f : <span class="hljs-number">1</span>) {}</div><span class="line"></span>
<span class="line"></span>    <span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">scatter</span><span class="hljs-params">(<span class="hljs-type">const</span> ray&amp; r_in, <span class="hljs-type">const</span> hit_record&amp; rec, color&amp; attenuation, ray&amp; scattered)</span>
<span class="line"></span>    <span class="hljs-type">const</span> <span class="hljs-keyword">override</span> </span>{
<span class="line"></span>        vec3 reflected = <span class="hljs-built_in">reflect</span>(<span class="hljs-built_in">unit_vector</span>(r_in.<span class="hljs-built_in">direction</span>()), rec.normal);<div class=" highlight"><span class="line"></span>        scattered = <span class="hljs-built_in">ray</span>(rec.p, reflected + fuzz*<span class="hljs-built_in">random_unit_vector</span>());</div><span class="line"></span>        attenuation = albedo;<div class=" highlight"><span class="line"></span>        <span class="hljs-keyword">return</span> (<span class="hljs-built_in">dot</span>(scattered.<span class="hljs-built_in">direction</span>(), rec.normal) &gt; <span class="hljs-number">0</span>);</div><span class="line"></span>    }
<span class="line"></span>
<span class="line"></span>  <span class="hljs-keyword">private</span>:
<span class="line"></span>    color albedo;<div class=" highlight"><span class="line"></span>    <span class="hljs-type">double</span> fuzz;</div><span class="line"></span>};</code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_metal-fuzz">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;63:</b> <kbd>[material.h]</kbd> Metal material fuzziness</div></center>
<p>


</p><div class="together">
We can try that out by adding fuzziness 0.3 and 1.0 to the metals:

<p></p><pre class="listing tilde"><code><span class="line"></span><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
<span class="line"></span>    ...
<span class="line"></span>    <span class="hljs-keyword">auto</span> material_ground = <span class="hljs-built_in">make_shared</span>&lt;lambertian&gt;(<span class="hljs-built_in">color</span>(<span class="hljs-number">0.8</span>, <span class="hljs-number">0.8</span>, <span class="hljs-number">0.0</span>));
<span class="line"></span>    <span class="hljs-keyword">auto</span> material_center = <span class="hljs-built_in">make_shared</span>&lt;lambertian&gt;(<span class="hljs-built_in">color</span>(<span class="hljs-number">0.7</span>, <span class="hljs-number">0.3</span>, <span class="hljs-number">0.3</span>));<div class=" highlight"><span class="line"></span>    <span class="hljs-keyword">auto</span> material_left   = <span class="hljs-built_in">make_shared</span>&lt;metal&gt;(<span class="hljs-built_in">color</span>(<span class="hljs-number">0.8</span>, <span class="hljs-number">0.8</span>, <span class="hljs-number">0.8</span>), <span class="hljs-number">0.3</span>);
<span class="line"></span>    <span class="hljs-keyword">auto</span> material_right  = <span class="hljs-built_in">make_shared</span>&lt;metal&gt;(<span class="hljs-built_in">color</span>(<span class="hljs-number">0.8</span>, <span class="hljs-number">0.6</span>, <span class="hljs-number">0.2</span>), <span class="hljs-number">1.0</span>);</div><span class="line"></span>    ...
<span class="line"></span>}</code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_metal-fuzz-spheres">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;64:</b> <kbd>[main.cc]</kbd> Metal spheres with fuzziness</div></center>
<p>


  </p><center><div class="image" style=""><a href="https://raytracing.github.io/images/img-1.14-metal-fuzz.png" target="_blank"><img class="markdeep pixel" src="Ray%20Tracing%20in%20One%20Weekend_files/img-1.14-metal-fuzz.png"></a><center><span class="imagecaption"><span class="num">Image 14:</span> Fuzzed metal
  </span></center></div></center>

<p></p><p>

</p></div>

<p></p>
<a class="target" name="dielectrics">&nbsp;</a><a class="target" name="dielectrics">&nbsp;</a><a class="target" name="toc11">&nbsp;</a><h1>Dielectrics</h1>
<p>

Clear materials such as water, glass, and diamond are dielectrics. When a light ray hits them, it
splits into a reflected ray and a refracted (transmitted) ray. We’ll handle that by randomly
choosing between reflection and refraction, only generating one scattered ray per interaction.

</p>
<a class="target" name="refraction">&nbsp;</a><a class="target" name="dielectrics/refraction">&nbsp;</a><a class="target" name="toc11.1">&nbsp;</a><h2>Refraction</h2>
<p>

The hardest part to debug is the refracted ray. I usually first just have all the light refract if
there is a refraction ray at all. For this project, I tried to put two glass balls in our scene, and
I got this (I have not told you how to do this right or wrong yet, but soon!):

</p><p>

  </p><center><div class="image" style=""><a href="https://raytracing.github.io/images/img-1.15-glass-first.png" target="_blank"><img class="markdeep pixel" src="Ray%20Tracing%20in%20One%20Weekend_files/img-1.15-glass-first.png"></a><center><span class="imagecaption"><span class="num">Image 15:</span> Glass first
  </span></center></div></center>

<p></p><p>

Is that right? Glass balls look odd in real life. But no, it isn’t right. The world should be
flipped upside down and no weird black stuff. I just printed out the ray straight through the middle
of the image and it was clearly wrong. That often does the job.

</p>
<a class="target" name="snell'slaw">&nbsp;</a><a class="target" name="dielectrics/snell'slaw">&nbsp;</a><a class="target" name="toc11.2">&nbsp;</a><h2>Snell's Law</h2>
<p>

The refraction is described by Snell’s law:

</p><p>

  <span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-126-Frame" tabindex="0" style="text-align: center; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mi&gt;&amp;#x03B7;&lt;/mi&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mi&gt;sin&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;&amp;#x03B7;&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mi&gt;sin&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1302" style="width: 10.083em; display: inline-block;"><span style="display: inline-block; position: relative; width: 8.115em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.459em, 1008.12em, 2.787em, -1000em); top: -2.419em; left: 0em;"><span class="mrow" id="MathJax-Span-1303"><span class="mi" id="MathJax-Span-1304" style="font-family: MathJax_Math; font-style: italic;">η<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.006em;"></span></span><span class="mo" id="MathJax-Span-1305" style="font-family: MathJax_Main; padding-left: 0.222em;">⋅</span><span class="mi" id="MathJax-Span-1306" style="font-family: MathJax_Main; padding-left: 0.222em;">sin</span><span class="mo" id="MathJax-Span-1307"></span><span class="mi" id="MathJax-Span-1308" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.167em;">θ</span><span class="mo" id="MathJax-Span-1309" style="font-family: MathJax_Main; padding-left: 0.278em;">=</span><span class="msup" id="MathJax-Span-1310" style="padding-left: 0.278em;"><span style="display: inline-block; position: relative; width: 0.824em; height: 0px;"><span style="position: absolute; clip: rect(3.389em, 1000.5em, 4.349em, -1000em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-1311" style="font-family: MathJax_Math; font-style: italic;">η<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.006em;"></span></span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; top: -4.395em; left: 0.555em;"><span class="mo" id="MathJax-Span-1312" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span></span><span class="mo" id="MathJax-Span-1313" style="font-family: MathJax_Main; padding-left: 0.222em;">⋅</span><span class="mi" id="MathJax-Span-1314" style="font-family: MathJax_Main; padding-left: 0.222em;">sin</span><span class="mo" id="MathJax-Span-1315"></span><span class="msup" id="MathJax-Span-1316" style="padding-left: 0.167em;"><span style="display: inline-block; position: relative; width: 0.738em; height: 0px;"><span style="position: absolute; clip: rect(3.126em, 1000.46em, 4.143em, -1000em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-1317" style="font-family: MathJax_Math; font-style: italic;">θ</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; top: -4.395em; left: 0.469em;"><span class="mo" id="MathJax-Span-1318" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.419em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.33em; border-left: 0px solid; width: 0px; height: 1.396em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>η</mi><mo>⋅</mo><mi>sin</mi><mo>⁡</mo><mi>θ</mi><mo>=</mo><msup><mi>η</mi><mo>′</mo></msup><mo>⋅</mo><mi>sin</mi><mo>⁡</mo><msup><mi>θ</mi><mo>′</mo></msup></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-126"> \eta \cdot \sin\theta = \eta' \cdot \sin\theta' </script>

</p><p>

Where <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-127-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1319" style="width: 0.557em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.454em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.362em, 1000.45em, 2.379em, -1000em); top: -2.218em; left: 0em;"><span class="mrow" id="MathJax-Span-1320"><span class="mi" id="MathJax-Span-1321" style="font-family: MathJax_Math; font-style: italic;">θ</span></span><span style="display: inline-block; width: 0px; height: 2.218em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.075em; border-left: 0px solid; width: 0px; height: 1.012em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>θ</mi></math></span></span><script type="math/tex" id="MathJax-Element-127">\theta</script> and <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-128-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msup&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1322" style="width: 0.96em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.756em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(0.098em, 1000.76em, 1.169em, -1000em); top: -1.008em; left: 0em;"><span class="mrow" id="MathJax-Span-1323"><span class="msup" id="MathJax-Span-1324"><span style="display: inline-block; position: relative; width: 0.738em; height: 0px;"><span style="position: absolute; clip: rect(3.126em, 1000.46em, 4.143em, -1000em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-1325" style="font-family: MathJax_Math; font-style: italic;">θ</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; top: -4.345em; left: 0.469em;"><span class="mo" id="MathJax-Span-1326" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 1.008em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.075em; border-left: 0px solid; width: 0px; height: 1.078em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mi>θ</mi><mo>′</mo></msup></math></span></span><script type="math/tex" id="MathJax-Element-128">\theta'</script> are the angles from the normal, and <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-129-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;&amp;#x03B7;&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1327" style="width: 0.658em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.504em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.625em, 1000.5em, 2.585em, -1000em); top: -2.218em; left: 0em;"><span class="mrow" id="MathJax-Span-1328"><span class="mi" id="MathJax-Span-1329" style="font-family: MathJax_Math; font-style: italic;">η<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.006em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.218em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.33em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>η</mi></math></span></span><script type="math/tex" id="MathJax-Element-129">\eta</script> and <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-130-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msup&gt;&lt;mi&gt;&amp;#x03B7;&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1330" style="width: 1.011em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.806em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(0.098em, 1000.81em, 1.375em, -1000em); top: -1.008em; left: 0em;"><span class="mrow" id="MathJax-Span-1331"><span class="msup" id="MathJax-Span-1332"><span style="display: inline-block; position: relative; width: 0.824em; height: 0px;"><span style="position: absolute; clip: rect(3.389em, 1000.5em, 4.349em, -1000em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-1333" style="font-family: MathJax_Math; font-style: italic;">η<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.006em;"></span></span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; top: -4.345em; left: 0.555em;"><span class="mo" id="MathJax-Span-1334" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 1.008em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.33em; border-left: 0px solid; width: 0px; height: 1.334em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mi>η</mi><mo>′</mo></msup></math></span></span><script type="math/tex" id="MathJax-Element-130">\eta'</script> (pronounced
“eta” and “eta prime”) are the refractive indices (typically air = 1.0, glass = 1.3–1.7, diamond =
2.4). The geometry is:

</p><p>

  </p><center><div class="image" style=""><a href="https://raytracing.github.io/images/fig-1.17-refraction.jpg" target="_blank"><img class="markdeep" src="Ray%20Tracing%20in%20One%20Weekend_files/fig-1.17-refraction.jpg"></a><center><span class="imagecaption"><a class="target" name="figure_refraction">&nbsp;</a><b style="font-style:normal;">Figure&nbsp;17:</b> Ray refraction</span></center></div></center>

<p></p><p>

In order to determine the direction of the refracted ray, we have to solve for <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-131-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;sin&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1335" style="width: 2.623em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.117em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.459em, 1002.12em, 2.531em, -1000em); top: -2.369em; left: 0em;"><span class="mrow" id="MathJax-Span-1336"><span class="mi" id="MathJax-Span-1337" style="font-family: MathJax_Main;">sin</span><span class="mo" id="MathJax-Span-1338"></span><span class="msup" id="MathJax-Span-1339" style="padding-left: 0.167em;"><span style="display: inline-block; position: relative; width: 0.738em; height: 0px;"><span style="position: absolute; clip: rect(3.126em, 1000.46em, 4.143em, -1000em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-1340" style="font-family: MathJax_Math; font-style: italic;">θ</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; top: -4.345em; left: 0.469em;"><span class="mo" id="MathJax-Span-1341" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.369em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.076em; border-left: 0px solid; width: 0px; height: 1.08em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>sin</mi><mo>⁡</mo><msup><mi>θ</mi><mo>′</mo></msup></math></span></span><script type="math/tex" id="MathJax-Element-131">\sin\theta'</script>:

</p><p>

  <span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-132-Frame" tabindex="0" style="text-align: center; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mi&gt;sin&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mfrac&gt;&lt;mi&gt;&amp;#x03B7;&lt;/mi&gt;&lt;msup&gt;&lt;mi&gt;&amp;#x03B7;&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;/mfrac&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mi&gt;sin&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1342" style="width: 9.025em; display: inline-block;"><span style="display: inline-block; position: relative; width: 7.258em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.144em, 1007.25em, 3.473em, -1000em); top: -2.419em; left: 0em;"><span class="mrow" id="MathJax-Span-1343"><span class="mi" id="MathJax-Span-1344" style="font-family: MathJax_Main;">sin</span><span class="mo" id="MathJax-Span-1345"></span><span class="msup" id="MathJax-Span-1346" style="padding-left: 0.167em;"><span style="display: inline-block; position: relative; width: 0.738em; height: 0px;"><span style="position: absolute; clip: rect(3.126em, 1000.46em, 4.143em, -1000em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-1347" style="font-family: MathJax_Math; font-style: italic;">θ</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; top: -4.395em; left: 0.469em;"><span class="mo" id="MathJax-Span-1348" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span></span><span class="mo" id="MathJax-Span-1349" style="font-family: MathJax_Main; padding-left: 0.278em;">=</span><span class="mfrac" id="MathJax-Span-1350" style="padding-left: 0.278em;"><span style="display: inline-block; position: relative; width: 0.944em; height: 0px; margin-right: 0.12em; margin-left: 0.12em;"><span style="position: absolute; clip: rect(3.389em, 1000.5em, 4.349em, -1000em); top: -4.664em; left: 50%; margin-left: -0.252em;"><span class="mi" id="MathJax-Span-1351" style="font-family: MathJax_Math; font-style: italic;">η<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.006em;"></span></span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; clip: rect(3.146em, 1000.82em, 4.349em, -1000em); top: -3.296em; left: 50%; margin-left: -0.412em;"><span class="msup" id="MathJax-Span-1352"><span style="display: inline-block; position: relative; width: 0.824em; height: 0px;"><span style="position: absolute; clip: rect(3.389em, 1000.5em, 4.349em, -1000em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-1353" style="font-family: MathJax_Math; font-style: italic;">η<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.006em;"></span></span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; top: -4.271em; left: 0.555em;"><span class="mo" id="MathJax-Span-1354" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; clip: rect(0.844em, 1000.94em, 1.21em, -1000em); top: -1.278em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 0.944em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.058em;"></span></span></span></span><span class="mo" id="MathJax-Span-1355" style="font-family: MathJax_Main; padding-left: 0.222em;">⋅</span><span class="mi" id="MathJax-Span-1356" style="font-family: MathJax_Main; padding-left: 0.222em;">sin</span><span class="mo" id="MathJax-Span-1357"></span><span class="mi" id="MathJax-Span-1358" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.167em;">θ</span></span><span style="display: inline-block; width: 0px; height: 2.419em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.181em; border-left: 0px solid; width: 0px; height: 2.637em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>sin</mi><mo>⁡</mo><msup><mi>θ</mi><mo>′</mo></msup><mo>=</mo><mfrac><mi>η</mi><msup><mi>η</mi><mo>′</mo></msup></mfrac><mo>⋅</mo><mi>sin</mi><mo>⁡</mo><mi>θ</mi></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-132"> \sin\theta' = \frac{\eta}{\eta'} \cdot \sin\theta </script>

</p><p>

On the refracted side of the surface there is a refracted ray <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-133-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;msup&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;R&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1359" style="width: 1.414em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.109em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(0.098em, 1001.11em, 1.17em, -1000em); top: -1.008em; left: 0em;"><span class="mrow" id="MathJax-Span-1360"><span class="texatom" id="MathJax-Span-1361"><span class="mrow" id="MathJax-Span-1362"><span class="msup" id="MathJax-Span-1363"><span style="display: inline-block; position: relative; width: 1.131em; height: 0px;"><span style="position: absolute; clip: rect(3.145em, 1000.86em, 4.144em, -1000em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-1364" style="font-family: MathJax_Main; font-weight: bold;">R</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; top: -4.345em; left: 0.862em;"><span class="mo" id="MathJax-Span-1365" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 1.008em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.076em; border-left: 0px solid; width: 0px; height: 1.08em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><msup><mi mathvariant="bold">R</mi><mo>′</mo></msup></mrow></math></span></span><script type="math/tex" id="MathJax-Element-133">\mathbf{R'}</script> and a normal
<span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-134-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;msup&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;n&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1366" style="width: 1.162em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.907em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(0.098em, 1000.91em, 1.159em, -1000em); top: -1.008em; left: 0em;"><span class="mrow" id="MathJax-Span-1367"><span class="texatom" id="MathJax-Span-1368"><span class="mrow" id="MathJax-Span-1369"><span class="msup" id="MathJax-Span-1370"><span style="display: inline-block; position: relative; width: 0.908em; height: 0px;"><span style="position: absolute; clip: rect(3.381em, 1000.62em, 4.133em, -1000em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-1371" style="font-family: MathJax_Main; font-weight: bold;">n</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; top: -4.345em; left: 0.639em;"><span class="mo" id="MathJax-Span-1372" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 1.008em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.063em; border-left: 0px solid; width: 0px; height: 1.066em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><msup><mi mathvariant="bold">n</mi><mo>′</mo></msup></mrow></math></span></span><script type="math/tex" id="MathJax-Element-134">\mathbf{n'}</script>, and there exists an angle, <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-135-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msup&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1373" style="width: 0.96em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.756em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(0.098em, 1000.76em, 1.169em, -1000em); top: -1.008em; left: 0em;"><span class="mrow" id="MathJax-Span-1374"><span class="msup" id="MathJax-Span-1375"><span style="display: inline-block; position: relative; width: 0.738em; height: 0px;"><span style="position: absolute; clip: rect(3.126em, 1000.46em, 4.143em, -1000em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-1376" style="font-family: MathJax_Math; font-style: italic;">θ</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; top: -4.345em; left: 0.469em;"><span class="mo" id="MathJax-Span-1377" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 1.008em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.075em; border-left: 0px solid; width: 0px; height: 1.078em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mi>θ</mi><mo>′</mo></msup></math></span></span><script type="math/tex" id="MathJax-Element-135">\theta'</script>, between them. We can split <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-136-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;msup&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;R&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1378" style="width: 1.414em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.109em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(0.098em, 1001.11em, 1.17em, -1000em); top: -1.008em; left: 0em;"><span class="mrow" id="MathJax-Span-1379"><span class="texatom" id="MathJax-Span-1380"><span class="mrow" id="MathJax-Span-1381"><span class="msup" id="MathJax-Span-1382"><span style="display: inline-block; position: relative; width: 1.131em; height: 0px;"><span style="position: absolute; clip: rect(3.145em, 1000.86em, 4.144em, -1000em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-1383" style="font-family: MathJax_Main; font-weight: bold;">R</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; top: -4.345em; left: 0.862em;"><span class="mo" id="MathJax-Span-1384" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 1.008em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.076em; border-left: 0px solid; width: 0px; height: 1.08em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><msup><mi mathvariant="bold">R</mi><mo>′</mo></msup></mrow></math></span></span><script type="math/tex" id="MathJax-Element-136">\mathbf{R'}</script> into
the parts of the ray that are perpendicular to <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-137-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;msup&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;n&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1385" style="width: 1.162em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.907em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(0.098em, 1000.91em, 1.159em, -1000em); top: -1.008em; left: 0em;"><span class="mrow" id="MathJax-Span-1386"><span class="texatom" id="MathJax-Span-1387"><span class="mrow" id="MathJax-Span-1388"><span class="msup" id="MathJax-Span-1389"><span style="display: inline-block; position: relative; width: 0.908em; height: 0px;"><span style="position: absolute; clip: rect(3.381em, 1000.62em, 4.133em, -1000em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-1390" style="font-family: MathJax_Main; font-weight: bold;">n</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; top: -4.345em; left: 0.639em;"><span class="mo" id="MathJax-Span-1391" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 1.008em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.063em; border-left: 0px solid; width: 0px; height: 1.066em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><msup><mi mathvariant="bold">n</mi><mo>′</mo></msup></mrow></math></span></span><script type="math/tex" id="MathJax-Element-137">\mathbf{n'}</script> and parallel to <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-138-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;msup&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;n&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1392" style="width: 1.162em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.907em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(0.098em, 1000.91em, 1.159em, -1000em); top: -1.008em; left: 0em;"><span class="mrow" id="MathJax-Span-1393"><span class="texatom" id="MathJax-Span-1394"><span class="mrow" id="MathJax-Span-1395"><span class="msup" id="MathJax-Span-1396"><span style="display: inline-block; position: relative; width: 0.908em; height: 0px;"><span style="position: absolute; clip: rect(3.381em, 1000.62em, 4.133em, -1000em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-1397" style="font-family: MathJax_Main; font-weight: bold;">n</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; top: -4.345em; left: 0.639em;"><span class="mo" id="MathJax-Span-1398" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 1.008em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.063em; border-left: 0px solid; width: 0px; height: 1.066em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><msup><mi mathvariant="bold">n</mi><mo>′</mo></msup></mrow></math></span></span><script type="math/tex" id="MathJax-Element-138">\mathbf{n'}</script>:

</p><p>

  <span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-139-Frame" tabindex="0" style="text-align: center; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;msup&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;R&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;/mrow&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msub&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;msup&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;R&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;&amp;#x22A5;&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;msub&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;msup&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;R&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;&amp;#x2225;&lt;/mo&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1399" style="width: 8.722em; display: inline-block;"><span style="display: inline-block; position: relative; width: 7.006em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.409em, 1007.01em, 2.883em, -1000em); top: -2.369em; left: 0em;"><span class="mrow" id="MathJax-Span-1400"><span class="texatom" id="MathJax-Span-1401"><span class="mrow" id="MathJax-Span-1402"><span class="msup" id="MathJax-Span-1403"><span style="display: inline-block; position: relative; width: 1.131em; height: 0px;"><span style="position: absolute; clip: rect(3.145em, 1000.86em, 4.144em, -1000em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-1404" style="font-family: MathJax_Main; font-weight: bold;">R</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; top: -4.395em; left: 0.862em;"><span class="mo" id="MathJax-Span-1405" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span></span></span></span><span class="mo" id="MathJax-Span-1406" style="font-family: MathJax_Main; padding-left: 0.278em;">=</span><span class="msubsup" id="MathJax-Span-1407" style="padding-left: 0.278em;"><span style="display: inline-block; position: relative; width: 1.757em; height: 0px;"><span style="position: absolute; clip: rect(3.022em, 1001.13em, 4.144em, -1000em); top: -3.982em; left: 0em;"><span class="texatom" id="MathJax-Span-1408"><span class="mrow" id="MathJax-Span-1409"><span class="msup" id="MathJax-Span-1410"><span style="display: inline-block; position: relative; width: 1.131em; height: 0px;"><span style="position: absolute; clip: rect(3.145em, 1000.86em, 4.144em, -1000em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-1411" style="font-family: MathJax_Main; font-weight: bold;">R</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; top: -4.395em; left: 0.862em;"><span class="mo" id="MathJax-Span-1412" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; top: -3.832em; left: 1.131em;"><span class="texatom" id="MathJax-Span-1413"><span class="mrow" id="MathJax-Span-1414"><span class="mi" id="MathJax-Span-1415" style="font-size: 70.7%; font-family: MathJax_Main;">⊥</span></span></span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span></span><span class="mo" id="MathJax-Span-1416" style="font-family: MathJax_Main; padding-left: 0.222em;">+</span><span class="msubsup" id="MathJax-Span-1417" style="padding-left: 0.222em;"><span style="display: inline-block; position: relative; width: 1.56em; height: 0px;"><span style="position: absolute; clip: rect(3.022em, 1001.13em, 4.144em, -1000em); top: -3.982em; left: 0em;"><span class="texatom" id="MathJax-Span-1418"><span class="mrow" id="MathJax-Span-1419"><span class="msup" id="MathJax-Span-1420"><span style="display: inline-block; position: relative; width: 1.131em; height: 0px;"><span style="position: absolute; clip: rect(3.145em, 1000.86em, 4.144em, -1000em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-1421" style="font-family: MathJax_Main; font-weight: bold;">R</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; top: -4.395em; left: 0.862em;"><span class="mo" id="MathJax-Span-1422" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; top: -3.796em; left: 1.131em;"><span class="texatom" id="MathJax-Span-1423"><span class="mrow" id="MathJax-Span-1424"><span class="mo" id="MathJax-Span-1425" style="font-size: 70.7%; font-family: MathJax_Main;">∥</span></span></span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.369em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.512em; border-left: 0px solid; width: 0px; height: 1.578em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow class="MJX-TeXAtom-ORD"><msup><mi mathvariant="bold">R</mi><mo>′</mo></msup></mrow><mo>=</mo><msub><mrow class="MJX-TeXAtom-ORD"><msup><mi mathvariant="bold">R</mi><mo>′</mo></msup></mrow><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="normal">⊥</mi></mrow></msub><mo>+</mo><msub><mrow class="MJX-TeXAtom-ORD"><msup><mi mathvariant="bold">R</mi><mo>′</mo></msup></mrow><mrow class="MJX-TeXAtom-ORD"><mo>∥</mo></mrow></msub></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-139"> \mathbf{R'} = \mathbf{R'}_{\bot} + \mathbf{R'}_{\parallel} </script>

</p><p>

If we solve for <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-140-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;msup&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;R&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;&amp;#x22A5;&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1426" style="width: 2.22em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.764em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(0.098em, 1001.76em, 1.309em, -1000em); top: -1.008em; left: 0em;"><span class="mrow" id="MathJax-Span-1427"><span class="msubsup" id="MathJax-Span-1428"><span style="display: inline-block; position: relative; width: 1.757em; height: 0px;"><span style="position: absolute; clip: rect(3.072em, 1001.13em, 4.144em, -1000em); top: -3.982em; left: 0em;"><span class="texatom" id="MathJax-Span-1429"><span class="mrow" id="MathJax-Span-1430"><span class="msup" id="MathJax-Span-1431"><span style="display: inline-block; position: relative; width: 1.131em; height: 0px;"><span style="position: absolute; clip: rect(3.145em, 1000.86em, 4.144em, -1000em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-1432" style="font-family: MathJax_Main; font-weight: bold;">R</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; top: -4.345em; left: 0.862em;"><span class="mo" id="MathJax-Span-1433" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; top: -3.832em; left: 1.131em;"><span class="texatom" id="MathJax-Span-1434"><span class="mrow" id="MathJax-Span-1435"><span class="mi" id="MathJax-Span-1436" style="font-size: 70.7%; font-family: MathJax_Main;">⊥</span></span></span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 1.008em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.248em; border-left: 0px solid; width: 0px; height: 1.252em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mrow class="MJX-TeXAtom-ORD"><msup><mi mathvariant="bold">R</mi><mo>′</mo></msup></mrow><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="normal">⊥</mi></mrow></msub></math></span></span><script type="math/tex" id="MathJax-Element-140">\mathbf{R'}_{\bot}</script> and <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-141-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;msup&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;R&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;&amp;#x2225;&lt;/mo&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1437" style="width: 1.968em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.563em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(0.098em, 1001.56em, 1.522em, -1000em); top: -1.008em; left: 0em;"><span class="mrow" id="MathJax-Span-1438"><span class="msubsup" id="MathJax-Span-1439"><span style="display: inline-block; position: relative; width: 1.56em; height: 0px;"><span style="position: absolute; clip: rect(3.072em, 1001.13em, 4.144em, -1000em); top: -3.982em; left: 0em;"><span class="texatom" id="MathJax-Span-1440"><span class="mrow" id="MathJax-Span-1441"><span class="msup" id="MathJax-Span-1442"><span style="display: inline-block; position: relative; width: 1.131em; height: 0px;"><span style="position: absolute; clip: rect(3.145em, 1000.86em, 4.144em, -1000em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-1443" style="font-family: MathJax_Main; font-weight: bold;">R</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; top: -4.345em; left: 0.862em;"><span class="mo" id="MathJax-Span-1444" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; top: -3.796em; left: 1.131em;"><span class="texatom" id="MathJax-Span-1445"><span class="mrow" id="MathJax-Span-1446"><span class="mo" id="MathJax-Span-1447" style="font-size: 70.7%; font-family: MathJax_Main;">∥</span></span></span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 1.008em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.512em; border-left: 0px solid; width: 0px; height: 1.516em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mrow class="MJX-TeXAtom-ORD"><msup><mi mathvariant="bold">R</mi><mo>′</mo></msup></mrow><mrow class="MJX-TeXAtom-ORD"><mo>∥</mo></mrow></msub></math></span></span><script type="math/tex" id="MathJax-Element-141">\mathbf{R'}_{\parallel}</script> we get:

</p><p>

  <span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-142-Frame" tabindex="0" style="text-align: center; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;msub&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;msup&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;R&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;&amp;#x22A5;&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mfrac&gt;&lt;mi&gt;&amp;#x03B7;&lt;/mi&gt;&lt;msup&gt;&lt;mi&gt;&amp;#x03B7;&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;/mfrac&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;R&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;cos&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1448" style="width: 12.099em; display: inline-block;"><span style="display: inline-block; position: relative; width: 9.728em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.144em, 1009.63em, 3.473em, -1000em); top: -2.419em; left: 0em;"><span class="mrow" id="MathJax-Span-1449"><span class="msubsup" id="MathJax-Span-1450"><span style="display: inline-block; position: relative; width: 1.757em; height: 0px;"><span style="position: absolute; clip: rect(3.022em, 1001.13em, 4.144em, -1000em); top: -3.982em; left: 0em;"><span class="texatom" id="MathJax-Span-1451"><span class="mrow" id="MathJax-Span-1452"><span class="msup" id="MathJax-Span-1453"><span style="display: inline-block; position: relative; width: 1.131em; height: 0px;"><span style="position: absolute; clip: rect(3.145em, 1000.86em, 4.144em, -1000em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-1454" style="font-family: MathJax_Main; font-weight: bold;">R</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; top: -4.395em; left: 0.862em;"><span class="mo" id="MathJax-Span-1455" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; top: -3.832em; left: 1.131em;"><span class="texatom" id="MathJax-Span-1456"><span class="mrow" id="MathJax-Span-1457"><span class="mi" id="MathJax-Span-1458" style="font-size: 70.7%; font-family: MathJax_Main;">⊥</span></span></span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span></span><span class="mo" id="MathJax-Span-1459" style="font-family: MathJax_Main; padding-left: 0.278em;">=</span><span class="mfrac" id="MathJax-Span-1460" style="padding-left: 0.278em;"><span style="display: inline-block; position: relative; width: 0.944em; height: 0px; margin-right: 0.12em; margin-left: 0.12em;"><span style="position: absolute; clip: rect(3.389em, 1000.5em, 4.349em, -1000em); top: -4.664em; left: 50%; margin-left: -0.252em;"><span class="mi" id="MathJax-Span-1461" style="font-family: MathJax_Math; font-style: italic;">η<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.006em;"></span></span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; clip: rect(3.146em, 1000.82em, 4.349em, -1000em); top: -3.296em; left: 50%; margin-left: -0.412em;"><span class="msup" id="MathJax-Span-1462"><span style="display: inline-block; position: relative; width: 0.824em; height: 0px;"><span style="position: absolute; clip: rect(3.389em, 1000.5em, 4.349em, -1000em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-1463" style="font-family: MathJax_Math; font-style: italic;">η<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.006em;"></span></span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; top: -4.271em; left: 0.555em;"><span class="mo" id="MathJax-Span-1464" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; clip: rect(0.844em, 1000.94em, 1.21em, -1000em); top: -1.278em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 0.944em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.058em;"></span></span></span></span><span class="mo" id="MathJax-Span-1465" style="font-family: MathJax_Main;">(</span><span class="texatom" id="MathJax-Span-1466"><span class="mrow" id="MathJax-Span-1467"><span class="mi" id="MathJax-Span-1468" style="font-family: MathJax_Main; font-weight: bold;">R</span></span></span><span class="mo" id="MathJax-Span-1469" style="font-family: MathJax_Main; padding-left: 0.222em;">+</span><span class="mi" id="MathJax-Span-1470" style="font-family: MathJax_Main; padding-left: 0.222em;">cos</span><span class="mo" id="MathJax-Span-1471"></span><span class="mi" id="MathJax-Span-1472" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.167em;">θ</span><span class="texatom" id="MathJax-Span-1473"><span class="mrow" id="MathJax-Span-1474"><span class="mi" id="MathJax-Span-1475" style="font-family: MathJax_Main; font-weight: bold;">n</span></span></span><span class="mo" id="MathJax-Span-1476" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.419em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.181em; border-left: 0px solid; width: 0px; height: 2.637em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><msub><mrow class="MJX-TeXAtom-ORD"><msup><mi mathvariant="bold">R</mi><mo>′</mo></msup></mrow><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="normal">⊥</mi></mrow></msub><mo>=</mo><mfrac><mi>η</mi><msup><mi>η</mi><mo>′</mo></msup></mfrac><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">R</mi></mrow><mo>+</mo><mi>cos</mi><mo>⁡</mo><mi>θ</mi><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">n</mi></mrow><mo stretchy="false">)</mo></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-142"> \mathbf{R'}_{\bot} = \frac{\eta}{\eta'} (\mathbf{R} + \cos\theta \mathbf{n}) </script>
  <span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-143-Frame" tabindex="0" style="text-align: center; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;msub&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;msup&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;R&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;&amp;#x2225;&lt;/mo&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;msqrt&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;msub&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;msup&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;R&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;&amp;#x22A5;&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;msup&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;/msqrt&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1477" style="width: 12.15em; display: inline-block;"><span style="display: inline-block; position: relative; width: 9.778em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(0.891em, 1009.76em, 2.994em, -1000em); top: -2.268em; left: 0em;"><span class="mrow" id="MathJax-Span-1478"><span class="msubsup" id="MathJax-Span-1479"><span style="display: inline-block; position: relative; width: 1.56em; height: 0px;"><span style="position: absolute; clip: rect(3.022em, 1001.13em, 4.144em, -1000em); top: -3.982em; left: 0em;"><span class="texatom" id="MathJax-Span-1480"><span class="mrow" id="MathJax-Span-1481"><span class="msup" id="MathJax-Span-1482"><span style="display: inline-block; position: relative; width: 1.131em; height: 0px;"><span style="position: absolute; clip: rect(3.145em, 1000.86em, 4.144em, -1000em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-1483" style="font-family: MathJax_Main; font-weight: bold;">R</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; top: -4.395em; left: 0.862em;"><span class="mo" id="MathJax-Span-1484" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; top: -3.796em; left: 1.131em;"><span class="texatom" id="MathJax-Span-1485"><span class="mrow" id="MathJax-Span-1486"><span class="mo" id="MathJax-Span-1487" style="font-size: 70.7%; font-family: MathJax_Main;">∥</span></span></span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span></span><span class="mo" id="MathJax-Span-1488" style="font-family: MathJax_Main; padding-left: 0.278em;">=</span><span class="mo" id="MathJax-Span-1489" style="font-family: MathJax_Main; padding-left: 0.278em;">−</span><span class="msqrt" id="MathJax-Span-1490"><span style="display: inline-block; position: relative; width: 5.463em; height: 0px;"><span style="position: absolute; clip: rect(2.883em, 1004.46em, 4.382em, -1000em); top: -3.982em; left: 1em;"><span class="mrow" id="MathJax-Span-1491"><span class="mn" id="MathJax-Span-1492" style="font-family: MathJax_Main;">1</span><span class="mo" id="MathJax-Span-1493" style="font-family: MathJax_Main; padding-left: 0.222em;">−</span><span class="texatom" id="MathJax-Span-1494" style="padding-left: 0.222em;"><span class="mrow" id="MathJax-Span-1495"><span class="mo" id="MathJax-Span-1496" style="font-family: MathJax_Main;">|</span></span></span><span class="msubsup" id="MathJax-Span-1497"><span style="display: inline-block; position: relative; width: 1.757em; height: 0px;"><span style="position: absolute; clip: rect(3.022em, 1001.13em, 4.144em, -1000em); top: -3.982em; left: 0em;"><span class="texatom" id="MathJax-Span-1498"><span class="mrow" id="MathJax-Span-1499"><span class="msup" id="MathJax-Span-1500"><span style="display: inline-block; position: relative; width: 1.131em; height: 0px;"><span style="position: absolute; clip: rect(3.145em, 1000.86em, 4.144em, -1000em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-1501" style="font-family: MathJax_Main; font-weight: bold;">R</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; top: -4.395em; left: 0.862em;"><span class="mo" id="MathJax-Span-1502" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; top: -3.832em; left: 1.131em;"><span class="texatom" id="MathJax-Span-1503"><span class="mrow" id="MathJax-Span-1504"><span class="mi" id="MathJax-Span-1505" style="font-size: 70.7%; font-family: MathJax_Main;">⊥</span></span></span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-1506"><span style="display: inline-block; position: relative; width: 0.707em; height: 0px;"><span style="position: absolute; clip: rect(3.081em, 1000.16em, 4.382em, -1000em); top: -3.982em; left: 0em;"><span class="texatom" id="MathJax-Span-1507"><span class="mrow" id="MathJax-Span-1508"><span class="mo" id="MathJax-Span-1509" style="font-family: MathJax_Main;">|</span></span></span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; top: -4.459em; left: 0.278em;"><span class="mn" id="MathJax-Span-1510" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; clip: rect(3.558em, 1004.4em, 3.905em, -1000em); top: -4.934em; left: 1em;"><span style="display: inline-block; position: relative; width: 4.404em; height: 0px;"><span style="position: absolute; font-family: MathJax_Main; top: -3.982em; left: -0.084em;">−<span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; font-family: MathJax_Main; top: -3.982em; left: 3.71em;">−<span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.982em; left: 0.449em;">−<span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.982em; left: 1.006em;">−<span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.982em; left: 1.564em;">−<span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.982em; left: 2.121em;">−<span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.982em; left: 2.679em;">−<span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.982em; left: 3.237em;">−<span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; clip: rect(2.681em, 1001.02em, 4.783em, -1000em); top: -4.057em; left: 0em;"><span style="font-family: MathJax_Size2;">√</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span></span><span class="texatom" id="MathJax-Span-1511"><span class="mrow" id="MathJax-Span-1512"><span class="mi" id="MathJax-Span-1513" style="font-family: MathJax_Main; font-weight: bold;">n</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.268em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.775em; border-left: 0px solid; width: 0px; height: 2.357em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><msub><mrow class="MJX-TeXAtom-ORD"><msup><mi mathvariant="bold">R</mi><mo>′</mo></msup></mrow><mrow class="MJX-TeXAtom-ORD"><mo>∥</mo></mrow></msub><mo>=</mo><mo>−</mo><msqrt><mn>1</mn><mo>−</mo><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><msub><mrow class="MJX-TeXAtom-ORD"><msup><mi mathvariant="bold">R</mi><mo>′</mo></msup></mrow><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="normal">⊥</mi></mrow></msub><msup><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><mn>2</mn></msup></msqrt><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">n</mi></mrow></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-143"> \mathbf{R'}_{\parallel} = -\sqrt{1 - |\mathbf{R'}_{\bot}|^2} \mathbf{n} </script>

</p><p>

You can go ahead and prove this for yourself if you want, but we will treat it as fact and move on.
The rest of the book will not require you to understand the proof.

</p><p>

We know the value of every term on the right-hand side except for <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-144-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;cos&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1514" style="width: 2.472em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.966em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.412em, 1001.96em, 2.43em, -1000em); top: -2.268em; left: 0em;"><span class="mrow" id="MathJax-Span-1515"><span class="mi" id="MathJax-Span-1516" style="font-family: MathJax_Main;">cos</span><span class="mo" id="MathJax-Span-1517"></span><span class="mi" id="MathJax-Span-1518" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.167em;">θ</span></span><span style="display: inline-block; width: 0px; height: 2.268em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.076em; border-left: 0px solid; width: 0px; height: 1.013em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>cos</mi><mo>⁡</mo><mi>θ</mi></math></span></span><script type="math/tex" id="MathJax-Element-144">\cos\theta</script>. It is well known
that the dot product of two vectors can be explained in terms of the cosine of the angle between
them:

</p><p>

  <span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-145-Frame" tabindex="0" style="text-align: center; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;a&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;b&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;a&lt;/mi&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;b&lt;/mi&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;mi&gt;cos&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1519" style="width: 9.579em; display: inline-block;"><span style="display: inline-block; position: relative; width: 7.712em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.518em, 1007.71em, 2.82em, -1000em); top: -2.419em; left: 0em;"><span class="mrow" id="MathJax-Span-1520"><span class="texatom" id="MathJax-Span-1521"><span class="mrow" id="MathJax-Span-1522"><span class="mi" id="MathJax-Span-1523" style="font-family: MathJax_Main; font-weight: bold;">a</span></span></span><span class="mo" id="MathJax-Span-1524" style="font-family: MathJax_Main; padding-left: 0.222em;">⋅</span><span class="texatom" id="MathJax-Span-1525" style="padding-left: 0.222em;"><span class="mrow" id="MathJax-Span-1526"><span class="mi" id="MathJax-Span-1527" style="font-family: MathJax_Main; font-weight: bold;">b</span></span></span><span class="mo" id="MathJax-Span-1528" style="font-family: MathJax_Main; padding-left: 0.278em;">=</span><span class="texatom" id="MathJax-Span-1529" style="padding-left: 0.278em;"><span class="mrow" id="MathJax-Span-1530"><span class="mo" id="MathJax-Span-1531" style="font-family: MathJax_Main;">|</span></span></span><span class="texatom" id="MathJax-Span-1532"><span class="mrow" id="MathJax-Span-1533"><span class="mi" id="MathJax-Span-1534" style="font-family: MathJax_Main; font-weight: bold;">a</span></span></span><span class="texatom" id="MathJax-Span-1535"><span class="mrow" id="MathJax-Span-1536"><span class="mo" id="MathJax-Span-1537" style="font-family: MathJax_Main;">|</span></span></span><span class="texatom" id="MathJax-Span-1538"><span class="mrow" id="MathJax-Span-1539"><span class="mo" id="MathJax-Span-1540" style="font-family: MathJax_Main;">|</span></span></span><span class="texatom" id="MathJax-Span-1541"><span class="mrow" id="MathJax-Span-1542"><span class="mi" id="MathJax-Span-1543" style="font-family: MathJax_Main; font-weight: bold;">b</span></span></span><span class="texatom" id="MathJax-Span-1544"><span class="mrow" id="MathJax-Span-1545"><span class="mo" id="MathJax-Span-1546" style="font-family: MathJax_Main;">|</span></span></span><span class="mi" id="MathJax-Span-1547" style="font-family: MathJax_Main; padding-left: 0.167em;">cos</span><span class="mo" id="MathJax-Span-1548"></span><span class="mi" id="MathJax-Span-1549" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.167em;">θ</span></span><span style="display: inline-block; width: 0px; height: 2.419em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.371em; border-left: 0px solid; width: 0px; height: 1.364em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">a</mi></mrow><mo>⋅</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">b</mi></mrow><mo>=</mo><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">a</mi></mrow><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">b</mi></mrow><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><mi>cos</mi><mo>⁡</mo><mi>θ</mi></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-145"> \mathbf{a} \cdot \mathbf{b} = |\mathbf{a}| |\mathbf{b}| \cos\theta </script>

</p><p>

If we restrict <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-146-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;a&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1550" style="width: 0.708em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.554em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.664em, 1000.55em, 2.425em, -1000em); top: -2.268em; left: 0em;"><span class="mrow" id="MathJax-Span-1551"><span class="texatom" id="MathJax-Span-1552"><span class="mrow" id="MathJax-Span-1553"><span class="mi" id="MathJax-Span-1554" style="font-family: MathJax_Main; font-weight: bold;">a</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.268em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.07em; border-left: 0px solid; width: 0px; height: 0.694em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">a</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-146">\mathbf{a}</script> and <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-147-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;b&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1555" style="width: 0.809em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.655em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.423em, 1000.62em, 2.425em, -1000em); top: -2.268em; left: 0em;"><span class="mrow" id="MathJax-Span-1556"><span class="texatom" id="MathJax-Span-1557"><span class="mrow" id="MathJax-Span-1558"><span class="mi" id="MathJax-Span-1559" style="font-family: MathJax_Main; font-weight: bold;">b</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.268em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.07em; border-left: 0px solid; width: 0px; height: 0.993em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">b</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-147">\mathbf{b}</script> to be unit vectors:

</p><p>

  <span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-148-Frame" tabindex="0" style="text-align: center; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;a&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;b&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;cos&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1560" style="width: 6.505em; display: inline-block;"><span style="display: inline-block; position: relative; width: 5.242em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.563em, 1005.24em, 2.582em, -1000em); top: -2.419em; left: 0em;"><span class="mrow" id="MathJax-Span-1561"><span class="texatom" id="MathJax-Span-1562"><span class="mrow" id="MathJax-Span-1563"><span class="mi" id="MathJax-Span-1564" style="font-family: MathJax_Main; font-weight: bold;">a</span></span></span><span class="mo" id="MathJax-Span-1565" style="font-family: MathJax_Main; padding-left: 0.222em;">⋅</span><span class="texatom" id="MathJax-Span-1566" style="padding-left: 0.222em;"><span class="mrow" id="MathJax-Span-1567"><span class="mi" id="MathJax-Span-1568" style="font-family: MathJax_Main; font-weight: bold;">b</span></span></span><span class="mo" id="MathJax-Span-1569" style="font-family: MathJax_Main; padding-left: 0.278em;">=</span><span class="mi" id="MathJax-Span-1570" style="font-family: MathJax_Main; padding-left: 0.278em;">cos</span><span class="mo" id="MathJax-Span-1571"></span><span class="mi" id="MathJax-Span-1572" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.167em;">θ</span></span><span style="display: inline-block; width: 0px; height: 2.419em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.076em; border-left: 0px solid; width: 0px; height: 1.013em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">a</mi></mrow><mo>⋅</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">b</mi></mrow><mo>=</mo><mi>cos</mi><mo>⁡</mo><mi>θ</mi></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-148"> \mathbf{a} \cdot \mathbf{b} = \cos\theta </script>

</p><p>

We can now rewrite <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-149-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;msup&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;R&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;&amp;#x22A5;&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1573" style="width: 2.22em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.764em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(0.098em, 1001.76em, 1.309em, -1000em); top: -1.008em; left: 0em;"><span class="mrow" id="MathJax-Span-1574"><span class="msubsup" id="MathJax-Span-1575"><span style="display: inline-block; position: relative; width: 1.757em; height: 0px;"><span style="position: absolute; clip: rect(3.072em, 1001.13em, 4.144em, -1000em); top: -3.982em; left: 0em;"><span class="texatom" id="MathJax-Span-1576"><span class="mrow" id="MathJax-Span-1577"><span class="msup" id="MathJax-Span-1578"><span style="display: inline-block; position: relative; width: 1.131em; height: 0px;"><span style="position: absolute; clip: rect(3.145em, 1000.86em, 4.144em, -1000em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-1579" style="font-family: MathJax_Main; font-weight: bold;">R</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; top: -4.345em; left: 0.862em;"><span class="mo" id="MathJax-Span-1580" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; top: -3.832em; left: 1.131em;"><span class="texatom" id="MathJax-Span-1581"><span class="mrow" id="MathJax-Span-1582"><span class="mi" id="MathJax-Span-1583" style="font-size: 70.7%; font-family: MathJax_Main;">⊥</span></span></span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 1.008em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.248em; border-left: 0px solid; width: 0px; height: 1.252em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mrow class="MJX-TeXAtom-ORD"><msup><mi mathvariant="bold">R</mi><mo>′</mo></msup></mrow><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="normal">⊥</mi></mrow></msub></math></span></span><script type="math/tex" id="MathJax-Element-149">\mathbf{R'}_{\bot}</script> in terms of known quantities:

</p><p>

  <span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-150-Frame" tabindex="0" style="text-align: center; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;msub&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;msup&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;R&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;&amp;#x22A5;&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mfrac&gt;&lt;mi&gt;&amp;#x03B7;&lt;/mi&gt;&lt;msup&gt;&lt;mi&gt;&amp;#x03B7;&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;/mfrac&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;R&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo mathvariant=&quot;bold&quot;&gt;&amp;#x2212;&lt;/mo&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;R&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1584" style="width: 14.519em; display: inline-block;"><span style="display: inline-block; position: relative; width: 11.694em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.094em, 1011.6em, 3.422em, -1000em); top: -2.369em; left: 0em;"><span class="mrow" id="MathJax-Span-1585"><span class="msubsup" id="MathJax-Span-1586"><span style="display: inline-block; position: relative; width: 1.757em; height: 0px;"><span style="position: absolute; clip: rect(3.022em, 1001.13em, 4.144em, -1000em); top: -3.982em; left: 0em;"><span class="texatom" id="MathJax-Span-1587"><span class="mrow" id="MathJax-Span-1588"><span class="msup" id="MathJax-Span-1589"><span style="display: inline-block; position: relative; width: 1.131em; height: 0px;"><span style="position: absolute; clip: rect(3.145em, 1000.86em, 4.144em, -1000em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-1590" style="font-family: MathJax_Main; font-weight: bold;">R</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; top: -4.395em; left: 0.862em;"><span class="mo" id="MathJax-Span-1591" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; top: -3.832em; left: 1.131em;"><span class="texatom" id="MathJax-Span-1592"><span class="mrow" id="MathJax-Span-1593"><span class="mi" id="MathJax-Span-1594" style="font-size: 70.7%; font-family: MathJax_Main;">⊥</span></span></span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span></span><span class="mo" id="MathJax-Span-1595" style="font-family: MathJax_Main; padding-left: 0.278em;">=</span><span class="mfrac" id="MathJax-Span-1596" style="padding-left: 0.278em;"><span style="display: inline-block; position: relative; width: 0.944em; height: 0px; margin-right: 0.12em; margin-left: 0.12em;"><span style="position: absolute; clip: rect(3.389em, 1000.5em, 4.349em, -1000em); top: -4.664em; left: 50%; margin-left: -0.252em;"><span class="mi" id="MathJax-Span-1597" style="font-family: MathJax_Math; font-style: italic;">η<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.006em;"></span></span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; clip: rect(3.146em, 1000.82em, 4.349em, -1000em); top: -3.296em; left: 50%; margin-left: -0.412em;"><span class="msup" id="MathJax-Span-1598"><span style="display: inline-block; position: relative; width: 0.824em; height: 0px;"><span style="position: absolute; clip: rect(3.389em, 1000.5em, 4.349em, -1000em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-1599" style="font-family: MathJax_Math; font-style: italic;">η<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.006em;"></span></span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; top: -4.271em; left: 0.555em;"><span class="mo" id="MathJax-Span-1600" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; clip: rect(0.844em, 1000.94em, 1.21em, -1000em); top: -1.278em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 0.944em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.058em;"></span></span></span></span><span class="mo" id="MathJax-Span-1601" style="font-family: MathJax_Main;">(</span><span class="texatom" id="MathJax-Span-1602"><span class="mrow" id="MathJax-Span-1603"><span class="mi" id="MathJax-Span-1604" style="font-family: MathJax_Main; font-weight: bold;">R</span></span></span><span class="mo" id="MathJax-Span-1605" style="font-family: MathJax_Main; padding-left: 0.222em;">+</span><span class="mo" id="MathJax-Span-1606" style="font-family: MathJax_Main; padding-left: 0.222em;">(</span><span class="texatom" id="MathJax-Span-1607"><span class="mrow" id="MathJax-Span-1608"><span class="mo" id="MathJax-Span-1609" style="font-family: MathJax_Main; font-weight: bold;">−</span><span class="mi" id="MathJax-Span-1610" style="font-family: MathJax_Main; font-weight: bold;">R</span></span></span><span class="mo" id="MathJax-Span-1611" style="font-family: MathJax_Main; padding-left: 0.222em;">⋅</span><span class="texatom" id="MathJax-Span-1612" style="padding-left: 0.222em;"><span class="mrow" id="MathJax-Span-1613"><span class="mi" id="MathJax-Span-1614" style="font-family: MathJax_Main; font-weight: bold;">n</span></span></span><span class="mo" id="MathJax-Span-1615" style="font-family: MathJax_Main;">)</span><span class="texatom" id="MathJax-Span-1616"><span class="mrow" id="MathJax-Span-1617"><span class="mi" id="MathJax-Span-1618" style="font-family: MathJax_Main; font-weight: bold;">n</span></span></span><span class="mo" id="MathJax-Span-1619" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.369em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.181em; border-left: 0px solid; width: 0px; height: 2.637em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><msub><mrow class="MJX-TeXAtom-ORD"><msup><mi mathvariant="bold">R</mi><mo>′</mo></msup></mrow><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="normal">⊥</mi></mrow></msub><mo>=</mo><mfrac><mi>η</mi><msup><mi>η</mi><mo>′</mo></msup></mfrac><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">R</mi></mrow><mo>+</mo><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mo mathvariant="bold">−</mo><mi mathvariant="bold">R</mi></mrow><mo>⋅</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">n</mi></mrow><mo stretchy="false">)</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">n</mi></mrow><mo stretchy="false">)</mo></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-150"> \mathbf{R'}_{\bot} =
     \frac{\eta}{\eta'} (\mathbf{R} + (\mathbf{-R} \cdot \mathbf{n}) \mathbf{n}) </script>

</p><p>

</p><div class="together">
When we combine them back together, we can write a function to calculate <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-151-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;msup&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;R&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1620" style="width: 1.414em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.109em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(0.098em, 1001.11em, 1.17em, -1000em); top: -1.008em; left: 0em;"><span class="mrow" id="MathJax-Span-1621"><span class="texatom" id="MathJax-Span-1622"><span class="mrow" id="MathJax-Span-1623"><span class="msup" id="MathJax-Span-1624"><span style="display: inline-block; position: relative; width: 1.131em; height: 0px;"><span style="position: absolute; clip: rect(3.145em, 1000.86em, 4.144em, -1000em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-1625" style="font-family: MathJax_Main; font-weight: bold;">R</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; top: -4.345em; left: 0.862em;"><span class="mo" id="MathJax-Span-1626" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 1.008em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.076em; border-left: 0px solid; width: 0px; height: 1.08em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><msup><mi mathvariant="bold">R</mi><mo>′</mo></msup></mrow></math></span></span><script type="math/tex" id="MathJax-Element-151">\mathbf{R'}</script>:

<p></p><pre class="listing tilde"><code><span class="line"></span>...
<span class="line"></span>
<span class="line"></span><span class="hljs-function"><span class="hljs-keyword">inline</span> vec3 <span class="hljs-title">reflect</span><span class="hljs-params">(<span class="hljs-type">const</span> vec3&amp; v, <span class="hljs-type">const</span> vec3&amp; n)</span> </span>{
<span class="line"></span>    <span class="hljs-keyword">return</span> v - <span class="hljs-number">2</span>*<span class="hljs-built_in">dot</span>(v,n)*n;
<span class="line"></span>}
<span class="line"></span>
<span class="line"></span><div class=" Highlight"><span class="line"></span><span class="hljs-function"><span class="hljs-keyword">inline</span> vec3 <span class="hljs-title">refract</span><span class="hljs-params">(<span class="hljs-type">const</span> vec3&amp; uv, <span class="hljs-type">const</span> vec3&amp; n, <span class="hljs-type">double</span> etai_over_etat)</span> </span>{
<span class="line"></span>    <span class="hljs-keyword">auto</span> cos_theta = <span class="hljs-built_in">fmin</span>(<span class="hljs-built_in">dot</span>(-uv, n), <span class="hljs-number">1.0</span>);
<span class="line"></span>    vec3 r_out_perp =  etai_over_etat * (uv + cos_theta*n);
<span class="line"></span>    vec3 r_out_parallel = -<span class="hljs-built_in">sqrt</span>(<span class="hljs-built_in">fabs</span>(<span class="hljs-number">1.0</span> - r_out_perp.<span class="hljs-built_in">length_squared</span>())) * n;
<span class="line"></span>    <span class="hljs-keyword">return</span> r_out_perp + r_out_parallel;
<span class="line"></span>}</div></code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_refract">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;65:</b> <kbd>[vec3.h]</kbd> Refraction function</div></center>
<p>


</p></div>

<p></p><p>

</p><div class="together">
And the dielectric material that always refracts is:

<p></p><pre class="listing tilde"><code><span class="line"></span>...
<span class="line"></span>
<span class="line"></span><span class="hljs-keyword">class</span> <span class="hljs-title class_">metal</span> : <span class="hljs-keyword">public</span> material {
<span class="line"></span>    ...
<span class="line"></span>};
<span class="line"></span>
<span class="line"></span><div class=" Highlight"><span class="line"></span><span class="hljs-keyword">class</span> <span class="hljs-title class_">dielectric</span> : <span class="hljs-keyword">public</span> material {
<span class="line"></span>  <span class="hljs-keyword">public</span>:
<span class="line"></span>    <span class="hljs-built_in">dielectric</span>(<span class="hljs-type">double</span> index_of_refraction) : <span class="hljs-built_in">ir</span>(index_of_refraction) {}
<span class="line"></span>
<span class="line"></span>    <span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">scatter</span><span class="hljs-params">(<span class="hljs-type">const</span> ray&amp; r_in, <span class="hljs-type">const</span> hit_record&amp; rec, color&amp; attenuation, ray&amp; scattered)</span>
<span class="line"></span>    <span class="hljs-type">const</span> <span class="hljs-keyword">override</span> </span>{
<span class="line"></span>        attenuation = <span class="hljs-built_in">color</span>(<span class="hljs-number">1.0</span>, <span class="hljs-number">1.0</span>, <span class="hljs-number">1.0</span>);
<span class="line"></span>        <span class="hljs-type">double</span> refraction_ratio = rec.front_face ? (<span class="hljs-number">1.0</span>/ir) : ir;
<span class="line"></span>
<span class="line"></span>        vec3 unit_direction = <span class="hljs-built_in">unit_vector</span>(r_in.<span class="hljs-built_in">direction</span>());
<span class="line"></span>        vec3 refracted = <span class="hljs-built_in">refract</span>(unit_direction, rec.normal, refraction_ratio);
<span class="line"></span>
<span class="line"></span>        scattered = <span class="hljs-built_in">ray</span>(rec.p, refracted);
<span class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
<span class="line"></span>    }
<span class="line"></span>
<span class="line"></span>  <span class="hljs-keyword">private</span>:
<span class="line"></span>    <span class="hljs-type">double</span> ir; <span class="hljs-comment">// Index of Refraction</span>
<span class="line"></span>};</div></code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_dielectric-always-refract">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;66:</b> <kbd>[material.h]</kbd>
        Dielectric material class that always refracts</div></center>
<p>


</p></div>

<p></p><p>

</p><div class="together">
Now we'll update the scene to change the left and center spheres to glass:

<p></p><pre class="listing tilde"><code><span class="line"></span><span class="hljs-keyword">auto</span> material_ground = <span class="hljs-built_in">make_shared</span>&lt;lambertian&gt;(<span class="hljs-built_in">color</span>(<span class="hljs-number">0.8</span>, <span class="hljs-number">0.8</span>, <span class="hljs-number">0.0</span>));<div class=" highlight"><span class="line"></span><span class="hljs-keyword">auto</span> material_center = <span class="hljs-built_in">make_shared</span>&lt;dielectric&gt;(<span class="hljs-number">1.5</span>);
<span class="line"></span><span class="hljs-keyword">auto</span> material_left   = <span class="hljs-built_in">make_shared</span>&lt;dielectric&gt;(<span class="hljs-number">1.5</span>);</div><span class="line"></span><span class="hljs-keyword">auto</span> material_right  = <span class="hljs-built_in">make_shared</span>&lt;metal&gt;(<span class="hljs-built_in">color</span>(<span class="hljs-number">0.8</span>, <span class="hljs-number">0.6</span>, <span class="hljs-number">0.2</span>), <span class="hljs-number">1.0</span>);</code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_two-glass">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;67:</b> <kbd>[main.cc]</kbd> Changing left and center spheres to glass</div></center>
<p>


</p></div>

<p></p><p>

</p><div class="together">
This gives us the following result:

<p></p><p>

  </p><center><div class="image" style=""><a href="https://raytracing.github.io/images/img-1.16-glass-always-refract.png" target="_blank"><img class="markdeep pixel" src="Ray%20Tracing%20in%20One%20Weekend_files/img-1.16-glass-always-refract.png"></a><center><span class="imagecaption"><span class="num">Image 16:</span> Glass sphere that always refracts
  </span></center></div></center>

<p></p><p>

</p></div>

<p></p>
<a class="target" name="totalinternalreflection">&nbsp;</a><a class="target" name="dielectrics/totalinternalreflection">&nbsp;</a><a class="target" name="toc11.3">&nbsp;</a><h2>Total Internal Reflection</h2>
<p>

That definitely doesn't look right. One troublesome practical issue is that when the ray is in the
material with the higher refractive index, there is no real solution to Snell’s law, and thus there
is no refraction possible. If we refer back to Snell's law and the derivation of <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-152-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;sin&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1627" style="width: 2.623em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.117em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.459em, 1002.12em, 2.531em, -1000em); top: -2.369em; left: 0em;"><span class="mrow" id="MathJax-Span-1628"><span class="mi" id="MathJax-Span-1629" style="font-family: MathJax_Main;">sin</span><span class="mo" id="MathJax-Span-1630"></span><span class="msup" id="MathJax-Span-1631" style="padding-left: 0.167em;"><span style="display: inline-block; position: relative; width: 0.738em; height: 0px;"><span style="position: absolute; clip: rect(3.126em, 1000.46em, 4.143em, -1000em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-1632" style="font-family: MathJax_Math; font-style: italic;">θ</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; top: -4.345em; left: 0.469em;"><span class="mo" id="MathJax-Span-1633" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.369em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.076em; border-left: 0px solid; width: 0px; height: 1.08em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>sin</mi><mo>⁡</mo><msup><mi>θ</mi><mo>′</mo></msup></math></span></span><script type="math/tex" id="MathJax-Element-152">\sin\theta'</script>:

</p><p>

  <span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-153-Frame" tabindex="0" style="text-align: center; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mi&gt;sin&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mfrac&gt;&lt;mi&gt;&amp;#x03B7;&lt;/mi&gt;&lt;msup&gt;&lt;mi&gt;&amp;#x03B7;&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;/mfrac&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mi&gt;sin&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1634" style="width: 9.025em; display: inline-block;"><span style="display: inline-block; position: relative; width: 7.258em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.144em, 1007.25em, 3.473em, -1000em); top: -2.419em; left: 0em;"><span class="mrow" id="MathJax-Span-1635"><span class="mi" id="MathJax-Span-1636" style="font-family: MathJax_Main;">sin</span><span class="mo" id="MathJax-Span-1637"></span><span class="msup" id="MathJax-Span-1638" style="padding-left: 0.167em;"><span style="display: inline-block; position: relative; width: 0.738em; height: 0px;"><span style="position: absolute; clip: rect(3.126em, 1000.46em, 4.143em, -1000em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-1639" style="font-family: MathJax_Math; font-style: italic;">θ</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; top: -4.395em; left: 0.469em;"><span class="mo" id="MathJax-Span-1640" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span></span><span class="mo" id="MathJax-Span-1641" style="font-family: MathJax_Main; padding-left: 0.278em;">=</span><span class="mfrac" id="MathJax-Span-1642" style="padding-left: 0.278em;"><span style="display: inline-block; position: relative; width: 0.944em; height: 0px; margin-right: 0.12em; margin-left: 0.12em;"><span style="position: absolute; clip: rect(3.389em, 1000.5em, 4.349em, -1000em); top: -4.664em; left: 50%; margin-left: -0.252em;"><span class="mi" id="MathJax-Span-1643" style="font-family: MathJax_Math; font-style: italic;">η<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.006em;"></span></span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; clip: rect(3.146em, 1000.82em, 4.349em, -1000em); top: -3.296em; left: 50%; margin-left: -0.412em;"><span class="msup" id="MathJax-Span-1644"><span style="display: inline-block; position: relative; width: 0.824em; height: 0px;"><span style="position: absolute; clip: rect(3.389em, 1000.5em, 4.349em, -1000em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-1645" style="font-family: MathJax_Math; font-style: italic;">η<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.006em;"></span></span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; top: -4.271em; left: 0.555em;"><span class="mo" id="MathJax-Span-1646" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; clip: rect(0.844em, 1000.94em, 1.21em, -1000em); top: -1.278em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 0.944em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.058em;"></span></span></span></span><span class="mo" id="MathJax-Span-1647" style="font-family: MathJax_Main; padding-left: 0.222em;">⋅</span><span class="mi" id="MathJax-Span-1648" style="font-family: MathJax_Main; padding-left: 0.222em;">sin</span><span class="mo" id="MathJax-Span-1649"></span><span class="mi" id="MathJax-Span-1650" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.167em;">θ</span></span><span style="display: inline-block; width: 0px; height: 2.419em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.181em; border-left: 0px solid; width: 0px; height: 2.637em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>sin</mi><mo>⁡</mo><msup><mi>θ</mi><mo>′</mo></msup><mo>=</mo><mfrac><mi>η</mi><msup><mi>η</mi><mo>′</mo></msup></mfrac><mo>⋅</mo><mi>sin</mi><mo>⁡</mo><mi>θ</mi></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-153"> \sin\theta' = \frac{\eta}{\eta'} \cdot \sin\theta </script>

</p><p>

If the ray is inside glass and outside is air (<span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-154-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;&amp;#x03B7;&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;1.5&lt;/mn&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1651" style="width: 3.884em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.125em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.451em, 1003.07em, 2.635em, -1000em); top: -2.268em; left: 0em;"><span class="mrow" id="MathJax-Span-1652"><span class="mi" id="MathJax-Span-1653" style="font-family: MathJax_Math; font-style: italic;">η<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.006em;"></span></span><span class="mo" id="MathJax-Span-1654" style="font-family: MathJax_Main; padding-left: 0.278em;">=</span><span class="mn" id="MathJax-Span-1655" style="font-family: MathJax_Main; padding-left: 0.278em;">1.5</span></span><span style="display: inline-block; width: 0px; height: 2.268em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.33em; border-left: 0px solid; width: 0px; height: 1.219em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>η</mi><mo>=</mo><mn>1.5</mn></math></span></span><script type="math/tex" id="MathJax-Element-154">\eta = 1.5</script> and <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-155-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msup&gt;&lt;mi&gt;&amp;#x03B7;&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;1.0&lt;/mn&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1656" style="width: 4.287em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.427em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.308em, 1003.39em, 2.585em, -1000em); top: -2.218em; left: 0em;"><span class="mrow" id="MathJax-Span-1657"><span class="msup" id="MathJax-Span-1658"><span style="display: inline-block; position: relative; width: 0.824em; height: 0px;"><span style="position: absolute; clip: rect(3.389em, 1000.5em, 4.349em, -1000em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-1659" style="font-family: MathJax_Math; font-style: italic;">η<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.006em;"></span></span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; top: -4.345em; left: 0.555em;"><span class="mo" id="MathJax-Span-1660" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span></span><span class="mo" id="MathJax-Span-1661" style="font-family: MathJax_Main; padding-left: 0.278em;">=</span><span class="mn" id="MathJax-Span-1662" style="font-family: MathJax_Main; padding-left: 0.278em;">1.0</span></span><span style="display: inline-block; width: 0px; height: 2.218em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.33em; border-left: 0px solid; width: 0px; height: 1.334em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mi>η</mi><mo>′</mo></msup><mo>=</mo><mn>1.0</mn></math></span></span><script type="math/tex" id="MathJax-Element-155">\eta' = 1.0</script>):

</p><p>

  <span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-156-Frame" tabindex="0" style="text-align: center; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mi&gt;sin&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mfrac&gt;&lt;mn&gt;1.5&lt;/mn&gt;&lt;mn&gt;1.0&lt;/mn&gt;&lt;/mfrac&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mi&gt;sin&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1663" style="width: 9.579em; display: inline-block;"><span style="display: inline-block; position: relative; width: 7.712em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(0.926em, 1007.71em, 3.279em, -1000em); top: -2.419em; left: 0em;"><span class="mrow" id="MathJax-Span-1664"><span class="mi" id="MathJax-Span-1665" style="font-family: MathJax_Main;">sin</span><span class="mo" id="MathJax-Span-1666"></span><span class="msup" id="MathJax-Span-1667" style="padding-left: 0.167em;"><span style="display: inline-block; position: relative; width: 0.738em; height: 0px;"><span style="position: absolute; clip: rect(3.126em, 1000.46em, 4.143em, -1000em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-1668" style="font-family: MathJax_Math; font-style: italic;">θ</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; top: -4.395em; left: 0.469em;"><span class="mo" id="MathJax-Span-1669" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span></span><span class="mo" id="MathJax-Span-1670" style="font-family: MathJax_Main; padding-left: 0.278em;">=</span><span class="mfrac" id="MathJax-Span-1671" style="padding-left: 0.278em;"><span style="display: inline-block; position: relative; width: 1.398em; height: 0px; margin-right: 0.12em; margin-left: 0.12em;"><span style="position: absolute; clip: rect(3.165em, 1001.23em, 4.155em, -1000em); top: -4.658em; left: 50%; margin-left: -0.639em;"><span class="mn" id="MathJax-Span-1672" style="font-family: MathJax_Main;">1.5</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; clip: rect(3.165em, 1001.24em, 4.155em, -1000em); top: -3.296em; left: 50%; margin-left: -0.639em;"><span class="mn" id="MathJax-Span-1673" style="font-family: MathJax_Main;">1.0</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; clip: rect(0.844em, 1001.4em, 1.21em, -1000em); top: -1.278em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 1.398em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.058em;"></span></span></span></span><span class="mo" id="MathJax-Span-1674" style="font-family: MathJax_Main; padding-left: 0.222em;">⋅</span><span class="mi" id="MathJax-Span-1675" style="font-family: MathJax_Main; padding-left: 0.222em;">sin</span><span class="mo" id="MathJax-Span-1676"></span><span class="mi" id="MathJax-Span-1677" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.167em;">θ</span></span><span style="display: inline-block; width: 0px; height: 2.419em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.94em; border-left: 0px solid; width: 0px; height: 2.668em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>sin</mi><mo>⁡</mo><msup><mi>θ</mi><mo>′</mo></msup><mo>=</mo><mfrac><mn>1.5</mn><mn>1.0</mn></mfrac><mo>⋅</mo><mi>sin</mi><mo>⁡</mo><mi>θ</mi></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-156"> \sin\theta' = \frac{1.5}{1.0} \cdot \sin\theta </script>

</p><p>

</p><div class="together">
The value of <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-157-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;sin&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1678" style="width: 2.623em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.117em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.459em, 1002.12em, 2.531em, -1000em); top: -2.369em; left: 0em;"><span class="mrow" id="MathJax-Span-1679"><span class="mi" id="MathJax-Span-1680" style="font-family: MathJax_Main;">sin</span><span class="mo" id="MathJax-Span-1681"></span><span class="msup" id="MathJax-Span-1682" style="padding-left: 0.167em;"><span style="display: inline-block; position: relative; width: 0.738em; height: 0px;"><span style="position: absolute; clip: rect(3.126em, 1000.46em, 4.143em, -1000em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-1683" style="font-family: MathJax_Math; font-style: italic;">θ</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; top: -4.345em; left: 0.469em;"><span class="mo" id="MathJax-Span-1684" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.369em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.076em; border-left: 0px solid; width: 0px; height: 1.08em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>sin</mi><mo>⁡</mo><msup><mi>θ</mi><mo>′</mo></msup></math></span></span><script type="math/tex" id="MathJax-Element-157">\sin\theta'</script> cannot be greater than 1. So, if,

<p></p><p>

  <span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-158-Frame" tabindex="0" style="text-align: center; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mfrac&gt;&lt;mn&gt;1.5&lt;/mn&gt;&lt;mn&gt;1.0&lt;/mn&gt;&lt;/mfrac&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mi&gt;sin&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mo&gt;&amp;gt;&lt;/mo&gt;&lt;mn&gt;1.0&lt;/mn&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1685" style="width: 8.521em; display: inline-block;"><span style="display: inline-block; position: relative; width: 6.855em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(0.774em, 1006.82em, 3.127em, -1000em); top: -2.268em; left: 0em;"><span class="mrow" id="MathJax-Span-1686"><span class="mfrac" id="MathJax-Span-1687"><span style="display: inline-block; position: relative; width: 1.398em; height: 0px; margin-right: 0.12em; margin-left: 0.12em;"><span style="position: absolute; clip: rect(3.165em, 1001.23em, 4.155em, -1000em); top: -4.658em; left: 50%; margin-left: -0.639em;"><span class="mn" id="MathJax-Span-1688" style="font-family: MathJax_Main;">1.5</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; clip: rect(3.165em, 1001.24em, 4.155em, -1000em); top: -3.296em; left: 50%; margin-left: -0.639em;"><span class="mn" id="MathJax-Span-1689" style="font-family: MathJax_Main;">1.0</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; clip: rect(0.844em, 1001.4em, 1.21em, -1000em); top: -1.278em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 1.398em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.058em;"></span></span></span></span><span class="mo" id="MathJax-Span-1690" style="font-family: MathJax_Main; padding-left: 0.222em;">⋅</span><span class="mi" id="MathJax-Span-1691" style="font-family: MathJax_Main; padding-left: 0.222em;">sin</span><span class="mo" id="MathJax-Span-1692"></span><span class="mi" id="MathJax-Span-1693" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.167em;">θ</span><span class="mo" id="MathJax-Span-1694" style="font-family: MathJax_Main; padding-left: 0.278em;">&gt;</span><span class="mn" id="MathJax-Span-1695" style="font-family: MathJax_Main; padding-left: 0.278em;">1.0</span></span><span style="display: inline-block; width: 0px; height: 2.268em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.94em; border-left: 0px solid; width: 0px; height: 2.668em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mfrac><mn>1.5</mn><mn>1.0</mn></mfrac><mo>⋅</mo><mi>sin</mi><mo>⁡</mo><mi>θ</mi><mo>&gt;</mo><mn>1.0</mn></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-158"> \frac{1.5}{1.0} \cdot \sin\theta > 1.0 </script>

</p><p>

the equality between the two sides of the equation is broken, and a solution cannot exist. If a
solution does not exist, the glass cannot refract, and therefore must reflect the ray:

</p><pre class="listing tilde"><code><span class="line"></span><span class="hljs-keyword">if</span> (refraction_ratio * sin_theta &gt; <span class="hljs-number">1.0</span>) {
<span class="line"></span>    <span class="hljs-comment">// Must Reflect</span>
<span class="line"></span>    ...
<span class="line"></span>} <span class="hljs-keyword">else</span> {
<span class="line"></span>    <span class="hljs-comment">// Can Refract</span>
<span class="line"></span>    ...
<span class="line"></span>}</code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_dielectric-can-refract-1">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;68:</b> <kbd>[material.h]</kbd> Determining if the ray can refract</div></center>
<p>

</p></div>

<p></p><p>

Here all the light is reflected, and because in practice that is usually inside solid objects, it
is called “total internal reflection”. This is why sometimes the water-air boundary acts as a
perfect mirror when you are submerged.

</p><p>

We can solve for <code>sin_theta</code> using the trigonometric qualities:

</p><p>

  <span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-159-Frame" tabindex="0" style="text-align: center; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mi&gt;sin&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msqrt&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;cos&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;/msqrt&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1696" style="width: 10.335em; display: inline-block;"><span style="display: inline-block; position: relative; width: 8.317em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.291em, 1008.31em, 2.793em, -1000em); top: -2.419em; left: 0em;"><span class="mrow" id="MathJax-Span-1697"><span class="mi" id="MathJax-Span-1698" style="font-family: MathJax_Main;">sin</span><span class="mo" id="MathJax-Span-1699"></span><span class="mi" id="MathJax-Span-1700" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.167em;">θ</span><span class="mo" id="MathJax-Span-1701" style="font-family: MathJax_Main; padding-left: 0.278em;">=</span><span class="msqrt" id="MathJax-Span-1702" style="padding-left: 0.278em;"><span style="display: inline-block; position: relative; width: 5.125em; height: 0px;"><span style="position: absolute; clip: rect(2.947em, 1004.12em, 4.215em, -1000em); top: -3.982em; left: 1em;"><span class="mrow" id="MathJax-Span-1703"><span class="mn" id="MathJax-Span-1704" style="font-family: MathJax_Main;">1</span><span class="mo" id="MathJax-Span-1705" style="font-family: MathJax_Main; padding-left: 0.222em;">−</span><span class="msubsup" id="MathJax-Span-1706" style="padding-left: 0.222em;"><span style="display: inline-block; position: relative; width: 1.767em; height: 0px;"><span style="position: absolute; clip: rect(3.383em, 1001.3em, 4.144em, -1000em); top: -3.982em; left: 0em;"><span class="mi" id="MathJax-Span-1707" style="font-family: MathJax_Main;">cos</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; top: -4.395em; left: 1.338em;"><span class="mn" id="MathJax-Span-1708" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span></span><span class="mo" id="MathJax-Span-1709"></span><span class="mi" id="MathJax-Span-1710" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.167em;">θ</span></span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; clip: rect(3.558em, 1004.07em, 3.905em, -1000em); top: -4.686em; left: 1em;"><span style="display: inline-block; position: relative; width: 4.066em; height: 0px;"><span style="position: absolute; font-family: MathJax_Main; top: -3.982em; left: -0.084em;">−<span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; font-family: MathJax_Main; top: -3.982em; left: 3.372em;">−<span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.982em; left: 0.4em;">−<span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.982em; left: 0.909em;">−<span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.982em; left: 1.419em;">−<span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.982em; left: 1.928em;">−<span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.982em; left: 2.437em;">−<span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.982em; left: 2.946em;">−<span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; clip: rect(2.981em, 1001.02em, 4.483em, -1000em); top: -4.109em; left: 0em;"><span style="font-family: MathJax_Size1;">√</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.419em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.339em; border-left: 0px solid; width: 0px; height: 1.613em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>sin</mi><mo>⁡</mo><mi>θ</mi><mo>=</mo><msqrt><mn>1</mn><mo>−</mo><msup><mi>cos</mi><mn>2</mn></msup><mo>⁡</mo><mi>θ</mi></msqrt></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-159"> \sin\theta  = \sqrt{1 - \cos^2\theta} </script>

</p><p>

and

</p><p>

  <span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-160-Frame" tabindex="0" style="text-align: center; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mi&gt;cos&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;R&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1711" style="width: 6.908em; display: inline-block;"><span style="display: inline-block; position: relative; width: 5.544em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.563em, 1005.53em, 2.582em, -1000em); top: -2.419em; left: 0em;"><span class="mrow" id="MathJax-Span-1712"><span class="mi" id="MathJax-Span-1713" style="font-family: MathJax_Main;">cos</span><span class="mo" id="MathJax-Span-1714"></span><span class="mi" id="MathJax-Span-1715" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.167em;">θ</span><span class="mo" id="MathJax-Span-1716" style="font-family: MathJax_Main; padding-left: 0.278em;">=</span><span class="texatom" id="MathJax-Span-1717" style="padding-left: 0.278em;"><span class="mrow" id="MathJax-Span-1718"><span class="mi" id="MathJax-Span-1719" style="font-family: MathJax_Main; font-weight: bold;">R</span></span></span><span class="mo" id="MathJax-Span-1720" style="font-family: MathJax_Main; padding-left: 0.222em;">⋅</span><span class="texatom" id="MathJax-Span-1721" style="padding-left: 0.222em;"><span class="mrow" id="MathJax-Span-1722"><span class="mi" id="MathJax-Span-1723" style="font-family: MathJax_Main; font-weight: bold;">n</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.419em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.076em; border-left: 0px solid; width: 0px; height: 1.013em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>cos</mi><mo>⁡</mo><mi>θ</mi><mo>=</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">R</mi></mrow><mo>⋅</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">n</mi></mrow></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-160"> \cos\theta = \mathbf{R} \cdot \mathbf{n} </script>

</p><pre class="listing tilde"><code><span class="line"></span><span class="hljs-type">double</span> cos_theta = <span class="hljs-built_in">fmin</span>(<span class="hljs-built_in">dot</span>(-unit_direction, rec.normal), <span class="hljs-number">1.0</span>);
<span class="line"></span><span class="hljs-type">double</span> sin_theta = <span class="hljs-built_in">sqrt</span>(<span class="hljs-number">1.0</span> - cos_theta*cos_theta);
<span class="line"></span>
<span class="line"></span><span class="hljs-keyword">if</span> (refraction_ratio * sin_theta &gt; <span class="hljs-number">1.0</span>) {
<span class="line"></span>    <span class="hljs-comment">// Must Reflect</span>
<span class="line"></span>    ...
<span class="line"></span>} <span class="hljs-keyword">else</span> {
<span class="line"></span>    <span class="hljs-comment">// Can Refract</span>
<span class="line"></span>    ...
<span class="line"></span>}</code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_dielectric-can-refract-2">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;69:</b> <kbd>[material.h]</kbd> Determining if the ray can refract</div></center>
<p>


</p><div class="together">
And the dielectric material that always refracts (when possible) is:

<p></p><pre class="listing tilde"><code><span class="line"></span><span class="hljs-keyword">class</span> <span class="hljs-title class_">dielectric</span> : <span class="hljs-keyword">public</span> material {
<span class="line"></span>  <span class="hljs-keyword">public</span>:
<span class="line"></span>    <span class="hljs-built_in">dielectric</span>(<span class="hljs-type">double</span> index_of_refraction) : <span class="hljs-built_in">ir</span>(index_of_refraction) {}
<span class="line"></span>
<span class="line"></span>    <span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">scatter</span><span class="hljs-params">(<span class="hljs-type">const</span> ray&amp; r_in, <span class="hljs-type">const</span> hit_record&amp; rec, color&amp; attenuation, ray&amp; scattered)</span>
<span class="line"></span>    <span class="hljs-type">const</span> <span class="hljs-keyword">override</span> </span>{
<span class="line"></span>        attenuation = <span class="hljs-built_in">color</span>(<span class="hljs-number">1.0</span>, <span class="hljs-number">1.0</span>, <span class="hljs-number">1.0</span>);
<span class="line"></span>        <span class="hljs-type">double</span> refraction_ratio = rec.front_face ? (<span class="hljs-number">1.0</span>/ir) : ir;
<span class="line"></span>
<span class="line"></span>        vec3 unit_direction = <span class="hljs-built_in">unit_vector</span>(r_in.<span class="hljs-built_in">direction</span>());<div class=" highlight"><span class="line"></span>        <span class="hljs-type">double</span> cos_theta = <span class="hljs-built_in">fmin</span>(<span class="hljs-built_in">dot</span>(-unit_direction, rec.normal), <span class="hljs-number">1.0</span>);
<span class="line"></span>        <span class="hljs-type">double</span> sin_theta = <span class="hljs-built_in">sqrt</span>(<span class="hljs-number">1.0</span> - cos_theta*cos_theta);
<span class="line"></span>
<span class="line"></span>        <span class="hljs-type">bool</span> cannot_refract = refraction_ratio * sin_theta &gt; <span class="hljs-number">1.0</span>;
<span class="line"></span>        vec3 direction;
<span class="line"></span>
<span class="line"></span>        <span class="hljs-keyword">if</span> (cannot_refract)
<span class="line"></span>            direction = <span class="hljs-built_in">reflect</span>(unit_direction, rec.normal);
<span class="line"></span>        <span class="hljs-keyword">else</span>
<span class="line"></span>            direction = <span class="hljs-built_in">refract</span>(unit_direction, rec.normal, refraction_ratio);
<span class="line"></span>
<span class="line"></span>        scattered = <span class="hljs-built_in">ray</span>(rec.p, direction);</div><span class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
<span class="line"></span>    }
<span class="line"></span>
<span class="line"></span>  <span class="hljs-keyword">private</span>:
<span class="line"></span>    <span class="hljs-type">double</span> ir; <span class="hljs-comment">// Index of Refraction</span>
<span class="line"></span>};</code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_dielectric-with-refraction">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;70:</b> <kbd>[material.h]</kbd>
        Dielectric material class with reflection</div></center>
<p>


</p></div>

<p></p><p>

</p><div class="together">
Attenuation is always 1 — the glass surface absorbs nothing. If we try that out with these
parameters:

<p></p><pre class="listing tilde"><code><div class=" Highlight"><span class="line"></span><span class="hljs-keyword">auto</span> material_ground = <span class="hljs-built_in">make_shared</span>&lt;lambertian&gt;(<span class="hljs-built_in">color</span>(<span class="hljs-number">0.8</span>, <span class="hljs-number">0.8</span>, <span class="hljs-number">0.0</span>));
<span class="line"></span><span class="hljs-keyword">auto</span> material_center = <span class="hljs-built_in">make_shared</span>&lt;lambertian&gt;(<span class="hljs-built_in">color</span>(<span class="hljs-number">0.1</span>, <span class="hljs-number">0.2</span>, <span class="hljs-number">0.5</span>));
<span class="line"></span><span class="hljs-keyword">auto</span> material_left   = <span class="hljs-built_in">make_shared</span>&lt;dielectric&gt;(<span class="hljs-number">1.5</span>);
<span class="line"></span><span class="hljs-keyword">auto</span> material_right  = <span class="hljs-built_in">make_shared</span>&lt;metal&gt;(<span class="hljs-built_in">color</span>(<span class="hljs-number">0.8</span>, <span class="hljs-number">0.6</span>, <span class="hljs-number">0.2</span>), <span class="hljs-number">0.0</span>);</div></code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_scene-dielectric">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;71:</b> <kbd>[main.cc]</kbd> Scene with dielectric and shiny sphere</div></center>
<p>


</p></div>

<p></p><p>

</p><div class="together">
We get:

<p></p><p>

  </p><center><div class="image" style=""><a href="https://raytracing.github.io/images/img-1.17-glass-sometimes-refract.png" target="_blank"><img class="markdeep pixel" src="Ray%20Tracing%20in%20One%20Weekend_files/img-1.17-glass-sometimes-refract.png"></a><center><span class="imagecaption"><span class="num">Image 17:</span> Glass sphere that sometimes refracts
  </span></center></div></center>

<p></p><p>

</p></div>

<p></p>
<a class="target" name="schlickapproximation">&nbsp;</a><a class="target" name="dielectrics/schlickapproximation">&nbsp;</a><a class="target" name="toc11.4">&nbsp;</a><h2>Schlick Approximation</h2>
<p>

Now real glass has reflectivity that varies with angle — look at a window at a steep angle and it
becomes a mirror. There is a big ugly equation for that, but almost everybody uses a cheap and
surprisingly accurate polynomial approximation by Christophe Schlick. This yields our full glass
material:

</p><pre class="listing tilde"><code><span class="line"></span><span class="hljs-keyword">class</span> <span class="hljs-title class_">dielectric</span> : <span class="hljs-keyword">public</span> material {
<span class="line"></span>  <span class="hljs-keyword">public</span>:
<span class="line"></span>    <span class="hljs-built_in">dielectric</span>(<span class="hljs-type">double</span> index_of_refraction) : <span class="hljs-built_in">ir</span>(index_of_refraction) {}
<span class="line"></span>
<span class="line"></span>    <span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">scatter</span><span class="hljs-params">(<span class="hljs-type">const</span> ray&amp; r_in, <span class="hljs-type">const</span> hit_record&amp; rec, color&amp; attenuation, ray&amp; scattered)</span>
<span class="line"></span>    <span class="hljs-type">const</span> <span class="hljs-keyword">override</span> </span>{
<span class="line"></span>        attenuation = <span class="hljs-built_in">color</span>(<span class="hljs-number">1.0</span>, <span class="hljs-number">1.0</span>, <span class="hljs-number">1.0</span>);
<span class="line"></span>        <span class="hljs-type">double</span> refraction_ratio = rec.front_face ? (<span class="hljs-number">1.0</span>/ir) : ir;
<span class="line"></span>
<span class="line"></span>        vec3 unit_direction = <span class="hljs-built_in">unit_vector</span>(r_in.<span class="hljs-built_in">direction</span>());
<span class="line"></span>        <span class="hljs-type">double</span> cos_theta = <span class="hljs-built_in">fmin</span>(<span class="hljs-built_in">dot</span>(-unit_direction, rec.normal), <span class="hljs-number">1.0</span>);
<span class="line"></span>        <span class="hljs-type">double</span> sin_theta = <span class="hljs-built_in">sqrt</span>(<span class="hljs-number">1.0</span> - cos_theta*cos_theta);
<span class="line"></span>
<span class="line"></span>        <span class="hljs-type">bool</span> cannot_refract = refraction_ratio * sin_theta &gt; <span class="hljs-number">1.0</span>;
<span class="line"></span>        vec3 direction;
<span class="line"></span><div class=" highlight"><span class="line"></span>        <span class="hljs-keyword">if</span> (cannot_refract || <span class="hljs-built_in">reflectance</span>(cos_theta, refraction_ratio) &gt; <span class="hljs-built_in">random_double</span>())</div><span class="line"></span>            direction = <span class="hljs-built_in">reflect</span>(unit_direction, rec.normal);
<span class="line"></span>        <span class="hljs-keyword">else</span>
<span class="line"></span>            direction = <span class="hljs-built_in">refract</span>(unit_direction, rec.normal, refraction_ratio);
<span class="line"></span>
<span class="line"></span>        scattered = <span class="hljs-built_in">ray</span>(rec.p, direction);
<span class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
<span class="line"></span>    }
<span class="line"></span>
<span class="line"></span>  <span class="hljs-keyword">private</span>:
<span class="line"></span>    <span class="hljs-type">double</span> ir; <span class="hljs-comment">// Index of Refraction</span>
<span class="line"></span>
<span class="line"></span><div class=" highlight"><span class="line"></span>    <span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-type">double</span> <span class="hljs-title">reflectance</span><span class="hljs-params">(<span class="hljs-type">double</span> cosine, <span class="hljs-type">double</span> ref_idx)</span> </span>{
<span class="line"></span>        <span class="hljs-comment">// Use Schlick's approximation for reflectance.</span>
<span class="line"></span>        <span class="hljs-keyword">auto</span> r0 = (<span class="hljs-number">1</span>-ref_idx) / (<span class="hljs-number">1</span>+ref_idx);
<span class="line"></span>        r0 = r0*r0;
<span class="line"></span>        <span class="hljs-keyword">return</span> r0 + (<span class="hljs-number">1</span>-r0)*<span class="hljs-built_in">pow</span>((<span class="hljs-number">1</span> - cosine),<span class="hljs-number">5</span>);
<span class="line"></span>    }</div><span class="line"></span>};</code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_glass">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;72:</b> <kbd>[material.h]</kbd> Full glass material</div></center>

<a class="target" name="modelingahollowglasssphere">&nbsp;</a><a class="target" name="dielectrics/modelingahollowglasssphere">&nbsp;</a><a class="target" name="toc11.5">&nbsp;</a><h2>Modeling a Hollow Glass Sphere</h2>
<p>

An interesting and easy trick with dielectric spheres is to note that if you use a negative radius,
the geometry is unaffected, but the surface normal points inward. This can be used as a bubble to
make a hollow glass sphere:

</p><pre class="listing tilde"><code><span class="line"></span>...
<span class="line"></span>world.<span class="hljs-built_in">add</span>(<span class="hljs-built_in">make_shared</span>&lt;sphere&gt;(<span class="hljs-built_in">point3</span>( <span class="hljs-number">0.0</span>, <span class="hljs-number">-100.5</span>, <span class="hljs-number">-1.0</span>), <span class="hljs-number">100.0</span>, material_ground));
<span class="line"></span>world.<span class="hljs-built_in">add</span>(<span class="hljs-built_in">make_shared</span>&lt;sphere&gt;(<span class="hljs-built_in">point3</span>( <span class="hljs-number">0.0</span>,    <span class="hljs-number">0.0</span>, <span class="hljs-number">-1.0</span>),   <span class="hljs-number">0.5</span>, material_center));
<span class="line"></span>world.<span class="hljs-built_in">add</span>(<span class="hljs-built_in">make_shared</span>&lt;sphere&gt;(<span class="hljs-built_in">point3</span>(<span class="hljs-number">-1.0</span>,    <span class="hljs-number">0.0</span>, <span class="hljs-number">-1.0</span>),   <span class="hljs-number">0.5</span>, material_left));<div class=" highlight"><span class="line"></span>world.<span class="hljs-built_in">add</span>(<span class="hljs-built_in">make_shared</span>&lt;sphere&gt;(<span class="hljs-built_in">point3</span>(<span class="hljs-number">-1.0</span>,    <span class="hljs-number">0.0</span>, <span class="hljs-number">-1.0</span>),  <span class="hljs-number">-0.4</span>, material_left));</div><span class="line"></span>world.<span class="hljs-built_in">add</span>(<span class="hljs-built_in">make_shared</span>&lt;sphere&gt;(<span class="hljs-built_in">point3</span>( <span class="hljs-number">1.0</span>,    <span class="hljs-number">0.0</span>, <span class="hljs-number">-1.0</span>),   <span class="hljs-number">0.5</span>, material_right));
<span class="line"></span>...</code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_scene-hollow-glass">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;73:</b> <kbd>[main.cc]</kbd> Scene with hollow glass sphere</div></center>
<p>


</p><div class="together">
This gives:

<p></p><p>

  </p><center><div class="image" style=""><a href="https://raytracing.github.io/images/img-1.18-glass-hollow.png" target="_blank"><img class="markdeep pixel" src="Ray%20Tracing%20in%20One%20Weekend_files/img-1.18-glass-hollow.png"></a><center><span class="imagecaption"><span class="num">Image 18:</span> A hollow glass sphere
  </span></center></div></center>

<p></p><p>

</p></div>

<p></p>
<a class="target" name="positionablecamera">&nbsp;</a><a class="target" name="positionablecamera">&nbsp;</a><a class="target" name="toc12">&nbsp;</a><h1>Positionable Camera</h1>
<p>

Cameras, like dielectrics, are a pain to debug, so I always develop mine incrementally.
First, let’s allow for an adjustable field of view (<em class="underscore">fov</em>).
This is the visual angle from edge to edge of the rendered image.
Since our image is not square, the fov is different horizontally and vertically.
I always use vertical fov.
I also usually specify it in degrees and change to radians inside a constructor — a matter of
personal taste.

</p>
<a class="target" name="cameraviewinggeometry">&nbsp;</a><a class="target" name="positionablecamera/cameraviewinggeometry">&nbsp;</a><a class="target" name="toc12.1">&nbsp;</a><h2>Camera Viewing Geometry</h2>
<p>

First, we'll keep the rays coming from the origin and heading to the <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-161-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1724" style="width: 3.833em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.075em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.451em, 1003em, 2.501em, -1000em); top: -2.268em; left: 0em;"><span class="mrow" id="MathJax-Span-1725"><span class="mi" id="MathJax-Span-1726" style="font-family: MathJax_Math; font-style: italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-1727" style="font-family: MathJax_Main; padding-left: 0.278em;">=</span><span class="mo" id="MathJax-Span-1728" style="font-family: MathJax_Main; padding-left: 0.278em;">−</span><span class="mn" id="MathJax-Span-1729" style="font-family: MathJax_Main;">1</span></span><span style="display: inline-block; width: 0px; height: 2.268em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.164em; border-left: 0px solid; width: 0px; height: 1.053em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>z</mi><mo>=</mo><mo>−</mo><mn>1</mn></math></span></span><script type="math/tex" id="MathJax-Element-161">z = -1</script> plane. We could make
it the <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-162-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1730" style="width: 3.833em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.075em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.451em, 1003.02em, 2.501em, -1000em); top: -2.268em; left: 0em;"><span class="mrow" id="MathJax-Span-1731"><span class="mi" id="MathJax-Span-1732" style="font-family: MathJax_Math; font-style: italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-1733" style="font-family: MathJax_Main; padding-left: 0.278em;">=</span><span class="mo" id="MathJax-Span-1734" style="font-family: MathJax_Main; padding-left: 0.278em;">−</span><span class="mn" id="MathJax-Span-1735" style="font-family: MathJax_Main;">2</span></span><span style="display: inline-block; width: 0px; height: 2.268em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.164em; border-left: 0px solid; width: 0px; height: 1.053em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>z</mi><mo>=</mo><mo>−</mo><mn>2</mn></math></span></span><script type="math/tex" id="MathJax-Element-162">z = -2</script> plane, or whatever, as long as we made <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-163-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;h&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1736" style="width: 0.708em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.554em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.373em, 1000.53em, 2.38em, -1000em); top: -2.218em; left: 0em;"><span class="mrow" id="MathJax-Span-1737"><span class="mi" id="MathJax-Span-1738" style="font-family: MathJax_Math; font-style: italic;">h</span></span><span style="display: inline-block; width: 0px; height: 2.218em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.076em; border-left: 0px solid; width: 0px; height: 0.999em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>h</mi></math></span></span><script type="math/tex" id="MathJax-Element-163">h</script> a ratio to that distance. Here is our
setup:

</p><p>

  </p><center><div class="image" style=""><a href="https://raytracing.github.io/images/fig-1.18-cam-view-geom.jpg" target="_blank"><img class="markdeep" src="Ray%20Tracing%20in%20One%20Weekend_files/fig-1.18-cam-view-geom.jpg"></a><center><span class="imagecaption"><a class="target" name="figure_cam-view-geom">&nbsp;</a><b style="font-style:normal;">Figure&nbsp;18:</b> Camera viewing geometry (from the side)
  </span></center></div></center>

<p></p><p>

</p><div class="together">
This implies <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-164-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;h&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;tan&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mfrac&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/mfrac&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1739" style="width: 6.001em; display: inline-block;"><span style="display: inline-block; position: relative; width: 4.839em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.207em, 1004.74em, 2.795em, -1000em); top: -2.268em; left: 0em;"><span class="mrow" id="MathJax-Span-1740"><span class="mi" id="MathJax-Span-1741" style="font-family: MathJax_Math; font-style: italic;">h</span><span class="mo" id="MathJax-Span-1742" style="font-family: MathJax_Main; padding-left: 0.278em;">=</span><span class="mi" id="MathJax-Span-1743" style="font-family: MathJax_Main; padding-left: 0.278em;">tan</span><span class="mo" id="MathJax-Span-1744"></span><span class="mo" id="MathJax-Span-1745" style="font-family: MathJax_Main;">(</span><span class="mfrac" id="MathJax-Span-1746"><span style="display: inline-block; position: relative; width: 0.474em; height: 0px; margin-right: 0.12em; margin-left: 0.12em;"><span style="position: absolute; clip: rect(3.332em, 1000.33em, 4.14em, -1000em); top: -4.393em; left: 50%; margin-left: -0.166em;"><span class="mi" id="MathJax-Span-1747" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">θ</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; clip: rect(3.36em, 1000.32em, 4.133em, -1000em); top: -3.606em; left: 50%; margin-left: -0.177em;"><span class="mn" id="MathJax-Span-1748" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 3.982em;"></span></span><span style="position: absolute; clip: rect(0.844em, 1000.47em, 1.21em, -1000em); top: -1.278em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 0.474em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.058em;"></span></span></span></span><span class="mo" id="MathJax-Span-1749" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.268em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.528em; border-left: 0px solid; width: 0px; height: 1.719em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>h</mi><mo>=</mo><mi>tan</mi><mo>⁡</mo><mo stretchy="false">(</mo><mfrac><mi>θ</mi><mn>2</mn></mfrac><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-164">h = \tan(\frac{\theta}{2})</script>. Our camera now becomes:

<p></p><pre class="listing tilde"><code><span class="line"></span><span class="hljs-keyword">class</span> <span class="hljs-title class_">camera</span> {
<span class="line"></span>  <span class="hljs-keyword">public</span>:
<span class="line"></span>    <span class="hljs-type">double</span> aspect_ratio      = <span class="hljs-number">1.0</span>;  <span class="hljs-comment">// Ratio of image width over height</span>
<span class="line"></span>    <span class="hljs-type">int</span>    image_width       = <span class="hljs-number">100</span>;  <span class="hljs-comment">// Rendered image width in pixel count</span>
<span class="line"></span>    <span class="hljs-type">int</span>    samples_per_pixel = <span class="hljs-number">10</span>;   <span class="hljs-comment">// Count of random samples for each pixel</span>
<span class="line"></span>    <span class="hljs-type">int</span>    max_depth         = <span class="hljs-number">10</span>;   <span class="hljs-comment">// Maximum number of ray bounces into scene</span>
<span class="line"></span>
<span class="line"></span><div class=" highlight"><span class="line"></span>    <span class="hljs-type">double</span> vfov = <span class="hljs-number">90</span>;  <span class="hljs-comment">// Vertical view angle (field of view)</span></div><span class="line"></span>
<span class="line"></span>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">render</span><span class="hljs-params">(<span class="hljs-type">const</span> hittable&amp; world)</span> </span>{
<span class="line"></span>    ...
<span class="line"></span>
<span class="line"></span>  <span class="hljs-keyword">private</span>:
<span class="line"></span>    ...
<span class="line"></span>
<span class="line"></span>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">initialize</span><span class="hljs-params">()</span> </span>{
<span class="line"></span>        image_height = <span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">int</span>&gt;(image_width / aspect_ratio);
<span class="line"></span>        image_height = (image_height &lt; <span class="hljs-number">1</span>) ? <span class="hljs-number">1</span> : image_height;
<span class="line"></span>
<span class="line"></span>        center = <span class="hljs-built_in">point3</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);
<span class="line"></span>
<span class="line"></span>        <span class="hljs-comment">// Determine viewport dimensions.</span>
<span class="line"></span>        <span class="hljs-keyword">auto</span> focal_length = <span class="hljs-number">1.0</span>;<div class=" highlight"><span class="line"></span>        <span class="hljs-keyword">auto</span> theta = <span class="hljs-built_in">degrees_to_radians</span>(vfov);
<span class="line"></span>        <span class="hljs-keyword">auto</span> h = <span class="hljs-built_in">tan</span>(theta/<span class="hljs-number">2</span>);
<span class="line"></span>        <span class="hljs-keyword">auto</span> viewport_height = <span class="hljs-number">2</span> * h * focal_length;</div><span class="line"></span>        <span class="hljs-keyword">auto</span> viewport_width = viewport_height * (<span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">double</span>&gt;(image_width)/image_height);
<span class="line"></span>
<span class="line"></span>        <span class="hljs-comment">// Calculate the vectors across the horizontal and down the vertical viewport edges.</span>
<span class="line"></span>        <span class="hljs-keyword">auto</span> viewport_u = <span class="hljs-built_in">vec3</span>(viewport_width, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);
<span class="line"></span>        <span class="hljs-keyword">auto</span> viewport_v = <span class="hljs-built_in">vec3</span>(<span class="hljs-number">0</span>, -viewport_height, <span class="hljs-number">0</span>);
<span class="line"></span>
<span class="line"></span>        <span class="hljs-comment">// Calculate the horizontal and vertical delta vectors from pixel to pixel.</span>
<span class="line"></span>        pixel_delta_u = viewport_u / image_width;
<span class="line"></span>        pixel_delta_v = viewport_v / image_height;
<span class="line"></span>
<span class="line"></span>        <span class="hljs-comment">// Calculate the location of the upper left pixel.</span>
<span class="line"></span>        <span class="hljs-keyword">auto</span> viewport_upper_left =
<span class="line"></span>            center - <span class="hljs-built_in">vec3</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, focal_length) - viewport_u/<span class="hljs-number">2</span> - viewport_v/<span class="hljs-number">2</span>;
<span class="line"></span>        pixel00_loc = viewport_upper_left + <span class="hljs-number">0.5</span> * (pixel_delta_u + pixel_delta_v);
<span class="line"></span>    }
<span class="line"></span>
<span class="line"></span>    ...
<span class="line"></span>};</code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_camera-fov">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;74:</b> <kbd>[camera.h]</kbd> Camera with adjustable field-of-view (fov)</div></center>
<p>


</p></div>

<p></p><p>

</p><div class="together">
We'll test out these changes with a simple scene of two touching spheres, using a 90° field of view.

<p></p><pre class="listing tilde"><code><span class="line"></span><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
<span class="line"></span>    hittable_list world;
<span class="line"></span>
<span class="line"></span><div class=" highlight"><span class="line"></span>    <span class="hljs-keyword">auto</span> R = <span class="hljs-built_in">cos</span>(pi/<span class="hljs-number">4</span>);
<span class="line"></span>
<span class="line"></span>    <span class="hljs-keyword">auto</span> material_left  = <span class="hljs-built_in">make_shared</span>&lt;lambertian&gt;(<span class="hljs-built_in">color</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>));
<span class="line"></span>    <span class="hljs-keyword">auto</span> material_right = <span class="hljs-built_in">make_shared</span>&lt;lambertian&gt;(<span class="hljs-built_in">color</span>(<span class="hljs-number">1</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>));
<span class="line"></span>
<span class="line"></span>    world.<span class="hljs-built_in">add</span>(<span class="hljs-built_in">make_shared</span>&lt;sphere&gt;(<span class="hljs-built_in">point3</span>(-R, <span class="hljs-number">0</span>, <span class="hljs-number">-1</span>), R, material_left));
<span class="line"></span>    world.<span class="hljs-built_in">add</span>(<span class="hljs-built_in">make_shared</span>&lt;sphere&gt;(<span class="hljs-built_in">point3</span>( R, <span class="hljs-number">0</span>, <span class="hljs-number">-1</span>), R, material_right));</div><span class="line"></span>
<span class="line"></span>    camera cam;
<span class="line"></span>
<span class="line"></span>    cam.aspect_ratio      = <span class="hljs-number">16.0</span> / <span class="hljs-number">9.0</span>;
<span class="line"></span>    cam.image_width       = <span class="hljs-number">400</span>;
<span class="line"></span>    cam.samples_per_pixel = <span class="hljs-number">100</span>;
<span class="line"></span>    cam.max_depth         = <span class="hljs-number">50</span>;
<span class="line"></span>
<span class="line"></span><div class=" highlight"><span class="line"></span>    cam.vfov = <span class="hljs-number">90</span>;</div><span class="line"></span>
<span class="line"></span>    cam.<span class="hljs-built_in">render</span>(world);
<span class="line"></span>}</code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_scene-wide-angle">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;75:</b> <kbd>[main.cc]</kbd> Scene with wide-angle camera</div></center>
<p>


</p></div>

<p></p><p>

</p><div class="together">
This gives us the rendering:

<p></p><p>

  </p><center><div class="image" style=""><a href="https://raytracing.github.io/images/img-1.19-wide-view.png" target="_blank"><img class="markdeep pixel" src="Ray%20Tracing%20in%20One%20Weekend_files/img-1.19-wide-view.png"></a><center><span class="imagecaption"><span class="num">Image 19:</span> A wide-angle view
  </span></center></div></center>

<p></p><p>

</p></div>

<p></p>
<a class="target" name="positioningandorientingthecamera">&nbsp;</a><a class="target" name="positionablecamera/positioningandorientingthecamera">&nbsp;</a><a class="target" name="toc12.2">&nbsp;</a><h2>Positioning and Orienting the Camera</h2>
<p>

To get an arbitrary viewpoint, let’s first name the points we care about. We’ll call the position
where we place the camera <em class="underscore">lookfrom</em>, and the point we look at <em class="underscore">lookat</em>. (Later, if you want, you
could define a direction to look in instead of a point to look at.)

</p><p>

We also need a way to specify the roll, or sideways tilt, of the camera: the rotation around the
lookat-lookfrom axis.
Another way to think about it is that even if you keep <code>lookfrom</code> and <code>lookat</code> constant, you can
still rotate your head around your nose. What we need is a way to specify an “up” vector for the
camera.

</p><p>

  </p><center><div class="image" style=""><a href="https://raytracing.github.io/images/fig-1.19-cam-view-dir.jpg" target="_blank"><img class="markdeep" src="Ray%20Tracing%20in%20One%20Weekend_files/fig-1.19-cam-view-dir.jpg"></a><center><span class="imagecaption"><a class="target" name="figure_cam-view-dir">&nbsp;</a><b style="font-style:normal;">Figure&nbsp;19:</b> Camera view direction</span></center></div></center>

<p></p><p>

We can specify any up vector we want, as long as it's not parallel to the view direction.
Project this up vector onto the plane orthogonal to the view direction to get a camera-relative up
vector.
I use the common convention of naming this the “view up” (<em class="underscore">vup</em>) vector.
After a few cross products and vector normalizations, we now have a complete orthonormal basis
<span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-165-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;u&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;v&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;w&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1750" style="width: 4.287em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.427em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.367em, 1003.33em, 2.669em, -1000em); top: -2.268em; left: 0em;"><span class="mrow" id="MathJax-Span-1751"><span class="mo" id="MathJax-Span-1752" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-1753" style="font-family: MathJax_Math; font-style: italic;">u</span><span class="mo" id="MathJax-Span-1754" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-1755" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.167em;">v</span><span class="mo" id="MathJax-Span-1756" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-1757" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.167em;">w</span><span class="mo" id="MathJax-Span-1758" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.268em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.365em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">(</mo><mi>u</mi><mo>,</mo><mi>v</mi><mo>,</mo><mi>w</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-165">(u,v,w)</script> to describe our camera’s orientation.
<span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-166-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;u&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1759" style="width: 0.708em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.554em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.625em, 1000.53em, 2.38em, -1000em); top: -2.218em; left: 0em;"><span class="mrow" id="MathJax-Span-1760"><span class="mi" id="MathJax-Span-1761" style="font-family: MathJax_Math; font-style: italic;">u</span></span><span style="display: inline-block; width: 0px; height: 2.218em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.076em; border-left: 0px solid; width: 0px; height: 0.687em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>u</mi></math></span></span><script type="math/tex" id="MathJax-Element-166">u</script> will be the unit vector pointing to camera right, <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-167-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;v&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1762" style="width: 0.658em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.504em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.624em, 1000.49em, 2.38em, -1000em); top: -2.218em; left: 0em;"><span class="mrow" id="MathJax-Span-1763"><span class="mi" id="MathJax-Span-1764" style="font-family: MathJax_Math; font-style: italic;">v</span></span><span style="display: inline-block; width: 0px; height: 2.218em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.076em; border-left: 0px solid; width: 0px; height: 0.688em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>v</mi></math></span></span><script type="math/tex" id="MathJax-Element-167">v</script> is the unit vector pointing to camera up,
<span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-168-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;w&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1765" style="width: 0.91em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.706em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.624em, 1000.68em, 2.38em, -1000em); top: -2.218em; left: 0em;"><span class="mrow" id="MathJax-Span-1766"><span class="mi" id="MathJax-Span-1767" style="font-family: MathJax_Math; font-style: italic;">w</span></span><span style="display: inline-block; width: 0px; height: 2.218em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.076em; border-left: 0px solid; width: 0px; height: 0.688em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>w</mi></math></span></span><script type="math/tex" id="MathJax-Element-168">w</script> is the unit vector pointing opposite the view direction (since we use right-hand coordinates),
and the camera center is at the origin.

</p><p>

  </p><center><div class="image" style=""><a href="https://raytracing.github.io/images/fig-1.20-cam-view-up.jpg" target="_blank"><img class="markdeep" src="Ray%20Tracing%20in%20One%20Weekend_files/fig-1.20-cam-view-up.jpg"></a><center><span class="imagecaption"><a class="target" name="figure_cam-view-up">&nbsp;</a><b style="font-style:normal;">Figure&nbsp;20:</b> Camera view up direction</span></center></div></center>

<p></p><p>

Like before, when our fixed camera faced <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-169-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mi&gt;Z&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1768" style="width: 1.918em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.512em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.434em, 1001.51em, 2.501em, -1000em); top: -2.268em; left: 0em;"><span class="mrow" id="MathJax-Span-1769"><span class="mo" id="MathJax-Span-1770" style="font-family: MathJax_Main;">−</span><span class="mi" id="MathJax-Span-1771" style="font-family: MathJax_Math; font-style: italic;">Z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.04em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.268em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.164em; border-left: 0px solid; width: 0px; height: 1.074em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>−</mo><mi>Z</mi></math></span></span><script type="math/tex" id="MathJax-Element-169">-Z</script>, our arbitrary view camera faces <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-170-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mi&gt;w&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1772" style="width: 1.918em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.512em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.534em, 1001.49em, 2.501em, -1000em); top: -2.268em; left: 0em;"><span class="mrow" id="MathJax-Span-1773"><span class="mo" id="MathJax-Span-1774" style="font-family: MathJax_Main;">−</span><span class="mi" id="MathJax-Span-1775" style="font-family: MathJax_Math; font-style: italic;">w</span></span><span style="display: inline-block; width: 0px; height: 2.268em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.164em; border-left: 0px solid; width: 0px; height: 0.95em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>−</mo><mi>w</mi></math></span></span><script type="math/tex" id="MathJax-Element-170">-w</script>.
Keep in mind that we can — but we don’t have to — use world up <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-171-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1776" style="width: 3.934em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.175em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.317em, 1003.08em, 2.619em, -1000em); top: -2.218em; left: 0em;"><span class="mrow" id="MathJax-Span-1777"><span class="mo" id="MathJax-Span-1778" style="font-family: MathJax_Main;">(</span><span class="mn" id="MathJax-Span-1779" style="font-family: MathJax_Main;">0</span><span class="mo" id="MathJax-Span-1780" style="font-family: MathJax_Main;">,</span><span class="mn" id="MathJax-Span-1781" style="font-family: MathJax_Main; padding-left: 0.167em;">1</span><span class="mo" id="MathJax-Span-1782" style="font-family: MathJax_Main;">,</span><span class="mn" id="MathJax-Span-1783" style="font-family: MathJax_Main; padding-left: 0.167em;">0</span><span class="mo" id="MathJax-Span-1784" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.218em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.365em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">(</mo><mn>0</mn><mo>,</mo><mn>1</mn><mo>,</mo><mn>0</mn><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-171">(0,1,0)</script> to specify vup.
This is convenient and will naturally keep your camera horizontally level until you decide to
experiment with crazy camera angles.

</p><pre class="listing tilde"><code><span class="line"></span><span class="hljs-keyword">class</span> <span class="hljs-title class_">camera</span> {
<span class="line"></span>  <span class="hljs-keyword">public</span>:
<span class="line"></span>    <span class="hljs-type">double</span> aspect_ratio      = <span class="hljs-number">1.0</span>;  <span class="hljs-comment">// Ratio of image width over height</span>
<span class="line"></span>    <span class="hljs-type">int</span>    image_width       = <span class="hljs-number">100</span>;  <span class="hljs-comment">// Rendered image width in pixel count</span>
<span class="line"></span>    <span class="hljs-type">int</span>    samples_per_pixel = <span class="hljs-number">10</span>;   <span class="hljs-comment">// Count of random samples for each pixel</span>
<span class="line"></span>    <span class="hljs-type">int</span>    max_depth         = <span class="hljs-number">10</span>;   <span class="hljs-comment">// Maximum number of ray bounces into scene</span>
<span class="line"></span>
<span class="line"></span>    <span class="hljs-type">double</span> vfov     = <span class="hljs-number">90</span>;              <span class="hljs-comment">// Vertical view angle (field of view)</span><div class=" highlight"><span class="line"></span>    point3 lookfrom = <span class="hljs-built_in">point3</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">-1</span>);  <span class="hljs-comment">// Point camera is looking from</span>
<span class="line"></span>    point3 lookat   = <span class="hljs-built_in">point3</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);   <span class="hljs-comment">// Point camera is looking at</span>
<span class="line"></span>    vec3   vup      = <span class="hljs-built_in">vec3</span>(<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>);     <span class="hljs-comment">// Camera-relative "up" direction</span></div><span class="line"></span>
<span class="line"></span>    ...
<span class="line"></span>
<span class="line"></span>  <span class="hljs-keyword">private</span>:
<span class="line"></span>    <span class="hljs-type">int</span>    image_height;   <span class="hljs-comment">// Rendered image height</span>
<span class="line"></span>    point3 center;         <span class="hljs-comment">// Camera center</span>
<span class="line"></span>    point3 pixel00_loc;    <span class="hljs-comment">// Location of pixel 0, 0</span>
<span class="line"></span>    vec3   pixel_delta_u;  <span class="hljs-comment">// Offset to pixel to the right</span>
<span class="line"></span>    vec3   pixel_delta_v;  <span class="hljs-comment">// Offset to pixel below</span><div class=" highlight"><span class="line"></span>    vec3   u, v, w;        <span class="hljs-comment">// Camera frame basis vectors</span></div><span class="line"></span>
<span class="line"></span>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">initialize</span><span class="hljs-params">()</span> </span>{
<span class="line"></span>        image_height = <span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">int</span>&gt;(image_width / aspect_ratio);
<span class="line"></span>        image_height = (image_height &lt; <span class="hljs-number">1</span>) ? <span class="hljs-number">1</span> : image_height;
<span class="line"></span>
<span class="line"></span><div class=" highlight"><span class="line"></span>        center = lookfrom;</div><span class="line"></span>
<span class="line"></span>        <span class="hljs-comment">// Determine viewport dimensions.</span><div class=" highlight"><span class="line"></span>        <span class="hljs-keyword">auto</span> focal_length = (lookfrom - lookat).<span class="hljs-built_in">length</span>();</div><span class="line"></span>        <span class="hljs-keyword">auto</span> theta = <span class="hljs-built_in">degrees_to_radians</span>(vfov);
<span class="line"></span>        <span class="hljs-keyword">auto</span> h = <span class="hljs-built_in">tan</span>(theta/<span class="hljs-number">2</span>);
<span class="line"></span>        <span class="hljs-keyword">auto</span> viewport_height = <span class="hljs-number">2</span> * h * focal_length;
<span class="line"></span>        <span class="hljs-keyword">auto</span> viewport_width = viewport_height * (<span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">double</span>&gt;(image_width)/image_height);
<span class="line"></span>
<span class="line"></span><div class=" highlight"><span class="line"></span>        <span class="hljs-comment">// Calculate the u,v,w unit basis vectors for the camera coordinate frame.</span>
<span class="line"></span>        w = <span class="hljs-built_in">unit_vector</span>(lookfrom - lookat);
<span class="line"></span>        u = <span class="hljs-built_in">unit_vector</span>(<span class="hljs-built_in">cross</span>(vup, w));
<span class="line"></span>        v = <span class="hljs-built_in">cross</span>(w, u);</div><span class="line"></span>
<span class="line"></span>        <span class="hljs-comment">// Calculate the vectors across the horizontal and down the vertical viewport edges.</span><div class=" highlight"><span class="line"></span>        vec3 viewport_u = viewport_width * u;    <span class="hljs-comment">// Vector across viewport horizontal edge</span>
<span class="line"></span>        vec3 viewport_v = viewport_height * -v;  <span class="hljs-comment">// Vector down viewport vertical edge</span></div><span class="line"></span>
<span class="line"></span>        <span class="hljs-comment">// Calculate the horizontal and vertical delta vectors from pixel to pixel.</span>
<span class="line"></span>        pixel_delta_u = viewport_u / image_width;
<span class="line"></span>        pixel_delta_v = viewport_v / image_height;
<span class="line"></span>
<span class="line"></span>        <span class="hljs-comment">// Calculate the location of the upper left pixel.</span><div class=" highlight"><span class="line"></span>        <span class="hljs-keyword">auto</span> viewport_upper_left = center - (focal_length * w) - viewport_u/<span class="hljs-number">2</span> - viewport_v/<span class="hljs-number">2</span>;</div><span class="line"></span>        pixel00_loc = viewport_upper_left + <span class="hljs-number">0.5</span> * (pixel_delta_u + pixel_delta_v);
<span class="line"></span>    }
<span class="line"></span>
<span class="line"></span>    ...
<span class="line"></span>
<span class="line"></span>  <span class="hljs-keyword">private</span>:
<span class="line"></span>};</code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_camera-orient">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;76:</b> <kbd>[camera.h]</kbd> Positionable and orientable camera</div></center>
<p>


</p><div class="together">
We'll change back to the prior scene, and use the new viewpoint:

<p></p><pre class="listing tilde"><code><span class="line"></span><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
<span class="line"></span>    hittable_list world;
<span class="line"></span>
<span class="line"></span><div class=" highlight"><span class="line"></span>    <span class="hljs-keyword">auto</span> material_ground = <span class="hljs-built_in">make_shared</span>&lt;lambertian&gt;(<span class="hljs-built_in">color</span>(<span class="hljs-number">0.8</span>, <span class="hljs-number">0.8</span>, <span class="hljs-number">0.0</span>));
<span class="line"></span>    <span class="hljs-keyword">auto</span> material_center = <span class="hljs-built_in">make_shared</span>&lt;lambertian&gt;(<span class="hljs-built_in">color</span>(<span class="hljs-number">0.1</span>, <span class="hljs-number">0.2</span>, <span class="hljs-number">0.5</span>));
<span class="line"></span>    <span class="hljs-keyword">auto</span> material_left   = <span class="hljs-built_in">make_shared</span>&lt;dielectric&gt;(<span class="hljs-number">1.5</span>);
<span class="line"></span>    <span class="hljs-keyword">auto</span> material_right  = <span class="hljs-built_in">make_shared</span>&lt;metal&gt;(<span class="hljs-built_in">color</span>(<span class="hljs-number">0.8</span>, <span class="hljs-number">0.6</span>, <span class="hljs-number">0.2</span>), <span class="hljs-number">0.0</span>);
<span class="line"></span>
<span class="line"></span>    world.<span class="hljs-built_in">add</span>(<span class="hljs-built_in">make_shared</span>&lt;sphere&gt;(<span class="hljs-built_in">point3</span>( <span class="hljs-number">0.0</span>, <span class="hljs-number">-100.5</span>, <span class="hljs-number">-1.0</span>), <span class="hljs-number">100.0</span>, material_ground));
<span class="line"></span>    world.<span class="hljs-built_in">add</span>(<span class="hljs-built_in">make_shared</span>&lt;sphere&gt;(<span class="hljs-built_in">point3</span>( <span class="hljs-number">0.0</span>,    <span class="hljs-number">0.0</span>, <span class="hljs-number">-1.0</span>),   <span class="hljs-number">0.5</span>, material_center));
<span class="line"></span>    world.<span class="hljs-built_in">add</span>(<span class="hljs-built_in">make_shared</span>&lt;sphere&gt;(<span class="hljs-built_in">point3</span>(<span class="hljs-number">-1.0</span>,    <span class="hljs-number">0.0</span>, <span class="hljs-number">-1.0</span>),   <span class="hljs-number">0.5</span>, material_left));
<span class="line"></span>    world.<span class="hljs-built_in">add</span>(<span class="hljs-built_in">make_shared</span>&lt;sphere&gt;(<span class="hljs-built_in">point3</span>(<span class="hljs-number">-1.0</span>,    <span class="hljs-number">0.0</span>, <span class="hljs-number">-1.0</span>),  <span class="hljs-number">-0.4</span>, material_left));
<span class="line"></span>    world.<span class="hljs-built_in">add</span>(<span class="hljs-built_in">make_shared</span>&lt;sphere&gt;(<span class="hljs-built_in">point3</span>( <span class="hljs-number">1.0</span>,    <span class="hljs-number">0.0</span>, <span class="hljs-number">-1.0</span>),   <span class="hljs-number">0.5</span>, material_right));</div><span class="line"></span>
<span class="line"></span>    camera cam;
<span class="line"></span>
<span class="line"></span>    cam.aspect_ratio      = <span class="hljs-number">16.0</span> / <span class="hljs-number">9.0</span>;
<span class="line"></span>    cam.image_width       = <span class="hljs-number">400</span>;
<span class="line"></span>    cam.samples_per_pixel = <span class="hljs-number">100</span>;
<span class="line"></span>    cam.max_depth         = <span class="hljs-number">50</span>;
<span class="line"></span>
<span class="line"></span><div class=" highlight"><span class="line"></span>    cam.vfov     = <span class="hljs-number">90</span>;
<span class="line"></span>    cam.lookfrom = <span class="hljs-built_in">point3</span>(<span class="hljs-number">-2</span>,<span class="hljs-number">2</span>,<span class="hljs-number">1</span>);
<span class="line"></span>    cam.lookat   = <span class="hljs-built_in">point3</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">-1</span>);
<span class="line"></span>    cam.vup      = <span class="hljs-built_in">vec3</span>(<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>);</div><span class="line"></span>
<span class="line"></span>    cam.<span class="hljs-built_in">render</span>(world);
<span class="line"></span>}</code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_scene-free-view">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;77:</b> <kbd>[main.cc]</kbd> Scene with alternate viewpoint</div></center>
<p>


</p></div>

<p></p><p>

</p><div class="together">
to get:

<p></p><p>

  </p><center><div class="image" style=""><a href="https://raytracing.github.io/images/img-1.20-view-distant.png" target="_blank"><img class="markdeep pixel" src="Ray%20Tracing%20in%20One%20Weekend_files/img-1.20-view-distant.png"></a><center><span class="imagecaption"><span class="num">Image 20:</span> A distant view
  </span></center></div></center>

<p></p><p>

</p></div>

<p></p><p>

</p><div class="together">
And we can change field of view:

<p></p><pre class="listing tilde"><code><div class=" highlight"><span class="line"></span>    cam.vfov     = <span class="hljs-number">20</span>;</div></code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_change-field-view">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;78:</b> <kbd>[main.cc]</kbd> Change field of view</div></center>
<p>


</p></div>

<p></p><p>

</p><div class="together">
to get:

<p></p><p>

  </p><center><div class="image" style=""><a href="https://raytracing.github.io/images/img-1.21-view-zoom.png" target="_blank"><img class="markdeep pixel" src="Ray%20Tracing%20in%20One%20Weekend_files/img-1.21-view-zoom.png"></a><center><span class="imagecaption"><span class="num">Image 21:</span> Zooming in</span></center></div></center>

<p></p><p>

</p></div>

<p></p>
<a class="target" name="defocusblur">&nbsp;</a><a class="target" name="defocusblur">&nbsp;</a><a class="target" name="toc13">&nbsp;</a><h1>Defocus Blur</h1>
<p>

Now our final feature: <em class="underscore">defocus blur</em>.
Note, photographers call this <em class="underscore">depth of field</em>, so be sure to only use the term <em class="underscore">defocus blur</em> among
your raytracing friends.

</p><p>

The reason we have defocus blur in real cameras is because they need a big hole (rather than just a
pinhole) through which to gather light.
A large hole would defocus everything, but if we stick a lens in front of the film/sensor, there
will be a certain distance at which everything is in focus.
Objects placed at that distance will appear in focus and will linearly appear blurrier the further
they are from that distance.
You can think of a lens this way: all light rays coming <em class="underscore">from</em> a specific point at the focus
distance — and that hit the lens — will be bent back <em class="underscore">to</em> a single point on the image sensor.

</p><p>

We call the distance between the camera center and the plane where everything is in perfect focus
the <em class="underscore">focus distance</em>.
Be aware that the focus distance is not usually the same as the focal length — the <em class="underscore">focal length</em>
is the distance between the camera center and the image plane.
For our model, however, these two will have the same value, as we will put our pixel grid right on
the focus plane, which is <em class="underscore">focus distance</em> away from the camera center.

</p><p>

In a physical camera, the focus distance is controlled by the distance between the lens and the
film/sensor.
That is why you see the lens move relative to the camera when you change what is in focus (that may
happen in your phone camera too, but the sensor moves).
The “aperture” is a hole to control how big the lens is effectively.
For a real camera, if you need more light you make the aperture bigger, and will get more blur for
objects away from the focus distance.
For our virtual camera, we can have a perfect sensor and never need more light, so we only use an
aperture when we want defocus blur.

</p>
<a class="target" name="athinlensapproximation">&nbsp;</a><a class="target" name="defocusblur/athinlensapproximation">&nbsp;</a><a class="target" name="toc13.1">&nbsp;</a><h2>A Thin Lens Approximation</h2>
<p>

A real camera has a complicated compound lens. For our code, we could simulate the order: sensor,
then lens, then aperture. Then we could figure out where to send the rays, and flip the image after
it's computed (the image is projected upside down on the film). Graphics people, however, usually
use a thin lens approximation:

</p><p>

  </p><center><div class="image" style=""><a href="https://raytracing.github.io/images/fig-1.21-cam-lens.jpg" target="_blank"><img class="markdeep" src="Ray%20Tracing%20in%20One%20Weekend_files/fig-1.21-cam-lens.jpg"></a><center><span class="imagecaption"><a class="target" name="figure_cam-lens">&nbsp;</a><b style="font-style:normal;">Figure&nbsp;21:</b> Camera lens model</span></center></div></center>

<p></p><p>

We don’t need to simulate any of the inside of the camera — for the purposes of rendering an image
outside the camera, that would be unnecessary complexity.
Instead, I usually start rays from an infinitely thin circular “lens”, and send them toward the
pixel of interest on the focus plane (<code>focal_length</code> away from the lens), where everything on that
plane in the 3D world is in perfect focus.

</p><p>

In practice, we accomplish this by placing the viewport in this plane.
Putting everything together:

</p><p>

</p><ol start="1">
  <li class="number">The focus plane is orthogonal to the camera view direction.
</li>
  <li class="number">The focus distance is the distance between the camera center and the focus plane.
</li>
  <li class="number">The viewport lies on the focus plane, centered on the camera view direction vector.
</li>
  <li class="number">The grid of pixel locations lies inside the viewport (located in the 3D world).
</li>
  <li class="number">Random image sample locations are chosen from the region around the current pixel location.
</li>
  <li class="number">The camera fires rays from random points on the lens through the current image sample location.

<p></p><p>

</p></li></ol>
  <center><div class="image" style=""><a href="https://raytracing.github.io/images/fig-1.22-cam-film-plane.jpg" target="_blank"><img class="markdeep" src="Ray%20Tracing%20in%20One%20Weekend_files/fig-1.22-cam-film-plane.jpg"></a><center><span class="imagecaption"><a class="target" name="figure_cam-film-plane">&nbsp;</a><b style="font-style:normal;">Figure&nbsp;22:</b> Camera focus plane</span></center></div></center>

<p></p>
<a class="target" name="generatingsamplerays">&nbsp;</a><a class="target" name="defocusblur/generatingsamplerays">&nbsp;</a><a class="target" name="toc13.2">&nbsp;</a><h2>Generating Sample Rays</h2>
<p>

Without defocus blur, all scene rays originate from the camera center (or <code>lookfrom</code>).
In order to accomplish defocus blur, we construct a disk centered at the camera center.
The larger the radius, the greater the defocus blur.
You can think of our original camera as having a defocus disk of radius zero (no blur at all), so
all rays originated at the disk center (<code>lookfrom</code>).

</p><p>

So, how large should the defocus disk be?
Since the size of this disk controls how much defocus blur we get, that should be a parameter of the
camera class.
We could just take the radius of the disk as a camera parameter, but the blur would vary depending
on the projection distance.
A slightly easier parameter is to specify the angle of the cone with apex at viewport center and
base (defocus disk) at the camera center.
This should give you more consistent results as you vary the focus distance for a given shot.

</p><p>

Since we'll be choosing random points from the defocus disk, we'll need a function to do that:
<code>random_in_unit_disk()</code>.
This function works using the same kind of method we use in <code>random_in_unit_sphere()</code>, just for two
dimensions.

</p><pre class="listing tilde"><code><span class="line"></span><span class="hljs-function"><span class="hljs-keyword">inline</span> vec3 <span class="hljs-title">unit_vector</span><span class="hljs-params">(vec3 u)</span> </span>{
<span class="line"></span>    <span class="hljs-keyword">return</span> v / v.<span class="hljs-built_in">length</span>();
<span class="line"></span>}
<span class="line"></span>
<span class="line"></span><div class=" Highlight"><span class="line"></span><span class="hljs-function"><span class="hljs-keyword">inline</span> vec3 <span class="hljs-title">random_in_unit_disk</span><span class="hljs-params">()</span> </span>{
<span class="line"></span>    <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
<span class="line"></span>        <span class="hljs-keyword">auto</span> p = <span class="hljs-built_in">vec3</span>(<span class="hljs-built_in">random_double</span>(<span class="hljs-number">-1</span>,<span class="hljs-number">1</span>), <span class="hljs-built_in">random_double</span>(<span class="hljs-number">-1</span>,<span class="hljs-number">1</span>), <span class="hljs-number">0</span>);
<span class="line"></span>        <span class="hljs-keyword">if</span> (p.<span class="hljs-built_in">length_squared</span>() &lt; <span class="hljs-number">1</span>)
<span class="line"></span>            <span class="hljs-keyword">return</span> p;
<span class="line"></span>    }
<span class="line"></span>}</div></code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_rand-in-unit-disk">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;79:</b> <kbd>[vec3.h]</kbd> Generate random point inside unit disk</div></center>
<p>


Now let's update the camera to originate rays from the defocus disk:

</p><pre class="listing tilde"><code><span class="line"></span><span class="hljs-keyword">class</span> <span class="hljs-title class_">camera</span> {
<span class="line"></span>  <span class="hljs-keyword">public</span>:
<span class="line"></span>    <span class="hljs-type">double</span> aspect_ratio      = <span class="hljs-number">1.0</span>;  <span class="hljs-comment">// Ratio of image width over height</span>
<span class="line"></span>    <span class="hljs-type">int</span>    image_width       = <span class="hljs-number">100</span>;  <span class="hljs-comment">// Rendered image width in pixel count</span>
<span class="line"></span>    <span class="hljs-type">int</span>    samples_per_pixel = <span class="hljs-number">10</span>;   <span class="hljs-comment">// Count of random samples for each pixel</span>
<span class="line"></span>    <span class="hljs-type">int</span>    max_depth         = <span class="hljs-number">10</span>;   <span class="hljs-comment">// Maximum number of ray bounces into scene</span>
<span class="line"></span>
<span class="line"></span>    <span class="hljs-type">double</span> vfov     = <span class="hljs-number">90</span>;              <span class="hljs-comment">// Vertical view angle (field of view)</span>
<span class="line"></span>    point3 lookfrom = <span class="hljs-built_in">point3</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">-1</span>);  <span class="hljs-comment">// Point camera is looking from</span>
<span class="line"></span>    point3 lookat   = <span class="hljs-built_in">point3</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);   <span class="hljs-comment">// Point camera is looking at</span>
<span class="line"></span>    vec3   vup      = <span class="hljs-built_in">vec3</span>(<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>);     <span class="hljs-comment">// Camera-relative "up" direction</span>
<span class="line"></span>
<span class="line"></span><div class=" highlight"><span class="line"></span>    <span class="hljs-type">double</span> defocus_angle = <span class="hljs-number">0</span>;  <span class="hljs-comment">// Variation angle of rays through each pixel</span>
<span class="line"></span>    <span class="hljs-type">double</span> focus_dist = <span class="hljs-number">10</span>;    <span class="hljs-comment">// Distance from camera lookfrom point to plane of perfect focus</span></div><span class="line"></span>
<span class="line"></span>    ...
<span class="line"></span>
<span class="line"></span>  <span class="hljs-keyword">private</span>:
<span class="line"></span>    <span class="hljs-type">int</span>    image_height;    <span class="hljs-comment">// Rendered image height</span>
<span class="line"></span>    point3 center;          <span class="hljs-comment">// Camera center</span>
<span class="line"></span>    point3 pixel00_loc;     <span class="hljs-comment">// Location of pixel 0, 0</span>
<span class="line"></span>    vec3   pixel_delta_u;   <span class="hljs-comment">// Offset to pixel to the right</span>
<span class="line"></span>    vec3   pixel_delta_v;   <span class="hljs-comment">// Offset to pixel below</span>
<span class="line"></span>    vec3   u, v, w;         <span class="hljs-comment">// Camera frame basis vectors</span><div class=" highlight"><span class="line"></span>    vec3   defocus_disk_u;  <span class="hljs-comment">// Defocus disk horizontal radius</span>
<span class="line"></span>    vec3   defocus_disk_v;  <span class="hljs-comment">// Defocus disk vertical radius</span></div><span class="line"></span>
<span class="line"></span>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">initialize</span><span class="hljs-params">()</span> </span>{
<span class="line"></span>        image_height = <span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">int</span>&gt;(image_width / aspect_ratio);
<span class="line"></span>        image_height = (image_height &lt; <span class="hljs-number">1</span>) ? <span class="hljs-number">1</span> : image_height;
<span class="line"></span>
<span class="line"></span>        center = lookfrom;
<span class="line"></span>
<span class="line"></span>        <span class="hljs-comment">// Determine viewport dimensions.</span><div class=" delete"><span class="line"></span>        <span class="hljs-keyword">auto</span> focal_length = (lookfrom - lookat).<span class="hljs-built_in">length</span>();</div><span class="line"></span>        <span class="hljs-keyword">auto</span> theta = <span class="hljs-built_in">degrees_to_radians</span>(vfov);
<span class="line"></span>        <span class="hljs-keyword">auto</span> h = <span class="hljs-built_in">tan</span>(theta/<span class="hljs-number">2</span>);<div class=" highlight"><span class="line"></span>        <span class="hljs-keyword">auto</span> viewport_height = <span class="hljs-number">2</span> * h * focus_dist;</div><span class="line"></span>        <span class="hljs-keyword">auto</span> viewport_width = viewport_height * (<span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">double</span>&gt;(image_width)/image_height);
<span class="line"></span>
<span class="line"></span>        <span class="hljs-comment">// Calculate the u,v,w unit basis vectors for the camera coordinate frame.</span>
<span class="line"></span>        w = <span class="hljs-built_in">unit_vector</span>(lookfrom - lookat);
<span class="line"></span>        u = <span class="hljs-built_in">unit_vector</span>(<span class="hljs-built_in">cross</span>(vup, w));
<span class="line"></span>        v = <span class="hljs-built_in">cross</span>(w, u);
<span class="line"></span>
<span class="line"></span>        <span class="hljs-comment">// Calculate the vectors across the horizontal and down the vertical viewport edges.</span>
<span class="line"></span>        vec3 viewport_u = viewport_width * u;    <span class="hljs-comment">// Vector across viewport horizontal edge</span>
<span class="line"></span>        vec3 viewport_v = viewport_height * -v;  <span class="hljs-comment">// Vector down viewport vertical edge</span>
<span class="line"></span>
<span class="line"></span>        <span class="hljs-comment">// Calculate the horizontal and vertical delta vectors to the next pixel.</span>
<span class="line"></span>        pixel_delta_u = viewport_u / image_width;
<span class="line"></span>        pixel_delta_v = viewport_v / image_height;
<span class="line"></span>
<span class="line"></span>        <span class="hljs-comment">// Calculate the location of the upper left pixel.</span><div class=" highlight"><span class="line"></span>        <span class="hljs-keyword">auto</span> viewport_upper_left = center - (focus_dist * w) - viewport_u/<span class="hljs-number">2</span> - viewport_v/<span class="hljs-number">2</span>;</div><span class="line"></span>        pixel00_loc = viewport_upper_left + <span class="hljs-number">0.5</span> * (pixel_delta_u + pixel_delta_v);
<span class="line"></span>
<span class="line"></span><div class=" highlight"><span class="line"></span>        <span class="hljs-comment">// Calculate the camera defocus disk basis vectors.</span>
<span class="line"></span>        <span class="hljs-keyword">auto</span> defocus_radius = focus_dist * <span class="hljs-built_in">tan</span>(<span class="hljs-built_in">degrees_to_radians</span>(defocus_angle / <span class="hljs-number">2</span>));
<span class="line"></span>        defocus_disk_u = u * defocus_radius;
<span class="line"></span>        defocus_disk_v = v * defocus_radius;</div><span class="line"></span>    }
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>    <span class="hljs-function">ray <span class="hljs-title">get_ray</span><span class="hljs-params">(<span class="hljs-type">int</span> i, <span class="hljs-type">int</span> j)</span> <span class="hljs-type">const</span> </span>{<div class=" highlight"><span class="line"></span>        <span class="hljs-comment">// Get a randomly-sampled camera ray for the pixel at location i,j, originating from</span>
<span class="line"></span>        <span class="hljs-comment">// the camera defocus disk.</span></div><span class="line"></span>
<span class="line"></span>        <span class="hljs-keyword">auto</span> pixel_center = pixel00_loc + (i * pixel_delta_u) + (j * pixel_delta_v);
<span class="line"></span>        <span class="hljs-keyword">auto</span> pixel_sample = pixel_center + <span class="hljs-built_in">pixel_sample_square</span>();
<span class="line"></span>
<span class="line"></span><div class=" highlight"><span class="line"></span>        <span class="hljs-keyword">auto</span> ray_origin = (defocus_angle &lt;= <span class="hljs-number">0</span>) ? center : <span class="hljs-built_in">defocus_disk_sample</span>();</div><span class="line"></span>        <span class="hljs-keyword">auto</span> ray_direction = pixel_sample - ray_origin;
<span class="line"></span>
<span class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">ray</span>(ray_origin, ray_direction);
<span class="line"></span>    }
<span class="line"></span>
<span class="line"></span>    ...
<span class="line"></span><div class=" highlight"><span class="line"></span>    <span class="hljs-function">point3 <span class="hljs-title">defocus_disk_sample</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>{
<span class="line"></span>        <span class="hljs-comment">// Returns a random point in the camera defocus disk.</span>
<span class="line"></span>        <span class="hljs-keyword">auto</span> p = <span class="hljs-built_in">random_in_unit_disk</span>();
<span class="line"></span>        <span class="hljs-keyword">return</span> center + (p[<span class="hljs-number">0</span>] * defocus_disk_u) + (p[<span class="hljs-number">1</span>] * defocus_disk_v);
<span class="line"></span>    }</div><span class="line"></span>
<span class="line"></span>    <span class="hljs-function">color <span class="hljs-title">ray_color</span><span class="hljs-params">(<span class="hljs-type">const</span> ray&amp; r, <span class="hljs-type">int</span> depth, <span class="hljs-type">const</span> hittable&amp; world)</span> <span class="hljs-type">const</span> </span>{
<span class="line"></span>    ...
<span class="line"></span>};</code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_camera-dof">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;80:</b> <kbd>[camera.h]</kbd> Camera with adjustable depth-of-field (dof)</div></center>
<p>


</p><div class="together">
Using a large aperture:

<p></p><pre class="listing tilde"><code><span class="line"></span><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
<span class="line"></span>    ...
<span class="line"></span>
<span class="line"></span>    camera cam;
<span class="line"></span>
<span class="line"></span>    cam.aspect_ratio      = <span class="hljs-number">16.0</span> / <span class="hljs-number">9.0</span>;
<span class="line"></span>    cam.image_width       = <span class="hljs-number">400</span>;
<span class="line"></span>    cam.samples_per_pixel = <span class="hljs-number">100</span>;
<span class="line"></span>    cam.max_depth         = <span class="hljs-number">50</span>;
<span class="line"></span>
<span class="line"></span>    cam.vfov     = <span class="hljs-number">20</span>;
<span class="line"></span>    cam.lookfrom = <span class="hljs-built_in">point3</span>(<span class="hljs-number">-2</span>,<span class="hljs-number">2</span>,<span class="hljs-number">1</span>);
<span class="line"></span>    cam.lookat   = <span class="hljs-built_in">point3</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">-1</span>);
<span class="line"></span>    cam.vup      = <span class="hljs-built_in">vec3</span>(<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>);
<span class="line"></span>
<span class="line"></span><div class=" highlight"><span class="line"></span>    cam.defocus_angle = <span class="hljs-number">10.0</span>;
<span class="line"></span>    cam.focus_dist    = <span class="hljs-number">3.4</span>;</div><span class="line"></span>
<span class="line"></span>    cam.<span class="hljs-built_in">render</span>(world);
<span class="line"></span>}</code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_scene-camera-dof">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;81:</b> <kbd>[main.cc]</kbd> Scene camera with depth-of-field</div></center>
<p>


</p></div>

<p></p><p>

</p><div class="together">
We get:

<p></p><p>

  </p><center><div class="image" style=""><a href="https://raytracing.github.io/images/img-1.22-depth-of-field.png" target="_blank"><img class="markdeep pixel" src="Ray%20Tracing%20in%20One%20Weekend_files/img-1.22-depth-of-field.png"></a><center><span class="imagecaption"><span class="num">Image 22:</span> Spheres with depth-of-field
  </span></center></div></center>

<p></p><p>

</p></div>

<p></p>
<a class="target" name="wherenext?">&nbsp;</a><a class="target" name="wherenext?">&nbsp;</a><a class="target" name="toc14">&nbsp;</a><h1>Where Next?</h1>

<a class="target" name="afinalrender">&nbsp;</a><a class="target" name="wherenext?/afinalrender">&nbsp;</a><a class="target" name="toc14.1">&nbsp;</a><h2>A Final Render</h2>
<p>

Let’s make the image on the cover of this book — lots of random spheres.

</p><pre class="listing tilde"><code><span class="line"></span><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
<span class="line"></span>    hittable_list world;
<span class="line"></span>
<span class="line"></span><div class=" Highlight"><span class="line"></span>    <span class="hljs-keyword">auto</span> ground_material = <span class="hljs-built_in">make_shared</span>&lt;lambertian&gt;(<span class="hljs-built_in">color</span>(<span class="hljs-number">0.5</span>, <span class="hljs-number">0.5</span>, <span class="hljs-number">0.5</span>));
<span class="line"></span>    world.<span class="hljs-built_in">add</span>(<span class="hljs-built_in">make_shared</span>&lt;sphere&gt;(<span class="hljs-built_in">point3</span>(<span class="hljs-number">0</span>,<span class="hljs-number">-1000</span>,<span class="hljs-number">0</span>), <span class="hljs-number">1000</span>, ground_material));
<span class="line"></span>
<span class="line"></span>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> a = <span class="hljs-number">-11</span>; a &lt; <span class="hljs-number">11</span>; a++) {
<span class="line"></span>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> b = <span class="hljs-number">-11</span>; b &lt; <span class="hljs-number">11</span>; b++) {
<span class="line"></span>            <span class="hljs-keyword">auto</span> choose_mat = <span class="hljs-built_in">random_double</span>();
<span class="line"></span>            <span class="hljs-function">point3 <span class="hljs-title">center</span><span class="hljs-params">(a + <span class="hljs-number">0.9</span>*random_double(), <span class="hljs-number">0.2</span>, b + <span class="hljs-number">0.9</span>*random_double())</span></span>;
<span class="line"></span>
<span class="line"></span>            <span class="hljs-keyword">if</span> ((center - <span class="hljs-built_in">point3</span>(<span class="hljs-number">4</span>, <span class="hljs-number">0.2</span>, <span class="hljs-number">0</span>)).<span class="hljs-built_in">length</span>() &gt; <span class="hljs-number">0.9</span>) {
<span class="line"></span>                shared_ptr&lt;material&gt; sphere_material;
<span class="line"></span>
<span class="line"></span>                <span class="hljs-keyword">if</span> (choose_mat &lt; <span class="hljs-number">0.8</span>) {
<span class="line"></span>                    <span class="hljs-comment">// diffuse</span>
<span class="line"></span>                    <span class="hljs-keyword">auto</span> albedo = color::<span class="hljs-built_in">random</span>() * color::<span class="hljs-built_in">random</span>();
<span class="line"></span>                    sphere_material = <span class="hljs-built_in">make_shared</span>&lt;lambertian&gt;(albedo);
<span class="line"></span>                    world.<span class="hljs-built_in">add</span>(<span class="hljs-built_in">make_shared</span>&lt;sphere&gt;(center, <span class="hljs-number">0.2</span>, sphere_material));
<span class="line"></span>                } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (choose_mat &lt; <span class="hljs-number">0.95</span>) {
<span class="line"></span>                    <span class="hljs-comment">// metal</span>
<span class="line"></span>                    <span class="hljs-keyword">auto</span> albedo = color::<span class="hljs-built_in">random</span>(<span class="hljs-number">0.5</span>, <span class="hljs-number">1</span>);
<span class="line"></span>                    <span class="hljs-keyword">auto</span> fuzz = <span class="hljs-built_in">random_double</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0.5</span>);
<span class="line"></span>                    sphere_material = <span class="hljs-built_in">make_shared</span>&lt;metal&gt;(albedo, fuzz);
<span class="line"></span>                    world.<span class="hljs-built_in">add</span>(<span class="hljs-built_in">make_shared</span>&lt;sphere&gt;(center, <span class="hljs-number">0.2</span>, sphere_material));
<span class="line"></span>                } <span class="hljs-keyword">else</span> {
<span class="line"></span>                    <span class="hljs-comment">// glass</span>
<span class="line"></span>                    sphere_material = <span class="hljs-built_in">make_shared</span>&lt;dielectric&gt;(<span class="hljs-number">1.5</span>);
<span class="line"></span>                    world.<span class="hljs-built_in">add</span>(<span class="hljs-built_in">make_shared</span>&lt;sphere&gt;(center, <span class="hljs-number">0.2</span>, sphere_material));
<span class="line"></span>                }
<span class="line"></span>            }
<span class="line"></span>        }
<span class="line"></span>    }
<span class="line"></span>
<span class="line"></span>    <span class="hljs-keyword">auto</span> material1 = <span class="hljs-built_in">make_shared</span>&lt;dielectric&gt;(<span class="hljs-number">1.5</span>);
<span class="line"></span>    world.<span class="hljs-built_in">add</span>(<span class="hljs-built_in">make_shared</span>&lt;sphere&gt;(<span class="hljs-built_in">point3</span>(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>), <span class="hljs-number">1.0</span>, material1));
<span class="line"></span>
<span class="line"></span>    <span class="hljs-keyword">auto</span> material2 = <span class="hljs-built_in">make_shared</span>&lt;lambertian&gt;(<span class="hljs-built_in">color</span>(<span class="hljs-number">0.4</span>, <span class="hljs-number">0.2</span>, <span class="hljs-number">0.1</span>));
<span class="line"></span>    world.<span class="hljs-built_in">add</span>(<span class="hljs-built_in">make_shared</span>&lt;sphere&gt;(<span class="hljs-built_in">point3</span>(<span class="hljs-number">-4</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>), <span class="hljs-number">1.0</span>, material2));
<span class="line"></span>
<span class="line"></span>    <span class="hljs-keyword">auto</span> material3 = <span class="hljs-built_in">make_shared</span>&lt;metal&gt;(<span class="hljs-built_in">color</span>(<span class="hljs-number">0.7</span>, <span class="hljs-number">0.6</span>, <span class="hljs-number">0.5</span>), <span class="hljs-number">0.0</span>);
<span class="line"></span>    world.<span class="hljs-built_in">add</span>(<span class="hljs-built_in">make_shared</span>&lt;sphere&gt;(<span class="hljs-built_in">point3</span>(<span class="hljs-number">4</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>), <span class="hljs-number">1.0</span>, material3));</div><span class="line"></span>
<span class="line"></span>    camera cam;
<span class="line"></span>
<span class="line"></span><div class=" Highlight"><span class="line"></span>    cam.aspect_ratio      = <span class="hljs-number">16.0</span> / <span class="hljs-number">9.0</span>;
<span class="line"></span>    cam.image_width       = <span class="hljs-number">1200</span>;
<span class="line"></span>    cam.samples_per_pixel = <span class="hljs-number">500</span>;
<span class="line"></span>    cam.max_depth         = <span class="hljs-number">50</span>;
<span class="line"></span>
<span class="line"></span>    cam.vfov     = <span class="hljs-number">20</span>;
<span class="line"></span>    cam.lookfrom = <span class="hljs-built_in">point3</span>(<span class="hljs-number">13</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>);
<span class="line"></span>    cam.lookat   = <span class="hljs-built_in">point3</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);
<span class="line"></span>    cam.vup      = <span class="hljs-built_in">vec3</span>(<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>);
<span class="line"></span>
<span class="line"></span>    cam.defocus_angle = <span class="hljs-number">0.6</span>;
<span class="line"></span>    cam.focus_dist    = <span class="hljs-number">10.0</span>;</div><span class="line"></span>
<span class="line"></span>    cam.<span class="hljs-built_in">render</span>(world);
<span class="line"></span>}</code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_scene-final">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;82:</b> <kbd>[main.cc]</kbd> Final scene</div></center>
<p>


(Note that the code above differs slightly from the project sample code: the <code>samples_per_pixel</code> is
set to 500 above for a high-quality image that will take quite a while to render.
The sample code uses a value of 10 in the interest of reasonable run times while developing and
validating.)

</p><p>

</p><div class="together">
This gives:

<p></p><p>

  </p><center><div class="image" style=""><a href="https://raytracing.github.io/images/img-1.23-book1-final.jpg" target="_blank"><img class="markdeep" src="Ray%20Tracing%20in%20One%20Weekend_files/img-1.23-book1-final.jpg"></a><center><span class="imagecaption"><span class="num">Image 23:</span> Final scene</span></center></div></center>

<p></p><p>

</p></div>

<p></p><p>

An interesting thing you might note is the glass balls don’t really have shadows which makes them
look like they are floating. This is not a bug — you don’t see glass balls much in real life, where
they also look a bit strange, and indeed seem to float on cloudy days. A point on the big sphere
under a glass ball still has lots of light hitting it because the sky is re-ordered rather than
blocked.

</p>
<a class="target" name="nextsteps">&nbsp;</a><a class="target" name="wherenext?/nextsteps">&nbsp;</a><a class="target" name="toc14.2">&nbsp;</a><h2>Next Steps</h2>
<p>

You now have a cool ray tracer! What next?

</p><p>

</p><ol start="1">
  <li class="number">Lights — You can do this explicitly, by sending shadow rays to lights, or it can be done
       implicitly by making some objects emit light, biasing scattered rays toward them, and then
       downweighting those rays to cancel out the bias. Both work. I am in the minority in favoring
       the latter approach.

<p></p><p>

</p></li>
  <li class="number">Triangles — Most cool models are in triangle form. The model I/O is the worst and almost
       everybody tries to get somebody else’s code to do this.

<p></p><p>

</p></li>
  <li class="number">Surface Textures — This lets you paste images on like wall paper. Pretty easy and a good thing
       to do.

<p></p><p>

</p></li>
  <li class="number">Solid textures — Ken Perlin has his code online. Andrew Kensler has some very cool info at his
       blog.

<p></p><p>

</p></li>
  <li class="number">Volumes and Media — Cool stuff and will challenge your software architecture. I favor making
       volumes have the hittable interface and probabilistically have intersections based on density.
       Your rendering code doesn’t even have to know it has volumes with that method.

<p></p><p>

</p></li>
  <li class="number">Parallelism — Run <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-172-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1785" style="width: 1.162em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.907em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.384em, 1000.91em, 2.369em, -1000em); top: -2.218em; left: 0em;"><span class="mrow" id="MathJax-Span-1786"><span class="mi" id="MathJax-Span-1787" style="font-family: MathJax_Math; font-style: italic;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.085em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.218em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.063em; border-left: 0px solid; width: 0px; height: 0.972em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>N</mi></math></span></span><script type="math/tex" id="MathJax-Element-172">N</script> copies of your code on <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-173-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1788" style="width: 1.162em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.907em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.384em, 1000.91em, 2.369em, -1000em); top: -2.218em; left: 0em;"><span class="mrow" id="MathJax-Span-1789"><span class="mi" id="MathJax-Span-1790" style="font-family: MathJax_Math; font-style: italic;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.085em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.218em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.063em; border-left: 0px solid; width: 0px; height: 0.972em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>N</mi></math></span></span><script type="math/tex" id="MathJax-Element-173">N</script> cores with different random seeds. Average
       the <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-174-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1791" style="width: 1.162em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.907em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.384em, 1000.91em, 2.369em, -1000em); top: -2.218em; left: 0em;"><span class="mrow" id="MathJax-Span-1792"><span class="mi" id="MathJax-Span-1793" style="font-family: MathJax_Math; font-style: italic;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.085em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.218em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.063em; border-left: 0px solid; width: 0px; height: 0.972em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>N</mi></math></span></span><script type="math/tex" id="MathJax-Element-174">N</script> runs. This averaging can also be done hierarchically where <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-175-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;/&lt;/mo&gt;&lt;/mrow&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1794" style="width: 2.321em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.865em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.367em, 1001.81em, 2.669em, -1000em); top: -2.268em; left: 0em;"><span class="mrow" id="MathJax-Span-1795"><span class="mi" id="MathJax-Span-1796" style="font-family: MathJax_Math; font-style: italic;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.085em;"></span></span><span class="texatom" id="MathJax-Span-1797"><span class="mrow" id="MathJax-Span-1798"><span class="mo" id="MathJax-Span-1799" style="font-family: MathJax_Main;">/</span></span></span><span class="mn" id="MathJax-Span-1800" style="font-family: MathJax_Main;">2</span></span><span style="display: inline-block; width: 0px; height: 2.268em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.365em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>N</mi><mrow class="MJX-TeXAtom-ORD"><mo>/</mo></mrow><mn>2</mn></math></span></span><script type="math/tex" id="MathJax-Element-175">N/2</script> pairs can be averaged
       to get <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-176-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;/&lt;/mo&gt;&lt;/mrow&gt;&lt;mn&gt;4&lt;/mn&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1801" style="width: 2.321em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.865em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.367em, 1001.84em, 2.669em, -1000em); top: -2.268em; left: 0em;"><span class="mrow" id="MathJax-Span-1802"><span class="mi" id="MathJax-Span-1803" style="font-family: MathJax_Math; font-style: italic;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.085em;"></span></span><span class="texatom" id="MathJax-Span-1804"><span class="mrow" id="MathJax-Span-1805"><span class="mo" id="MathJax-Span-1806" style="font-family: MathJax_Main;">/</span></span></span><span class="mn" id="MathJax-Span-1807" style="font-family: MathJax_Main;">4</span></span><span style="display: inline-block; width: 0px; height: 2.268em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.365em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>N</mi><mrow class="MJX-TeXAtom-ORD"><mo>/</mo></mrow><mn>4</mn></math></span></span><script type="math/tex" id="MathJax-Element-176">N/4</script> images, and pairs of those can be averaged. That method of parallelism should
       extend well into the thousands of cores with very little coding.</li></ol>

<p></p><p>

Have fun, and please send me your cool images!

</p>
<a class="target" name="acknowledgments">&nbsp;</a><a class="target" name="acknowledgments">&nbsp;</a><a class="target" name="toc15">&nbsp;</a><h1>Acknowledgments</h1>
<p>


</p><div class="credit-list"> <strong class="asterisk">Original Manuscript Help</strong>

<p></p><p>

</p><ul>
  <li class="minus">Dave Hart
</li>
  <li class="minus">Jean Buckley</li></ul>

<p></p><p>

</p></div>

<p></p><p>

</p><div class="credit-list"> <strong class="asterisk">Web Release</strong>

<p></p><p>

</p><ul>
  <li class="minus"><a href="https://github.com/bernakabadayi">Berna Kabadayı</a>
</li>
  <li class="minus"><a href="https://github.com/lmancini">Lorenzo Mancini</a>
</li>
  <li class="minus"><a href="https://github.com/lorihollasch">Lori Whippler Hollasch</a>
</li>
  <li class="minus"><a href="https://github.com/ronaldfw">Ronald Wotzlaw</a></li></ul>

<p></p><p>

</p></div>

<p></p><p>

</p><div class="credit-list"> <strong class="asterisk">Corrections and Improvements</strong>

<p></p><p>

</p><ul>
  <li class="minus"><a href="https://github.com/jammm">Aaryaman Vasishta</a>
</li>
  <li class="minus">Andrew Kensler
</li>
  <li class="minus"><a href="https://github.com/antoniogamiz">Antonio Gamiz</a>
</li>
  <li class="minus">Apoorva Joshi
</li>
  <li class="minus"><a href="https://github.com/aras-p">Aras Pranckevičius</a>
</li>
  <li class="minus">Becker
</li>
  <li class="minus">Ben Kerl
</li>
  <li class="minus">Benjamin Summerton
</li>
  <li class="minus">Bennett Hardwick
</li>
  <li class="minus">Dan Drummond
</li>
  <li class="minus"><a href="https://github.com/dafhi">David Chambers</a>
</li>
  <li class="minus">David Hart
</li>
  <li class="minus"><a href="https://github.com/mu-lambda">Dmitry Lomov</a>
</li>
  <li class="minus"><a href="https://github.com/erich666">Eric Haines</a>
</li>
  <li class="minus">Fabio Sancinetti
</li>
  <li class="minus">Filipe Scur
</li>
  <li class="minus">Frank He
</li>
  <li class="minus"><a href="https://github.com/celeph">Gerrit Wessendorf</a>
</li>
  <li class="minus">Grue Debry
</li>
  <li class="minus"><a href="https://github.com/xaldew">Gustaf Waldemarson</a>
</li>
  <li class="minus">Ingo Wald
</li>
  <li class="minus">Jason Stone
</li>
  <li class="minus"><a href="https://github.com/JC-ProgJava">JC-ProgJava</a>
</li>
  <li class="minus">Jean Buckley
</li>
  <li class="minus">Joey Cho
</li>
  <li class="minus"><a href="https://github.com/rjkilpatrick">John Kilpatrick</a>
</li>
  <li class="minus"><a href="https://github.com/D-K-E">Kaan Eraslan</a>
</li>
  <li class="minus"><a href="https://github.com/lmancini">Lorenzo Mancini</a>
</li>
  <li class="minus"><a href="https://github.com/manas96">Manas Kale</a>
</li>
  <li class="minus">Marcus Ottosson
</li>
  <li class="minus"><a href="https://github.com/mrmcsoftware">Mark Craig</a>
</li>
  <li class="minus">Matthew Heimlich
</li>
  <li class="minus">Nakata Daisuke
</li>
  <li class="minus">Paul Melis
</li>
  <li class="minus">Phil Cristensen
</li>
  <li class="minus"><a href="https://github.com/LollipopFt">LollipopFt</a>
</li>
  <li class="minus"><a href="https://github.com/ronaldfw">Ronald Wotzlaw</a>
</li>
  <li class="minus"><a href="https://github.com/shaunplee">Shaun P. Lee</a>
</li>
  <li class="minus"><a href="https://github.com/estshorter">Shota Kawajiri</a>
</li>
  <li class="minus">Tatsuya Ogawa
</li>
  <li class="minus">Thiago Ize
</li>
  <li class="minus">Vahan Sosoyan
</li>
  <li class="minus"><a href="https://github.com/ymherklotz">Yann Herklotz</a>
</li>
  <li class="minus"><a href="https://github.com/oxine">ZeHao Chen</a></li></ul>

<p></p><p>

</p></div>

<p></p><p>

</p><div class="credit-list"> <strong class="asterisk">Special Thanks</strong>

<p></p><p>

  </p><div class="indented">
  Thanks to the team at <a href="https://limnu.com/">Limnu</a> for help on the figures.

<p></p><p>

  These books are entirely written in Morgan McGuire's fantastic and free
  <a href="https://casual-effects.com/markdeep/">Markdeep</a> library. To see what this looks like, view the
  page source from your browser.

</p><p>

  Thanks to <a href="https://github.com/hhu">Helen Hu</a> for graciously donating her
  <a href="https://github.com/RayTracing/" class="url">https://github.com/RayTracing/</a> GitHub organization to this project.

</p><p>

  </p></div>
</div>

<p></p><p>

<link rel="stylesheet" href="Ray%20Tracing%20in%20One%20Weekend_files/book.css">

</p>
<a class="target" name="citingthisbook">&nbsp;</a><a class="target" name="citingthisbook">&nbsp;</a><a class="target" name="toc16">&nbsp;</a><h1>Citing This Book</h1>
<p>

Consistent citations make it easier to identify the source, location and versions of this work. If
you are citing this book, we ask that you try to use one of the following forms if possible.

</p>
<a class="target" name="basicdata">&nbsp;</a><a class="target" name="citingthisbook/basicdata">&nbsp;</a><a class="target" name="toc16.1">&nbsp;</a><h2>Basic Data</h2>
<p>


</p><ul>
  <li class="minus"><strong class="asterisk">Title (series)</strong>: “Ray Tracing in One Weekend Series”
</li>
  <li class="minus"><strong class="asterisk">Title (book)</strong>: “Ray Tracing in One Weekend”
</li>
  <li class="minus"><strong class="asterisk">Author</strong>: Peter Shirley, Trevor David Black, Steve Hollasch
</li>
  <li class="minus"><strong class="asterisk">Version/Edition</strong>: v4.0.0-alpha.1
</li>
  <li class="minus"><strong class="asterisk">Date</strong>: 2023-08-06
</li>
  <li class="minus"><strong class="asterisk">URL (series)</strong>: <a href="https://raytracing.github.io/" class="url">https://raytracing.github.io/</a>
</li>
  <li class="minus"><strong class="asterisk">URL (book)</strong>: <a href="https://raytracing.github.io/books/RayTracingInOneWeekend.html" class="url">https://raytracing.github.io/books/RayTracingInOneWeekend.html</a></li></ul>

<p></p>
<a class="target" name="snippets">&nbsp;</a><a class="target" name="citingthisbook/snippets">&nbsp;</a><a class="target" name="toc16.2">&nbsp;</a><h2>Snippets</h2>

<a class="target" name="markdown">&nbsp;</a><a class="target" name="citingthisbook/snippets/markdown">&nbsp;</a><a class="target" name="toc16.2.1">&nbsp;</a><h3>Markdown</h3>
<pre class="listing tilde"><code><span class="line"></span>[<span class="hljs-meta">_Ray Tracing in One Weekend_</span>](https:<span class="hljs-comment">//raytracing.github.io/books/RayTracingInOneWeekend.html)</span></code></pre>
<a class="target" name="html">&nbsp;</a><a class="target" name="citingthisbook/snippets/html">&nbsp;</a><a class="target" name="toc16.2.2">&nbsp;</a><h3>HTML</h3>
<pre class="listing tilde"><code><span class="line"></span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"https://raytracing.github.io/books/RayTracingInOneWeekend.html"</span>&gt;</span>
<span class="line"></span>    <span class="hljs-tag">&lt;<span class="hljs-name">cite</span>&gt;</span>Ray Tracing in One Weekend<span class="hljs-tag">&lt;/<span class="hljs-name">cite</span>&gt;</span>
<span class="line"></span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></code></pre>
<a class="target" name="latexandbibtex">&nbsp;</a><a class="target" name="citingthisbook/snippets/latexandbibtex">&nbsp;</a><a class="target" name="toc16.2.3">&nbsp;</a><h3>LaTeX and BibTex</h3>
<pre class="listing tilde"><code><span class="line"></span>~\cite{Shirley2023RTW1}
<span class="line"></span>
<span class="line"></span><span class="hljs-meta">@misc</span>{Shirley2023RTW1,
<span class="line"></span>   title = {Ray Tracing in One Weekend},
<span class="line"></span>   author = {Peter Shirley, Trevor David Black, Steve Hollasch},
<span class="line"></span>   year = {<span class="hljs-number">2023</span>},
<span class="line"></span>   month = {August},
<span class="line"></span>   note = {\small \texttt{https:<span class="hljs-comment">//raytracing.github.io/books/RayTracingInOneWeekend.html}},</span>
<span class="line"></span>   url = {https:<span class="hljs-comment">//raytracing.github.io/books/RayTracingInOneWeekend.html}</span>
<span class="line"></span>}</code></pre>
<a class="target" name="biblatex">&nbsp;</a><a class="target" name="citingthisbook/snippets/biblatex">&nbsp;</a><a class="target" name="toc16.2.4">&nbsp;</a><h3>BibLaTeX</h3>
<pre class="listing tilde"><code><span class="line"></span>\usepackage{biblatex}
<span class="line"></span>
<span class="line"></span>~\cite{Shirley2023RTW1}
<span class="line"></span>
<span class="line"></span><span class="hljs-meta">@online</span>{Shirley2023RTW1,
<span class="line"></span>   title = {Ray Tracing in One Weekend},
<span class="line"></span>   author = {Peter Shirley, Trevor David Black, Steve Hollasch},
<span class="line"></span>   year = {<span class="hljs-number">2023</span>},
<span class="line"></span>   month = {August},
<span class="line"></span>   url = {https:<span class="hljs-comment">//raytracing.github.io/books/RayTracingInOneWeekend.html}</span>
<span class="line"></span>}</code></pre>
<a class="target" name="ieee">&nbsp;</a><a class="target" name="citingthisbook/snippets/ieee">&nbsp;</a><a class="target" name="toc16.2.5">&nbsp;</a><h3>IEEE</h3>
<pre class="listing tilde"><code><span class="line"></span>“Ray Tracing <span class="hljs-keyword">in</span> One Weekend.” raytracing.github.io/books/RayTracingInOneWeekend.html
<span class="line"></span>(accessed MMM. DD, YYYY)</code></pre>
<a class="target" name="mla:">&nbsp;</a><a class="target" name="citingthisbook/snippets/mla:">&nbsp;</a><a class="target" name="toc16.2.6">&nbsp;</a><h3>MLA:</h3>
<pre class="listing tilde"><code><span class="line"></span>Ray Tracing <span class="hljs-keyword">in</span> One Weekend. raytracing.github.io/books/RayTracingInOneWeekend.html
<span class="line"></span>Accessed DD MMM. YYYY.</code></pre><p>















<link rel="stylesheet" href="Ray%20Tracing%20in%20One%20Weekend_files/book.css">

</p><p>

</p></span><div id="mdContextMenu" style="visibility:hidden"></div><div class="markdeepFooter"><i>formatted by <a href="https://casual-effects.com/markdeep" style="color:#999">Markdeep&nbsp;1.15&nbsp;&nbsp;</a></i><div style="display:inline-block;font-size:13px;font-family:'Times New Roman',serif;vertical-align:middle;transform:translate(-3px,-1px)rotate(135deg);">✒</div></div><div style="position: absolute; width: 0px; height: 0px; overflow: hidden; padding: 0px; border: 0px; margin: 0px;"><div id="MathJax_Font_Test" style="position: absolute; visibility: hidden; top: 0px; left: 0px; width: auto; min-width: 0px; max-width: none; padding: 0px; border: 0px; margin: 0px; white-space: nowrap; text-align: left; text-indent: 0px; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; font-size: 40px; font-weight: normal; font-style: normal; font-size-adjust: none; font-family: MathJax_Size2, sans-serif;"></div></div></body></html>